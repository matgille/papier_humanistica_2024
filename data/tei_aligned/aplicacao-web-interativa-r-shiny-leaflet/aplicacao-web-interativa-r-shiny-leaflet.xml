<TEI xmlns="http://www.tei-c.org/ns/1.0" xmlns:xi="http://www.w3.org/2001/XInclude" xml:id="aplicacao-web-interativa-r-shiny-leaflet" type="translation" xml:base="aplicacao-web-interativa-r-shiny-leaflet/aplicacao-web-interativa-r-shiny-leaflet.xml">
    <teiHeader>
        <fileDesc>
            <titleStmt>
                <title>Criando uma aplicação Web interativa com R e Shiny</title>
                <author role="original_author">Yann Ryan</author>
                <editor role="reviewers">
                    <persName>Amanda Regan</persName>
                    <persName>Nicole Lemire Garlic</persName>
                </editor>
                <author role="translators">Aracele Torres</author>
                <editor role="translation-reviewers">
                    <persName>Joana Malta</persName>
                    <persName>Juciane Pereira</persName>
                </editor>
                <editor role="editors">
                    <persName>Tiago Sousa Garcia</persName>
                    <persName>Alex Wermer-Colan</persName>
                </editor>
            </titleStmt>
            <publicationStmt>
                <distributor>Programming Historian</distributor>
                <date type="translated">10/14/2023</date>
                <idno type="doi">10.46430/phpt0044</idno>
                <date type="published">10/19/2022</date>
            </publicationStmt>
            <sourceDesc>
                <p>Born digital, in a markdown format. Original file: <ref type="original_file" target="#shiny-leaflet-newspaper-map-tutorial"/>.</p>
                <p>There are other translations: <ref target="#creacion-de-aplicacion-shiny"/>
                </p>
            </sourceDesc>
        </fileDesc>
        <profileDesc>
            <abstract>
                <p>Esta lição demonstra como construir um mapa interativo na web usando R e a biblioteca Shiny. Na lição, será projetado e implementado um aplicativo simples, que consiste num controlo deslizante que permite ao usuário selecionar um intervalo de datas e exibir um conjunto de pontos correspondentes num mapa interativo.</p>
            </abstract>
            <textClass>
                <keywords>
                    <term xml:lang="en">mapping</term>
                    <term xml:lang="en">website</term>
                    <term xml:lang="en">r</term>
                    <term xml:lang="en">data-visualization</term>
                </keywords>
            </textClass>
        </profileDesc>
    </teiHeader>
    <text xml:lang="pt">
        <body>
            <div type="2" n="1">
                <head>Introdução</head>
                <p>Esta lição demonstra como criar uma aplicação Web interativa básica usando Shiny. Shiny é uma biblioteca (um conjunto de funções adicionais) para a linguagem de programação R. O seu objetivo é facilitar o desenvolvimento de aplicações Web, que permitem que um usuário interaja com o código R usando elementos da Interface do Utilizador (UI) num navegador Web, como controlos deslizantes, menus suspensos e assim por diante. Na lição, será projetada e implementada uma aplicação simples, consistindo num controlo deslizante que permite ao usuário selecionar um intervalo de datas, que acionará algum código em R e exibirá um conjunto de pontos correspondentes num mapa interativo. </p>
            </div>
            <div type="2" n="2">
                <head>Objetivos da lição</head>
                <p>Nesta lição, irá aprender:</p>
                <list type="unordered">
                    <item>Como criar uma aplicação Shiny interativa básica.</item>
                    <item>Os principais <emph>layouts</emph> e princípios de design da UI Shiny.</item>
                    <item>O conceito e a prática de 'programação reativa', conforme implementado por aplicações Shiny. Especificamente, aprenderá como usar Shiny para 'entender' informações de <emph>input</emph> e como elas estão conectadas aos resultados a serem exibidos na sua aplicação.</item>
                </list>
                <p style="alert alert-info">
Saiba que esta lição não ensina nenhuma codificação em R, além da suficiente para criar a aplicação, nem aborda a publicação da aplicação finalizada na Web. É recomendado um conhecimento básico em linguagem de programação R, particularmente com o <ref target="/pt/licoes/manipulacao-transformacao-dados-R">tidyverse</ref>.
</p>
                <div type="3" n="2.1">
                    <head>Interfaces Gráficas do Utilizador e Humanidades Digitais</head>
                    <p>
                        <ref target="https://perma.cc/8SYH-TX26">Interfaces Gráficas do Utilizador</ref> (em inglês) (GUI, na sigla em inglês) e elementos interativos podem ajudar a tornar certos tipos de trabalhos académicos baseados em dados mais acessíveis ou legíveis. Para dar um exemplo simples, os historiadores que trabalham com um grande volume de dados (<emph>big data</emph>) podem querer demonstrar a mudança numa variável ao longo do tempo. Um mapa interativo com uma linha do tempo ajustável é, em alguns casos, mais fácil de ler e permite mais granularidade do que uma série de mapas estáticos. Permitir que um usuário defina os parâmetros da visualização pode ajudar a evitar alguns dos vieses frequentemente encontrados em visualizações de dados usando séries temporais (por exemplo, desenhar arbitrariamente um mapa por década).</p>
                    <p>Muitos projetos de pesquisa têm elementos interativos como resultados. Alguns exemplos incluem o <ref target="https://tudornetworks.net/">Tudor Networks of Power</ref> (em inglês), uma visualização das redes nos Tudor State Papers, o <ref target="https://livingwithmachines.ac.uk/press-tracer-visualise-newspaper-lineage/">Press Tracer</ref> (em inglês) interativo e (para dar um exemplo usando Shiny) o <ref target="https://utrecht-university.shinyapps.io/GeoNewsMiner/">GeoNewsMiner</ref> (em inglês), que exibe menções geocodificadas num <emph>corpus</emph> de jornais. Aplicações interativas podem ser ferramentas úteis para arquivistas: pesquisadores do National Archives UK <ref target="https://perma.cc/C6U5-PYHF">criaram uma aplicação usando Shiny</ref> (em inglês) que avalia o nível de risco numa coleção digital, por meio de uma série de perguntas respondidas por um usuário.</p>
                    <p>Outro caso de uso típico para aplicações interativas é fornecer uma maneira mais fácil de explorar o seu próprio conjunto de dados, sem nunca pretender que a própria aplicação seja disponibilizada publicamente. Pode-se simplesmente usá-la para encontrar padrões interessantes ou como ponto de partida para pesquisas futuras. Dessa forma, a interatividade pode ser particularmente útil para ajudar a explorar e encontrar padrões em conjuntos de dados de grande escala.</p>
                </div>
                <div type="3" n="2.2">
                    <head>Opções para criar uma GUI</head>
                    <p>Existem várias maneiras de abordar o desenvolvimento de visualizações interativas semelhantes aos exemplos acima. Uma delas é aprender a desenvolver uma ferramenta especializada projetada para manipular páginas da Web em resposta a informações de <emph>input</emph>, como a <ref target="https://perma.cc/BG9S-KPJE">biblioteca Javascript D3</ref> (em inglês). Uma segunda opção seria usar ferramentas baseadas na Web existentes, sejam gerais, como <ref target="https://perma.cc/M6Y9-9ZCP">Tableau</ref> (em inglês) e <ref target="https://perma.cc/TAA2-W7WA">Rawgraphs</ref> (em inglês), ou com uma finalidade mais específica, como <ref target="https://perma.cc/2W5A-PBJU">Palladio</ref> (em inglês) ou <ref target="https://perma.cc/SS9Z-6DAG">Gephi</ref> (em inglês). Uma terceira abordagem pode ser usar <ref target="https://perma.cc/CX23-VTAK">Jupyter notebooks</ref> (em inglês), que permitem compartilhar código interativo e até mesmo, com alguns <ref target="https://perma.cc/ESA5-9MEJ">pacotes adicionais</ref>, criar uma interface do usuário.</p>
                    <p>Esta lição abrange uma quarta abordagem: fazer aplicações interativas com uma GUI usando uma biblioteca para uma linguagem de programação de propósito geral, como <ref target="https://perma.cc/LXR5-BYC9">Bokeh</ref> (em inglês) ou <ref target="https://perma.cc/J7T9-EHTJ">Dash</ref> (em inglês) para Python ou, conforme usado neste tutorial, <ref target="https://perma.cc/CK9W-VRKN">Shiny</ref> (em inglês) para R. Tanto o Python quanto o R são linguagens de programação versáteis, de código aberto, amplamente usadas, com comunidades ativas e com uma enorme variedade de pacotes de terceiros. Há muitas circunstâncias em que faz sentido usá-las como base para aplicações interativas. Em essência, esses pacotes atuam como interfaces interativas para a linguagem de programação, permitindo a criação de controlos deslizantes e outras funcionalidades, que podem ser usadas como informação de <emph>input</emph> para alterar dinamicamente parcelas de código. Na maioria dos casos, estes pacotes não exigem conhecimento técnico do usuário final. Como são projetados para funcionar num navegador, funcionam em qualquer plataforma e são fáceis de compartilhar.</p>
                </div>
                <div type="3" n="2.3">
                    <head>Shiny e programação reativa</head>
                    <p>Shiny é baseada num conceito chamado <ref target="https://perma.cc/SGQ8-BU48">reatividade</ref>. Normalmente, ao codificar, definimos uma variável para um valor específico, digamos <code rend="inline">x = 5</code>. Na <emph>programação reativa</emph>, a variável depende de uma informação de <emph>input</emph> variável, geralmente definida por um usuário (de um controlo deslizante de texto ou lista suspensa, por exemplo). O código 'capta' as alterações nessas variáveis reativas e, sempre que essas variáveis especiais mudam, quaisquer resultados são usados para gerar atualizações automaticamente.</p>
                    <p>No entanto, essa atualização só acontece em <hi rend="bold">contextos reativos</hi>. Shiny tem três contextos reativos importantes: funções <code rend="inline">render*</code>, que são usadas para criar objetos R e exibi-los na aplicação, <code rend="inline">observe({})</code> e <code rend="inline">reactive({})</code>. Neste tutorial, usará a reatividade para criar um <emph>dataframe</emph> resumido de títulos de jornais e suas datas, que é atualizado dinamicamente com base num <emph>input</emph> de datas do usuário. Em outras partes da sua aplicação, usará uma função <code rend="inline">render*</code> para exibir um mapa que captará as alterações nesse <emph>dataframe</emph> reativo e se atualizará quando qualquer uma for encontrada. </p>
                </div>
                <div type="3" n="2.4">
                    <head>Vantagens e desvantagens de usar Shiny</head>
                    <p>A vantagem dessa abordagem é que a criação de aplicações Shiny é <emph>relativamente</emph> simples se já conhece R, e toda a variedade de bibliotecas e recursos da R pode ser aproveitada pela Shiny. Em algumas circunstâncias, isso pode ser preferível a aprender uma nova linguagem do zero. Se tiver experiência com R e pouco conhecimento de Shiny, poderá criar aplicações muito complexas e úteis, abrangendo tudo, desde mapas, análise de redes, <ref target="https://perma.cc/YAX3-RZZP">modelos de aprendizado de máquina</ref> (em inglês) ou painéis de controlo completos com muitas funcionalidades. Se pode programá-las com R, provavelmente pode torná-las interativas com Shiny. O processo de criação de uma interface do usuário Shiny é muito flexível e fácil de personalizar, o que significa que é simples criar uma aplicação num formato que possa ser incorporado num site de projeto usando <emph>iframes</emph>: veja o projeto <ref target="https://www.mappingthegayguides.org/map/">Mapping the Gay Guides</ref> (em inglês) como exemplo.</p>
                    <p>Existem algumas desvantagens que valem a pena considerar. Para aqueles que não têm intenção de usar uma linguagem como R em outros aspectos do seu trabalho, aprendê-la apenas para produzir aplicações Shiny pode ser um exagero. Shiny é de código aberto e de uso gratuito, mas de longe a maneira mais fácil de publicar a sua aplicação finalizada na Web é usando um serviço chamado shinyapps.io. Shinyapps.io é um produto comercial com uma opção gratuita que oferece um número limitado de horas de uso (25 horas, depois disso precisará pagar uma taxa mensal). Pode executar a Shiny no seu próprio servidor (ou através de algo como <ref target="https://perma.cc/DEA2-HCC7">Amazon Web Services</ref> (em inglês)), mas é um processo bastante complicado e requer conhecimento avançado de configuração de servidores Web. Deve ter isso em mente se estiver pensando em usar Shiny para uma saída voltada para o público, principalmente se achar que pode ter muito tráfego e uso pesado.</p>
                </div>
            </div>
            <div type="2" n="3">
                <head>Contexto histórico e dados</head>
                <p>A biblioteca nacional do Reino Unido, a <ref target="https://perma.cc/C7VP-VBTS">British Library</ref> (em inglês) possui, de longe, a maior coleção de jornais britânicos e irlandeses do mundo. A primeira publicação de notícias em série na sua coleção é de 1621 e continua a ser coletada até hoje. O catálogo da biblioteca contém uma riqueza de informações sobre os seus acervos jornalísticos, que foram disponibilizadas publicamente na forma de metadados estruturados. Esses metadados são, essencialmente, uma lista de títulos de jornais, contendo as datas e locais de publicação de cada um, mudanças e fusões de títulos e informações sobre substitutos de microfilmes e acervos digitais.</p>
                <p>Esses metadados estruturados são o recurso usado nesta lição. Rastrear os metadados dessa coleção é uma forma dos historiadores mapearem o crescimento e as mudanças na imprensa ao longo do tempo e em diferentes regiões. Além disso, pode ajudar a entender mais sobre o próprio acervo da British Library, incluindo as suas lacunas, vieses, estratégias de digitalização e pontos cegos. Os dados podem até indicar algo sobre a mudança demográfica e industrialização da Grã-Bretanha, bem como desenvolvimentos nas tecnologias de comunicação (por exemplo, comboios e, depois, telégrafos tornaram possível ter imprensas regionais e locais).</p>
                <p>A indústria jornalística (e, também, a coleção) cresceu de um pequeno número de títulos publicados em Londres no início do século XVII para uma florescente imprensa provincial semanal e diária no século XVIII e, depois, para uma grande imprensa local nos séculos XIX e XX. Durante grande parte do século XVIII, um imposto foi adicionado a cada exemplar de jornal, tornando-o caro e disponível apenas para a elite. No século seguinte, este foi revogado e a imprensa começou —ainda que lentamente— a refletir mais plenamente sobre as aspirações e a diversidade do país. A aplicação criada neste tutorial —um mapa interativo de títulos publicados, com um controlo deslizante de tempo selecionado pelo usuário— é uma maneira útil de visualizar essas mudanças.</p>
                <div type="3" n="3.1">
                    <head>Obtendo os dados</head>
                    <p>Para este tutorial, será preciso descarregar dois ficheiros: primeiro, uma lista de títulos de jornais britânicos e irlandeses, depois disso chamada de 'lista de títulos'; e, segundo, um conjunto de dados auxiliar com nomes de lugares e coordenadas, que permitirá a correspondência dos lugares encontrados na lista de títulos aos locais num mapa, a que chamaremos de 'lista de coordenadas'.</p>
                    <list type="unordered">
                        <item>
                            <p>Para obter a lista de títulos, visite o <ref target="https://bl.iro.bl.uk/concern/datasets/7da47fac-a759-49e2-a95a-26d49004eba8?locale=en">repositório da British Library</ref> (em inglês). A lista está disponível no repositório em dois formatos: um ficheiro <code rend="inline">.zip</code> contendo um <code rend="inline">.csv</code> e um readme, ou uma folha de cálculo do Excel. Para esta lição, trabalharemos com o formato <code rend="inline">.csv</code>. Descarregue o ficheiro <code rend="inline">.zip</code> e descompacte-o. Como alternativa, pode <ref target="/assets/shiny-leaflet-newspaper-map-tutorial-data/newspaper_coordinates.csv">descarregar aqui</ref> uma cópia do conjunto de dados usado neste tutorial. </p>
                        </item>
                        <item>
                            <p>A lista de coordenadas está <ref target="/assets/shiny-leaflet-newspaper-map-tutorial-data/newspaper_coordinates.csv">disponível aqui</ref>. Descarregue este ficheiro de coordenadas. Não importa onde o coloca agora, pois posteriormente na lição moverá os dois ficheiros para uma nova pasta.</p>
                        </item>
                    </list>
                </div>
                <div type="3" n="3.2">
                    <head>Entender a lista de títulos</head>
                    <p>Feito isto, dê uma olhada no conjunto de dados da lista de títulos (pode abri-lo no R, num programa de folha de cálculo ou um editor de texto). A lista de títulos foi produzida pela British Library e publicada no seu repositório institucional. Contém metadados retirados do catálogo da biblioteca, de todos os jornais publicados na Grã-Bretanha e Irlanda até o ano de 2019, um total de cerca de 24.000 títulos. Há mais informações disponíveis num artigo de dados publicado.<ref type="footnotemark" target="#pt_note_1"/>
                    </p>
                    <p>O ficheiro <code rend="inline">.csv</code> (<code rend="inline">BritishAndIrishNewspapersTitleList_20191118.csv</code>) contém vários campos para cada título, incluindo o nome da publicação, nomes de títulos posteriores e anteriores, vários campos para a cobertura geográfica, a primeira e a última datas catalogadas e algumas outras informações.</p>
                    <p>Vale a pena ler o ficheiro <code rend="inline">README</code> que acompanha o ficheiro <code rend="inline">.zip</code>. Este explica que existem vários campos previstos para a cobertura geográfica, pois os registros foram catalogados durante um longo período de tempo durante o qual os padrões e convenções de catalogação mudaram. O objetivo aqui é mapear os jornais num nível de ponto geográfico, ou seja, no nível de povoado, vila ou cidade, em vez de região ou país. Existem dois campos onde podemos encontrar os pontos geográficos potencialmente relevantes para mapear: <code rend="inline">place_of_publication</code> e <code rend="inline">coverage_city</code>. Parecem coisas diferentes (um jornal poderia ser publicado num lugar, mas ter cobertura geográfica noutro, talvez se o primeiro não tivesse uma imprensa jornalística adequada), mas não é assim que têm sido usados pelos catalogadores na prática. O ficheiro <code rend="inline">README</code> diz que este último (<code rend="inline">coverage_city</code>) contém dados mais completos, então é esse que usará para mapear os títulos.</p>
                    <p>Os outros dois campos de interesse são a primeira e a última datas catalogadas. O readme também nos diz que a biblioteca não tem cobertura completa, embora tenha a maioria dos títulos da década de 1840 em diante, e efetivamente todos os títulos a partir de 1869, quando o Depósito Legal<ref type="footnotemark" target="#pt_note_2"/> foi introduzido. Isso significa que a coleção não possui, necessariamente, todos os números de um jornal <emph>entre</emph> a primeira e a última data catalogadas pela Biblioteca. </p>
                    <p>Neste tutorial, será criado um controlo deslizante interativo que permitirá ao usuário escolher uma data de início e de término. Isso pode ser usado para filtrar os dados de duas maneiras: para todos os jornais publicados <emph>em algum momento</emph> entre essas duas datas, ou pode mapear todos os jornais publicados <emph>pela primeira vez</emph> entre duas datas específicas. Como o primeiro cenário super-representaria as coleções da biblioteca, para simplificar as coisas, neste tutorial trabalhará na visualização dos jornais publicados dentro de um determinado período de tempo.</p>
                </div>
            </div>
            <div type="2" n="4">
                <head>Configurando o seu ambiente de codificação e criando a aplicação Shiny</head>
                <p>Para demonstrar como Shiny funciona, neste tutorial será utilizado esse conjunto de dados de títulos de jornais, locais de publicação e datas e o transformará numa aplicação interativa básica. No total, há cinco tarefas curtas de codificação que a sua aplicação precisa de realizar:</p>
                <list type="unordered">
                    <item>Carregar os dois conjuntos de dados necessários</item>
                    <item>Criar uma interface de usuário</item>
                    <item>Criar um conjunto de dados "reativo" de lugares, uma contagem de ocorrências e as suas coordenadas geográficas</item>
                    <item>Transformar isto num conjunto de dados geográfico especial chamado de objeto de recursos simples</item>
                    <item>Criar um mapa interativo usando outra biblioteca R chamada <ref target="https://perma.cc/RW6M-ZCG2">Leaflet</ref> (em inglês)</item>
                </list>
                <p>No entanto, antes de chegar a estes pontos é preciso configurar o ambiente correto e criar uma nova aplicação Shiny.</p>
                <div type="3" n="4.1">
                    <head>Instalar o R e o RStudio</head>
                    <p>Instale as <ref target="https://cran.rstudio.com/">últimas versões do R</ref> (em inglês) e do <ref target="https://www.rstudio.com/products/rstudio/download/">RStudio</ref> (em inglês) na sua máquina local para concluir esta lição. O R tem uma IDE (Ambiente de Desenvolvimento Integrado) muito popular (embora separado) chamado RStudio, que é frequentemente usado junto com o R, pois fornece um grande conjunto de recursos para tornar a codificação na linguagem mais conveniente. Usaremos ao longo da lição. </p>
                    <p>Lições anteriores do <emph>Programming Historian</emph> abordaram como <ref target="/pt/licoes/nocoes-basicas-R-dados-tabulares">trabalhar com R</ref> e <ref target="/pt/licoes/manipulacao-transformacao-dados-R">trabalhar com o tydeverse</ref>. Seria útil passar por essas lições primeiro, para aprender os fundamentos da instalação do R e usar o tydeverse para organizar os dados.</p>
                </div>
                <div type="3" n="4.2">
                    <head>Criar um novo projeto no RStudio</head>
                    <p>Depois de instalar o R e o RStudio, abra o último e crie um novo projeto para trabalhar na sua aplicação. Para fazer isto, abra a janela 'Create a Project' (em português, criar um novo projeto) usando o menu (File-&gt;New Project) (em português, Ficheiro-&gt;Novo Projeto). Selecione 'New Directory' (em português, novo diretório), e então 'New Project' (em português, novo projeto). Nomeie o diretótio do seu projeto, marque a opção 'Use renv with the project' (em português, use renv com o projeto), e clique em 'Create Project' (em português, criar projeto).</p>
                    <p>Antes de continuar, instale os quatro pacotes necessários para concluir o tutorial, caso ainda não os tenha. Três deles podem ser instalados diretamente pelo RStudio. Na linha de comandos do R ou num script R separado, execute os seguintes comandos:</p>
                    <ab>
                        <code xml:id="code_aplicacao-web-interativa-r-shiny-leaflet_0" corresp="code_aplicacao-web-interativa-r-shiny-leaflet_0.txt" rend="block"/>
                    </ab>
                    <p>Dependendo da configuração do seu sistema, o quarto pacote, <code rend="inline">sf</code>, pode exigir etapas adicionais antes de ser instalado. Detalhes sobre isso podem ser encontrados na <ref target="https://github.com/r-spatial/sf">página do pacote no Github</ref> (em inglês). Verifique as instruções no cabeçalho <hi rend="bold">Installing</hi> (em português, instalar) no ficheiro Readme vinculado ao Github. Usuários de Mac em particular podem precisar de instalar uma biblioteca de terceiros, <code rend="inline">gdal</code>, antes que a instalação funcione, usando o <ref target="https://brew.sh/pt/">Homebrew</ref>.</p>
                </div>
                <div type="3" n="4.3">
                    <head>Criar uma aplicação Shiny vazia</head>
                    <p>Uma aplicação Shiny consiste num ficheiro de script com um nome de ficheiro especial reservado, <code rend="inline">app.R</code>, que diz ao RStudio para tratar esse script como uma aplicação e abri-lo num navegador Web quando for executado. Nesta primeira seção, será criado um aplicativo que carregará as bibliotecas e conjuntos de dados relevantes e exibirá uma mensagem de teste 'Olá mundo'. Para isso, execute os seguintes passos:</p>
                    <p>1. Configure uma pasta da aplicação</p>
                    <p>É uma boa prática colocar todos os ficheiros necessários para a aplicação numa pasta própria, dentro do projeto RStudio. Faça isso criando uma nova pasta chamada 'jornal-app' dentro da pasta do projeto RStudio que acabou de criar. Coloque os ficheiros descarregados acima (<code rend="inline">BritishAndIrishNewspapersTitleList_20191118.csv</code> e <code rend="inline">newspaper_coordinates.csv</code>) nesta nova pasta.</p>
                    <p>2. Crie o ficheiro app.R</p>
                    <p>Com o RStudio aberto, clique em file-&gt; new file -&gt; R Script. Use o menu ou command/ctrl + s para salvar o ficheiro. Navegue até à nova pasta que acabou de criar e salve o ficheiro lá, digitando <code rend="inline">app.R</code> como o nome do ficheiro. Agora deve ter os seguintes ficheiros na pasta 'jornal-app' que acabou de criar:</p>
                    <figure>
                        <desc>Figura 1. Captura de tela da pasta da aplicação mostrando os ficheiros necessários.</desc>
                        <figDesc>Uma captura de tela do painel de ficheiros R, mostrando os ficheiros necessários. Há três ficheiros no total, App.R, o csv dos jornais britânicos e irlandeses, e o csv das coordenadas do jornal.</figDesc>
                        <graphic url="pt-tr-aplicacao-web-interativa-r-shiny-leaflet-01.png"/>
                    </figure>
                    <p>3. Carregue as bibliotecas relevantes</p>
                    <p style="alert alert-warning">
É importante notar que, ao contrário de muitos tutoriais, o código que está prestes a inserir não funcionará se for executado linha por linha, mas somente quando o script `app.R` for executado de dentro do RStudio.
</p>
                    <p>A primeira coisa que a aplicação precisará de fazer é preparar e carregar os dados. Isto é feito dentro do script <code rend="inline">app.R</code>, mas fora da interface do usuário e dos elementos do servidor que será criado num momento. Primeiro, carregue todas as bibliotecas que precisa de usar digitando o seguinte:</p>
                    <ab>
                        <code xml:id="code_aplicacao-web-interativa-r-shiny-leaflet_1" corresp="code_aplicacao-web-interativa-r-shiny-leaflet_1.txt" rend="block"/>
                    </ab>
                    <p>4. Carregue os conjuntos de dados</p>
                    <p>Em seguida, a aplicação deve carregar a lista de títulos e os ficheiros de lista de coordenadas como <emph>dataframes</emph> chamados <code rend="inline">title_list</code> e <code rend="inline">coordinates_list</code>, respectivamente. Adicione a seguinte linha ao seu script app.R, que deve ser exibido no painel superior esquerdo do RStudio. Observe que, como o diretório de trabalho é diferente do diretório da sua aplicação, estes comandos só funcionarão quando executar a própria aplicação.</p>
                    <ab>
                        <code xml:id="code_aplicacao-web-interativa-r-shiny-leaflet_2" corresp="code_aplicacao-web-interativa-r-shiny-leaflet_2.txt" rend="block"/>
                    </ab>
                </div>
                <div type="3" n="4.4">
                    <head>Adicionar os elementos Shiny necessários</head>
                    <p>Para transformar isto numa aplicação Shiny, este script <code rend="inline">app.R</code> precisa de três elementos:</p>
                    <p>1.   A <hi rend="bold">UI</hi>, onde a aparência visual da aplicação será armazenada.</p>
                    <p>2.   O <hi rend="bold">servidor</hi> com o código usado.</p>
                    <p>3.   O comando para executar a própria aplicação.</p>
                    <p>Em seguida, criará cada um deles de cada vez.</p>
                    <p>1. Crie um elemento de UI vazio</p>
                    <p>A interface do usuário (UI) é um elemento que conterá vários comandos especiais de Shiny para definir a aparência da aplicação. Examinaremos as opções específicas abaixo, mas geralmente você define um tipo de página e os vários componentes da interface do usuário são aninhados nesse primeiro elemento: primeiro, um tipo de <emph>layout</emph>, dentro deste, elementos de <emph>layout</emph> específicos; e, finalmente, dentro deles, os vários componentes da própria aplicação.</p>
                    <p>O tipo que usará é chamado <code rend="inline">fluidPage()</code>, uma página —que redimensiona dinamicamente dependendo do tamanho da janela do navegador— contendo um <emph>layout</emph> fluido de linhas que, por sua vez, contêm colunas.</p>
                    <p>O primeiro passo é criar todos os elementos básicos necessários para uma aplicação, antes de preenchê-los com os componentes necessários. Para começar, crie um elemento de UI em branco definindo a variável <code rend="inline">ui</code> para o elemento <code rend="inline">fluidPage()</code>. Para que saiba que sua aplicação está em execução, quando testá-la pela primeira vez, adicione uma mensagem simples 'Olá mundo' ao elemento de UI. Adicione o seguinte código em seu script <code rend="inline">app.R</code>:</p>
                    <ab>
                        <code xml:id="code_aplicacao-web-interativa-r-shiny-leaflet_3" corresp="code_aplicacao-web-interativa-r-shiny-leaflet_3.txt" rend="block"/>
                    </ab>
                    <p>2. Crie um elemento do servidor</p>
                    <p>Em seguida é a parte do servidor. O servidor é criado como uma função R com dois argumentos, <code rend="inline">input</code> e <code rend="inline">output</code> (por enquanto, não precisa se preocupar com o que os argumentos de <emph>input</emph> e <emph>output</emph> fazem, desde que estejam lá).<ref type="footnotemark" target="#pt_note_3"/> Em R, uma função é feita usando o comando <code rend="inline">function(){}</code>, especificando os argumentos entre parênteses e, em seguida, o código da função entre chaves. Todo o código para a lógica da aplicação ficará entre essas duas chaves. </p>
                    <p>Especifique a parte do servidor usando o seguinte código:</p>
                    <ab>
                        <code xml:id="code_aplicacao-web-interativa-r-shiny-leaflet_4" corresp="code_aplicacao-web-interativa-r-shiny-leaflet_4.txt" rend="block"/>
                    </ab>
                    <p>3. Adicione o comando para executar a aplicação</p>
                    <p>Por fim, adicione o comando para executar a própria aplicação. Este é outro comando especial de Shiny, <code rend="inline">shinyApp()</code>, com a UI e os itens do servidor que acabou de criar como argumentos.</p>
                    <p>
                        <code rend="inline">shinyApp(ui, server)</code>
                    </p>
                    <p>O ficheiro <code rend="inline">app.R</code> completo deve conter agora as seguintes linhas:</p>
                    <ab>
                        <code xml:id="code_aplicacao-web-interativa-r-shiny-leaflet_5" corresp="code_aplicacao-web-interativa-r-shiny-leaflet_5.txt" rend="block"/>
                    </ab>
                </div>
                <div type="3" n="4.5">
                    <head>Teste a sua nova aplicação</head>
                    <p>Depois de criar estes itens, salve novamente o ficheiro <code rend="inline">app.R</code>. Agora, o RStudio reconhecerá como um aplicativo Shiny e os ícones na parte superior do painel mudarão, aparecendo a opção 'Run App' (Figura 2). Se clicar, executará a aplicação numa nova janela usando o navegador embutido do RStudio.</p>
                    <figure>
                        <desc>Figura 2: Captura de tela do painel de controlo com o botão Run App destacado.</desc>
                        <figDesc>Captura de tela do painel de controlo com o botão Run App destacado com um retângulo vermelho.</figDesc>
                        <graphic url="pt-tr-aplicacao-web-interativa-r-shiny-leaflet-02.png"/>
                    </figure>
                    <p>Deve ver uma página da Web em branco com 'Olá mundo' exibido no canto superior esquerdo. Também notará que, enquanto a aplicação está em execução, não pode executar nenhum código no RStudio: a consola de comandos do R surge como 'ocupado'. Para parar a aplicação, basta fechar a página do navegador apenas aberta. Também pode usar a opção 'Open in Browser' para testar a aplicação no seu navegador padrão. </p>
                </div>
            </div>
            <div type="2" n="5">
                <head>Codificar a aplicação</head>
                <div type="3" n="5.1">
                    <head>Desenhar a Interface do Usuário</head>
                    <p>A UI Shiny utiliza o formato <ref target="https://perma.cc/BK3T-V6HP">Bootstrap</ref> (em inglês). A interface do usuário é construída em torno de um sistema de grade de linhas e colunas, permitindo <emph>layouts</emph> personalizáveis. Consulte a <ref target="https://perma.cc/9U3B-AHF6">documentação oficial</ref>(em inglês)  para obter mais informações sobre as várias opções e como criar esses <emph>layouts</emph>. Para esta aplicação, usaremos um <emph>layout</emph> conhecido como <code rend="inline">sidebarLayout</code>, que consiste num título, uma coluna de barra lateral à esquerda da página para informação de <emph>input</emph> do usuário e um painel principal para exibir os resultados. O diagrama de <emph>wireframe</emph> a seguir deve ajudá-lo a visualizar o <emph>layout</emph>: </p>
                    <figure>
                        <desc>Figura 3. Diagrama de *wireframe* exibindo a estrutura do _layout_ de barra lateral.</desc>
                        <figDesc>Imagem que descreve o layout da interface a ser desenhada</figDesc>
                        <graphic url="pt-tr-aplicacao-web-interativa-r-shiny-leaflet-03.png"/>
                    </figure>
                    <p>O próximo passo é preencher o elemento <code rend="inline">ui</code> com os componentes necessários para apresentar este <emph>layout</emph> de barra lateral. Primeiro, use o elemento <code rend="inline">titlePanel</code> para dar um título à sua aplicação e adicione o elemento da barra lateral. Dentro do objeto <code rend="inline">fluidPage()</code>, exclua a mensagem 'Olá mundo' e substitua pelo seguinte: </p>
                    <ab>
                        <code xml:id="code_aplicacao-web-interativa-r-shiny-leaflet_6" corresp="code_aplicacao-web-interativa-r-shiny-leaflet_6.txt" rend="block"/>
                    </ab>
                    <p>Depois disso, preencha o <emph>layout</emph> com partes específicas da página Web, componentes chamados <code rend="inline">sidebarPanel()</code> e <code rend="inline">mainPanel()</code>. Faça-o colocando-os dentro de <code rend="inline">sidebarLayout()</code>.</p>
                    <p style="alert alert-info">
Como o código da UI Shiny geralmente acaba com muitos parênteses aninhados, dividi-los em duas linhas, como no trecho de código abaixo, pode facilitar a leitura, mas não é necessário para que o código funcione.
</p>
                    <p>Agora, o elemento completo da UI deve ter esta aparência:</p>
                    <ab>
                        <code xml:id="code_aplicacao-web-interativa-r-shiny-leaflet_7" corresp="code_aplicacao-web-interativa-r-shiny-leaflet_7.txt" rend="block"/>
                    </ab>
                    <p>Notará que estes comandos aninhados correspondem ao <emph>layout</emph> do diagrama de <emph>wireframe</emph> na Figura 3 acima.</p>
                </div>
                <div type="3" n="5.2">
                    <head>Adicionar um 'Widget': o controlo sliderInput</head>
                    <p>Em Shiny, os usuários atualizam os valores usando vários controlos interativos e personalizáveis conhecidos como 'widgets'. A lista completa pode ser encontrada na <ref target="https://perma.cc/GW78-FQEJ">Galeria de widgets Shiny</ref> (em inglês). O widget que vai usar chama-se <code rend="inline">sliderInput()</code>. Este exibirá uma barra deslizante interativa com um grande número de opções, como o(s) valor(es) mínimo(s), máximo(s) e inicial(is). Também pode definir os incrementos e o formato dos números (digite <code rend="inline">?sliderInput</code> na linha de comandos para obter uma lista completa de opções e explicações). Aqui fará um com um ano mínimo de 1620 (o ponto de dados mais antigo na lista de títulos) e um máximo de 2019 (o mais recente). </p>
                    <p>O valor inicial (padrão) pode ser um único número ou um vetor de dois números. Se o último for usado, o controlo deslizante terá duas extremidades, com um primeiro e um segundo valor. Este é o que queremos usar, para que o usuário possa especificar um intervalo de anos. </p>
                    <p>O código a seguir criará um controlo deslizante com duas extremidades arrastáveis, definidas por padrão para 1700 e 1750:</p>
                    <ab>
                        <code xml:id="code_aplicacao-web-interativa-r-shiny-leaflet_8" corresp="code_aplicacao-web-interativa-r-shiny-leaflet_8.txt" rend="block"/>
                    </ab>
                    <p>Insira este código entre os parênteses do comando <code rend="inline">sidebarPanel = sidebarPanel( )</code> no seu script. Se se perder ou precisar de identificar e corrigir erros, dê uma olhada no <ref target="#c%C3%B3digo-final">código final</ref> fornecido no fim desta lição. </p>
                    <p>Agora, execute o aplicativo para ver a aparência do controlo deslizante. Verá um painel cinza à esquerda (o painel da barra lateral), contendo o 'widget' deslizante. Se passar o rato sobre o controlo deslizante, notará que pode arrastar cada extremidade (para selecionar um tamanho de intervalo) e também pode arrastar o meio (o que moverá o controlo deslizante inteiro sobre uma janela do tamanho de intervalo selecionado). </p>
                    <figure>
                        <desc>Figura 4. Gif animado demonstrando a funcionalidade do 'widget' de _input_ do controlo deslizante.</desc>
                        <figDesc>Gif animado demonstrando a funcionalidade do widget de input do controlo deslizante. Um cursor clica em cada extremidade do controlo deslizante para redimensioná-lo e depois o arrasta.</figDesc>
                        <graphic url="pt-tr-aplicacao-web-interativa-r-shiny-leaflet-04.gif"/>
                    </figure>
                </div>
                <div type="3" n="5.3">
                    <head>Colocar o leafletOutput no elemento mainPanel</head>
                    <p>Em Shiny, precisa de dar informação à interface do usuário que deve exibir um resultado (algum tipo de elemento R, como uma tabela de dados ou um gráfico, ou algo tão simples quanto uma linha de texto) criada no código do servidor. Isso é feito criando um elemento na interface do usuário da família de comandos <code rend="inline">*Output</code>. Cada elemento R que pode exibir em Shiny tem seu próprio comando <code rend="inline">*Output</code>: aqui, usará <code rend="inline">leafletOutput()</code>, que diz à interface do usuário para criar um mapa com leaflet. <code rend="inline">leafletOutput</code> tem um argumento obrigatório: seu ID do resultado. Esse rótulo será usado para corresponder o elemento da interface do usuário ao objeto do mapa real que, posteriormente, criará no código do servidor. Defina este rótulo como 'map'. Insira o seguinte código entre os parênteses de <code rend="inline">mainPanel()</code>:</p>
                    <ab>
                        <code xml:id="code_aplicacao-web-interativa-r-shiny-leaflet_9" corresp="code_aplicacao-web-interativa-r-shiny-leaflet_9.txt" rend="block"/>
                    </ab>
                </div>
            </div>
            <div type="2" n="6">
                <head>Criar a lógica do servidor</head>
                <p>Em seguida, precisa de escrever a lógica para criar um objeto que será exibido na interface do usuário. Isto tem duas partes. Primeiro, criará um <emph>elemento reativo</emph> que, como explicado acima, é um objeto especial que captará as alterações no <emph>input</emph> do usuário e se refaz conforme necessário. Segundo, criará um <emph>resultado</emph> que conterá o próprio mapa interativo. </p>
                <div type="3" n="6.1">
                    <head>Criar o reativo para o mapa leaflet</head>
                    <p>Primeiro, crie o elemento reativo. Nesse caso, será um tipo especial de conjunto de dados geográficos chamado <emph>objeto de recursos simples</emph>. Este formato foi abordado numa lição anterior do <emph>The Programming Historian</emph>, <ref target="/en/lessons/geospatial-data-analysis">'Using Geospatial Data to Inform Historical Research in R'</ref> (em inglês). Sempre que o usuário alterar as variáveis no controlo deslizante de data de alguma forma, seu aplicativo será executado por meio de um conjunto de comandos:</p>
                    <list type="unordered">
                        <item>
                            <p>Filtrar a lista de títulos para o conjunto de datas selecionadas pelo usuário</p>
                        </item>
                        <item>
                            <p>Contar o número de vezes que cada lugar ocorre nesta lista filtrada</p>
                        </item>
                        <item>
                            <p>Associar os lugares a um conjunto de coordenadas usando uma junção</p>
                        </item>
                        <item>
                            <p>Converter o resultado num objeto de recursos simples, uma estrutura de dados que armazena informações geográficas</p>
                        </item>
                    </list>
                    <p>Para criar um objeto reativo chamado <code rend="inline">map_df</code>, adicione o seguinte código dentro das chaves do componente do servidor:</p>
                    <ab>
                        <code xml:id="code_aplicacao-web-interativa-r-shiny-leaflet_10" corresp="code_aplicacao-web-interativa-r-shiny-leaflet_10.txt" rend="block"/>
                    </ab>
                    <p>Este código executa as seguintes funções:</p>
                    <list type="ordered">
                        <item>
                            <p>Filtra o conjunto de dados de jornais usando o comando <code rend="inline">filter()</code>, usando os valores do widget <code rend="inline">sliderInput</code>. Esses valores são acedidos usando <code rend="inline">input$&lt;LABELNAME&gt;</code>, que neste caso é <code rend="inline">input$years</code>, embora haja uma complicação adicional a ser observada. Anteriormente definiu o valor de <code rend="inline">sliderInput</code> para um vetor de comprimento dois, para que um intervalo pudesse ser selecionado? Os dois números deste intervalo são armazenados em <code rend="inline">input$years[1]</code> e <code rend="inline">input$years[2]</code>. Estes são os valores a que precisa de aceder para filtrar os dados. A função <code rend="inline">filter</code> retorna linhas de um <emph>dataframe</emph> onde um conjunto específico de condições é verdadeiro: neste caso, onde a coluna <code rend="inline">first_date_held</code> é maior que o primeiro valor e menor que o segundo. </p>
                        </item>
                        <item>
                            <p>
                                <code rend="inline">count()</code> neste conjunto de dados filtrado para produzir um <emph>dataframe</emph> de cada cidade e uma contagem das vezes em que ocorrem. Especifica o nome da nova coluna que contém as contagens com o argumento <code rend="inline">name =</code>. </p>
                        </item>
                        <item>
                            <p>Faz uma junção (um tipo de combinação de dois <emph>dataframes</emph> com base numa chave comum) para combinar o <emph>dataframe</emph> de coordenadas ao <emph>dataframe</emph> de contagem usando <code rend="inline">left_join()</code>. Deve especificar a chave a partir da qual será feita a junção, que é <code rend="inline">coverage_city</code>. </p>
                        </item>
                        <item>
                            <p>Há um pequeno número de títulos de jornais sem coordenadas de latitude/longitude, o que causaria um erro ao criar o objeto geográfico. Filtre-os com <code rend="inline">filter(!is.na(lat) &amp; !is.na(lng))</code>
                            </p>
                        </item>
                        <item>
                            <p>Finalmente, transforme-os num objeto de recursos simples, usando <code rend="inline">st_as_sf()</code>. Para fazê-lo, especifique as colunas de coordenadas de latitude/longitude que devem ser adotadas usando <code rend="inline">coords</code> e, em seguida, usa <code rend="inline">st_set_crs</code> para definir um sistema de referência de coordenadas.<ref type="footnotemark" target="#pt_note_4"/>
                            </p>
                        </item>
                    </list>
                    <p>Este <emph>dataframe</emph> de informações geográficas pode ser acedido em qualquer contexto reativo por Shiny usando <code rend="inline">map_df()</code> e pode ser usado por vários resultados ao mesmo tempo: por exemplo, pode criar uma aplicação que exibe um mapa e um gráfico de barras, cada um usando o mesmo objeto reativo.</p>
                </div>
                <div type="3" n="6.2">
                    <head>Criar o mapa leaflet</head>
                    <p>A última coisa a fazer é criar o próprio mapa. Isto é feito usando a biblioteca <code rend="inline">leaflet</code>, que permite produzir mapas interativos e com zoom. Funciona particularmente bem com Shiny. Adicione o seguinte código dentro do elemento <code rend="inline">server()</code>, logo abaixo do elemento reativo <code rend="inline">map_df</code>: </p>
                    <ab>
                        <code xml:id="code_aplicacao-web-interativa-r-shiny-leaflet_11" corresp="code_aplicacao-web-interativa-r-shiny-leaflet_11.txt" rend="block"/>
                    </ab>
                    <p>Há algumas coisas bastante complexas acontecendo aqui, por isso é importante analisar o código em detalhe. Em Shiny, cria reatividade conectando <hi rend="bold">inputs</hi> a <hi rend="bold">outputs</hi>. <hi rend="bold">Inputs</hi>, neste contexto, são as variáveis ajustadas pelo usuário. Recorda-se do <code rend="inline">sliderInput()</code> que criou na interface do usuário acima, com o rótulo 'years'? Já vimos que o seu valor é armazenado pela Shiny na variável <code rend="inline">input$years</code>. <hi rend="bold">Outputs</hi> são as expressões R que dizem a Shiny o que exibir na interface do usuário e são criadas, no servidor, com o nome da variável <code rend="inline">output$*</code>. Os <hi rend="bold">outputs</hi> precisam de corresponder a um elemento <code rend="inline">*Output</code> da interface do usuário. Nesta última criou um <hi rend="bold">output</hi> leaflet com o rótulo <code rend="inline">map</code> usando o código <code rend="inline">leafletOutput('map')</code>. Isto deve corresponder a um <hi rend="bold">output</hi> no servidor chamado <code rend="inline">output$map</code>. </p>
                    <p>Por sua vez, esta variável <code rend="inline">output$map</code> deve ser definida para uma função Shiny <code rend="inline">render*</code>, que informa a Shiny que tipo de objeto deve ser apresentado na interface do usuário. O que precisamos é chamado <code rend="inline">renderLeaflet</code>, que diz à interface do usuário para gerar um mapa criado pela biblioteca leaflet. O objeto <code rend="inline">renderLeaflet</code> tem parênteses e chaves, assim como o objeto reativo que criamos acima. </p>
                    <p>O próprio mapa leaflet será criado dentro disto. Primeiro, adicione a função <code rend="inline">leaflet()</code>. Em seguida, adicione os blocos padrão (as imagens de mapa com zoom) usando <code rend="inline">addTiles()</code>. Depois, defina a posição padrão do mapa e amplie para Grã-Bretanha e Irlanda usando o comando <code rend="inline">setView(lng = -5, lat = 54, zoom = 5)</code>. </p>
                </div>
                <div type="3" n="6.3">
                    <head>Desenhar pontos usando o <emph>dataframe</emph> reativo</head>
                    <p>Faça uma pausa aqui e execute a aplicação novamente. Se tudo correr bem, deverá ver um mapa interativo da Grã-Bretanha e da Irlanda à direita do controlo deslizante. Pode ampliar e deslizar, mas não mais do que isso. O mapa precisa de ser preenchido com pontos representando a contagem de títulos de cada lugar. </p>
                    <figure>
                        <desc>Figura 5. Captura de tela da aplicação com mapa leaflet e widget de controlo deslizante.</desc>
                        <figDesc>Captura de tela da aplicação com mapa Leaflet e o widget de controlo deslizante.</figDesc>
                        <graphic url="pt-tr-aplicacao-web-interativa-r-shiny-leaflet-05.png"/>
                    </figure>
                    <p>Para fazer isso, use o comando <code rend="inline">addCircleMarkers()</code>, que adiciona uma camada gráfica de círculos ao mapa leaflet, com coordenadas retiradas de um objeto de dados geográficos. Usando o encadeamento de funções <code rend="inline">%&gt;%</code> (pipe), adicione o seguinte após a função <code rend="inline">addCircleMarkers()</code> (veja o <ref target="#c%C3%B3digo-final">código final</ref> se não tiver certeza de onde isto deve ir): </p>
                    <ab>
                        <code xml:id="code_aplicacao-web-interativa-r-shiny-leaflet_12" corresp="code_aplicacao-web-interativa-r-shiny-leaflet_12.txt" rend="block"/>
                    </ab>
                    <p>Aqui está a parte crucial: em vez de uma fonte de dados fixa, o comando acima especifica que <code rend="inline">addCircleMarkers</code> deve usar o <emph>dataframe</emph> reativo que criámos anteriormente, com o argumento <code rend="inline">data = map_df()</code>. Observe que, diferentemente das variáveis regulares em R, esta tem um par de parênteses depois, denotando que é uma variável reativa especial. Cada vez que a aplicação percebe uma alteração nesse objeto reativo, ele redesenha o mapa com os novos dados. </p>
                    <p>Neste ponto, também pode definir o raio dos círculos para corresponder à coluna que contém a contagem de títulos para cada lugar, usando <code rend="inline">radius = ~sqrt(titles)</code>. Usamos a raiz quadrada, porque torna a área dos círculos corretamente proporcional à contagem. </p>
                </div>
                <div type="3" n="6.4">
                    <head>Teste a aplicação</head>
                    <p>É hora de executar a aplicação novamente. Agora, deve haver círculos de tamanhos variados espalhados pelo mapa. Tente mover ou arrastar os controlos deslizantes - o mapa deve ser atualizado a cada alteração. Parabéns, fez a sua primeira aplicação Shiny! </p>
                    <figure>
                        <desc>Figura 6. Gif animado monstrando a atualização do mapa leaflet quando os valores no widget do controlo deslizante são alterados.</desc>
                        <figDesc>Gif animado demonstrando a atualização do mapa Leaflet à medida que os valores no widget de controlo deslizante são alterados.</figDesc>
                        <graphic url="pt-tr-aplicacao-web-interativa-r-shiny-leaflet-06.gif"/>
                    </figure>
                </div>
            </div>
            <div type="2" n="7">
                <head>Melhorar a aplicação</head>
                <p>Para saber mais sobre Shiny e Leaflet, pode tentar adicionar alguns dos seguintes recursos à sua aplicação:</p>
                <p>Primeiro, adicione um <emph>input</emph> de usuário adicional para filtrar os dados do mapa. Usando outro widget, <code rend="inline">selectInput</code>, pode permitir que um usuário exiba dados de apenas um dos quatro países na lista de títulos. Digite <code rend="inline">?selectInput</code> na linha de comandos para obter ajuda sobre os parâmetros necessários para fazer isto corretamente. <emph>Inputs</emph> adicionais podem ser colocados sob o <code rend="inline">sliderInput</code> existente, separados por uma vírgula. </p>
                <p>Em seguida, adicione alguns elementos ao mapa leaflet. Uma lista completa de opções pode ser encontrada usando <code rend="inline">?circleMarkers</code> no RStudio. Por exemplo, pode adicionar um rótulo aos pontos com <code rend="inline">label = coverage_city</code>. </p>
                <p>Notará que sempre que move o controlo deslizante, o mapa inteiro redesenha e redefine a sua visualização, o que não é muito elegante. Isto pode ser corrigido usando outra função chamada <code rend="inline">leafletProxy</code>. Resumidamente, crie um mapa leaflet vazio (sem os <code rend="inline">circleMarkers</code>) como acima. De seguida, em outro contexto reativo, <code rend="inline">observe</code>, adicionará o código para redesenhar as partes em mudança do mapa, usando <code rend="inline">leafletProxy</code>. As instruções de como fazer isto podem ser encontradas <ref target="https://perma.cc/CZ84-CW9F">aqui</ref> (em inglês).</p>
            </div>
            <div type="2" n="8">
                <head>Conclusão</head>
                <p>Visualizações interativas podem ajudar a trazer novas perspectivas para dados históricos. Neste tutorial, usamos alguns pacotes R versáteis e robustos, como o tydeverse e o leaflet, e pudemos usá-los num ambiente interativo, em vez de ter que preparar todos os dados antecipadamente. Aprendemos como e porquê podemos usar programação reativa, o que nos permite criar código R dinâmico onde os <emph>inputs</emph> do usuário substituem as variáveis fixas. </p>
                <p>Essa abordagem pode ser facilmente adaptada para atender a uma variedade de diferentes formatos de dados e modos de análise. A dificuldade relativamente baixa de utilização destas ferramentas facilita a criação de aplicações rápidas que podem tornar o trabalho com um grande volume de dados menos penoso. As aplicações Shiny também são uma maneira útil de compartilhar alguns dos benefícios dos recursos de programação do R com um público não técnico ou membros da equipe do projeto. É relativamente fácil criar uma aplicação que permitirá que um usuário faça sua própria análise de dados com R, sem precisar codificar ou usar a linha de comandos. </p>
            </div>
            <div type="2" n="9">
                <head>Código final</head>
                <ab>
                    <code xml:id="code_aplicacao-web-interativa-r-shiny-leaflet_13" corresp="code_aplicacao-web-interativa-r-shiny-leaflet_13.txt" rend="block"/>
                </ab>
            </div>
            <div type="2" n="10">
                <head>Notas de fim</head>
                <p>
                    <ref type="footnotemark" target="#pt_note_1"/> : Yann Ryan and Luke McKernan, "Converting the British Library's Catalogue of British and Irish Newspapers into a Public Domain Dataset: Processes and Applications," Journal of Open Humanities Data 7, no. 0 (January 22, 2021): 1, <ref target="https://doi.org/10.5334/johd.23">https://doi.org/10.5334/johd.23</ref>.</p>
                <p>
                    <ref type="footnotemark" target="#pt_note_2"/> : Depósito Legal era um mecanismo pelo qual os editores eram obrigados a dar ao British Museum (e, posteriormente, à British Library) uma cópia de qualquer livro produzido, incluindo jornais. </p>
                <p>
                    <ref type="footnotemark" target="#pt_note_3"/> : O objeto servidor é, na verdade, uma lista R com todos os <emph>inputs</emph> armazenados no primeiro elemento, chamado <emph>input</emph>, e todos os resultados armazenados no segundo elemento, chamado <emph>output</emph>.</p>
                <p>
                    <ref type="footnotemark" target="#pt_note_4"/> : Como existem várias maneiras de transformar um globo numa representação 2D, a exibição correta de dados geográficos requer a configuração de um sistema de referência de coordenadas. 4326 é comumente usado para dados geográficos mundiais.</p>
            </div>
        </body>
    </text>
</TEI>
