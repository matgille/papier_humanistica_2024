Module GoalsþObjetivos del móduloþObjetivos do Módulo
Downloading a single record from a website is easy , but downloading many records at a time – an increasingly frequent need for a historian – is much more efficient using a programming language such as Python .þDescargar un solo registro de un sitio web es fácil , aunque la descarga de muchos registros a la vez —una necesidad cada vez más frecuente para personas de humanidades— es mucho más eficiente si se utiliza un lenguaje de programación como Python .þFazer o download de um único registro de um website é fácil , mas fazer o download de vários registros de uma vez - uma necessidade cada vez mais frequente para um historiador - é muito mais eficiente usando uma linguagem de programação como o Python .
In this lesson , we will write a program that will download a series of records from the Old Bailey Online using custom search criteria , and save them to a directory on our computer .þEn esta lección escribiremos un programa para descargar una serie de registros del Old Bailey Online ( OBO ) utilizando criterios de búsqueda personalizados y luego guardarlos en un directorio de nuestro computador .þNesta lição , escreveremos um programa que fará o download de uma série de registros do Old Bailey Online usando critérios de investigação personalizados e irá armazená-los num diretório no nosso computador .
This process involves interpreting and manipulating URL Query Strings .þEste proceso conlleva la interpretación y manipulación de cadenas de consulta ( query strings , en inglés ) en la URL .þEsse processo envolve interpretar e manipular Query Strings de URL .
In this case , the tutorial will seek to download sources that contain references to people of African descent that were published in the Old Bailey Proceedings between 1700 and 1750 . The examples in this lesson include historic racialized language that readers may find offensive .þEn este caso , el programa tratará de descargar fuentes que contengan referencias a personas de ascendencia africana , publicadas en el Old Bailey Proceedings entre 1700 y 1750 .þNesse caso , o tutorial buscará fazer o download de fontes que contenham referências a afrodescendentes que foram publicadas no Old Bailey Proceedings entre 1700 e 1750 . Os exemplos nessa lição incluem linguagem histórica racializada que os leitores podem achar ofensiva .
The author does not condone the use of this language but has tried to use it in its historic context , recognizing that it is otherwise impossible to find the desired materials of the case study .þþO autor não tolera o uso dessa linguagem , mas tentou usá-la no seu contexto histórico , reconhecendo que , de outra forma , é impossível encontrar os materiais desejados do estudo de caso .
Anyone teaching with this material is advised to take a sensitive approach towards the language and to apply best practices when teaching about race .þþQualquer pessoa que ensine com este material é aconselhada a adotar uma abordagem sensível em relação à linguagem e a aplicar as boas práticas ao ensinar sobre raça .
The author recommends the many resources from Teaching Tolerance ( https : //www.tolerance.org ) ; Peggy McIntosh , ‘ White Privilege : Unpacking the Invisible Knapsack ’ * Peace and Freedom Magazine * , ( 1989 ) , 10-12 ; Binyavanga Wainaina , ‘ How to Write About Africa ’ , * Granta * ( 92 ) : 2006 .þþO autor recomenda os muitos recursos do Teaching Tolerance ; Peggy McIntosh , ‘ White Privilege : Unpacking the Invisible Knapsack ’ , Peace and Freedom Magazine , ( 1989 ) , 10-12 ; Binyavanga Wainaina , ‘ How to Write About Africa ’ , Granta ( 92 ) : 2006 .
For Whom is this Useful ?þ¿Para quién es útil esto ?þPara Quem isso é Útil ?
Automating the process of downloading records from an online database will be useful for anyone who works with historical sources that are stored online in an orderly and accessible fashion and who wishes to save copies of those sources on their own computer .þAutomatizar el proceso de descarga de registros de una base de datos en línea será útil para cualquier persona que trabaje con fuentes históricas almacenadas en línea de manera ordenada y accesible , y que desea guardar copias de esas fuentes en su propio computador .þAutomatizar o processo de download de registros de uma base de dados online será útil para qualquer um que trabalhe com fontes históricas armazenadas online de forma ordenada e acessível e que deseje salvar cópias dessas fontes no seu próprio computador .
It is particularly useful for someone who wants to download many specific records , rather than just a handful .þEs particularmente útil para quien quiera descargar muchos registros específicos , en lugar de solo unos cuantos .þÉ particularmente útil para alguém que deseja fazer o download de vários registros específicos , em vez de apenas um punhado .
If you want to download all or most of the records in a particular database , you may find Ian Milligan ’ s tutorial on Automated Downloading with WGET more suitable .þSi deseas descargar todos o la mayoría de los registros de una base de datos determinada , el tutorial de Ian Milligan sobre Descarga automatizada con Wget puede ser más adecuado .þCaso deseje fazer o download de todos ou da maioria dos registros de uma base de dados em particular , pode achar o tutorial de Ian Milligan sobre Automated Downloading with WGET mais adequado .
The present tutorial will allow you to download discriminately , isolating specific records that meet your needs .þEl presente tutorial te permitirá descargar registros específicos de manera selectiva , aislando aquellos que satisfagan tus necesidades .þO presente tutorial permitirá que faça download de forma isolada e discriminada de registros específicos que atendam às suas necessidades .
Downloading multiple sources automatically saves considerable time .þLa descarga automática de varias fuentes ahorra un tiempo considerable .þFazer o download de múltiplas fontes de forma automática economiza um tempo considerável .
What you do with the downloaded sources depends on your research goals .þLo que hagas con las fuentes descargadas depende de tus objetivos de investigación .þO que faz com as fontes baixadas depende dos seus objetivos de investigação .
You may wish to create visualizations or perform various data analysis methods , or simply reformat them to make browsing easier .þEs posible que quieras crear visualizaciones , aplicar diversos métodos de análisis de datos o simplemente reformatearlos para facilitar la navegación .þPode desejar criar visualizações ou realizar uma série de métodos de análise de dados , ou simplesmente reformatá-las para facilitar a navegação .
Or , you may just want to keep a backup copy so you can access them without Internet access .þO quizá solo desees guardar una copia de seguridad para acceder a ellos cuando no tengas acceso a Internet .þOu pode desejar apenas manter uma cópia de backup para poder acessá-las sem acesso à internet .
This lesson is for intermediate Python users .þEsta lección está dirigida a usuarios intermedios de Python .þEssa lição é voltada para usuários de Python com nível intermediário .
If you have not already tried the Python Programming Basics lessons , you may find that a useful starting point .þSi aún no has revisado las lecciones de Programación básica en Python , puedes encontrar en ellas un punto de partida útil .þCaso ainda não tenha tentado as lições do Básico de Programação em Python , pode achá-las um ponto de partida útil .
Applying our Historical KnowledgeþCómo aplicar nuestro conocimiento históricoþAplicando nosso Conhecimento Histórico
In this lesson , we are trying to create our own corpus of cases related to people of African descent .þEn esta lección crearemos nuestro propio corpus de casos relacionados con personas de ascendencia africana .þNesta lição , estamos tentando criar o nosso próprio corpus de casos relacionados com pessoas afrodescendentes .
From Benjamin Bowsey ’ s case at the Old Bailey in 1780 , we might note that “ black ” can be a useful keyword for us to use for locating other cases involving defendants of African descent .þA partir del caso de Benjamin Bowsey en el OBO en 1780 , notamos que la voz `` black `` es una palabra clave útil para localizar otros casos que involucren a acusados de ascendencia africana .þA partir do caso de Benjamin Bowsey no Old Bailey em 1780 , podemos notar que `` black `` pode ser uma palavra-chave útil para usarmos para localizar outros casos envolvendo réus de ascendência africana .
However , when we search for “ black ” on the Old Bailey website , we find it often refers to other uses of the word : black horses , or black cloth .þSin embargo , cuando buscamos `` black `` en el sitio web del OBO , encontramos que a menudo se refiere a otros usos de la palabra : caballos negros , tela negra , etc .þNo entanto , quando buscamos por black no website do Old Bailey , percebemos que esta palavra às vezes se refere a outros usos : black horses ou black cloth .
The task of disambiguating this use of language will have to wait for another lesson .þLa tarea de desambiguar este uso del lenguaje tendrá que esperar a otra lección .þA tarefa de desambiguar esse uso da linguagem terá que esperar por outra lição .
For now , let ’ s turn to easier cases .þPor ahora vayamos a los casos más fáciles .þPor enquanto , vamos nos voltar para casos mais fáceis .
As historians , we can probably think of keywords of historic racialised terms related to African descendants that would be worth pursuing .þComo historiadores e historiadoras , probablemente podamos pensar en palabras clave relacionadas con los descendientes de africanos que valdría la pena explorar .þComo historiadores , provavelmente , podemos pensar em palavras-chave de termos historicamente racializados relacionados com afrodescendentes as quais valeria a pena buscar .
The infamous “ n-word ” of course is not useful , as this term did not come into regular usage until the mid-nineteenth century .þLa infame n-word no es útil , por supuesto , ya que ese término no entró en uso regular sino hasta mediados del siglo XIX .þA infame `` n-word `` , é claro , não é útil , já que esse termo não era comumente utilizado até meados do século XIX .
Other racialised language such as “ negro ” and “ mulatto ” are however , much more relevant to the early eighteenth century .þPero negro y mulatto eran voces muy utilizadas a principios del siglo XVIII .þOutras expressões racializadas como `` negro `` e `` mulatto `` são , porém , muito mais relevantes para o início do século XVIII .
These keywords are less ambiguous than “ black ” and are much more likely to be immediate references to people in our target demographic .þEstas palabras clave son menos ambiguas que `` black `` y es mucho más probable que sean referencias inmediatas a personas de nuestro grupo demográfico objetivo .þEssas palavras-chave são menos ambíguas do que `` black `` e são muito mais propensas a serem referências imediatas a pessoas no nosso público-alvo .
If we try these two terms in separate simple searches on the Old Bailey website , we get results like in these screenshots :þSi intentamos buscar por separado estos dos términos en el sitio web del OBO , obtenemos resultados como en estas capturas de pantalla :þSe testarmos esses dois termos em buscas separadas simples no Old Bailey website , temos resultados como nessa captura de tela :
Search results for 'negro ' in the Old Bailey OnlineþResultados de búsqueda para 'negro ' en el OBOþResultados de investigação para 'negro ' no * Old Bailey Online *
Search results for 'mulatto ' in the Old Bailey OnlineþResultados de búsqueda para 'mulatto ' en el OBOþResultados de investigação para 'mulatto ' no * Old Bailey Online *
After glancing through these search results , it seems clear that these are references to people , rather than horses or cloth or other things that may be black .þDespués de analizar estos resultados , resulta evidente que se trata de referencias a personas y no a caballos , ropa u otras cosas que pueden ser de color negro .þDepois de examinar estes resultados de busca , parece evidente que são referências a pessoas e não a cavalos , panos ou qualquer outra coisa que seja preta .
We want to download them all to use in our analysis . We could , of course , download them one at a time , manually .þQueremos tener todos estos registros en nuestro computador para usarlos en nuestro análisis así que podríamos descargarlos manualmente uno por uno .þDesejamos fazer o download de todas para usar na nossa análise . Poderíamos , é claro , fazer o download de uma por uma manualmente .
But let ’ s find a programmatic way to automate this task .þPero encontremos una manera programática de automatizar esta tarea .þMas vamos encontrar uma maneira programática de automatizar essa tarefa .
The Advanced Search on OBOþLa búsqueda avanzada en el OBOþA Investigação Avançada no OBO
Every website ’ s search features work differently .þLas características de búsqueda de cada sitio web funcionan de manera diferente .þAs ferramentas de pesquisa de cada site funcionam de maneira diferente .
While searches work similarly , the intricacies of database searches may not be entirely obvious .þSi bien las búsquedas funcionan de manera similar , la complejidad en la que están estructuradas las búsquedas en bases de datos pueden no ser del todo obvias .þEmbora as pesquisas funcionem de forma semelhante , as complexidades das pesquisas numa base de dados podem não ser totalmente óbvias .
Therefore it ’ s important to think critically about database search options and , when available , read the documentation provided on the website .þPor lo tanto , es importante pensar críticamente sobre las opciones de búsqueda en la base de datos y leer la documentación proporcionada en el sitio web , cuando esta esté disponible .þPortanto , é importante pensar criticamente sobre as opções de busca de uma base de dados e , quando disponível , ler a documentação fornecida pelo website .
Prudent historical researchers always interrogate their sources ; the procedures behind your search boxes should receive the same attention .þEl historiador o historiadora prudente siempre critica sus fuentes , por lo que los procedimientos que hay detrás de las casillas de búsqueda deben recibir la misma atención de nuestra parte .þInvestigadores de história prudentes sempre interrogam suas fontes ; os procedimentos por trás das suas caixas de pesquisa devem receber a mesma atenção .
The Old Bailey Online ’ s advanced search form lets you refine your searches based on ten different fields including simple keywords , a date range , and a crime type .þEl formulario de búsqueda avanzada del OBO te permite refinar tus búsquedas en diez campos diferentes , incluyendo palabras clave simples , un rango de fechas y un tipo de delito .þO formulário de busca avançada do Old Bailey Online permite refinar as suas buscas com base em dez campos diferentes , incluindo palavras-chave simples , um intervalo de datas e um tipo de crime .
As each website ’ s search feature is different it always pays to take a moment or two to play with and read about the search options available .þComo la función de búsqueda de cada sitio web es diferente , siempre vale la pena tomarse un tiempo para experimentar con ella y leer acerca de las opciones disponibles .þComo as ferramentas de busca de cada website são diferentes , vale sempre a pena reservar um momento ou dois para testar e ler a respeito das opções de investigação disponíveis .
Since we have already done the simple searches for “ negro ” and “ mulatto ” , we know there will be results .þComo ya hemos hecho una búsqueda simple de los términos `` negro `` y `` mulatto `` , sabemos que obtendremos resultados .þUma vez que já fizemos buscas simples por `` negro `` e `` mulatto `` , sabemos que haverá resultados .
However , let ’ s use the advanced search to limit our results to records published in the Old Bailey Proceedings trial accounts from 1700 to 1750 only .þUsaremos la búsqueda avanzada para limitar nuestros resultados a los registros de procesos judiciales publicados en los Old Bailey Proceedings entre 1700 y 1750 solamente .þNo entanto , vamos usar a busca avançada para limitar os nossos resultados aos registros publicados no Old Bailey Proceedings que dizem respeito a julgamentos apenas de 1700 até 1750 .
You can of course change this to whatever you like , but this will make the example easier to follow .þDesde luego , puedes ajustar la búsqueda como quieras ; pero si sigues el ejemplo aquí presentado , será más fácil comprender la lección .þÉ claro que pode alterá-lo para o que desejar , mas isso tornará o exemplo mais simples de ser acompanhado .
Perform the search shown in the image below .þEjecuta la búsqueda que se muestra en la imagen de abajo .þFaça a busca mostrada na imagem abaixo .
Make sure you tick the “ Advanced ” radio button and include the * wildcards to include pluralized entries or those with an extra “ e ” on the end .þAsegúrate de marcar el botón de opción Advanced ( `` Avanzado '' ) y usa los comodines * para incluir entradas en plural o aquellas con una “ e ” adicional al final .þCertifique-se de que marcou o botão `` Advanced `` e incluiu as wildcards * para incluir entradas pluralizadas ou com um `` e '' extra no final .
Old Bailey Advanced Search ExampleþEjemplo de búsqueda avanzada en el OBOþExemplo de Busca Avançada no * Old Bailey *
Execute the search and then click on the “ Calculate Total ” link to see how many entries there are .þRealiza la búsqueda y luego haz clic en el enlace Calculate total ( `` Calcular el total '' ) para ver cuántas entradas hay .þExecute a busca e depois clique no link `` Calculate Total `` para ver quantas entradas existem .
We now have 13 results ( if you have a different number go back and make sure you copied the example above exactly ) .þDebe haber 13 resultados ( si tienes un número diferente , vuelve atrás y asegúrate de haber copiado exactamente el ejemplo anterior ) .þAgora temos 13 resultados ( caso tenha um número diferente , volte e certifique-se de que copiou o exemplo acima da forma exata ) .
What we want to do at this point is download all of these trial documents and analyze them further .þVamos a descargar estas transcripciones de procesos judiciales para analizarlas más a fondo .þO que queremos fazer neste ponto é o download de todos esses ficheiros de julgamento e analizá-los mais profundamente .
Again , for only 13 records , you might as well download each record manually .þPor supuesto , puedes descargar cada uno de los 13 registros manualmente .þMais uma vez , para apenas 13 registros , também pode fazer o download de cada registro manualmente .
But as more and more data comes online , it becomes more common to need to download 1,300 or even 130,000 records , in which case downloading individual records becomes impractical and an understanding of how to automate the process becomes that much more valuable .þSin embargo , a medida queb más datos están disponibles en línea , será necesario manejar descargas de 1,300 o incluso 130,000 registros . La descarga de registros individuales resulta poco práctica y saber cómo automatizar el proceso es una herramienta muy valiosa .þMas à medida que mais e mais dados são disponibilizados online , torna-se mais comum a necessidade de baixar 1.300 ou até 130.000 registros , caso no qual o download individual dos registros se torna impraticável e entender como automatizar o processo se torna muito valioso .
To automate the download process , we need to step back and learn how the search URLs are created on the Old Bailey website , a method common to many online databases and websites .þPara automatizar el proceso de descarga debemos retroceder y aprender cómo se crean las URLs de búsqueda en el sitio web del OBO , un método común en muchas bases de datos y sitios web en línea .þPara automatizar o processo , precisamos de dar um passo atrás e lembrar como as URLs de busca são criadas no Old Bailey website , um método comum para muitas bases de dados online e websites .
Understanding URL QueriesþComprender las consultas en URLsþEntendendo Queries de URL
Take a look at the URL produced with the last search results page .þEcha un vistazo a la URL producida con la última página de resultados de búsqueda .þObserve a URL produzida com a última página de resultado de busca .
It should look like this :þDebe tener un aspecto como este :þEla deve se parecer com isso :
We had a look at URLs in Viewing HTML Files , but this looks a lot more complex .þYa hemos estudiado las URLs en la lección Para entender páginas web y HTML y este parece mucho más complicado .þVimos sobre URLs em Noções básicas de páginas web e HTML , mas isso parece muito mais complexo .
Although longer , it is actually not that much more complex .þPero , aunque es más largo , en realidad no es mucho más complejo .þAinda que mais longo , não é verdadeiramente muito mais complexo .
But it is easier to understand by noticing how our search criteria get represented in the URL .þEs sencillo entenderlo al observar cómo se representan nuestros criterios de búsqueda en la URL :þMas é mais fácil de entender observando como os nossos critérios de busca são representados na URL .
In this view , we see more clearly our 12 important pieces of information that we need to perform our search ( one per line ) .þAquí observamos más claramente los 12 datos que necesitamos para realizar nuestra búsqueda ( uno en cada línea ) .þNessa visão , vemos com mais clareza as 12 informações importantes que precisamos para realizar a nossa busca ( uma por linha ) .
On the first is the Old Bailey ’ s base website URL , followed by a query : “ ?þTenemos la URL del sitio web del OBO seguido de una consulta ( introducida por el carácter ? ) , seguida de 11 pares nombre/valor acompañados cada uno del carácter & .þNa primeira há a URL base do Old Bailey website , seguida por uma query `` ?
” ( don ’ t worry about the gen=1 bit ; the developers of the Old Bailey Online say that it does not do anything . ) and a series of 10 name/value pairs put together with & characters .þCada par contiene el nombre de una variable de servidor ( por ejemplo , toYear ) , unido con el signo de asignación = al valor de dicha variable ( en nuestro ejemplo , 1750 ) .þ'' ( não se preocupe com o bit gen=1 ; os desenvolvedores do Old Bailey Online dizem que ele não faz nada ) e uma série de 10 pares nome/valor unidos por caracteres & .
Together these 10 name/value pairs comprise the query string , which tells the search engine what variables to use in specific stages of the search . Notice that each name/value pair contains both a variable name : toYear , and then assigns that variable a value : 1750 .þFinalmente , el carácter ' & ' le indica al servidor que a continuación siguen más pares nombre/valor en la URL .þJuntos , esses 10 pares de nome/valor compõem a query string ( expressão de busca ) , que informa ao mecanismo de busca quais variáveis usar em etapas específicas da investigação . Observe que cada par nome/valor contém um nome de variável : toYear e , em seguida , atribui a essa variável um valor : 1750 .
This works in exactly the same way as Function Arguments by passing certain information to specific variables .þTodo esto forma la cadena de consulta que le dice al motor de búsqueda qué variables utilizar en etapas específicas de la búsqueda .þIsso funciona exatamente da mesma forma que os Argumentos de Função , passando certas informações para variáveis específicas .
In this case , the most important variable is _divs_fulltext= which has been given the value :þEn nuestro caso , la variable de servidor más importante de la cadena de consulta es _divs_fulltext , a la que se le ha dado el valor mulatto * +negro * .þNesse caso , a variável mais importante é _divs_fulltext= , para a qual foi dado o valor :
This holds the search term we have typed into the search box .þEste valor contiene el término de consulta que hemos escrito en el cuadro de búsqueda .þEsta contém o termo que digitamos na caixa de busca .
The program has automatically added a + sign in place of a blank space ( URLs can not contain spaces ) ; otherwise that ’ s exactly what we ’ ve asked the Old Bailey site to find for us .þ( La aplicación web ha agregado automáticamente un signo + en lugar de un espacio en blanco ya que las URLs no pueden contener espacios . ) Esto es exactamente lo que le hemos pedido al buscador del OBO que nos encuentre .þO programa adicionou automaticamente um sinal de soma + no lugar de um espaço em branco ( URLs não podem conter espaçamentos ) ; dito de outro modo , isso é exatamente o que pedimos que o site do Old Bailey encontrasse .
The other variables hold values that we defined as well .þLas otras variables de servidor tienen valores que también establecimos en la caja de búsqueda .þAs outras variáveis carregam valores que nós também definimos .
fromYear and toYear contain our date range .þfromYear y toYear contienen nuestro intervalo de fechas .þfromYear e toYear contém o nosso intervalo de datas .
Since no year has 99 months as suggested in the toMonth variable , we can assume this is how the search algorithm ensures all records from that year are included .þNota que en nuestro ejemplo el valor de toMonth es 99 . Como ningún año tiene 99 meses , podemos conjeturar que así es como el algoritmo de búsqueda garantiza que se incluyan todos los registros de un mismo año .þJá que nenhum ano possui 99 meses , como sugerido na variável toMonth , podemos assumir que esse seja o modo através do qual o algoritmo garante que todos os registros daquele ano são incluídos .
There are no hard and fast rules for figuring out what each variable does because the person who built the site gets to name them .þNo hay reglas estrictas para determinar qué hace cada variable porque las personas que construyeron el sitio les han asignado un nombre arbitrario .þNão há regras difíceis ou rápidas para descobrir o que cada variável faz , porque a pessoa que criou o site as nomeou .
Often you can make an educated guess .þA menudo podemos hacer una conjetura basada en nuestra experiencia y conocimiento .þMuitas vezes pode fazer uma suposição razoável .
All of the possible search fields on the Advanced Search page have their own name/value pair .þTodos los campos de búsqueda posibles en la página de búsqueda avanzada tienen su propio par de nombre/valor .þTodos os campos de busca possíveis na página de busca avançada possuem os seus próprios pares nome/valor .
If you ’ d like to find out the name of the variable so you can use it , do a new search and make sure you put a value in the field in which you are interested .þSi deseas averiguar el nombre de la variable de servidor para poder usarla , busca de nuevo y asegúrate de poner un valor en el campo de tu interés .þCaso deseje descobrir o nome da variável de modo a que possa utilizá-la , faça uma nova busca e certifique-se de colocar um valor no campo no qual está interessado .
After you submit your search , you ’ ll see your value and the name associated with it as part of the URL of the search results page .þDespués de enviar tu búsqueda , verás el valor y el nombre asociado a él como parte de la URL de la página de resultados .þApós submeter a sua busca , verá o seu valor e o nome associado a ele como parte da URL da página dos resultados de busca .
With the Old Bailey Online , as with many other websites , the search form ( advanced or not ) essentially helps you to construct URLs that tell the database what to search for .þCon el OBO , al igual que con muchos otros sitios web , el formulario de búsqueda te ayuda esencialmente a construir URLs que le indiquen a la base de datos qué debe buscar .þCom o Old Bailey Online , assim como com noutros websites , o formulário de busca ( avançada ou não ) ajuda , essencialmente , a construir URLs que informam à base de dados o que está buscando .
If you can understand how the search fields are represented in the URL – which is often quite straightforward – then it becomes relatively simple to programmatically construct these URLs and thus to automate the process of downloading records .þSi comprendes cómo se representan los campos de búsqueda en la URL , lo que a menudo es bastante sencillo , entonces es relativamente fácil construir las URLs mediante programación y , por lo tanto , automatizar el proceso de descarga de registros . Entre las variables de servidor hay una que será importante en nuestra búsqueda programática .þSe puder entender como os campos de busca estão representados no URL - o que geralmente é algo bem direto - , então torna-se relativamente simples construir esses URLs programaticamente e automatizar o processo de download de registros .
Now try changing the “ ” to “ ” and hit enter . start=0þLa variable start le indica al servidor en cuál número de registro debe iniciar la página de resultados .þAgora tente alterar o start=0 para start=10 e pressione enter .
start=10 You should now have results 11-13 .þPor ejemplo , si cambias start=0 por start=10 en la URL y presionas enter , deberás obtener los resultados del 11 al 13 .þDeve agora ter os resultados 11-13 .
The “ start ” variable tells the website which entry should be shown at the top of the search results list .þY si la cambias por start=5 , obtendrás del 6 al 13 . Sería ideal que pudiéramos elegir mostrar todos los resultados en una sola página , pues ello facilitará su procesamiento ; pero la aplicación web del OBO despliega los resultados en páginas de 10 registros cada una .þA variável start informa ao website qual a entrada que deve ser mostrada no início da lista de resultados de busca .
We should be able to use this knowledge to create a series of URLs that will allow us to download all 13 files . Let ’ s turn to that now .þAhora aprovecharemos este conocimiento para crear una serie de URLs que nos permitirá descargar los 13 archivos .þNós devemos ser capazes de utilizar esse conhecimento para criar uma série de URLs que nos permitirão fazer o download de todos os 13 ficheiros . Vamos nos voltar para isso agora .
Systematically Downloading FilesþDescarga sistemática de archivosþFazendo o Download de Ficheiros Sistematicamente
In Working with Webpages we learned that Python can download a webpage as long as we have the URL .þEn Descargar páginas web con Python aprendimos que Python puede descargar una página web siempre que tengamos la URL .þNa lição Download de Páginas Web com Python , aprendemos que o Python pode fazer o download de uma página web desde que tenhamos a URL .
In that lesson we used the URL to download the trial transcript of Benjamin Bowsey .þEn dicha lección usamos la URL para descargar la transcripción del proceso de Benjamin Bowsey .þNaquela lição , usamos a URL para fazer o download da transcrição do julgamento de Benjamin Bowsey .
In this case , we ’ re trying to download multiple trial transcripts that meet the search criteria we outlined above without having to repeatedly re-run the program .þEn la presente lección estamos intentando descargar varias transcripciones de procesos judiciales que cumplan con los criterios de búsqueda que describimos anteriormente , sin tener que volver a ejecutar el programa repetidamente .þNesse caso , estamos tentando fazer o download de múltiplas transcrições de julgamentos que atendem aos critérios de busca descritos acima sem precisar executar o programa repetidamente .
Instead , we want a program that will download everything we need in one go .þAsí pues , queremos un programa que descargue todo lo que necesitamos de una sola vez .þAo invés disso , queremos um programa que faça o download de tudo de uma vez .
At this point we have a URL to a search results page that contains the first ten entries of our search .þEn este punto , tenemos la URL de una página de resultados de búsqueda que contiene las diez primeras entradas de nuestra consulta .þNeste ponto , temos a URL para a página de resultados de busca que contém as 10 primeiras entradas na nossa investigação .
We also know that by changing the “ start ” value in the URL we can sequentially call each search results page , and ultimately retrieve all of the trial documents from them .þTambién sabemos que al modificar el valor de la variable start en la URL , podemos llamar secuencialmente cada página de resultados de búsqueda y así al fin recuperar todos los registros de procesos judiciales .þTambém sabemos que ao mudarmos o valor de start na URL , podemos sequencialmente chamar cada uma das páginas de resultados de busca e finalmente recuperar todos os ficheiros de julgamento que elas possuem .
Of course the research results don ’ t give us the trial documents themselves , but only links to them .þPor supuesto , las páginas de resultados no nos dan los los registros de los procesos judiciales sino enlaces a ellos .þÉ claro que os resultados de busca não nos oferecem os ficheiros do julgamento em si , mas apenas links para eles .
So we need to extract the link to the underlying records from the search results .þAsí que necesitamos extraer el enlace a los registros contenidos en los resultados de búsqueda .þEntão precisamos de extrair esses links para os registros subjacentes dos resultados de busca .
On the Old Bailey Online website , the URLs for the individual records ( the trial transcript files ) can be found as links on the search results pages .þEn el sitio web del OBO , los de los registros individuales ( los archivos de transcripción de los procesos judiciales ) se pueden encontrar como enlaces en las páginas de resultados de búsqueda .þNo Old Bailey Online website , as URLs para os registros individuais ( os ficheiros de transcrição de julgamento ) podem ser encontrados como links na página de resultados de busca .
We know that all trial transcript URLs contain a trial id that takes the form : “ t ” followed by at least 8 numbers ( e.g . t17800628-33 ) .þSabemos que todas las URLs de transcripciones contienen una identificación formada por una t seguida de al menos 8 números ( por ejemplo , t17800628-33 ) .þSabemos que todas as transcrições de julgamento possuem um id de julgamento que assume a forma : `` t '' seguido por , pelo menos , 8 números ( ex . : t17800628-33 ) .
By looking for links that contain that pattern , we can identify trial transcript URLs .þAl buscar los enlaces que contengan ese patrón , podemos identificar las URLs de las transcripciones de los procesos judiciales .þAo buscar links que contenham esse padrão , podemos identificar URLs de transcrição de julgamento .
As in previous lessons , let ’ s develop an algorithm so that we can begin tackling this problem in a manner that a computer can handle .þAl igual que en las lecciones anteriores , desarrollaremos un algoritmo para abordar el problema de tal manera que el computador lo pueda manejar .þComo em lições anteriores , vamos desenvolver um algoritmo de modo a que possamos começar a enfrentar esse problema de uma maneira que o computador possa lidar .
It seems this task can be achieved in four steps .þAl parecer , esta tarea se puede lograr en cuatro pasos .þParece que a tarefa pode ser realizada em 4 passos .
We will need to :þNecesitaremos :þPrecisaremos :
Generate the URLs for each search results page by incrementing the “ start ” variable by a fixed amount an appropriate number of times .þGenerar las URLs para cada página de resultados de búsqueda incrementando en una cantidad fija la variable de servidor start por un número apropiado de veces .þGerar as URLs para cada página de resultados de busca incrementando a variável start numa quantidade fixa um número apropriado de vezes .
Download each search results page as an HTML file .þDescargar cada página de resultados de búsqueda como un archivo HTML .þFazer o download de cada página de resultados de busca como um ficheiro HTML .
Extract the URLs of each trial transcript ( using the trial ID as described above ) from the search results HTML files .þExtraer las URLs de cada procesos judiciales ( utilizando la ID de proceso , como se describió anteriormente ) contenidos en los archivos HTML de los resultados de la consulta .þExtrair os URLs de cada transcrição de julgamento ( usando o ID do julgamento como descrito acima ) de cada ficheiro HTML de resultados de busca .
Cycle through those extracted URLs to download each trial transcript and save it to a directory on our computerþRecorrer esos URLs extraídos para descargar cada transcripción de prueba y guardarlas en una carpeta en nuestro computador .þPercorrer essas URLs extraídas para baixar cada transcrição de avaliação e salvá-las num diretório no nosso computador .
You ’ ll recall that this is fairly similar to the tasks we achieved in Working with Webpages and From HTML to a List of Words 2 .þRecordarás que esto es bastante similar a las tareas que realizamos en Descargar páginas web con Python y De HTML a lista de palabras ( parte 2 ) .þPerceberá que isso é razoavelmente similiar às tarefas que realizamos em Download de Páginas Web com Python e De HTML para Lista de Palavras ( parte 2 ) .
First we download , then we parse out the information we ’ re after . And in this case , we download some more .þPrimero descargamos y luego analizamos la información que buscamos ; y , en el presente caso , descargamos un poco más .þPrimeiro , fazemos o download e , então , analisamos as informações que procuramos . E , nesse caso , fazemos mais alguns downloads .
Downloading the search results pagesþDescargar las páginas de resultados de consultaþFazendo o Download das Páginas de Resultados de Busca
First we need to generate the URLs for downloading each search results page .þPrimero necesitamos generar las URLs para descargar cada página de resultados de consulta .þPrimeiro , precisamos de gerar as URLs para fazer o download de cada página de resultados de busca .
We have already got the first one by using the form on the website :þYa tenemos el primero utilizando el formulario en el sitio web :þJá temos a primeira usando a forma do próprio website .
We could type this URL out twice and alter the ‘ start ’ variable to get us all 13 entries , but let ’ s write a program that would work no matter how many search results pages or records we had to download , and no matter what we decide to search for .þEscribamos un programa que funcione sin importar cuántas páginas de resultados de búsqueda o registros tengamos que descargar , y sin importar qué decidamos buscar .þPoderíamos escrever essa URL duas vezes e alterar a variável start para obter todas as 13 entradas , mas vamos escrever um programa que funcionaria independentemente de quantas páginas de resultados de busca ou registros precisássemos de fazer download , não importando o que decidíssemos investigar .
Study this code and then add this function to a module named obo.py ( create a file with that name and save it to the directory where you want to do your work ) .þEstudia el siguiente código y luego agrega esta función a un módulo llamado obo.py ( crea un archivo con ese nombre y guárdalo en el directorio donde deseas hacer tu trabajo ) .þEstude esse código e , depois , adicione essa função ao seu módulo chamado obo.py ( crie um ficheiro com esse nome e armazene-o no diretório onde deseja trabalhar ) .
The comments in the code are meant to help you decipher the various parts .þLos comentarios en el código ( las líneas que empiezan con un # ) están destinados a ayudarte a descifrar las distintas partes .þOs comentários no código destinam-se a ajudá-lo a decifrar as várias partes .
In this function we have split up the various Query String components and used Function Arguments so that this function can be reused beyond our specific needs right now .þEn esta función hemos dividido los diversos componentes de la cadena de consulta y hemos utilizado argumentos de función para que pueda reutilizarse más allá de nuestras necesidades específicas del momento .þNessa função , separamos os vários componentes da Query String e usamos Argumentos de Função para que a função possa ser reutilizada além dos nossos objetivos específicos atuais .
When we call this function we will replace the arguments with the values we want to search for .þCuando llamamos esta función , reemplazamos los argumentos con los valores que queremos buscar .þQuando chamarmos por essa função , substituiremos os argumentos pelos valores que desejamos buscar .
We then download the search results page in a similar manner as done in Working with Webpages .þLuego , descargamos la página de resultados de búsqueda de una manera similar a como se hace en Descargar páginas web con Python .þDepois , fazemos o download das páginas dos resultados de busca de maneira similiar a como foi feito em Download de Páginas Web com Python .
þLa línea que hemos marcado con ① crea el archivo resultado_consulta.html , asegurándonos de estar usando la codificación de caracteres UTF-8 .þ
þY la línea ② guarda en dicho archivo el valor de la variable contenido_web , también asegurándose de usar esa misma codificación .þ
þ( No necesitas cerrar explícitamente el archivo con la instrucción close , ya que el bloque with se encarga de ello .þ
Now , make a new file : download-searches.py and copy into it the following code .þ) Ahora crea un nuevo programa de Python llamado descarga_consultas.py y copia en él el siguiente código .þAgora , crie um novo ficheiro : download-searches.py e copie o código a seguir dentro dele .
Note , the values we have passed as arguments are exactly the same as those used in the example above .þTen en cuenta que los valores que hemos utilizado como argumentos son exactamente los mismos del ejemplo anterior .þObserve : os valores que passamos como argumentos são exatamente os mesmos dos utilizados no exemplo acima .
Feel free to play with these to get different results or see how they work .þSiéntete libre de jugar con estos para obtener diferentes resultados o ver cómo funcionan .þSinta-se livre para testá-los para receber resultados diferentes ou ver como funcionam .
When you run this code you should find a new file : “ search-results.html ” in your programming-historian directory containing the first search results page for your search .þCuando ejecutes este programa ( con python3 descarga_consultas.py desde el terminal , o desde tu editor de código preferido ) , encontrarás un nuevo archivo llamado resultado_consulta.html en tu carpeta de trabajo . Este archivo contiene la primera página de los resultados de búsqueda .þQuando executar esse código , deve encontrar um novo ficheiro : search-result.html no seu diretório programming-historian contendo a primeira página dos resultados de busca da sua investigação .
Check that this downloaded properly and then delete the file .þComprueba que se haya descargado correctamente y luego bórralo , pues ya no lo necesitaremos .þCertifique-se de que o download foi realizado apropriadamente e apague o ficheiro .
We ’ re going to adapt our program to download the other page containing the other 3 entries at the same time so we want to make sure we get both .þVamos a adaptar nuestro programa para descargar la otra página que contiene las otras 3 entradas al mismo tiempo , por lo que debemos asegurarnos de obtener ambas .þVamos adaptar o nosso programa para fazer o download da outra página contendo as outras 3 entradas ao mesmo tempo , assim queremos ter certeza que obteremos as duas .
Let ’ s refine our getSearchResults function by adding another function argument called “ entries ” so we can tell the program how many pages of search results we need to download .þRefinemos ahora nuestra función de Python obtener_resultados_consulta . Primero agregaremos otro argumento de función llamado entradas para que podamos decirle al programa cuántas páginas de resultados necesitamos descargar .þVamos refinar a nossa função getSearchResults adicionando outro argumento de função chamado entries , de modo a que possamos dizer ao programa quantas páginas de resultados de busca precisamos fazer o download .
We will use the value of entries and some simple math to determine how many search results pages there are .þUsaremos el valor de las entradas y algunos cálculos matemáticos simples para determinar cuántas páginas de resultados de búsqueda hay .þUsaremos o valor das entradas e matemática simples para determinar quantas páginas de resultado de busca existem .
This is fairly straightforward since we know there are ten trial transcripts listed per page .þEsto es bastante sencillo ya que sabemos que en el OBO hay 10 transcripciones enumeradas por página .þIsso é algo bastante direto uma vez que sabemos que há dez transcrições de julgamento listadas por página .
We can calculate the number of search results pages by dividing the value of entries by 10 .þPodemos calcular el número de páginas de resultados dividiendo el valor de las entradas por 10 .þPodemos calcular o número de páginas de resultados de busca dividindo o valor das entradas por 10 .
We will save this result to a variable named pageCount .þGuardaremos este resultado en una variable entera llamada contar_paginas .þArmazenaremos esse resultado na variável chamada pageCount .
It looks like this :þSerá algo como lo siguiente :þEla se parecerá com isso :
However , in cases where the number of entries is not a multiple of 10 , this will result in a decimal number .þDebido a que en Python 3 el operador // es de división entera , y por lo tanto redondea hacia el menor número entero el resultado de la división , el valor de contar_palabras siempre será un número entero .þNo entanto , em casos em que o número de entradas não é um múltiplo de 10 , isso resultará num número decimal .
You can test this by running this code in your Terminal ( Mac & Linux ) / Python Command Line ( Windows ) and printing out the value held in pageCount .þPrueba lo siguiente ejecutando el siguiente código en el intérprete REPL de Python en tu terminal ( en Mac y Linux ) , o en cmd o PowerShell ( en Windows ) .þPode testá-lo executando esse código no seu Terminal ( Mac & Linux ) / Linha de Comandos Python ( Windows ) e exibindo o valor mantido em pageCount .
( Note , from here on , we will use the word Terminal to refer to this program ) .þ( Nota , de aquí en adelante , usaremos la palabra `` terminal '' para referirnos al intérprete de línea de comandos . )þ( Observe que , daqui em diante , usaremos a palavra Terminal para referir esse programa ) .
We know the page count should be 2 ( one page containing entries 1-10 , and one page containing entries 11-13 ) .þAhora bien , lo que queremos obtener es `` 2 '' : una página que contiene las entradas 1 a 10 , y otra que contiene las entradas 11 a 13 . Pero dado que hay un residuo en esta operación ( de 3 en este caso , aunque no importa cuál sea ) , los últimos 3 resultados no se descargarán ya que solo capturaremos 1 página de 10 resultados .þSabemos que a contagem do número de página deve ser 2 ( uma página contendo as entradas 1-10 e uma página contendo as entradas 11-13 ) .
Since we always want the next higher integer , we can round up the result of the division .þPara solucionar este problema utilizaremos el operador modulo ( % ) , que divide el primer valor por el segundo y nos devuelve el residuo . Así , si el residuo es mayor que 0 , sabemos que hay una página adicional de resultados y necesitamos aumentar el valor de la variable de Python contar_paginas en una unidad .þUma vez que sempre queremos o maior inteiro mais próximo , podemos arredondar o resultado da divisão .
If we add this to our getSearchResults function just under the startValue = 0 line , our program , the code can now calculate the number of pages that need to be downloaded .þEl código ahora debería verse así : Si agregamos este código a nuestra función obtener_resultados_consulta , justo debajo de la línea start_value = 0 , nuestro programa podrá calcular el número de páginas que deben descargarse .þSe adicionarmos isso à nossa função getSearchResults abaixo da linha startValue=0 , agora o código é capaz de calcular o número de páginas cujo download precisa de ser realizado .
However , at this stage it will still only download the first page since we have only told the downloading section of the function to run once .þSin embargo , en esta etapa solo se descargará la primera página , ya que hemos indicado , en la sección de la función de descarga , que se ejecute solamente una vez .þNo entanto , nesta etapa ele irá fazer somente o download da primeira página , já que informamos à seção de download da função para executar somente uma vez .
To correct this , we can add that downloading code to a for loop which will download once for every number in the pageCount variable .þPara corregirlo , debemos encerrar en un bucle for el código de descarga que trabajará una vez por cada número que se indique en la variable de Python contar_paginas .þPara corrigir isso , podemos adicionar o código de download a um for loop que fará o download uma vez para cada número na variável pageCount .
If it reads 1 , then it will download once ; if it reads 5 it will download five times , and so on .þSi el valor de dicha variable es 1 , entonces descargará una vez ; si obtiene 5 descargará cinco veces , y así sucesivamente .þCaso ele leia 1 , fará o download uma vez ; caso ele leia 5 , fará o download cinco vezes e assim por diante .
Immediately after the if statement you have just written , add the following line and indent everything down to f.close one additional tab so that it is all enclosed in the for loop :þ( El valor de pagina irá aumentando en cada iteración de bucle for : 1 , 2 , 3 , etc. hasta una unidad menos que el valor de contar_páginas ) Inmediatamente después de la línea que contiene la expresión contar_paginas += 1 , que acabas de escribir , agrega la siguiente línea y todo lo que está debajo de la línea que contiene f.write ( contenido_web.decode ( 'utf-8 ' ) ) ( cuida de sangrar a la derecha todo el código para que este se incluya en el bucle for ) :þImediatamente após o if statement que acabou de escrever , adicione a linha a seguir e indente tudo antes de f.close com um espaçamento adicional de modo que tudo fique dentro do for loop :
Since this is a for loop , all of the code we want to run repeatedly needs to be intended as well .þDado que este es un bucle for , debemos planear bien todo el código que queremos ejecutar repetidamente ahí .þUma vez que isso é um for loop , todo o código que desejamos executar repetidamente também precisa de ser planejado .
You can see if you have done this correctly by looking at the finished code example below .þPuedes saber si lo has hecho correctamente al ver el ejemplo del código terminado a continuación .þPode-se certificar de que fez isso corretamente verificando o código finalizado no exemplo abaixo .
This loop takes advantage of Python ’ s range funciton .þEste bucle aprovecha la función range ( `` rango '' ) de Python .þEsse loop aproveita a função range do Python .
To understand this for loop it is probably best to think of pageCount as equal to 2 as it is in the example .þPara entender esto , es mejor pensar que la variable de Python contar_paginas es igual a 2 como se muestra en el ejemplo .þPara entender esse for loop é melhor , provavelmente , pensar em pageCount igual a 2 como no exemplo .
This two lines of code then means : start running with an initial loop value of 1 , and each time you run , add 1 more to that value .þEstas dos líneas de código significan : '' Comienza a ejecutarlo con un valor de bucle inicial de 0 , y cada vez que ejecutes agrega 1 más a ese valor .þPortanto , essas duas linhas de código significam : comece a executar com um valor de loop inicial 1 e , a cada vez que executar , adicione uma unidade a esse valor .
When the loop value is the same as pageCount , run once more and then stop .þCuando el valor del bucle es el mismo que contar_paginas , ejecuta una vez más y luego para .þQuando o valor do loop é o mesmo de pageCount , executa mais uma vez e para .
This is particularly valuable for us because it means we can tell our program to run exactly once for each search results page and provides a flexible new skill for controlling how many times a for loop runs .þ'' Esto es particularmente valioso en nuestro caso , porque podemos decirle a nuestro programa que se ejecute exactamente una vez para cada página de resultados , lo que proporciona una nueva habilidad flexible para controlar cuántas veces se ejecuta el bucle for .þIsso é particularmente valioso porque significa que podemos dizer ao nosso programa para executar exatamente uma vez para cada página de resultados de busca e oferece uma nova habilidade flexível para controlar quantas vezes um for loop é executado .
If you would like to practice with this new and powerful way of writing for loops , you can open your Terminal and play around .þSi deseas practicar con esta nueva y poderosa forma de escribir bucles , puedes abrir tu terminal y jugar con el REPL de Python :þCaso deseje praticar essa nova e poderosa maneira de escrever loops , pode abrir o seu Terminal e brincar .
Before we add all of this code together to our getSearchResults function , we have to make two final adjustments .þAhora bien , antes de agregar todo este código a nuestra función obtener_resultados_consulta , tenemos que hacer dos ajustes .þAntes de adicionar todo esse código à nossa função getSearchResults , temos que fazer dois ajustes finais .
At the end of the for loop ( but still inside the loop ) , and after our downloading code has run we will need to change the startValue variable , which is used in building the URL of the page we want to download .þPrimero , al final del bucle for ( pero aún dentro del bucle ) y después de que se haya ejecutado nuestro código de descarga , necesitaremos modificar la variable de servidor startValue en la URL de la página que queremos descargar . ( Esto lo hacemos modificando la variable de Python correspondiente start_value , que es la que nuestro programa usa para general el valor de la variable de servidor startValue en la URL .þNo final do for loop ( mas ainda dentro do loop ) e depois que o nosso código de download for executado , precisamos de mudar nossa variável startValue , que é usada na construção da URL da página que desejamos fazer o download .
If we forget to do this , our program will repeatedly download the first search results page since we are not actually changing anything in the initial URL . The startValue variable , as discussed above , is what controls which search results page we want to download .þ) Si no lo hacemos , nuestro programa descargará repetidamente la primera página de resultados pues no estamos cambiando nada en la URL inicial .þSe nos esquecermos de fazer isso , o nosso programa fará repetidamente o download da primeira página de resultados de busca , já que não estamos verdadeiramente mudando nada na URL inicial . A variável startValue , como discutido acima , é o que controla em que página de resultados de busca desejamos fazer o download .
Therefore , we can request the next search results page by increasing the value of startValue by 10 after the initial download has completed .þPor lo tanto , podemos solicitar la siguiente página de resultados de búsqueda aumentando su valor en 10 , una vez que se haya completado la descarga inicial .þPortanto , podemos solicitar a próxima página de resultados de busca incrementando o valor de startvalue em 10 unidades depois que o download inicial for concluído .
If you are not sure where to put this line you can peek ahead to the finished code example below .þSi no sabes exactamente dónde colocar esta línea , puedes echar un vistazo al ejemplo de código terminado , más abajo .þCaso não tenha certeza de onde adicionar essa linha , pode espiar adiante o código finalizado no exemplo abaixo .
Finally , we want to ensure that the name of the file we have downloaded is different for each file .þSegundo , debemos asegurarnos de que el nombre del archivo con los datos que hemos descargado sea diferente para cada página registrada .þFinalmente , queremos garantir que os nomes do ficheiros que fizemos o download são diferentes entre si .
Otherwise , each download will save over the previous download , leaving us with only a single file of search results .þDe lo contrario , cada descarga se guardará sobrescribiendo la descarga anterior , lo que nos dejará con un solo archivo de resultados .þDe outro modo , cada download será armazenado em cima do download anterior , deixando apenas um único ficheiro de resultados de busca .
To solve this , we can adjust the contents of the filename variable to include the value held in startValue so that each time we download a new page , it gets a different name .þPara resolver esto , debemos ajustar el contenido de la variable nombre_archivo para incluir el valor contenido en la variable pagina . Así , cada vez que descarguemos una nueva página , obtendremos un nombre diferente : resultado_consulta0.html , resultado_consulta1.html , resultado_consulta2.html y así sucesivamente .þPara resolver isso , podemos ajustar os conteúdos da variável filename para incluir o valor armazenado em startValue de modo que a cada vez que fizermos o download de uma nova página , ela recebe um nome diferente .
Since startValue is an integer , we will have to convert it to a string before we can add it to the filename variable .þComo pagina contiene un número entero , tendremos que convertir su valor en una cadena ( con la función str ( ) de Python ) antes de poder agregarlo a la variable de cadena nombre_archivo . ( De lo contrario obtendremos un error , pues el operador + , usado como concatenador , requiere necesariamente datos de tipo de cadena , no de tipo numérico .þJá que a variável startValue é um inteiro , precisaremos de convertê-la para uma string antes de adicioná-la à variável filename .
Adjust the line in your program that pertains to the filename variable to looks like this :þ) Ajusta la línea en tu programa que pertenece a la variable nombre_archivo para que se vea así :þAjuste a linha no seu programa que pertence à variável filename para ficar assim :
You should now be able to add these new lines of code to your getSearchResults function .þAhora ya puedes agregar estas nuevas líneas de código a tu función obtener_resultados_consulta .þAgora deve ser capaz de adicionar essas novas linhas de código à sua função getSearchResults .
Recall we have made the following additions :þRecordemos que hasta el momento hemos añadido lo siguiente :þLembre-se de que fizemos as adições a seguir :
Add entries as an additional function argument right after toMonthþagregamos la variable de Python entradas como un argumento de función adicional justo después de to_month ;þAdicionar entries como um argumento de função adicional logo depois de toMonth
Calculate the number of search results pages and add this immediately after the line that begins with startValue = 0 ( before we build the URL and start downloading )þcalculamos el número de páginas de resultados e incluimos esto inmediatamente después de la línea que comienza con start_value = 0 ( antes de crear la URL y comenzar a descargar ) ;þCalcular o número de páginas de resultados de pesquisa e adicionar isso imediatamente após a linha que começa com startValue = 0 ( antes de construirmos a URL e começarmos o download )
Follow this immediately with a for loop that will tell the program to run once for each search results page , and indent the rest of the code in the function so that it is inside the new loop .þinmediatamente después de esto añadimos un bucle for , que le indicará al programa que se ejecute una vez para cada página de resultados de búsqueda ( es importante sangrar a la derecha el resto del código de la función para que quede dentro del nuevo bucle ) ; ajustamos la variable nombre_archivo existente para que cada vez que se descargue una página de resultados se le dé un nombre único al archivo ; yþImediatamente após isso , adicione um for loop que informará ao programa para executar uma vez para cada página de resultados de busca , e indentar o resto do código de modo a que ele esteja dentro do novo loop
The last line in the for loop should now increase the value of the startValue variable each time the loop runs .þfinalmente , en la última línea del bloque de for aumentamos el valor de la variable de Python start_value ( en 10 unidades ) cada vez que se ejecute el bucle . Ahora bien , antes de proseguir , hagamos una última cosa .þA última linha no for loop deve agora incrementar o valor da variável startValue a cada vez que o loop é executado
Adjust the existing filename variable so that each time a search results page is downloaded it gives the file a unique name .þNota que en el código de la función obtener_resultados_consulta la variable de Python entradas , que contiene el número de registros que han de ser obtenidos , está predefinida con un valor fijo ( 13 en nuestro ejemplo ) . Como queremos que nuestra función sea más flexible y no esté necesariamente atada a un número predeterminado de registros , vamos incluir un argumento o parámetro adicional en nuestra definición de función : entradas .þAjustar a variável filename existente de modo que a cada vez que for feito o download de uma página de resultados de busca ela forneça um nome único ao ficheiro .
þLo añadiremos al final de la lista de argumentos : def obtener_resultados_consulta ( ... , entradas ) .þ
The finished function code in your obo.py file should look like this :þAsí las cosas , el código de la función terminada en el archivo obo.py deberá verse de la siguiente manera :þA função finalizada no seu ficheiro obo.py deve-se parecer com isso :
To run this new function , add the extra argument to download-searches.py and run the program again :þComo hemos añadido la variable entradas en la definición de la función , debemos añadir un argumento adicional cuando la llamemos en el programa descarga_consultas.py :þPara executar essa nova função , adicione o argumento extra ao download-searches.py e execute o programa novamente :
Great !þ¡Estupendo !þÓtimo !
Now we have both search results pages , called search-result0.html and search-result10.html .þCorre el programa y verás que ahora tenemos dos páginas de resultados de búsqueda : resultado_consulta0.html y resultado_consulta1.html .þAgora temos as duas páginas de resultados de busca , chamadas search-result0.html e search-result10.html .
But before we move onto the next step in the algorithm , let ’ s take care of some housekeeping .þPero antes de avanzar al siguiente paso en el algoritmo , vamos a ocuparnos de algunas tareas de limpieza .þMas antes de seguirmos para o próximo passo do algoritmo , vamos cuidar de algumas `` tarefas de organização '' .
Our programming-historian directory will quickly become unwieldy if we download multiple search results pages and trial transcripts .þNuestra carpeta de trabajo se volverá difícil de manejar si descargamos varias páginas de resultados y transcripciones de procesos judiciales en ella .þO nosso diretório programming-historian rapidamente se tornará difícil de controlar se fizermos o download de múltiplas páginas de resultados de busca e transcrições de julgamento .
Let ’ s have Python make a new directory named after our search terms .þPor lo tanto , con Python crearemos un nuevo directorio con el nombre de nuestros términos de búsqueda .þVamos fazer com que o Python crie um novo diretório nomeado a partir dos nossos termos de busca .
We want to add this new functionality in getSearchResults , so that our search results pages are downloaded to a directory with the same name as our search query .þQueremos añadir esta nueva funcionalidad en obtener_resultados_consulta , para que nuestras páginas de resultados de búsqueda se descarguen en un directorio con el mismo nombre que nuestra consulta de búsqueda .þDesejamos adicionar essa nova funcionalidade em getSearchResults , de modo que os downloads das nossas páginas de resultados de busca sejam direcionadas a diretórios com o mesmo nome da nossa query de busca .
This will keep our programming-historian directory more organized .þEsto mantendrá nuestro directorio de trabajo más organizado .þIsso manterá o nosso diretório programming-historian mais organizado .
To do this we will create a new directory using the os library , short for “ operating system ” .þPara ello crearemos un nuevo directorio utilizando el módulo de Python os , ( abreviatura de operating system , `` sistema operativo '' ) .þPara fazê-lo , criaremos um novo diretório usando a biblioteca os , abreviação de `` operating system `` ( sistema operacional ) .
That library contains a function called makedirs , which , unsurprisingly , makes a new directory .þEsa biblioteca contiene una función llamada makedirs cuya función es crear un nuevo directorio .þEssa biblioteca contém uma função chamada makedirs que , não surpreendentemente , cria um novo diretório .
You can try this out using the Terminal .þPuedes probar esto usando el REPL de Python .þPode testar usando o Terminal :
This program will check to see if your computer already has a directory with this name .þEste código verifica si tu computador ya tiene un directorio con este nombre .þEsse programa irá verificar se o seu computador já possui um diretório com esse nome .
If not , you should now have a directory called myNewDirectory on your computer .þSi no lo tenías , ahora deberás tener un directorio llamado mi_directorio_nuevo .þCaso não possua , agora deve possuir um diretório chamado meuNovoDiretório no seu computador .
On a Mac this is probably located in your /Users/username/ directory , and on Windows you should be able to find it in the Python directory on your computer , the same in which you opened your command line program .þ( El directorio se creará como subdirectorio del directorio donde hayas llamado originalmente al REPL de Python .þNum Mac provavelmente está localizado no seu diretório /Users/username/ , e no Windows deve ser capaz de encontrá-lo no diretório Python no seu computador , o mesmo no qual abriu o programa da linha de comandos .
If this worked you can delete the directory from your hard drive , since it was just for practice .þ) Si esto funciona , puedes eliminar el directorio de tu disco duro , ya que esto fue solo para practicar .þSe isso funcionou , pode deletar o diretório do seu disco rígido , já que isso foi só uma prática .
Since we want to create a new directory named after the query that we input into the Old Bailey Online website , we will make direct use of the query function argument from the getSearchResults function .þComo queremos crear un nuevo directorio con el nombre de la consulta que ingresamos en el sitio web del OBO , haremos uso directamente del argumento de función consulta en la función obtener_resultados_consulta .þUma vez que desejamos criar um novo diretório nomeado a partir da query que inserimos no Old Bailey Online website , vamos usar diretamente esse argumento de função query da função getSearchResults .
To do this , import the os library after the others and then add the code you have just written immediately below .þPara hacer esto , importa el módulo os ( debajo de las otra instrucción de importación , from urllib.request import urlopen ) . Ahora bien , como estamos usando los caracteres * y + en nuestra búsqueda en el OBO , y como estos tienen una significación importante en el modo como los sistemas operativos navegan los directorios , es conveniente que los reemplacemos por otros más seguros antes de crear nuestro directorio .þPara fazer isso , importe a biblioteca os após as outras e , depois , adicione o código que acabou de escrever imediatamente abaixo .
Your getSearchResults function should now look like this :þUsaremos expresiones regulares en Python para excluir del nombre de directorio todos los caracteres que no sean alfanuméricos . Python dispone del potente módulo re ( que deberemos importar al inicio del archivo obo.py , debajo de las otras instrucciones de importación ) para ello .þA sua função getSearchResults deve agora se parecer com isso :
The last step for this function is to make sure that when we save our search results pages , we save them in this new directory .þNuestro código `` seguro '' será entonces el siguiente : En la primera línea , la función re.sub busca la expresión regular \W ( que significa : `` cualquier carácter no alfanumérico '' ) en el valor de la variable consulta y lo reemplaza por la cadena vacía '' , es decir , lo elimina .þO último passo para essa função é garantir que , quando salvarmos as nossas páginas de resultados de busca , as armazenaremos nesse novo diretório .
To do this we can make a minor adjustment to the filename variable so that the file ends up in the right place .þEl resultado de este reemplazo se almacena en la variable directorio . ( Es importante que recordemos , en todo caso , que el valor que nuestro programa pasará a la variable de servidor en la URL aún contiene los caracteres * y + .þPara fazer isso , podemos fazer um pequeno ajuste à variável filename de modo a que o ficheiro termine no lugar certo .
There are many ways we can do this , the easiest of which is just to append the new directory name plus a slash to the name of the file :þEste reemplazo solo es para el nombre del directorio .þHá muitas formas de o fazer e a mais fácil é simplesmente adicionar o nome do novo diretório mais uma barra no nome do ficheiro :
If your computer is running Windows you will need to use a backslash instead of a forward slash in the above example .þ)þCaso o seu computador esteja executando o Windows , precisará de uma barra invertida em vez da barra do exemplo acima .
Add the above line to your getSearchResults page in lieu of the current filename description .þAsí las cosas , la función obtener_resultados_consulta deberá quedar así : Muy bien .þAdicione a linha acima à sua função getSearchResults no lugar da descrição atual do filename .
If you are running Windows , chances are your downloadSearches.py program will now crash when you run it because you are trying to create a directory with a * in it .þAhora debemos asegurarnos de que guardemos nuestras páginas de resultados de búsqueda en este nuevo directorio . Podemos hacerlo de muchas maneras , pero la más sencilla es agregar el nuevo nombre del directorio más una barra al nombre del archivo ( en la variable nombre_archivo ) :þSe estiver executando o Windows , é provável que o seu programa downloadSearches.py falhe quando o executar porque está tentando criar um diretório com um * nele .
Windows does not like this . To get around this problem we can use regular expressions to remove any non-Windows-friendly characters .þNota , sin embargo , que este código solo funcionará adecuadamente en MacOS y en Linux , no en Windows , pues este usa la barra invertida \ para demarcar rutas de directorio .þO Windows não gosta disso . Para resolver esse problema podemos usar expressões regulares para remover qualquer caractere não compatível com o Windows .
We used regular expressions previously in Counting Frequencies .þPara asegurarnos de que funcione también en Windows , usaremos la función os.path.join de Python .þUsamos expressões regulares anteriormente em Contagem de Frequências de Palavras com Python .
To remove non-alpha-numeric characters from the query , first import the regular expressions library immediately after you have imported the os library , then use the re.sub ( ) function to create a new string named cleanQuery that contains only alphanumeric characters .þEsta función une adecuadamente las rutas , teniendo en cuenta el sistema operativo donde se corre el programa . Arriba en obo.py la importaremos así :þPara remover caracteres não-alfanuméricos da query , primeiro importe a biblioteca de expressões regulares imediatamente após importar a biblioteca os e , depois , use a função re.sub ( ) para criar uma nova string chamada cleanQuery que contém apenas caracteres alfanuméricos .
You will then have to substitute cleanQuery as the variable used in the os.path.exists ( ) , os.makedirs ( ) , and filename declarations .þ( la importaremos como pjoin porque de lo contrario habría una colisión con la función de concatenación join , que es más fundamental en Python ) . La línea modificada será entonces esta :þDepois precisará de substituir cleanQuery como a variável usada nas declarações de os.path.exists ( ) , os.makedirs ( ) e filename .
The final version of your function should look like this :þAsí pues , el código completo del programa obo.py deberá quedar así :þA versão final da sua função deve-se parecer com isso :
This time we tell the program to download the trials and put them in the new directory rather than our programming-historian directory .þþDessa vez dizemos ao programa para fazer o download dos julgamentos e armazená-los num novo diretório ao invés do nosso diretório programming-historian .
Run download-searches.py once more to ensure this worked and you understand how to save files to a particular directory using Python .þEjecuta el programa descarga_consultas.py una vez más para asegurarte de que funcione y entiendas cómo guardar archivos en un directorio particular usando Python .þExecute o programa download-searches.py mais uma vez para se certificar de que ele funcionou e que entendeu como armazenar os ficheiros num diretório particular usando Python .
Downloading the individual trial entriesþDescargar las entradas individuales de los procesos judicialesþFazendo o Download das Entradas de Julgamento Individuais
At this stage we have created a function that can download all of the search results HTML files from the Old Bailey Online website for an advanced search that we have defined , and have done so programmatically .þA estas alturas hemos creado una función capaz de descargar todos los archivos HTML con los resultados de consulta del sitio web del OBO , para realizar la búsqueda avanzada que hemos definido . Todo esto lo hemos hecho usando Python .þA este ponto , criamos uma função que é capaz de fazer o download de todos os ficheiros HTML de resultados de busca a partir do website Old Bailey Online para uma busca avançada que definimos e desenvolvemos de forma programática .
Now for the next step in the algorithm : Extract the URLs of each trial transcript from the search results HTML files .þPara el siguiente paso del algoritmo , debemos extraer las URLs de cada proceso judicial de los archivos HTML .þAgora o próximo passo do algoritmo : extrair as URLs de cada transcrição de julgamento dos ficheiros HTML de resultados de busca .
In the lessons that precede this one ( eg , Working with Webpages ) , we have worked with the printer friendly versions of the trial transcripts , so we will continue to do so .þEn las lecciones que preceden a esta ( por ejemplo , Descargar páginas web con Python ) , hemos trabajado con versiones para impresión ( printer friendly ) de los procesos judiciales , por lo que continuaremos haciéndolo así aquí .þNas lições que precedem esta ( ex . : Download de Páginas Web com Python ) , trabalhamos com as versões para exibição das transcrições dos julgamentos e continuaremos a fazer isso .
We know that the printer friendly version of Benjamin Bowsey ’ s trial is located at the URL :þSabemos que la versión para impresión del proceso judicial contra Benjamin Bowsey se encuentra en la URL :þSabemos que a versão de exibição do julgamento de Benjamin Bowsey está localizada na URL :
In the same way that changing query strings in the URLs yields different search results , changing the URL for trial records – namely substituting one trial ID for another – we will get the transcript for that new trial .þAsí como al cambiar las cadenas de consulta en las URLs se producen resultados de búsqueda diferentes , así también al cambiar la URL por registros de procesos judiciales —es decir , sustituyendo la ID de un proceso judicial por otra— , obtendremos la transcripción de otro proceso . ( En este caso , la ID del proceso judicial se pasa con la variable de servidor div , cuyo valor en el caso del ejemplo es t17800628-33 .þDa mesma forma que alterar as query strings nas URLs gera resultados de busca diferentes , alterar a URL dos registros de julgamento - no caso , substituir um ID de julgamento por outro - nos fará obter a transcrição para aquele novo julgamento .
This means that to find and download the 13 matching files , all we need are these trial IDs .þ) Esto significa que para descargar los 13 archivos coincidentes , todo lo que necesitamos son las IDs de los procesos judiciales .þIsso significa que , para encontrar e fazer o download dos 13 ficheiros que buscamos , tudo o que precisamos são esses IDs de julgamento .
Since we know that search results pages on websites generally contain a link to the pages described , there is a good chance that we can find these links embedded in the HTML code .þComo sabemos que las páginas de resultados de búsqueda en los sitios web generalmente contienen un enlace a las páginas descritas , es muy probable que podamos encontrar estos enlaces , incrustados en el código HTML .þUma vez que sabemos que essas páginas de resultados de busca geralmente contém um link para as páginas descritas , há uma boa chance de que consigamos encontrar esses links integrados ao código HTML .
If we can scrape this information from the downloaded search results pages , we can then use that information to generate a URL that will allow us to download each trial transcript .þSi en otras lecciones pudimos eliminar esta información de la página que descargamos , ahora podemos usar esa misma información para generar una URL que nos permita descargar cada transcripción del proceso judicial .þSe formos capazes de raspar essa informação das páginas de resultados de busca em que fizemos download , podemos então usar essa informação para gerar uma URL que nos permitirá fazer o download de cada transcrição de julgamento .
This is a technique that you can use for most search result pages , not just Old Bailey Online !þEsta técnica de web scraping se puede usar en la mayoría de las páginas de resultados de búsqueda , no solo la del OBO .þEssa é uma técnica que irá utilizar para a maioria das páginas de resultados de busca , não só o Old Bailey Online !
To do this , we must first find where the trial IDs are amidst the HTML code in the downloaded files , and then determine a way to consistently isolate them using code so that no matter which search results page we download from the site we are able to find the trial transcripts .þPara hacerlo , primero deberemos encontrar dónde están las IDs de cada proceso judicial en medio del código HTML de los archivos descargados . Luego determinaremos una forma de aislarlos consistentemente usando Python , de modo que siempre podamos encontrar las transcripciones de los procesos judiciales , sin importar qué página de resultados de búsqueda descarguemos del sitio .þPara fazer isso , primeiro precisamos encontrar onde os IDs de julgamento estão no código HTML dos ficheiros que fizemos o download e , depois , determinar uma maneira de isolá-los consistentemente usando código de modo a que , independentemente de qual página de resultado de busca fizermos o download , sejamos capazes de encontrar as transcrições de julgamento .
First , open search-results0.html in Komodo Edit and have a look for the list of the trials .þAbre el documento resultado_consulta0.html en tu editor de código y dale un vistazo a la lista de los procesos judiciales .þPrimeiro , abra search-results0.html no Komodo Edit e dê uma olhada na lista de julgamentos .
The first entry starts with “ Anne Smith ” so you can use the “ find ” feature in Komodo Edit to jump immediately to the right spot .þLa primera entrada comenzará con las palabras `` Anne Smith '' , por lo que puedes usar la herramienta de búsqueda de texto de tu editor de código para ir inmediatamente al lugar correcto .þA primeira entrada começa com `` Anne Smith '' , então pode usar o recurso find no Komodo Edit para pular imediatamente para o lugar certo .
Notice Anne ’ s name is part of a link :þFíjate que el nombre `` Anne '' está en el contenido de un enlace ( un elemento de < a > de HTML ) :þObserve que o nome de Anne faz parte de um link :
þEn el lenguaje HTML , el destino de un enlace ( el elemento < a > ) se especifica en el valor del atributo href , que en este caso es :þ
Perfect , the link contains the trial ID !þSaber esto es magnífico , pues podemos ver que el enlace contiene la ID del proceso judicial : t17160113-18 . ¡Excelente !þPerfeito , o link contém o ID do julgamento !
Scroll through the remaining entries and you ’ ll find the same is true .þDesplázate por las entradas restantes y encontrarás lo mismo en todas ellas .þPercorra as entradas restantes e verá que isso é verdade em todos os casos .
Lucky for us , the site is well formatted and it looks like each link starts with “ browse.jsp ? id= ” followed by the trial ID and finished with an & , in Anne ’ s case : “ browse.jsp ?þPor suerte para nosotros , el sitio está bien construido y parece que cada enlace comienza con browse.jsp ? id= , seguido de la ID del proceso judicial , luego un & y luego el resto de variables de servidor .þPara nossa sorte , o site é bem formatado e parece que cada link começa com browse.jsp ? id= seguido pelo ID do julgamento e termina com um & , no caso de Anne : browse.jsp ? id=t17160113-18 & .
id=t17160113-18 & ” . We can write a few lines of code that can isolate those IDs .þEn el caso de Anne Smith : browse.jsp ? id=t17160113-18 & . Vamos entonces a escribir unas líneas de código que capturen estas IDs .þPodemos escrever algumas linhas de código que sejam capazes de isolar esses IDs .
Take a look at the following function .þLas pondremos al final de nuestro programa de Python obo.py . Echa un vistazo al código de la función obtener_procesos_individuales a continuación .þVeja a função a seguir .
This function also uses the os library , in this case to list all of the files located in the directory created in the previous section .þEsta función también utiliza el módulo os de Python , en este caso para enumerar el contenido del directorio que creamos en la sección anterior .þEssa função também usa a biblioteca os , nesse caso para listar todos os ficheiros localizados no diretório criado na seção anterior .
The os library contains a range of useful functions that mirror the types of tasks you would expect to be able to do with your mouse in the Mac Finder or Windows such as opening , closing , creating , deleting , and moving files and directories , and is a great library to master – or at least familiarize yourself with .þ( Este módulo contiene una gama de funciones útiles que reflejan los tipos de tareas que podrías realizar con tu ratón en el Finder de Mac o el Explorador de Windows , como abrir , cerrar , crear , eliminar y mover archivos y directorios . Es un módulo magnífico que deberíamos dominar o , al menos , familiarizarnos con él .þA biblioteca os possui uma gama de funções úteis que imitam os tipos de tarefas que esperaria ser capaz de fazer com o seu mouse no Mac Finder ou Windows , como abrir , fechar , criar , deletar e mover ficheiros e diretórios , e é uma boa biblioteca a ser masterizada - ou pelo menos para se familiarizar .
Create and run a new program called extract-trial-ids.py with the following code .þ) Ahora crea y ejecuta un nuevo programa de Python llamado extraer_id_proceso.py con el siguiente código :þCrie e execute um novo programa chamado extract-trials-ids.py com o código a seguir .
Make sure you input the same value into the query argument as you did in the previous example :þAsegúrate de introducir el mismo valor en el argumento de consulta como en el ejemplo anterior ( mulatto * +negro * ) .þCertifique-se de inserir o mesmo valor nos argumentos da query como fez no exemplo anterior :
If everything went right , you should see a list containing the names of all the files in your new “ mulatto * +negro * ” directory , which at this point should be the two search results pages .þSi todo sale bien , Python imprimirá una lista con los nombres de todos los archivos que están en la nueva carpeta , algo como : Por ahora deberán ser solamente las dos páginas con los resultados de búsqueda .þSe tudo correu bem , deve ver uma lista contendo o nome de todos os ficheiros no seu novo diretório mulatto * +negro * , que a essa altura devem ser as duas páginas de resultados de busca .
Ensure this worked before moving forward .þAsegúrate de que esto funcione antes de seguir adelante .þCertifique-se de que isso funcionou antes de prosseguir .
Since we saved all of the search results pages with a filename that includes “ search-results ” , we now want to open each file with a name containing “ search-results ” , and extract all trial IDs found therein .þDado que hemos guardado todas las páginas de resultados usando nombres de archivo que contienen la expresión resultado_consulta , podemos abrir cada uno de ellos y extraer todas las IDs de los procesos judiciales que se encuentran en él .þUma vez que armazenamos todas as páginas de resultados de busca com um nome de ficheiro que inclui search-results , agora desejamos abrir todos os ficheiros cujo nome contenha search-results e extrair todos os IDs de julgamento encontrados neles .
In this case we know we have 2 , but we want our code to be as reusable as possible ( with reason , of course !þEn este caso , sabemos que solo hay dos , aunque queremos que nuestro código sea lo más flexible posible , desde luego .þNesse caso sabemos que temos 2 , mas desejamos que o nosso código seja o mais reutilizável possível ( com razão , é claro !
) Restricting this action to files named “ search-results ” will mean that this program will work as intended even if the directory contains many other unrelated files because the program will skip over anything with a different name .þAl restringir esta acción exclusivamente a los archivos cuyos nombres contienen la expresión resultado_consulta , nuestro programa funcionará como lo esperamos , incluso si el directorio contiene muchos otros archivos no relacionados porque el programa saltará cualquier cosa con un nombre diferente .þ) . Restringir essa ação a ficheiros denominados search-results significará que este programa funcionará como pretendido , mesmo que o diretório contenha muitos outros ficheiros não relacionados , já que o programa ignorará qualquer coisa com nome diferente .
Add the following to your getIndivTrials ( ) function , which will check if each file contains “ search-results ” in its name .þAgrega el siguiente código a la función obtener_procesos_individuales ( en el programa obo.py ) . El código pasará por cada archivo contenido en el directorio creado anteriormente y comprobará si su nombre contiene la expresión resultado_consulta .þAdicione o código a seguir à sua função getIndivTrials ( ) , que verificará se cada ficheiro contém search-results no seu nome .
If it does , the file will be opened and the contents saved to a variable named text .þEn caso positivo , el archivo se abrirá y los contenidos se guardarán en una variable llamada texto .þEm caso verdadeiro , o ficheiro será aberto e o conteúdo será salvo na variável chamada text .
That text variable will then be parsed looking for the trial ID , which we know always follows “ browse.jsp ? id= ” .þEl contenido de dicha variable se analizará luego para aislar la ID del proceso judicial , que sabemos que siempre está ubicada a la derecha de la expresión browse.jsp ? id= en la URL . Cuando el programa encuentre la ID del proceso judicial , se guardará en una lista de Python y se imprimirá en pantalla . Este código puede parecer algo complicado a primera vista , pero vamos a desmenuzarlo y verás que no es tan difícil . Las líneas ① y ④ usan el operador de continencia in de Python , en este caso entre cadenas .þEssa variável text será analisada na busca por um ID de julgamento , que sabemos que sempre segue browse.jsp ? id= .
If and when that trial ID is found it will be saved to a list and printed to the command output , which leaves us with all of the information we need to then write a program that will download the desired trials .þLa expresión : es verdadera solo si < cadena1 > es una subcadena de < cadena2 > , es decir , si los caracteres de la primera cadena están contenidos , en el mismo orden , en la segunda cadena .þSe e quando o ID de julgamento for encontrado , ele será armazenado numa lista e exibido na Saída de Comando , que nos deixa com todas as informações que precisamos para então escrever o programa que fará o download dos julgamentos desejados .
That last line of the for loop may look tricky , but make sure you understand it before moving on .þPor ejemplo , lo siguiente es verdadero : pero esto es falso :þEssa última linha do for loop pode parecer confusa , mas certifique-se de que entendeu antes de seguir em frente .
The words variable is checked to see if it contains the characters “ id= ” ( without the quotes ) , which of course refers to a specific trial transcript ID .þEn ese sentido , lo que las líneas ① y ④ hace es verificar que estemos seleccionando el archivo apropiado ( según nuestra convención de denominación ) , en el primer caso ; y si la `` palabra '' que estamos procesando contiene la expresión browse.jsp ? id= , en el segundo . Veamos ahora la importancia de esa expresión , para lo cual pasemos al bucle for en ③. Este bucle iterará por cada una de las `` palabras '' del documento HTML que estamos procesando .þA variável words é verificada para saber se contém os caracteres id= ( sem aspas ) , que obviamente se referem a um ID específico de transcrição de julgamento .
þLa línea ② ha guardado una lista enorme de palabras en la variable texto .þ
þPython ha partido todo el archivo con la función split , cuyo argumento es un espacio en blanco ( ' ' ) .þ
þEsto quiere decir que Python separará todo el documento donde haya espacios .þ
þEstas serán nuestras `` palabras '' , si se nos permite la expresión : Anne , Smith , href= '' browse.jsp ? id=t17160113-18 & amp ; div=t17160113-18 & amp ; terms=mulatto * _negro * # highlight '' > , etc. Nuestro for pasará por cada una de ellas .þ
þComo vimos , la línea ④ examinará si la expresión browse.jsp ? id= está contenida en la `` palabra '' .þ
þEs decir , determinará si ahí es donde está guardada la ID del proceso judicial que estamos buscando .þ
If it does , we use the slice string method to capture only the chunk between id= and & and append it to the url list .þSi esto es el caso , en la línea ⑤ aislaremos la parte de la expresión capturada en la palabra , la ID . Para esto usamos un grupo de captura de expresiones regulares , que se indican entre paréntesis .þCaso contenha , usamos o método de string slice para capturar apenas o trecho entre id= e & e o adicionamos à lista de url .
þMiremos en el documento HTML una de estas `` palabras '' que nos interesan :þ
þSubrayemos la parte que nos interesa únicamente :þ
If we knew the exact index positions of this substring we could have used those numerical values instead .þNuestro grupo de captura tomará el texto que va desde id= hasta el primer & ( excluyéndolos en el texto capturado ) . Eso es justo lo que significa la expresión regular id= ( .+ ? ) & .þSe soubéssemos as posições exatas dos índices dessa substring , poderíamos ter usado esses valores numéricos no lugar .
However , by using the find ( ) string method we have created a much more flexible program .þEn efecto , .+ ? significa : captura cualquier carácter ( . ) una o más veces ( + ) , pero hazlo sin codicia ( ? ) , es decir , detén la búsqueda apenas encuentres el primer & ; y finalmente guarda el texto hallado en un grupo de captura ( ( , ) ) . Python enumera secuencialmente los grupos de captura .þNo entanto , ao utilizar o método de string find ( ) , criamos um programa muito mais flexível .
The following code does exactly the same thing as that last line in a less condensed manner .þEn nuestra expresión regular solo hay un grupo ; por lo tanto , será el grupo 1 . La línea ⑥ guarda el contenido de ese grupo —nuestra ID— en la variable url .þO código a seguir faz exatamente a mesma coisa que essa última linha , mas de maneira menos condensada :
þFinalmente , la línea ⑦ la añade como un ítem adicional en nuestra lista urls , que luego aprovecharemos .þ
When you re-run extract-trial-ids.py , you should now see a list of all the trial IDs .þCuando vuelvas a ejecutar el programa extraer_id_procesos.py , verás una lista de todas las ID de los procesos judiciales .þAo executar novamente o programa extract-trial-ids.py , deve ver uma lista de todos os IDs de julgamento .
We can add a couple extra lines to turn these into proper URLs and download the whole list to our new directory .þPodemos agregar un par de líneas adicionales para convertirlas en URLs adecuadas y descargar la lista completa en nuestro nuevo directorio .þPodemos adicionar algumas linhas extra para transformá-los em URLs propriamente ditos e fazer o download de toda a lista para o nosso novo diretório .
We ’ ll also use the time library to pause our program for three seconds between downloads– a technique called throttling .þAsimismo , usaremos el módulo time de Python para pausar nuestro programa durante tres segundos entre las descargas . Esta técnica es llamada `` regulación '' o `` limitación '' ( throttling , en inglés ) .þTambém vamos usar a biblioteca time para pausar o nosso programa por 3 segundos entre cada download - uma técnica chamada throttling ( em português , estrangulamento ) .
It ’ s considered good form not to pound someone ’ s server with many requests per second ; and the slight delay makes it more likely that all the files will actually download rather than time out .þSe considera una buena forma de no golpear el servidor de alguien con muchas solicitudes por segundo ; y el ligero retraso hace que sea más probable que todos los archivos se descarguen antes de agotar nuestro tiempo de conexión ( véase time out ) . Elimina la línea que dice print ( urls ) y pon en su lugar el código de abajo ( ten en cuenta que quede sangrado exactamente donde estaba esa línea ) .þÉ considerada uma boa forma de não sobrecarregar o servidor de alguém com muitas solicitações por segundo ; e o pequeno retardamento torna mais fácil que todos esses ficheiros sejam , de fato , baixados ao invés de ocorrer um time out .
Add the following code to the end of your getIndivTrials ( ) function .þAgrega el siguiente código al final de la función obtener_procesos_individuales , luego de la línea que tiene urls.append ( url ) .þAdicione o código a seguir ao final da sua função getIndivTrials ( ) .
This code will generate the URL of each individual page , download the page to your computer , place it in your new directory , save the file , and pause for 3 seconds before moving on to the next trial .þEste código generará la URL de cada página individual , la descargará en tu computador en directorio ya creado , guardará el archivo y se detendrá durante 3 segundos antes de pasar al siguiente proceso judicial .þEsse código vai gerar uma URL para cada página individualmente , fará o download da página no seu computador , irá colocá-lo no seu diretório , armazenar o ficheiro e pausar por 3 segundos antes de continuar para o próximo julgamento .
This work is all contained in a for loop , and will run once for every trial in your url list .þTodo lo siguiente está contenido en un bucle for que se ejecutará una vez por cada proceso en tu lista de URLs . ( Nota que en la instrucción with open usamos la variable f2 en lugar de f .þTodo esse trabalho está contido num for loop e será executado uma vez para cada julgamento na sua lista de urls .
þEso es porque todo este código está incluido en bloque with open abierto , que ya ha definido la variable f .þ
If we put this all together into a single function it should look something like this . ( Note , we ’ ve put all the “ import ” calls at the top to keep things cleaner ) .þ) Si juntamos todo en una sola función , debería verse algo como lo que sigue . Hemos añadido también un par de print s para ir viendo cómo avanza nuestro programa :þSe unirmos tudo numa única função , ela deve-se parecer com isso ( note que adicionamos todas as chamadas por import no início para manter as coisas claras ) :
Let ’ s add the same three-second pause to our getSearchResults function to be kind to the Old Bailey Online servers :þAhora agreguemos la misma pausa de tres segundos a nuestra función obtener_resultados_consulta para ser amables con los servidores del OBO :þVamos adicionar a mesma pausa de três segundos à nossa função getSearchResults para ser amigável aos servers do Old Bailey Online :
Finally , call the function in the download-searches.py program .þFinalmente , llama a la función desde el programa descarga_consultas.py .þFinalmente , chame a função no programa download-searches.py :
Now , you ’ ve created a program that can request and download files from the Old Bailey website based on search parameters you define , all without visiting the site !þHas creado un programa que puede solicitar y descargar archivos del sitio web del OBO , según los parámetros de búsqueda que definiste , ¡todo sin visitar manualmente el sitio !þAgora criou um programa que é capaz de fazer a solicitação e o download de ficheiros do Old Bailey website , baseado em parâmetros de busca que definiu , tudo sem visitar o site !
In case a file does not downloadþSi los archivos no se descarganþNo Caso de um Ficheiro Não Ser Baixado
Check to make all thirteen files have downloaded properly .þComprueba que los 13 archivos se hayan descargado correctamente .þVerifique se o download dos treze ficheiros foi realizado corretamente .
If that ’ s the case for you , that ’ s great !þÁbrelos en tu navegador web y verifica que estén bien . Si es así , ¡genial !þSe esse for o caso , ótimo !
However , there ’ s a possibility that this program stalled along the way .þSin embargo , existe la posibilidad de que el programa se atore en el proceso .þNo entanto , há a possibilidade de que esse programa tenha parado no meio do caminho .
That ’ s because our program , though running on your own machine , relies on two factors outside of our immediate control : the speed of the Internet , and the response time of the Old Bailey Online server at that moment .þEsto se debe a que , aunque el programa se ejecute en nuestra propia máquina , se basa en dos factores que están fuera de nuestro control inmediato : la velocidad de Internet y el tiempo de respuesta del servidor del OBO en ese momento .þIsso porque o nosso programa , ao ser executado na nossa máquina , depende de dois fatores além do nosso controle imediato : a velocidade da internet e a o tempo de resposta do server do Old Bailey Online naquele momento .
It ’ s one thing to ask Python to download a single file , but when we start asking for a file every 3 seconds there ’ s a greater chance the server will either time out or fail to send us the file we are after .þUna cosa es pedirle a Python que descargue un solo archivo ; pero cuando le pedimos que descargue un archivo cada 3 segundos , existe una gran probabilidad de que el servidor agote el tiempo de conexión o no nos envíe el archivo que buscamos .þUma coisa é pedir que o Python faça o download de um único ficheiro , mas quando começamos a solicitar um ficheiro a cada três segundos , há grandes chances de ocorrer um time out no server ou que ele falhe em nos enviar o ficheiro que estamos buscando .
If we were using a web browser to make these requests , we ’ d eventually get a message that the “ connection had timed out ” or something of the sort .þSi estuviéramos usando un navegador web para hacer estas solicitudes , eventualmente recibiríamos un mensaje diciendo : '' La conexión se ha agotado '' o algo por el estilo .þSe estivermos usando um navegador web para fazer essas solicitações , eventualmente receberíamos uma mensagem de que `` a conexão expirou '' ou algo do tipo .
We all see this from time to time .þTodos vemos esto de vez en cuando .þTodos nós vemos isso de tempos em tempos .
However , our program isn ’ t built to handle or relay such error messages , so instead you ’ ll realize it when you discover that the program has not returned the expected number of files or just seemingly does nothing .þSin embargo , nuestro programa no está diseñado para manejar o transmitir dichos mensajes de error . En su lugar , te darás cuenta de que algo malo pasa , cuando descubras que el programa no ha devuelto el número esperado de archivos o que simplemente no hace nada .þNo entanto , o nosso programa não foi desenvolvido para lidar ou retransmitir essas mensagens de erro , então só perceberá o problema quando o programa não tiver retornado o número esperado de ficheiros ou simplesmente não fizer nada .
To prevent frustration and uncertainty , we want a fail-safe in our program that will attempt to download each trial .þPara evitar la frustración y la incertidumbre , queremos un programa a prueba de fallas que intente descargar cada proceso judicial .þPara evitar frustrações e incertezas , queremos um sistema à prova de falha no nosso programa , que tentará baixar cada julgamento .
If for whatever reason it fails , we ’ ll make a note of it and move on to the next trial .þSi por alguna razón falla , lo anotaremos y pasaremos al siguiente proceso .þSe por alguma razão ele falhar , apontaremos o problema e passaremos para o próximo julgamento .
To do this , we will make use of the Python try / except error handling mechanism , as well as a new library : socket .þPara hacer esto , haremos uso del mecanismo de manejo de errores y excepciones ( try/except ) de Python ( ver errores y excepciones ) , así como otro módulo de Python socket .þPara fazer isso , utilizaremos os mecanismos para lidar com erros do Python , try / except , bem como uma nova biblioteca : socket .
Try and Except are a lot like an if / else statement .þtry/except se parece mucho a una declaración if/else .þTry e Except são muito parecidos com um if / else statement .
When you ask Python to try something , it will attempt to run the code ; if the code fails to achieve what you have defined , it will run the except code .þCuando le pides a Python que pruebe algo ( try ) , intentará ejecutar el código . Si el código no logra hacer lo que se ha definido , ejecutará el código except .þQuando solicita que o Python try ( em português , tente ) algo , ele tentará executar o código ; caso o código falhe em alcançar o que definiu , ele executará o código em except ( em português , exceção ) .
This is often used when dealing with errors , known as error handling .þEsto se conoce como manejo de errores y se usa con mucha frecuencia .þIsso é frequentemente usado ao lidar com erros , conhecido como “ error handling ” .
We can use this to our advantage by telling our program to attempt downloading a page .þPodemos tomar ventaja de esto diciéndole a nuestro programa que intente descargar una página .þPodemos usá-lo a nosso favor dizendo ao programa para tentar fazer o download de uma página .
If it fails , we ’ ll ask it to let us know which file failed and then move on .þSi esto falla , le pediremos que nos informe qué archivo no se pudo descartar y luego seguiremos adelante .þCaso o programa falhe , solicitaremos que ele nos informe qual ficheiro falhou e depois prossiga .
To do this we need to use the socket library , which will allow us to put a time limit on a download attempt before moving on .þPara esto necesitamos usar el módulo socket , que nos permitirá poner un límite de tiempo en un intento de descarga antes de continuar .þPara fazer isso precisamos de usar a biblioteca socket , que nos permitirá definir um limite de tempo para um download antes de seguir em frente .
This involves altering the getIndivTrials function .þEsto implica alterar la función obtener_procesos_individuales .þIsso envolve alterar a função getIndivTrials .
First , we need to load the socket library , which should be done in the same way as all of our previous library imports .þPrimero debemos importar el módulo socket , lo que debe hacerse de la misma manera que todas nuestras importaciones de módulos anteriores .þPrimeiro , precisamos de carregar a biblioteca socket , o que deve ser feito da mesma forma que todos as outras importações de biblioteca .
Then , we need to import the urllib.error library , which allows us to handle download errors .þþDepois , precisamos de importar a biblioteca urllib.error , que nos permite lidar com erros de download .
We will also need to set the default socket timeout length – how long do we want to try to download a page before we give up .þTambién tendremos que establecer la duración predeterminada del tiempo de espera de socket : cuánto tiempo intentaremos descargar una página antes de darnos por vencidos .þTambém precisamos de definir o tamanho do timeout padrão do socket - por quanto tempo desejamos tentar fazer o download de uma página antes de desistirmos .
This should go immediately after the comment that begins with # download the pageþEsto debe escribirse inmediatamente después del comentario # descarga la páginaþIsso deve entrar imediatamente após o comentário que começa com # faz o download da página :
Then , we need a new python list that will hold all of the urls that failed to download .þþEntão , precisamos de uma nova lista de Python que armazenará todas as urls cujo download falhou .
We will call this failedAttempts and you can insert it immediately after the import instructions : Finally , we can add the try / except statement , which is added in much the same way as an if / else statement would be .þA continuación , agregaremos la declaración try/except .þVamos chamá-la de failedAttempts e pode inserí-la imediatamente após as instruções de importação : Finalmente , podemos adicionar o try / except statement de forma muito similar a como um if / else statement seria adicionado .
In this case , we will put all of the code designed to download and save the trials in the try statement , and in the except statement we will tell the program what we want it to do if that should fail .þEn este caso , pondremos todo el código diseñado para descargar y guardar los procesos judiciales en la declaración try , y en la declaración except le diremos al programa lo que queremos que haga si eso falla .þNesse caso , vamos colocar todo o código desenvolvido para fazer o download e armazenar os julgamentos no try statement , e no except statement vamos dizer ao programa o que desejamos que ele faça caso falhe .
Here , we will append the url that failed to download to our new list , failedAttempts Finally , we will tell the program to print the contents of the list to the command output so we know which files failed to download .þAunque podríamos dejar la línea de la excepción de manera genérica ( simplemente con un except : ) , Python recomienda especificar el tipo de excepción ocurrida .þAqui , vamos adicionar a url cujo download falhou à nossa nova lista , failedAttempts : Finalmente , diremos ao programa para exibir os conteúdos da lista na Saída de Comando de modo que saibamos quais ficheiros falharam no download .
This should be added as the last line in the function .þPara ello usamos except OSError as msg : . Esto nos dice que la excepción es de tipo OSError y guardará los detalles en la variable msg .þIsso deve ser adicionado nas linhas finais da função :
Now when you run the program , should there be a problem downloading a particular file , you will receive a message in the Command Output window of Komodo Edit . This message will contain any URLs of files that failed to download .þSi surge un problema al descargar un determinado archivo , recibirás un mensaje en el terminal .þAgora ao executarmos o programa , caso haja algum problema no download de um ficheiro específico , receberá uma mensagem na janela de Saída de Comando do Komodo Edit . Essa mensagem irá conter quaisquer URLs dos ficheiros que falharam no download .
If there are only one or two , it ’ s probably fastest just to visit the pages manually and use the “ Save As ” feature of your browser .þSi solo hay uno o dos archivos no descargados , probablemente sea más rápido visitar las páginas manualmente y usar la función `` Guardar como ... '' de tu navegador .þCaso haja apenas um ou dois , provavelmente é mais fácil simplesmente visitar as páginas manualmente e usar o recurso de `` Salvar Como '' do seu navegador .
If you are feeling adventurous , you could modify the program to automatically download the remaining files .þPero si tienes espíritu de aventura puedes modificar el programa para descargar automáticamente los archivos restantes .þCaso se esteja sentindo aventureiro , poderia modificar o programa para automaticamente fazer o download dos ficheiros faltantes .
The final version of your getSearchResults ( ) and getIndivTrials ( ) functions should now look like this :þEl archivo obo.py terminado deberá verse como esto : Próximos pasos : usar una interfaz de programación de aplicaciones ( API )þA versão final das suas funções getSearchResults ( ) e getIndivTrials ( ) deve-se parecer com isso :
Further Reading For more advanced users , or to become a more advanced user , you may find it worthwhile to read about achieving this same process using Application Programming Interfaces ( API ) .þPara usuarias/os más avanzadas/os , o para adquirir más destreza , vale la pena leer acerca de cómo lograr este mismo proceso utilizando las interfaces de programación de aplicaciones ( API ) .þLeituras Adicionais Para usuários mais avançados , ou para se tornar um usuário mais avançado , pode achar que vale a pena ler sobre como alcançar esse mesmo processo usando Interfaces de Programação de Aplicações ( API ) .
A website with an API will generally provide instructions on how to request certain documents .þUn sitio web con una API generalmente proporcionará instrucciones sobre cómo solicitar ciertos documentos .þGeralmente , um website com uma API dá instruções de como solicitar certos documentos .
It ’ s a very similar process to what we just did by interpreting the URL Query Strings , but without the added detective work required to decipher what each variable does .þEs un proceso muy similar al que acabamos de hacer interpretando las cadenas de consulta de URL , pero sin el trabajo adicional de detective que hicimos para descifrar el comportamiento de cada variable .þÉ um processo bastante similar ao que acabamos de fazer interpretando a Query String de URL , mas sem o trabalho de investigação adicional necessário para decifrar o que cada variável faz .
If you are interested in the Old Bailey Online , they have recently released an API and the documentation can be quite helpful :þSi tienes interés en el OBO , el sitio cuenta con una buena API y su documentación es muy útil . NotasþCaso esteja interessado no Old Bailey Online , recentemente liberaram uma API e a documentação pode ajudar bastante :
þ: El Tribunal Penal Central de Inglaterra y Gales es conocido también como el OBO , por la calle en la que está ubicada en Londres .þ
þEl sitio web del OBO contiene los registros judiciales de dicho tribunal desde 1674 hasta * 1913 .þ
þ( N. de T .þ
Old Bailey Online API ( http : //www.oldbaileyonline.org/static/DocAPI.jsp )þ) : Hemos dejado los términos de búsqueda en inglés , ya que son los que arrojan resultados en la página web de Old Bailey Online .þOld Bailey Online API ( http : //www.oldbaileyonline.org/static/DocAPI.jsp )
þ( N. de T .þ
þ)þ
þ: El eufemismo `` n-word '' se refiere a una de las palabras más ofensivas que existe en lengua inglesa para designar a los afrodescendientes .þ
Python Best way to create directory if it doesn ’ t exist for file write ?þPuede verse una explicación [ aquí ] aquí . ( N. de T .þMelhor maneira de criar um diretório para gravação de ficheiros , se ele não existir , usando Python ?
( http : //stackoverflow.com/questions/273192/python-best-way-to-create-directory-if-it-doesnt-exist-for-file-write )þ) : Aquí usaremos el término `` `` para las variables que se asignan en un URL y que son procesados por el servidor ( PhP , Ruby on Rails , Flask , etc. ) .þ( http : //stackoverflow.com/questions/273192/python-best-way-to-create-directory-if-it-doesnt-exist-for-file-write )
