Lesson GoalsþObjetivos de la lección
The collections of the Internet Archive ( IA ) include many digitized sources of interest to historians , including early JSTOR journal content , John Adams 's personal library , and the Haiti collection at the John Carter Brown Library .þLas colecciones del Internet Archive ( IA ) incluyen muchas fuentes digitalizadas de interés para los historiadores , entre las cuales se incluyen el JSTOR Early Journal Content , la biblioteca personal de John Adams y la colección Haití de la biblioteca John Carter Brown .
In short , to quote Programming Historian Ian Milligan , `` The Internet Archive rocks .þEn resumen , para citar al historiador-programador Ian Milligan , `` The Internet Archive rocks .
''þ''
In this lesson , you 'll learn how to download files from such collections using a Python module specifically designed for the Internet Archive . You will also learn how to use another Python module designed for parsing MARC XML records , a widely used standard for formatting bibliographic metadata .þEn esta lección aprenderás a descargar archivos desde esas colecciones usando un módulo de Python diseñado específicamente para el análisis semántico de registros MARC XML , un estándar usado comúnmente para dar formato a los metadatos bibliográficos .
For demonstration purposes , this lesson will focus on working with the digitized version of the Anti-Slavery Collection at the Boston Public Library in Copley Square .þPara fines demostrativos , esta lección se enfocará en trabajar con la versión digitalizada de la Anti-Slavery Collection de la Biblioteca Pública de Boston de Copley Square .
We will first download a large collection of MARC records from this collection , and then use Python to retrieve and analyze bibliographic information about items in the collection .þPrimero descargaremos una cantidad relativamente grande de registros MARC desde esa colección , luego , usaremos Python para recolectar y analizar la información bibliográfica asociada a los elementos en esta colección .
For example , by the end of this lesson , you will be able to create a list of every named place from which a letter in the antislavery collection was written , which you could then use for a mapping project or some other kind of analysis .þPor ejemplo , al finalizar esta lección , serás capaz de crear una lista con el nombre de cada lugar desde el cual las cartas de la Anti-Slavery Collection fueron escritas , la cual podrás utilizar posteriormente para un proyecto de creación de mapas o algún otro tipo de análisis .
For Whom Is This Useful ?þ¿Para quién es útil esta lección ?
This intermediate lesson is good for users of the Programming Historian who have completed general lessons on downloading files and performing text analysis on them , but would like an applied example of these principles .þEsta lección de nivel intermedio es útil para los usuarios de Programming Historian que hayan completado las lecciones generales acerca de cómo descargar archivos y llevar a cabo análisis de textos en ellos , o que quieran ejemplos aplicados de aquellos principios .
It will also be of interest to historians or archivists who work with the MARC format or the Internet Archive on a regular basis .þTambién puede ser de interés para historiadores o archivistas que trabajen regularmente con formato MARC o con el Internet Archive .
Before You BeginþAntes de empezar
To write scripts that interact with the Internet Archive , you will first need to create an IA account .þEs necesario crear una cuenta para poder esccribir scripts que interactúen con el Internet Archive .
Follow the steps to confirm your account and carefully note down your email address and password .þSigue los pasos necesarios para confirmar tu cuenta , con especial cuidado de tu cuenta de correo y contraseña .
We will be working with two Python modules that are not included in Python 's standard library .þTrabajaremos con dos módulos de Python que no están incluidos en la librería estándar .
The first , internetarchive , provides programmatic access to the Internet Archive .þEl primero , internetarchive , provee acceso programático al Internet Archive .
The second , pymarc , makes it easier to parse MARC records .þEl segundo , pymarc , hace más sencillo el análisis de los registros MARC .
The easiest way to download both is to use pip , the python package manager .þLa manera más sencilla para descargarlos es mediante el uso de pip , el administrador de paquetes de Python .
Begin by installing pip using Fred Gibbs ' Installing Python Modules with pip .þComienza por instalar pip siguiendo la lección de Fred Gibbs : Instalar módulos de Python con pip .
Then issue these commands at the command line : To install internetarchive :þEscribe lo siguiente en la línea de comandos para instalar internetarchive :
Now you will need to configure your computer so that the new package will work .þAhora debes configurar tu ordenador de tal manera que el nuevo paquete funcione .
Type ia configure at the command line , and then enter in the email address and password you used above to create your Internet Archive account .þEscribe ia configure en la línea de comandos y después ingresa el nombre de la cuenta de correo y la contraseña con las que creaste tu cuenta en el Internet Archive .
To install pymarc :þDespués instala pymarc :
Now you are ready to go to work !þ¡Ahora estás listo para trabajar !
The Antislavery Collection at the Internet ArchiveþLa Antislavery Collection en el Internet Archive
The Boston Public Library 's anti-slavery collection at Copley Square contains not only the letters of William Lloyd Garrison , one of the icons of the American abolitionist movement , but also large collections of letters by and to reformers somehow connected to him .þLa Anti-Slavery Collection de la Biblioteca Pública de Boston en Copley Square contiene no solo las cartas de William Lloyd Garrison , uno de los personajes icónicos en el movimiento abolicionista estadounidense ; también custodia una inmensa colección de cartas enviadas y recibidas por los reformadores conectados de alguna manera con su persona .
And by `` large collection , '' I mean large .þY por `` inmensa colección '' me refiero a gigantesca .
According to the library 's estimates , there are over 16,000 items at Copley .þDe acuerdo con los cálculos de la biblioteca hay más de 16 000 elementos en Copley .
As of this writing , approximately 7,000 of those items have been digitized and uploaded to the Internet Archive .þEn el momento de escribir esta lección , aproximadamente 7 000 de aquellos elementos habían sido digitalizados y subidos al Internet Archive .
This is good news , not only because the Archive is committed to making its considerable cultural resources free for download , but also because each uploaded item is paired with a wealth of metadata suitable for machine-reading .þEsta es una buena noticia , no solo porque IA esté comprometido en poner sus considerables recursos culturales para la libre consulta , también porque cada elemento incorporado está acompañado por una riqueza de metadatos apropiada para la lectura por parte del ordenador .
Take this letter sent by Frederick Douglass to William Lloyd Garrison .þConsulta esta carta enviada por Frederick Douglass a William Lloyd Garrison .
Anyone can read the original manuscript online , without making the trip to Boston , and that alone may be enough to revolutionize and democratize future abolitionist historiography .þCualquiera puede leer el manuscrito original en línea sin hacer el viaje a Boston , y solo eso sería suficiente para revolucionar y democratizar la futura historiografía del abolicionismo .
But you can also download multiple files related to the letter that are rich in metadata , like a Dublin Core record and a fuller MARCXML record that uses the Library of Congress 's MARC 21 Format for Bibliographic Data .þPero puedes , también , descargar múltiples archivos asociados con la carta , que ha sido enriquecida con metadatos , como un registro Dublin Core y un completo registro MARCXML que usa el formato MARC 21 de la Biblioteca del Congreso para datos bibliográficos .
Stop and think about that for a moment : every item uploaded from the Collection contains these things . Right now , that means historians have access to rich metadata , full images , and partial descriptions for thousands of antislavery letters , manuscripts , and publications .þDetente y piensa por un momento : ahora mismo , cada elemento subido a la colección contiene esas cosas , lo cual significa que los historiadores tienen acceso a metadatos enriquecidos , imágenes completas y descripciones parciales de cientos de cartas , manuscritos y publicaciones antiesclavistas .
Accessing an IA Collection in PythonþAcceder a una colección del IA con Python
Internet Archive ( IA ) collections and items all have a unique identifier , and URLs to collections and items all look like this :þTodas las colecciones y archivos del Internet Archive ( IA ) tienen un identificador único , por lo cual todas las URL de las colecciones y archivos se ven así :
So , for example , here is a URL to the Archive item discussed above , Douglass 's letter to Garrison :þPor ejemplo , esta es una URL al elemento mencionado arriba , la carta de Douglass a Garrison :
And here is a URL to the entire antislavery collection at the Boston Public Library :þY esta es la URL a la Anti-Slavery Collection de la Biblioteca Pública de Boston :
Because the URLs are so similar , the only way to tell that you are looking at a collection page , instead of an individual item page , is to examine the page layout .þDebido a que estas URL son tan similares , la única manera de distinguir si se está consultando la página de una colección , en lugar de la de un elemento particular , consiste en examinar la distribución ( layout ) de la página .
An item page usually has a lefthand sidebar that says `` View the Book '' and lists links for reading the item online or accessing other file formats .þLa página de un elemento contiene una previsualización del libro en la cabecera de la página y en la columna derecha un listado de enlaces para descargar el archivo en otros formatos .
A collection page will probably have a '' Spotlight Item '' in the lefthand sidebar instead .þLa página de una colección despliega una galería de miniaturas y una serie de opciones para refinar la búsqueda en la columna izquierda .
You can browse to different collections through the eBook and Texts portal , and you may also want to read a little bit about the way that items and item URLs are structured .þPuedes navegar por diferentes colecciones a través del portal eBook and Texts . También querrás leer algo acerca de cómo los elementos y sus URL están estructurados .
Once you have a collection 's identifier—in this case , bplscas —seeing all of the items in the collection is as easy as navigating to the Archive 's advanced search page , selecting the id from the drop down menu next to `` Collection , '' and hitting the search button .þUna vez que tengas el identificador de una colección — bplscas en este caso— ver todos los elementos de la colección es tan sencillo como navegar a la página de búsqueda avanzada del IA , seleccionar la id del menú desplegable junto a Collection , y hacer clic en el botón de búsqueda Search .
Performing that search with bplscas selected returns this page , which as of this writing showed 7,029 results .þAl seleccionar bplscas en al búsqueda se obtiene esta página , que al momento de escribir esta lección mostraba 7 029 resultados .
We can also search the Archive using the Python module that we installed , and doing so makes it easier to iterate over all the items in the collection for purposes of further inspection and downloading .þTambién podemos buscar en el Internet Archive usando el módulo de Python que instalamos : al hacerlo es más fácil iterar sobre todos los elementos de la colección con el propósito de realizar posteriores inspecciones y descargas .
For example , let 's modify the sample code from the module's documentation to see if we can tell , with Python , how many items are in the digital Antislavery Collection .þPor ejemplo , vamos a modificar el código de ejemplo de la documentación del módulo con el fin de ver si podemos saber , con Python , cuántos elementos hay en la Anti-Slavery Collection .
The sample code looks something like what you see below .þEl código de ejemplo luce similar al que ves debajo .
The only difference is that instead of importing only the search_items module from internetarchive , we are going to import the whole library .þLa única diferencia es que en lugar de importar tan solo los módulos search_items desde internetarchive vamos a importar la totalidad de la biblioteca .
All we should need to modify is the collection identifier , from nasa to bplscas .þTodo lo que debemos hacer consiste en modificar el identificador de la colección : de nasa a bplscas .
After starting your computer 's Python interpreter , try entering each of the above lines , followed by enter , but modify the collection id in the second command :þDespués de iniciar el intérprete del ordenador intenta ingresar cada una de las líneas anteriores seguidas por Enter , pero modificando el id de la colección en el segundo comando :
After hitting enter on the print command , you should see a number that matches the number of results you saw when doing the advanced search for the collection in the browser .þDespués de pulsar Enter en el comando de impresión deberías ser capaz de ver un número que corresponde con la cantidad de resultados que verías al hacer una búsqueda avanzada en una colección [ ] desde el navegador .
Accessing an IA Item in PythonþAceder a un elemento del IA en Python
The internetarchive module also allows you to access individual items using their identifiers .þEl módulo internetarchive también permite acceder a elementos individuales mediante el uso de sus identificadores .
Let 's try that using the documentation's sample code , modifying it in order to get the Douglass letter we discussed earlier .þProbemos modificando el código de ejemplo de la documentación del módulo de tal manera que obtengamos la carta de Douglass que discutimos anteriormente .
If you are still at your Python interpreter 's command prompt , you don't need to import internetarchive again .þSi estás todavía en el intérprete de comandos de Python no necesitas declarar import internetarchive de nuevo .
Since we imported the whole module , we also need to modify the sample code so that our interpreter will know that get_item is from the internetarchive module .þComo ya hemos importado el módulo completo tan sólo necesitamos modificar el código de ejemplo para que nuestro intérprete sepa que get_item pertenece al módulo internetarchive .
We also need to change the sample identifier stairs to our item identifier , lettertowilliaml00doug ( note that the character before the two zeroes is a lowercase L , not the number 1 ) :þTambién necesitamos modificar el identificador de ejemplo stairs por nuestro identificador del elemento , lettertowilliaml00doug ( nótese que el carácter entre los dos ceros es una L minúscula , no el número 1 ) :
Enter each of those lines in your interpreter , followed by enter .þCopia cada una de esas líneas en tu intérpete seguidas por Enter .
Depending on your Internet connection speed , it will now probably take a minute or two for the command prompt to return , because your computer is downloading all of the files associated with that item , including some pretty large images .þSegún la velocidad de tu conexión a Internet tomará aproximadamente un minuto o dos para que el intérprete de comandos retorne , esto se debe a que tu ordenador se encuentra descargando todos los archivos asociados a ese elemento , incluyendo algunas imágenes muy pesadas .
But when it 's done downloading , you should be see a new directory on your computer whose name is the item identifier .þCuando se haya descargado podrás ver una nueva carpeta en tu ordenador cuyo nombre es el mismo del identificador del elemento .
To check , first exit your Python interpreter :þPara verificarlo , primero sal de tu intérprete de Python :
Then list the contents of the current directory to see if a folder now appears named lettertowilliaml00doug .þA continuación puedes listar los contenidos del directorio presente para corroborar que ahora existe una carpeta llamada lettertowilliaml00doug .
If you list the contents of that folder , you should see a list of files similar to this :þSi despliegas el contenido de esa carpeta podrás ver una lista similar a esta :
Now that we know how to use the Search and Item functions in the internetarchive module , we can turn to thinking about how to make this process more effective for downloading lots of information from the collection for further analysis .þAhora que sabemos cómo usar las funciones Search y Item en el módulo internetarchive podemos pensar en cómo llevar a cabo este proceso de manera más eficaz para descargar grupos de información desde las colecciones para un posterior análisis .
Downloading MARC Records from a CollectionþDescargar los registros MARC de una colección
Downloading one item is nice , but what if we want to look at thousands of items in a collection ?þDescargar un elemento está bien , pero ¿y si queremos revisar miles de elementos en una colección ?
We 're in luck , because the internetarchive module 's Search function allows us to iterate over all the results in a search .þEstamos de suerte , porque la función Search del módulo internetarchive nos permite iterar sobre todos los resultados de una búsqueda .
To see how , let 's first start our Python interpreter again .þPara ver cómo , comencemos iniciando nuevamente el intérprete de Python .
We 'll need to import our module again , and perform our search again :þNecesitaremos importar una vez más nuestro módulo y hacer de nuevo una búsqueda :
Now let 's enter the documentation 's sample code for printing out the item identifier of every item returned by our search :þAhora escribamos el código de ejemplo de la documentación para imprimir ( print ) los identificadores de cada uno de los elementos encontrados en la búsqueda :
Note that after entering the first line , your Python interpreter will automatically print an ellipsis on line two . This is because you have started a for loop , and Python is expecting there to be more .þNótese que , después de ingresar la primera línea , tu intéprete de Python imprimirá puntos suspensivos automáticamente en la línea dos : esto se debe a que iniciaste un bucle ( for loop ) y Python espera que haya más .
It wants to know what you want to do for each result in the search . That 's also why , once you hit enter on the second line , you 'll see a third line with another ellipsis , because Python does n't know whether you are finished telling it what to do with each result .þEl intérprete intenta saber lo que quieres conocer de cada resultado de búsqueda , por ello , una vez que des Enter en la segunda línea verás una tercera con otros puntos suspensivos , esto se debe a que Python no sabe cuándo has terminado de decirle qué hacer con cada resultado .
Hit enter again to end the for loop and execute the command .þHaz clic en Enter una vez más para finalizar el bucle y ejecutar el comando .
You should now see your terminal begin to print out the identifiers for each result returned by our bplscas search -- -in this case , all 7,029 of them !þDeberías ver entonces que tu terminal empieza a imprimir los identificadores de cada resultado obtenido de nuestro buscar en bplscas -- ( en este caso , ¡de todos los 7 029 elementos !
You can interrupt the print out by hitting Ctrl-C on your keyboard , which will return you to the prompt .þ) Puedes interrumpir la impresión pulsando ctrl-c en tu teclado , lo cual te regresará al intérprete de comandos .
If you did n't see identifiers printing out to your screen , but instead saw an error like this , you may have forgotten to enter a few spaces before your print command :þSi en lugar de ver los identificadores imprimiéndose en tu pantalla observas un mensaje de error como el siguiente , tal vez hayas olvidado ingresar algunos espacios en tu intérprete de comandos :
Remember that whitespace matters in Python , and you need to indent the lines in a for loop so that Python can tell which command ( s ) to perform on each item in the loop .þRecuerda que los espacios en blanco cuentan en Python y necesitas indentar las líneas en un for loop para que Python pueda saber qué comandos ejecutar en cada elemento del bucle .
Understanding the for loopþEntender el bucle for
The for loop , expressed in plain English , tells Python to do something to each thing in a collection of things .þEl bucle for , explicado de manera simple , le dice a Python que debe hacer algo en cada cosa dentro de un grupo de cosas .
In the above case , we printed the identifier for each result in the results of our collection search .þEn el ejemplo anterior , hemos impreso el identificador para cada producto dentro de los resultados de la búsqueda hecha en nuestra colección .
Two additional points about the for loop :þDos consideraciones adicionales acerca del bucle for :
First , the word we used after for is what 's called a local variable in Python . It serves as a placeholder for whatever instance or item we are going to be working with inside the loop .þPrimero , la palabra que usamos antes de for es denominada en Python variable local ( local variable ) y funciona como un marcador de posición para cualquier instancia o elemento con el cual vayamos a trabajar dentro del bucle .
Usually it makes sense to pick a name that describes what kind of thing we are working with—in this case , a search result—but we could have used other names in place of that one .þEn general , tiene sentido escoger un nombre que describa el tipo de cosa con la que estemos trabajando ( en este caso , un resultado de búsqueda ) pero podemos utilizar otros nombres en su lugar .
For example , try running the above for loop again , but substitute a different name for the local variable , such as :þPor ejemplo , intenta ejecutar el bucle anterior de nuevo pero esta vez substituye la variable local por otro nombre como :
You should get the same results .þObtendrás los mismos resultados .
The second thing to note about the for loop is that the indented block could could have contained other commands .þLo segundo que deberás tener en cuenta acerca del bucle for es que puede contener otros comandos en el bloque indentado .
In this case , we printed each individual search result 's identifier . But we could have chosen to do , for each result , anything that we could do to an individual Internet Archive item .þEn este caso , hemos impreso cada identificador para cada resultado de búsqueda , pero podríamos elegir qué hacer para cada resultado , cualquier cosa que podemos hacer con un elemento individual del Internet Archive .
For example , earlier we downloaded all the files associated with the item lettertowilliaml00doug . We could have done that to each item returned by our search by changing the line print result [ 'identifier ' ] in our for loop to result.download ( ) .þPor ejemplo , anteriormente descargamos todos los archivos asociados con el elemento lettertowilliaml00doug . Podríamos haber hecho lo mismo para cada elemento de nuestra búsqueda si cambiáramos la línea print resultado [ 'identifier ' ] por resultado.download ( ) en nuestro bucle for .
We probably want to think twice before doing that , though—downloading all the files for each of the 7,029 items in the bplscas collection is a lot of files .þProbablemente sea mejor pensarlo dos veces antes de hacer algo así ( descargar todos los archivos de cada uno de los 7 029 elementos de la colección bplscas representa un montón de archivos ) .
Fortunately , the download function in the internetarchive module also allows you to download specific files associated with an item .þAfortunadamente , la función download en el módulo internetarchive permite descargar archivos específicos asociados con un elemento .
If we had only wanted to download the MARC XML record associated with a particular item , we could have instead done this :þSi quisiéramos descargar solamente los archivos MARC XML asociados con un ítem en particular deberíamos hacer lo siguiente :
Because Internet Archive item files are named according to specific rules , we can also figure out the name of the MARC file we want just by knowing the item 's unique identifier .þDebido a que los archivos del IA son nombrados de acuerdo a reglas específicas podemos saber con anterioridad cuál es el nombre del archivo MARC con tan sólo conocer el identificador único del elemento .
And armed with that knowledge , we can proceed to …þArmados de tal conocimiento podemos proceder a…
Download All the MARC XML Files from a CollectionþDescargar todos los archivos MARC XML de una colección
For the next section , we 're going to move from using the Python shell to writing a Python script that downloads the MARC record from each item in the BPL Antislavery Collection .þPara la próxima sección pasaremos de usar el intérprete de Python a escribir un archivo script que descargue los archivos MARC de cada elemento en la BPL Anti-Slavery Collection .
Try putting this script into Komodo or your preferred text editor :þIntenta escribir este programa en Komodo o en tu editor de texto preferido :
This script looks a lot like the experiments we have done above with the Frederick Douglass letter , but since we want to download the MARC record for each item returned by our collection search , we are using an itemid variable to account for the fact that the identifier and filename will be different for each result .þEste programa se parece mucho a los experimentos que hicimos previamente con la carta de Frederick Douglass , pero debido a que queremos descargar los archivos MARC de cada elemento de nuestra búsqueda en la colección , estamos usando una variable elementoid para considerar el hecho que el identificador y el nombre del archivo serán diferentes para cada resultado .
Before running this script ( which , I should note , is going to download thousands of small XML files to your computer ) , make a directory where you want those MARC records to be stored and place the above script in that directory .þAntes de iniciar el programa ( que , debo aclarar , va a descargar miles de pequeños archivos XML en tu ordenador ) crea una carpeta donde quieras que se almacenen los archivos MARC y ubica el programa en ese directorio .
Then run the script from within the directory so that the files will be downloaded in an easy-to-find place .þDespués , inicia el programa desde la carpeta de tal manera que los archivos se guarden en un lugar fácil de encontrar .
( Note that if you receive what looks like a ConnectionError on your first attempt , check your Internet connection , wait a few minutes , and then try running the script again .þ( En caso de recibir una mensaje como ConnectionError en tu primer intento debes revisar tu conexión a Internet , esperar unos minutos e intentarlo de nuevo .
)þ)
If all goes well , when you run your script , you should see the program begin to print out status updates telling you that it is downloading MARC records . But allowing the script to run its full course will probably take a couple of hours , so let 's stop the script and look a little more closely at ways to improve it .þSi todo funciona correctamente , podrás ver que el programa empieza a imprimir mensajes de actualización diciéndote que está en proceso de descarga de los archivos MARC , pero permitir que el programa ejecute la función hasta finalizar tomará , probablemente , unas cuantas horas , así que detén el programa y revisa más detenidamente posibles maneras de mejorarlo .
Pressing Ctrl-C while in your terminal window should make the script stop .þPresiona ctrl-c mientras estés en la ventana de tu terminal y harás que se detenga el programa .
Building Error Reporting into the ScriptþConstruir un reporte de errores en el programa
Since downloading all of these records will take some time , we are probably going to want to walk away from our computer for a while .þDescargar todos esos archivos puede tomar un tiempo y probablemente queramos alejarnos de la computadora mientras tanto .
But the chances are high that during those two hours , something could go wrong that would prevent our script from working .þSin embargo , hay altas probabilidades de que durante esas dos horas algo salga mal e impida que nuestro programa funcione .
Let 's say , for example , that we had forgotten that we already downloaded an individual file into this directory . Or maybe your computer briefly loses its Internet connection , or some sort of outage happens on the Internet Archive server that prevents the script from getting the file it wants .þDigamos , por ejemplo , que hemos olvidado descargar previamente un archivo individual en esa carpeta o tal vez tu ordenador pierda brevemente la conexión a Internet o algún tipo de corte suceda en el servidor del IA que impida que el programa descargue el archivo que quiere .
In those and other error cases , Python will raise an `` exception '' telling you what the problem is .þEn estos y otros casos de error , Python puede hacer una `` excepción '' al decirte cuál es el problema .
Unfortunately , an exception will also crash your script instead of continuing on to the next item .þDesafortunadamente una excepción también hará que tu programa deje de funcionar en lugar de continuar con el siguiente archivo .
To prevent this , we can use what 's called a try statement in Python , which does exactly what it sounds like . The statement will try to execute a certain snippet of code until it hits an exception , in which case you can give it some other code to execute instead .þPara prevenir esto podemos usar lo que se denomina en Python como una declaración try ( try statement ) , la cual `` intenta '' ejecutar una cierta parte del código cuando se encuentra con una excepción , en cuyo caso puedes brindar otras opciones de código para ejecutar .
You can read more about handling exceptions in the Python documentation , but for now let 's just update our above script so that it looks like this :þPuedes leer más acerca del manejo de excepciones en la documentación de Python , pero por ahora tan sólo actualicemos nuestro programa para que luzca de esta manera :
The main thing we 've added here , after our module import statements , is a line that opens a text file called bpl-marcs-errors.log and prepares it to have text appended to it .þLo más importante que añadimos aquí , después de las declaraciones para importar los módulos , fue una línea que abre un archivo de texto llamado errores-bpl-marcs.log y lo prepara para incluir texto en él .
We are going to use this file to log exceptions that the script raises .þVamos a utilizar ese archivo para registrar las excepciones que encuentre el programa .
The try statement that we have added to our for loop will attempt to download the MARC record . If it ca n't , it will write a descriptive statement about what went wrong to our log file .þLa declaración try que añadimos a nuestro for loop intentará descargar el archivo MARC , en caso de que no pueda hacerlo escribirá un registro descriptivo del fallo en nuestro archivo log .
That way we can go back to the file later and identify which items we will need to try to download again .þDe esta manera podremos revisar posteriormente el archivo e identificar cuáles elementos debemos intentar descargar nuevamente .
If the try clause succeeds and can download the record , then the script will execute the code in the else clause .þSi la declaración try funciona y puede descargar el archivo el programa ejecutará el código sin la cláusula else .
One other thing we have added , upon successful download , is this line :þOtra cosa que añadimos , tras una descarga exitosa , fue esta línea :
This line uses the time module that we are now importing at the beginning to tell our script to pause for one second before proceeding , which is basically just a way for us to be nice to Internet Archive's servers by not clobbering them every millisecond or so with a request .þDicha línea usa el módulo time que importamos al inicio para decirle a nuestro programa que se detenga por un segundo antes de proceder , lo que es básicamente una manera en la que podemos ser amables con los servidores del IA para no sobrecargarlos cada tantos milisegundos con una solicitud .
Try updating your script to look like the above lines , and run it again in the directory where you want to store your MARC files .þIntenta actualizar tu programa para que se vea como el de arriba y ejecútalo nuevamente en el directorio donde guardaste tus archivos MARC .
Do n't be surprised if you immediately encounter a string of error messages ; that means the script is doing what it 's supposed to do !þNo te sorprendas si inmediatamente encuentras una cadena con un mensaje de error ¡eso significa que el programa hace lo que se supone debe hacer !
Calmly go into your text editor , while leaving the script running , and open the bpl-marcs-errors.log to see what exceptions have been recorded there .þRevisa tranquilamente tu editor de texto mientras el programa sigue ejecutándose y abre el archivo errores-bpl-marcs.log para ver cuáles excepciones han sido registradas .
You 'll probably see that the script raised the exception `` File already exists '' for each of the files that you had already downloaded when running our earlier , shorter program .þProbablemente veas que el programa registró la excepción `` File already exist '' para cada uno de los archivos que se habían descargado anteriormente cuando se ejecutó el programa más corto .
If you leave the program running for a little while , the script will eventually get to items that you have not already downloaded and resume collecting your MARCs !þSi ejecutas el programa por un tiempo más el código llegará hasta los elementos que no has descargado ¡y continuarán recolectando tus archivos MARC !
Scraping Information from a MARC RecordþRecolección automática de información desde un archivo MARC
Once your download script has completed , you should find yourself in the possession of nearly 7,000 detailed MARC XML records about items in the Anti-Slavery Collection ( or whichever other collection you may have downloaded instead ; the methods above should work on any collection whose items have MARC files attached to them ) .þUna vez que hayas el programa de descarga haya terminado estarás en la posesión de cerca de 7 000 registros detallados MARC XML relacionados con elementos de la Anti-Slavery Collection ( o cualquier otra colección que hayas decidido descargar , el método arriba explicado puede funcionar en cualquier colección cuyos elementos tengan archivos MARC asociados ) .
Now what ?þY ¿ahora qué ?
The next step depends on what sort of questions about the collection you want to answer .þEl próximo paso depende de cual tipo de pregunta quieras responder relacionada con la colección .
The MARC formatting language captures a wealth of data about an item , as you can see if you return to the MARC XML record for the Frederick Douglass letter mentioned at the outset .þEl formato de lenguaje MARC captura una rica cantidad de datos relativos a un elemento , como puedes ver si revisas el registro MARC XML de la carta de Frederick Douglass mencionado al inicio .
Notice , for example , that the Douglass letter contains information about the place where the letter was written in the datafield that is tagged 260 , inside the subfield coded a . The person who prepared this MARC record knew to put place information in that specific field because of rules specified for the 260 datafield by the MARC standards .þObserva , por ejemplo , que la carta de Douglass contiene información acerca del lugar donde fue escrita en el campo de datos ( datafield ) marcado con el número 260 , dentro del subcampo ( subfield ) con el código a . La persona que preparó este registro MARC sabía poner información en ese campo gracias a las reglas específicas para el campo 260 según los estándares MARC .
That means that it should be possible for us to look inside all of the MARC records we have downloaded , grab the information inside of datafield 260 , subfield a , and make a list of every place name where items in the collection were published .þEsto significa que es posible para nosotros revisar el interior de los archivos MARC que hemos descargado y recolectar la información almacenada dentro del campo de datos 260 , subcampo a , y hacer una lista del nombre de cada lugar donde fueron publicados los elementos de la colección .
To do this , we 'll use the other helpful Python module that we downloaded with pip at the beginning : pymarc .þPara hacer esto , usaremos otro módulo útil de Python que hemos descargado al inicio con pip : pymarc
That module makes it easy to get information out of subfields .þEse módulo facilita la recolección de información de los subcampos .
Assuming that we have a MARC record prepared for parsing by the module assigned to the variable record , we could get the information about publication place names this way :þAsumiendo que tenemos un registro MARC preparado para analizar por el módulo asignado a la variable del registro , podemos obtener la información relativa a los nombres de los lugares de publicación de esta manera :
The documentation for pymarc is a little less complete than that for the Internet Archive , especially when it comes to parsing XML records .þLa documentación de pymarc es un poco menos completa que la del IA , en particular cuando se trata de analizar registros XML .
But a little rooting around in the source code for the module reveals some functions that it provides for working with MARC XML records .þPero un poco de exploración alrededor de la raíz del código fuente del módulo revela algunas funciones que provee para trabajar con archivos MARC XML .
One of these , called map_xml ( ) is described this way :þUna de ella , llamada map_xml ( ) , se describe de la siguiente manera :
Translated into plain English , this function means that we can take an XML file containing MARC data ( like the nearly 7,000 we now have on our computer ) , pass it to the map_xml function in the pymarc module , and then specify another function ( that we will write ) telling our program what to do with the MARC data retrieved from the XML file .þEn lenguaje llano significa que esta función puede tomar un archivo XML que contiene datos MARC ( como los cerca de 7 000 que ahora tenemos en nuestro ordenador ) , los pasa por la función map_xml en el módulo de pymarc y especifica una función adicional ( que deberemos escribir ) diciéndole a nuestro programa qué hacer con los datos recolectados del registro MARC contenidos en el archivo XML .
In rough outline , our code will look something like this :þUn diseño preliminar de nuestro código se verá como sigue :
Try saving that code to a script and running it from a directory where you already have the Douglass letter XML saved .þIntenta guardar el código en un programa y ejecútalo desde una carpeta donde esté guardado el XML de la carta de Douglass .
If all goes well , the script should spit out this :þSi todo funciona correctamente el programa mostrará lo siguiente :
Voila !þVoilà !
Of course , this script would be much more useful if we scraped the place of publication from every letter in our collection of MARC records .þDesde luego , este programa tiene más utilidad si recolectamos la ubicación de cada carta en nuestra colección de archivos MARC .
Putting together what we 've learned from earlier in the lesson , we can do that with a script that looks like this :þAgrupando toddo lo que hemos aprendido desde el inicio en esta lección podemos escribir un programa que lucirá como el siguiente :
This script modifies our above code in several ways .þEste programa modifica nuestro código anterior de varias maneras .
First , it uses a for loop to iterate over each file in our directory .þPrimero , usa una declaración for looop para iterar sobre cada archivo de nuestro directorio .
In place of the internetarchive search results that we iterated over in our first part of this lesson , we iterate over the files returned by os.listdir ( path ) which uses the built-in Python module os to list the contents of the directory specified in the path variable , which you will need to modify so that it matches the directory where you have downloaded all of your MARC files .þEn lugar de la pesquisa de resultados con internetarchive con la cual iteramos en los resultados de búsqueda durante la primera parte de la lección , ahora iteramos sobre los archivos recolectados con os.listdir ( path ) que usa el módulo os de Python para listar los contenidos de los directorios especificados en la ruta de la variable , la cual debes modificar para que concuerde con la carpeta en la cual almacenaste todos tus archivos MARC .
We have also added some error handling to our get_place_of_pub ( ) function to account for the fact that some records may ( for whatever reason ) not contain the information we are looking for .þTambién añadimos un manejador de error a nuestra función obtener_lugar_de_pub ( ) para enfrentar el hecho de que algunos registros puedan ( por cualquier razón ) carecer de la información que buscamos .
The function will try to print the place of publication , but if this raises an Exception , it will print out the information returned by the Exception instead .þLa función intentará imprimir el lugar de publicación , pero si llega a una excepción imprimirá la información obtenida por la misma excepción .
In this case , if the try statement failed , the exception will probably print None .þEn este caso , si la declaración falla la excepción problablemente imprimirá None .
Understanding why is a subject for another lesson on Python Type errors , but for now the None printout is descriptive enough of what happened , so it could be useful to us .þEntender por qué es asunto de otra lección acerca de los tipos de errores de Python , pero por ahora el mensaje None es suficientemente descriptivo para lo que sucede , por lo cual puede ser útil para nosotros .
Try running this script .þIntenta ejecutar este programa .
If all goes well , your screen should fill with a list of the places where these letters were written .þSi todo funciona correctamente , tu pantalla se llenará con un listado de lugares donde las cartas fueron escritas .
If that works , try modifying your script so that it saves the place names to a text file instead of printing them to your screen .þSi sirve , intenta modificar tu programa para que guarde los nombres de los lugares en un archivo de texto en lugar de imprimirlos en pantalla .
You could then use the Counting Frequencies lesson to figure out which place names are most common in the collection .þPuedes servirte de la lección Contar frecuencias para saber cuáles lugares son los más comunes en la colección .
You could work with the place names to find coordinates that could be placed on a map using the Google Maps lesson .þTambién puedes trabajar con las ubicaciones para encontrar coordenadas que puedan ser ubicadas en un mapa usando la lección de introducción a Google Maps .
Or , to get a very rough visual sense of the places where letters were written , you could do what I 've done below and simply make a Wordle word cloud of the text file .þAsimismo , para obtener una visualización preliminar de los lugares donde las cartas fueron escritas , puedes hacer lo que yo he hecho abajo y simplemente hacer una nube de palabras en Wordle con el archivo de texto .
Wordle wordcloud of places of publication for abolitionist lettersþNube de palabras en * Wordle * de los lugares de publicación de cartas abolicionistas
Of course , to make such techniques useful would require more cleaning of your data .þDesde luego , para que esta técnica sea útil se requiere hacer algo de limpieza de tus datos .
And other applications of this lesson may prove more useful .þEsta lección también puede ser aplicada de otras maneras .
For example , working with the MARC data fields for personal names , you could create a network of correspondents . Or you could analyze which subjects are common in the MARC records .þPor ejemplo , trabajar con los campos de datos relativos a nombres de personas , con ellos puedes crear una red de corresponsales , o puedes analizar cuales temas ( subjects ) son comunes en los registros MARC .
Now that you have the MARC records downloaded and can use pymarc to extract information from the fields , the possibilities can multiply rapidly !þAhora que has descargado los archivos MARC y puedes usar pymarc para extraer información de los campos ¡las posibilidades se multiplican rápidamente !
