<TEI xmlns="http://www.tei-c.org/ns/1.0" xmlns:xi="http://www.w3.org/2001/XInclude" xml:id="json-and-jq" type="original" xml:base="json-and-jq/json-and-jq/json-and-jq.xml">
    <teiHeader>
        <fileDesc>
            <titleStmt>
                <title>Reshaping JSON with jq</title>
                <author role="original_author">Matthew Lincoln</author>
                <editor role="reviewers">
                    <persName>Shawn Graham</persName>
                    <persName>Nick Ruest</persName>
                </editor>
                <editor role="editors">Ian Milligan</editor>
            </titleStmt>
            <publicationStmt>
                <distributor>Programming Historian</distributor>
                <idno type="doi">10.46430/phen0055</idno>
                <date type="published">05/24/2016</date>
            </publicationStmt>
            <sourceDesc>
                <p>Born digital, in a markdown format. This lesson is original.</p>
            </sourceDesc>
        </fileDesc>
        <profileDesc>
            <abstract>
                <p>Working with data from an art museum API and from the Twitter API, this lesson teaches how to use the command-line utility _jq_ to filter and parse complex JSON files into flat CSV files.</p>
            </abstract>
            <textClass>
                <keywords>
                    <term xml:lang="en">data-manipulation</term>
                </keywords>
            </textClass>
        </profileDesc>
    </teiHeader>
    <text xml:lang="en">
        <body><p style="alert alert-warning"><w>Access</w><w>to</w><w>Twitter</w><w>â€™</w><w>s</w><w>API</w><w>has</w><w>recently</w><w>changed</w><pc>.</pc><w>The</w><w>Free</w><w>Tier</w><w>no</w><w>longer</w><w>allows</w><w>users</w><w>to</w><w>search</w><w>and</w><w>download</w><w>Twitter</w><w>data</w><pc>.</pc><w>Unfortunately</w><w>,</w><w>this</w><w>means</w><w>that</w><w>elements</w><w>of</w><w>this</w><w>lesson</w><w>will</w><w>only</w><w>work</w><w>for</w><w>those</w><w>who</w><w>are</w><w>paying</w><w>for</w><w>an</w><w>upgraded</w><w>plan</w><pc>.</pc><w>At</w><w>the</w><w>moment</w><w>,</w><w>there</w><w>are</w><w>no</w><w>special</w><w>access</w><w>plans</w><w>for</w><w>researchers</w><w>or</w><w>academics</w><pc>.</pc><w>[</w><w>2023</w><w>]</w></p><div type="2" n="1"><head><w>Lesson</w><w>goals</w></head><p><w>JSON</w><w>(</w><w>JavaScript</w><w>Object</w><w>Notation</w><w>)</w><w>is</w><w>a</w><w>common</w><w>data</w><w>sharing</w><w>format</w><w>that</w><w>can</w><w>describe</w><w>complex</w><w>relationships</w><pc>.</pc><w>Many</w><w>libraries</w><w>,</w><w>archives</w><w>,</w><w>museums</w><w>,</w><w>and</w><w>social</w><w>media</w><w>sites</w><w>expose</w><w>their</w><w>data</w><w>through</w><w>JSON-based</w><w>APIs</w><pc>.</pc><w>(</w><w>On</w><w>accessing</w><w>APIs</w><w>,</w><w>see</w><ref target="/lessons/applied-archival-downloading-with-wget"><w>downloading</w><w>structured</w><w>data</w><w>with</w><w>wget</w></ref><w>and</w><w>the</w><ref target="/lessons/intro-to-the-zotero-api"><w>series</w><w>of</w><w>lessons</w><w>on</w><w>working</w><w>with</w><w>APIs</w></ref><pc>.</pc><w>)</w></p><p><w>However</w><w>,</w><w>many</w><w>tools</w><w>for</w><w>data</w><w>analysis</w><w>and</w><w>visualization</w><w>require</w><w>input</w><w>in</w><w>flat</w><w>tables</w><w>(</w><w>i.e</w><pc>.</pc><w>CSV</w><w>)</w><w>,</w><w>and</w><w>because</w><w>JSON</w><w>is</w><w>such</w><w>a</w><w>flexible</w><w>data</w><w>format</w><w>,</w><w>often</w><w>with</w><w>many</w><w>nested</w><w>levels</w><w>of</w><w>data</w><w>,</w><w>there</w><w>is</w><w>no</w><w>one-size-fits-all</w><w>graphical</w><w>user</w><w>interface</w><w>for</w><w>transforming</w><w>JSON</w><w>into</w><w>other</w><w>formats</w><pc>.</pc></p><p><w>Working</w><w>with</w><w>data</w><w>from</w><w>an</w><w>art</w><w>museum</w><w>API</w><w>and</w><w>from</w><w>the</w><w>Twitter</w><w>API</w><w>,</w><w>this</w><w>lesson</w><w>teaches</w><w>how</w><w>to</w><w>use</w><w>the</w><w>command-line</w><w>utility</w><ref target="https://stedolan.github.io/jq/"><w>jq</w></ref><w>to</w><w>filter</w><w>and</w><w>parse</w><w>complex</w><w>JSON</w><w>files</w><w>into</w><w>flat</w><w>CSV</w><w>files</w><pc>.</pc><w>This</w><w>lesson</w><w>will</w><w>begin</w><w>with</w><w>an</w><w>overview</w><w>of</w><w>the</w><w>basic</w><w>operators</w><w>of</w><w>the</w><w>jq</w><w>query</w><w>syntax</w><pc>.</pc><w>Next</w><w>,</w><w>you</w><w>will</w><w>learn</w><w>progressively</w><w>more</w><w>complex</w><w>ways</w><w>of</w><w>connecting</w><w>these</w><w>operators</w><w>together</w><pc>.</pc><w>By</w><w>the</w><w>end</w><w>of</w><w>the</w><w>lesson</w><w>,</w><w>you</w><w>will</w><w>understand</w><w>how</w><w>to</w><w>combine</w><w>basic</w><w>operators</w><w>to</w><w>create</w><w>queries</w><w>that</w><w>can</w><w>reshape</w><w>many</w><w>types</w><w>of</w><w>JSON</w><w>data</w><pc>.</pc></p></div><div type="2" n="2"><head><w>What</w><w>is</w><w>JSON</w><pc>?</pc></head><p><ref target="http://www.json.org/"><w>You</w><w>may</w><w>find</w><w>a</w><w>short</w><w>and</w><w>cogent</w><w>primer</w><w>on</w><w>JSON</w><w>here</w><pc>.</pc></ref><w>In</w><w>brief</w><w>,</w><w>a</w><w>JSON</w><hi rend="bold"><w>object</w></hi><w>is</w><w>a</w><w>series</w><w>of</w><w>key/value</w><w>pairs</w><w>,</w><w>where</w><hi rend="bold"><w>keys</w></hi><w>are</w><w>the</w><w>names</w><w>for</w><w>the</w><hi rend="bold"><w>values</w></hi><w>they</w><w>are</w><w>paired</w><w>with</w><pc>.</pc><w>For</w><w>example</w><w>,</w><w>the</w><w>tiny</w><w>JSON</w><w>object</w><w>:</w></p><ab><code lang="language-json" xml:id="code_json-and-jq_0" corresp="code_json-and-jq_0.txt" rend="block"/></ab><p><w>describes</w><w>two</w><w>data</w><w>points</w><w>:</w><w>a</w><w>name</w><w>and</w><w>a</w><w>role</w><pc>.</pc><w>Keys</w><w>are</w><w>separated</w><w>from</w><w>values</w><w>with</w><w>a</w><w>colon</w><w>(</w><code rend="inline"><w>:</w></code><w>)</w><w>,</w><w>while</w><w>key/value</w><w>pairs</w><w>are</w><w>separated</w><w>from</w><w>each</w><w>other</w><w>by</w><w>a</w><w>comma</w><w>(</w><code rend="inline"><w>,</w></code><w>)</w><pc>.</pc><w>These</w><w>objects</w><w>must</w><w>be</w><w>wrapped</w><w>in</w><w>curly</w><w>braces</w><pc>.</pc><w>(</w><code rend="inline"><w>{</w><w>}</w></code><w>)</w></p><p><w>Keys</w><w>must</w><w>be</w><w>text</w><w>strings</w><w>(</w><w>wrapped</w><w>in</w><w>double</w><w>quotation</w><w>marks</w><w>:</w><code rend="inline"><w>``</w><w>``</w></code><w>)</w><w>,</w><w>while</w><w>values</w><w>may</w><w>be</w><w>quoted</w><w>text</w><w>;</w><w>the</w><w>unquoted</w><w>words</w><code rend="inline"><w>true</w></code><w>,</w><code rend="inline"><w>false</w></code><w>,</w><w>or</w><code rend="inline"><w>null</w></code><w>;</w><w>an</w><w>unquoted</w><w>number</w><w>;</w><w>an</w><hi rend="bold"><w>array</w></hi><w>(</w><w>multiple</w><w>equivalent</w><w>values</w><w>within</w><w>square</w><w>brackets</w><w>:</w><code rend="inline"><w>[</w><w>]</w></code><w>)</w><w>;</w><w>or</w><w>another</w><w>JSON</w><w>object</w><w>(</w><w>wrapped</w><w>in</w><w>curly</w><w>braces</w><w>:</w><code rend="inline"><w>{</w><w>}</w></code><w>)</w></p><p><w>Let</w><w>'s</w><w>consider</w><w>the</w><w>JSON</w><w>for</w><ref target="https://www.rijksmuseum.nl/nl/collectie/SK-C-5"><w>Rembrandt</w><w>'s</w><emph><w>Nightwatch</w></emph><w>in</w><w>the</w><w>Rijksmuseum</w></ref><w>:</w></p><ab><code lang="language-json" xml:id="code_json-and-jq_1" corresp="code_json-and-jq_1.txt" rend="block"/></ab><p><w>Takeaways</w><w>:</w></p><list type="unordered"><item><w>The</w><w>entire</w><w>text</w><w>is</w><w>wrapped</w><w>in</w><code rend="inline"><w>{</w><w>}</w></code><w>,</w><w>identifying</w><w>it</w><w>as</w><w>a</w><w>JSON</w><w>object</w><pc>.</pc></item><item><code rend="inline"><w>id</w></code><w>is</w><w>a</w><w>key</w><w>,</w><w>separated</w><w>by</w><w>a</w><w>colon</w><w>from</w><w>its</w><w>value</w><w>,</w><code rend="inline"><w>``</w><w>nl-SK-C-5</w><w>''</w></code></item><item><w>Some</w><w>keys</w><w>here</w><w>have</w><w>entire</w><w>objects</w><w>as</w><w>their</w><w>values</w><pc>.</pc><w>For</w><w>example</w><w>,</w><code rend="inline"><w>webImage</w></code><w>has</w><w>an</w><w>object</w><w>with</w><w>its</w><w>own</w><w>key</w><w>:</w><w>value</w><w>pairs</w><w>like</w><code rend="inline"><w>``</w><w>width</w><w>''</w><w>:</w><w>2500</w></code><w>and</w><code rend="inline"><w>``</w><w>height</w><w>''</w><w>:</w><w>2034</w></code><pc>.</pc></item><item><w>The</w><w>key</w><code rend="inline"><w>productionPlaces</w></code><w>has</w><w>an</w><emph><w>array</w></emph><w>as</w><w>its</w><w>value</w><w>,</w><w>denoted</w><w>by</w><w>the</w><code rend="inline"><w>[</w><w>]</w></code><w>wrapping</w><w>it</w><pc>.</pc><w>In</w><w>this</w><w>object</w><w>,</w><w>the</w><w>array</w><w>only</w><w>has</w><w>one</w><w>value</w><w>,</w><code rend="inline"><w>``</w><w>Amsterdam</w><w>''</w></code><w>,</w><w>however</w><w>it</w><w>could</w><w>have</w><w>multiple</w><w>values</w><w>,</w><w>e.g</w><pc>.</pc><code rend="inline"><w>[</w><w>``</w><w>Amsterdam</w><w>''</w><w>,</w><w>``</w><w>Kloveniersdoelen</w><w>''</w><w>]</w></code><pc>.</pc><w>Remember</w><w>,</w><w>values</w><w>of</w><w>an</w><w>array</w><w>have</w><w>no</w><w>keys</w><w>-</w><w>they</w><w>are</w><w>all</w><w>considered</w><w>to</w><w>be</w><w>semantically</w><w>equivalent</w><w>to</w><w>each</w><w>other</w><pc>.</pc></item></list></div><div type="2" n="3"><head><w>Lesson</w><w>Setup</w></head><p><w>For</w><w>the</w><w>bulk</w><w>of</w><w>this</w><w>lesson</w><w>,</w><w>we</w><w>will</w><w>be</w><w>working</w><w>with</w><w>a</w><w>web-based</w><w>version</w><w>of</w><w>jq</w><w>at</w><w>the</w><w>site</w><ref target="https://jqplay.org/"><w>jq</w><w>play</w></ref><pc>.</pc><w>For</w><w>this</w><w>,</w><w>you</w><w>will</w><w>only</w><w>need</w><w>your</w><w>internet</w><w>browser</w><pc>.</pc><ref target="https://jqplay.org/"><w>jq</w><w>play</w></ref><w>can</w><w>not</w><w>handle</w><w>very</w><w>large</w><w>JSON</w><w>files</w><w>,</w><w>but</w><w>it</w><w>is</w><w>a</w><w>great</w><w>sandbox</w><w>for</w><w>learning</w><w>the</w><w>query</w><w>language</w><w>for</w><w>jq</w><pc>.</pc><w>(</w><w>At</w><w>the</w><w>end</w><w>of</w><w>this</w><w>lesson</w><w>,</w><w>we</w><w>will</w><w>download</w><w>and</w><w>install</w><w>the</w><w>command-line</w><w>version</w><w>of</w><w>jq</w><w>,</w><w>which</w><w>you</w><w>may</w><w>use</w><w>to</w><w>speedily</w><w>parse</w><w>much</w><w>larger</w><w>JSON</w><w>files</w><pc>.</pc><w>)</w></p><figure><desc><w>The</w><w>jq</w><w>play</w><w>website</w><w>,</w><w>with</w><w>input</w><w>JSON</w><w>,</w><w>filter</w><w>,</w><w>and</w><w>results</w><pc>.</pc></desc><graphic url="jqplay-screenshot.png"/></figure><p><w>We</w><w>will</w><w>type</w><w>all</w><w>queries</w><w>into</w><w>the</w><w>``</w><w>Filter</w><w>''</w><w>box</w><w>in</w><w>the</w><w>upper-left</w><w>corner</w><w>of</w><ref target="https://jqplay.org/"><w>jq</w><w>play</w></ref><pc>.</pc><w>Some</w><w>of</w><w>the</w><w>filter</w><w>queries</w><w>are</w><w>long</w><w>,</w><w>so</w><w>be</w><w>sure</w><w>to</w><w>scroll</w><w>all</w><w>the</w><w>way</w><w>to</w><w>the</w><w>right</w><w>when</w><w>copying</w><w>them</w><pc>.</pc><w>The</w><w>results</w><w>will</w><w>immediately</w><w>display</w><w>on</w><w>the</w><w>right-hand</w><w>side</w><w>,</w><w>and</w><w>update</w><w>whenever</w><w>you</w><w>change</w><w>the</w><w>filter</w><w>or</w><w>the</w><w>input</w><w>JSON</w><pc>.</pc><w>You</w><w>do</w><w>not</w><w>need</w><w>to</w><w>press</w><w>enter</w><pc>.</pc><w>After</w><w>each</w><w>query</w><w>in</w><w>this</w><w>lesson</w><w>,</w><w>I</w><w>will</w><w>include</w><w>the</w><w>first</w><w>few</w><w>lines</w><w>of</w><w>the</w><w>expected</w><w>results</w><w>,</w><w>so</w><w>that</w><w>you</w><w>can</w><w>check</w><w>your</w><w>work</w><pc>.</pc><w>If</w><w>you</w><w>see</w><w>an</w><w>error</w><w>displayed</w><w>in</w><w>the</w><w>``</w><w>Results</w><w>''</w><w>field</w><w>of</w><w>jq</w><w>play</w><w>,</w><w>do</w><w>n't</w><w>panic</w><w>;</w><w>just</w><w>edit</w><w>the</w><w>query</w><w>in</w><w>the</w><w>``</w><w>Filter</w><w>''</w><w>field</w><w>and</w><w>jq</w><w>play</w><w>will</w><w>re-run</w><w>everything</w><pc>.</pc></p><p><w>In</w><w>some</w><w>instances</w><w>,</w><w>we</w><w>will</w><w>interact</w><w>with</w><w>the</w><w>checkboxes</w><w>on</w><w>the</w><w>upper-right</w><pc>.</pc><w>These</w><w>set</w><w>various</w><w>jq</w><ref target="https://stedolan.github.io/jq/manual/#Invokingjq"><w>command-line</w><w>options</w><w>,</w><w>or</w><emph><w>flags</w></emph></ref><w>,</w><w>that</w><w>affect</w><w>things</w><w>like</w><w>input</w><w>handling</w><w>,</w><w>and</w><w>the</w><w>final</w><w>formatting</w><w>of</w><w>the</w><w>output</w><pc>.</pc><hi rend="bold"><w>Start</w><w>the</w><w>lesson</w><w>with</w><w>all</w><w>of</w><w>them</w><w>unchecked</w><pc>.</pc></hi></p></div><div type="2" n="4"><head><w>Core</w><w>jq</w><w>filters</w></head><p><w>jq</w><w>operates</w><w>by</w><w>way</w><w>of</w><emph><w>filters</w></emph><w>:</w><w>a</w><w>series</w><w>of</w><w>text</w><w>commands</w><w>that</w><w>you</w><w>can</w><w>string</w><w>together</w><w>,</w><w>and</w><w>which</w><w>dictate</w><w>how</w><w>jq</w><w>should</w><w>transform</w><w>the</w><w>JSON</w><w>you</w><w>give</w><w>it</w><pc>.</pc></p><p><w>To</w><w>learn</w><w>the</w><w>basic</w><w>jq</w><w>filters</w><w>,</w><w>we</w><w>'ll</w><w>work</w><w>with</w><w>a</w><w>sample</w><w>response</w><w>from</w><w>the</w><w>Rijksmuseum</w><w>API</w><w>:</w><ref target="/assets/jq_rkm.json"><w>rkm.json</w></ref><w>Select</w><w>all</w><w>the</w><w>text</w><w>at</w><w>that</w><w>link</w><w>,</w><w>copy</w><w>it</w><w>,</w><w>and</w><w>paste</w><w>it</w><w>into</w><w>the</w><w>``</w><w>JSON</w><w>''</w><w>box</w><w>at</w><ref target="https://jqplay.org/"><w>jq</w><w>play</w></ref><w>on</w><w>the</w><w>left</w><w>hand</w><w>side</w><pc>.</pc></p><div type="3" n="4.1"><head><w>The</w><w>dot</w><w>:</w><code rend="inline"><pc>.</pc></code></head><p><w>The</w><w>basic</w><w>jq</w><w>operator</w><w>is</w><w>the</w><w>dot</w><w>:</w><code rend="inline"><pc>.</pc></code><w>Used</w><w>by</w><w>itself</w><w>,</w><code rend="inline"><pc>.</pc></code><w>leaves</w><w>the</w><w>input</w><w>unmodified</w><pc>.</pc><w>Add</w><w>the</w><w>name</w><w>of</w><w>a</w><w>key</w><w>to</w><w>it</w><w>,</w><w>however</w><w>,</w><w>and</w><w>the</w><w>filter</w><w>will</w><w>return</w><w>the</w><w>value</w><w>of</w><w>that</w><w>key</w><pc>.</pc><w>Try</w><w>the</w><w>following</w><w>filter</w><w>:</w></p><ab><code lang="language-txt" xml:id="code_json-and-jq_2" corresp="code_json-and-jq_2.txt" rend="block"/></ab><p><w>This</w><w>tells</w><w>jq</w><w>to</w><w>return</w><w>the</w><w>value</w><w>of</w><w>the</w><w>field</w><code rend="inline"><w>count</w></code><pc>.</pc><w>The</w><w>result</w><w>should</w><w>read</w><code rend="inline"><w>359</w></code><pc>.</pc><w>If</w><w>you</w><w>want</w><w>to</w><w>access</w><w>a</w><w>value</w><w>in</w><w>an</w><w>object</w><w>that</w><w>'s</w><w>already</w><w>within</w><w>another</w><w>object</w><w>,</w><w>you</w><w>can</w><w>chain</w><code rend="inline"><pc>.</pc></code><w>filters</w><w>together</w><w>,</w><w>e.g</w><pc>.</pc><code rend="inline"><w>.links.self</w></code><pc>.</pc><ref target="#output-a-csv-csv"><w>We</w><w>will</w><w>use</w><w>this</w><w>functionality</w><w>later</w><w>in</w><w>the</w><w>lesson</w><pc>.</pc></ref></p><p><w>Try</w><w>the</w><code rend="inline"><pc>.</pc></code><w>operator</w><w>again</w><w>,</w><w>this</w><w>time</w><w>accessing</w><w>the</w><w>field</w><code rend="inline"><w>artObjects</w></code><pc>.</pc></p><ab><code lang="language-txt" xml:id="code_json-and-jq_3" corresp="code_json-and-jq_3.txt" rend="block"/></ab><p><w>The</w><w>results</w><w>:</w></p><ab><code lang="language-json" xml:id="code_json-and-jq_4" corresp="code_json-and-jq_4.txt" rend="block"/></ab><p><w>Note</w><w>that</w><w>jq</w><w>has</w><w>returned</w><w>the</w><w>entire</w><w>array</w><pc>.</pc><w>Rather</w><w>than</w><w>being</w><w>wrapped</w><w>in</w><code rend="inline"><w>{</w><w>}</w></code><w>,</w><w>the</w><w>result</w><w>is</w><w>a</w><w>series</w><w>of</w><w>objects</w><w>wrapped</w><w>within</w><w>an</w><w>array</w><w>(</w><code rend="inline"><w>[</w><w>{</w><w>}</w><w>,</w><w>{</w><w>}</w><w>,</w><w>{</w><w>}</w><w>]</w></code><w>)</w><w>The</w><w>significance</w><w>of</w><w>this</w><w>will</w><w>be</w><w>discussed</w><w>in</w><w>the</w><w>next</w><w>section</w><pc>.</pc></p></div><div type="3" n="4.2"><head><w>The</w><w>array</w><w>operator</w><w>:</w><code rend="inline"><w>[</w><w>]</w></code></head><p><code rend="inline"><w>.artObjects</w></code><w>returned</w><w>one</w><w>big</w><w>array</w><w>of</w><w>JSON</w><w>objects</w><pc>.</pc><w>Before</w><w>we</w><w>can</w><w>access</w><w>the</w><w>values</w><w>inside</w><w>those</w><w>objects</w><w>,</w><w>we</w><w>need</w><w>to</w><w>break</w><w>them</w><w>out</w><w>of</w><w>the</w><w>array</w><w>that</w><w>they</w><w>'re</w><w>in</w><pc>.</pc><w>By</w><w>adding</w><code rend="inline"><w>[</w><w>]</w></code><w>onto</w><w>the</w><w>end</w><w>of</w><w>our</w><w>filter</w><w>,</w><w>jq</w><w>will</w><w>break</w><w>up</w><w>this</w><w>one</w><w>array</w><w>into</w><w>10</w><w>separate</w><w>objects</w><w>:</w></p><p><w>Try</w><w>it</w><w>:</w></p><ab><code lang="language-txt" xml:id="code_json-and-jq_5" corresp="code_json-and-jq_5.txt" rend="block"/></ab><p><w>Notice</w><w>that</w><w>the</w><code rend="inline"><w>[</w><w>]</w></code><w>wrapping</w><w>our</w><w>results</w><w>are</w><w>now</w><w>gone</w><pc>.</pc><w>To</w><w>make</w><w>clear</w><w>what</w><w>has</w><w>happened</w><w>,</w><w>check</w><w>the</w><w>``</w><w>Compact</w><w>Output</w><w>''</w><w>checkbox</w><w>in</w><w>the</w><w>upper</w><w>right</w><pc>.</pc><w>This</w><w>removes</w><w>the</w><w>cosmetic</w><w>line</w><w>breaks</w><w>in</w><w>the</w><w>results</w><w>,</w><w>returning</w><w>one</w><w>JSON</w><w>object</w><w>per</w><w>line</w><pc>.</pc><w>You</w><w>should</w><w>have</w><w>a</w><w>10-line</w><w>output</w><w>now</w><pc>.</pc></p><figure><desc><w>jq</w><w>'s</w><w>'Compact</w><w>Output</w><w>'</w><w>option</w><w>removes</w><w>all</w><w>cosmetic</w><w>line</w><w>breaks</w><w>in</w><w>a</w><w>file</w><w>,</w><w>just</w><w>leaving</w><w>one</w><w>JSON</w><w>object</w><w>per</w><w>line</w><pc>.</pc></desc><graphic url="compact-output-multiple.png"/></figure><p><w>Keeping</w><w>``</w><w>Compact</w><w>Output</w><w>''</w><w>checked</w><w>,</w><w>remove</w><w>the</w><code rend="inline"><w>[</w><w>]</w></code><w>from</w><w>the</w><w>filter</w><w>,</w><w>so</w><w>it</w><w>just</w><w>reads</w><code rend="inline"><w>.artObjects</w></code><w>again</w><pc>.</pc><w>The</w><w>results</w><w>should</w><w>now</w><w>be</w><w>just</w><w>one</w><w>line</w><w>,</w><w>as</w><w>jq</w><w>is</w><w>now</w><w>just</w><w>returning</w><w>one</w><w>single</w><w>JSON</w><w>array</w><w>:</w></p><figure><desc><w>When</w><w>jq</w><w>returns</w><w>just</w><w>one</w><w>JSON</w><w>object</w><w>,</w><w>the</w><w>'Compact</w><w>Output</w><w>'</w><w>option</w><w>will</w><w>produce</w><w>a</w><w>one-line</w><w>result</w><pc>.</pc></desc><graphic url="compact-output-single.png"/></figure><p><w>If</w><w>you</w><w>want</w><w>to</w><w>access</w><w>just</w><w>the</w><w>first</w><w>(</w><w>or</w><w>the</w><emph><w>n</w></emph><w>-th</w><w>)</w><w>item</w><w>in</w><w>an</w><w>array</w><w>,</w><w>put</w><w>a</w><w>digit</w><w>in</w><w>the</w><code rend="inline"><w>[</w><w>]</w></code><w>operator</w><w>:</w></p><ab><code lang="language-txt" xml:id="code_json-and-jq_6" corresp="code_json-and-jq_6.txt" rend="block"/></ab><p><hi rend="bold"><w>IMPORTANT</w><w>:</w><w>you</w><w>access</w><w>the</w><w>first</w><w>element</w><w>of</w><w>an</w><w>array</w><w>with</w><code rend="inline"><w>0</w></code><w>,</w><w>not</w><code rend="inline"><w>1</w></code><pc>.</pc></hi><w>This</w><w>is</w><w>because</w><w>JavaScript</w><w>,</w><w>like</w><w>quite</w><w>a</w><w>few</w><w>other</w><w>programming</w><w>languages</w><w>(</w><ref target="http://stackoverflow.com/questions/3135325/why-do-vector-indices-in-r-start-with-1-instead-of-0"><w>though</w><w>not</w><w>all</w><pc>!</pc></ref><w>)</w><w>,</w><ref target="http://skillcrush.com/2013/01/17/why-programmers-start-counting-at-zero/"><w>starts</w><w>counting</w><w>at</w><w>0</w></ref><pc>.</pc></p><p><w>This</w><w>filter</w><w>returns</w><w>just</w><w>the</w><w>first</w><w>element</w><w>of</w><w>the</w><code rend="inline"><w>artObjects</w></code><w>array</w><pc>.</pc><code rend="inline"><w>.artObjects</w><w>[</w><w>1</w><w>]</w></code><w>would</w><w>return</w><w>the</w><w>second</w><w>,</w><w>and</w><w>so</w><w>on</w><pc>.</pc></p><p><w>Uncheck</w><w>the</w><w>``</w><w>Compact</w><w>Output</w><w>''</w><w>box</w><w>again</w><w>before</w><w>continuing</w><w>with</w><w>the</w><w>lesson</w><pc>.</pc></p><p><w>|</w><w>#</w><w>#</w><w>#</w><w>The</w><w>pipe</w><w>:</w><code rend="inline"><w>|</w></code><w>|</w></p><p><w>The</w><w>magic</w><w>of</w><w>jq</w><w>is</w><w>that</w><w>you</w><w>can</w><w>connect</w><w>,</w><w>or</w><emph><w>pipe</w></emph><w>,</w><w>several</w><w>operators</w><w>together</w><w>to</w><w>accomplish</w><w>some</w><w>very</w><w>complex</w><w>transformations</w><w>of</w><w>your</w><w>data</w><pc>.</pc><w>What</w><w>'s</w><w>more</w><w>,</w><w>jq</w><w>will</w><w>repeat</w><w>the</w><w>filter</w><w>for</w><w>each</w><w>JSON</w><w>object</w><w>provided</w><w>by</w><w>the</w><w>previous</w><w>step</w><pc>.</pc><w>Therefore</w><w>,</w><w>while</w><w>we</w><w>started</w><w>with</w><w>just</w><w>one</w><w>big</w><w>JSON</w><w>object</w><w>,</w><code rend="inline"><w>.artObjects</w><w>[</w><w>]</w></code><w>created</w><w>10</w><w>smaller</w><w>JSON</w><w>objects</w><pc>.</pc><w>|</w><w>Any</w><w>operator</w><w>we</w><w>put</w><w>after</w><w>the</w><code rend="inline"><w>|</w></code><w>will</w><w>be</w><w>repeated</w><w>for</w><w>each</w><w>of</w><w>these</w><w>objects</w><pc>.</pc><w>|</w></p><p><w>For</w><w>example</w><w>,</w><w>try</w><w>the</w><w>following</w><w>query</w><w>:</w></p><ab><code lang="language-txt" xml:id="code_json-and-jq_7" corresp="code_json-and-jq_7.txt" rend="block"/></ab><p><w>This</w><w>will</w><w>return</w><w>a</w><w>list</w><w>of</w><w>every</w><w>value</w><w>at</w><w>the</w><w>key</w><code rend="inline"><w>id</w></code><w>within</w><w>the</w><code rend="inline"><w>artObjects</w></code><w>array</w><w>,</w><w>separated</w><w>by</w><w>a</w><w>line</w><w>break</w><pc>.</pc></p></div><div type="3" n="4.3"><head><w>Filter</w><w>:</w><code rend="inline"><w>select</w><w>(</w><w>)</w></code></head><p><w>Normally</w><w>jq</w><w>repeats</w><w>every</w><w>filter</w><w>operation</w><w>for</w><w>each</w><w>line</w><w>of</w><w>input</w><w>that</w><w>it</w><w>receives</w><w>,</w><w>passing</w><w>each</w><w>answer</w><w>on</w><w>to</w><w>the</w><w>following</w><w>filter</w><w>operation</w><pc>.</pc><code rend="inline"><w>select</w><w>(</w><w>)</w></code><w>will</w><w>only</w><w>pass</w><w>on</w><w>a</w><w>subset</w><w>of</w><w>the</w><w>input</w><w>onto</w><w>the</w><w>next</w><w>step</w><w>of</w><w>the</w><w>filter</w><pc>.</pc></p><p><w>Let</w><w>'s</w><w>filter</w><w>the</w><w>Rijksmuseum</w><w>JSON</w><w>to</w><w>only</w><w>return</w><w>the</w><w>ids</w><w>of</w><w>objects</w><w>that</w><w>have</w><w>at</w><w>least</w><w>one</w><w>value</w><w>assigned</w><w>to</w><w>their</w><code rend="inline"><w>productionPlaces</w></code><w>:</w></p><ab><code lang="language-txt" xml:id="code_json-and-jq_8" corresp="code_json-and-jq_8.txt" rend="block"/></ab><p><w>This</w><w>should</w><w>return</w><w>:</w></p><ab><code lang="language-json" xml:id="code_json-and-jq_9" corresp="code_json-and-jq_9.txt" rend="block"/></ab><p><w>Let</w><w>'s</w><w>break</w><w>down</w><w>this</w><w>query</w><w>into</w><w>its</w><w>component</w><w>pieces</w><w>:</w></p><p><w>|</w><w>1</w><pc>.</pc><code rend="inline"><w>.artObjects</w><w>[</w><w>]</w><w>|</w></code><w>Breaks</w><w>open</w><w>the</w><w>array</w><w>of</w><w>objects</w><w>contained</w><w>in</w><w>the</w><w>original</w><w>Rijksmuseum</w><w>JSON</w><w>,</w><w>just</w><w>like</w><w>we</w><w>did</w><w>in</w><w>the</w><w>previous</w><w>step</w><w>of</w><w>this</w><w>lesson</w><pc>.</pc><w>The</w><code rend="inline"><w>|</w></code><w>sends</w><w>the</w><w>results</w><w>of</w><w>this</w><w>step</w><w>along</w><w>to</w><w>the</w><w>next</w><w>command</w><w>...</w><w>|</w><w>2</w><pc>.</pc><code rend="inline"><w>select</w><w>(</w><w>.productionPlaces</w><w>|</w><w>length</w><w>&gt;</w><w>=</w><w>1</w><w>)</w><w>|</w></code><w>The</w><w>command</w><code rend="inline"><w>select</w><w>(</w><w>...</w><w>)</w></code><w>will</w><w>only</w><w>pass</w><w>along</w><w>the</w><w>JSON</w><w>objects</w><w>that</w><w>match</w><w>the</w><w>rule</w><w>defined</w><w>inside</w><w>the</w><w>parentheses</w><pc>.</pc><w>Our</w><w>rule</w><w>has</w><w>3</w><w>parts</w><w>:</w><w>1</w><pc>.</pc><code rend="inline"><w>.productionPlaces</w></code><w>Access</w><w>the</w><w>array</w><w>at</w><w>the</w><w>key</w><w>named</w><code rend="inline"><w>productionPlaces</w></code><w>|</w><w>2</w><pc>.</pc><code rend="inline"><w>|</w><w>length</w></code><w>The</w><w>pipe</w><w>(</w><code rend="inline"><w>|</w></code><w>)</w><w>sends</w><w>that</w><w>array</w><w>to</w><w>the</w><w>next</w><w>command</w><w>,</w><code rend="inline"><w>length</w></code><w>,</w><w>which</w><w>returns</w><w>the</w><w>number</w><w>of</w><w>elements</w><w>in</w><w>the</w><w>array</w><pc>.</pc><w>|</w><w>3</w><pc>.</pc><code rend="inline"><w>&gt;</w><w>=</w><w>1</w></code><w>This</w><w>last</w><w>part</w><w>of</w><w>our</w><w>rule</w><w>checks</w><w>whether</w><w>the</w><w>number</w><w>returned</w><w>by</w><code rend="inline"><w>length</w></code><w>is</w><w>greater</w><w>than</w><w>or</w><w>equal</w><w>to</w><w>1</w><pc>.</pc><w>If</w><w>it</w><w>is</w><code rend="inline"><w>true</w></code><w>,</w><w>then</w><code rend="inline"><w>select</w><w>(</w><w>)</w></code><w>will</w><w>pass</w><w>the</w><w>object</w><w>along</w><w>to</w><w>the</w><w>last</w><w>part</w><w>of</w><w>our</w><w>filter</w><pc>.</pc><w>If</w><w>it</w><w>is</w><code rend="inline"><w>false</w></code><w>,</w><w>it</w><w>will</w><w>not</w><w>pass</w><w>it</w><pc>.</pc><w>3</w><pc>.</pc><code rend="inline"><w>.id</w></code><w>This</w><w>final</w><w>command</w><w>accesses</w><w>the</w><w>value</w><w>stored</w><w>in</w><w>the</w><w>key</w><code rend="inline"><w>id</w></code><w>in</w><w>the</w><w>two</w><w>objects</w><w>that</w><w>make</w><w>it</w><w>through</w><w>the</w><code rend="inline"><w>select</w><w>(</w><w>)</w></code><w>filter</w><pc>.</pc></p><p><w>jq</w><w>can</w><w>also</w><w>filter</w><w>based</w><w>on</w><w>regular</w><w>expressions</w><pc>.</pc><w>(</w><w>To</w><w>learn</w><w>more</w><w>about</w><w>regular</w><w>expressions</w><w>,</w><w>see</w><w>the</w><w>Programming</w><w>Historian</w><w>lesson</w><ref target="/lessons/understanding-regular-expressions"><w>``</w><w>Understanding</w><w>Regular</w><w>Expressions</w><w>''</w></ref><pc>.</pc><w>)</w><w>For</w><w>example</w><w>,</w><w>let</w><w>'s</w><w>select</w><w>only</w><w>those</w><w>objects</w><w>whose</w><w>primary</w><w>maker</w><w>has</w><w>the</w><w>particle</w><w>``</w><w>van</w><w>''</w><w>in</w><w>their</w><w>name</w><w>,</w><w>and</w><w>return</w><w>the</w><w>artist</w><w>name</w><w>and</w><w>artwork</w><w>id</w><pc>.</pc><code rend="inline"><w>test</w><w>(</w><w>``</w><w>van</w><w>''</w><w>)</w></code><w>takes</w><w>the</w><w>value</w><w>returned</w><w>by</w><w>the</w><w>operator</w><code rend="inline"><w>.principalOrFirstMaker</w></code><w>and</w><w>returns</w><w>true</w><w>if</w><w>that</w><w>value</w><w>contains</w><w>the</w><w>string</w><code rend="inline"><w>van</w></code><w>:</w></p><ab><code lang="language-txt" xml:id="code_json-and-jq_10" corresp="code_json-and-jq_10.txt" rend="block"/></ab><p><w>The</w><w>results</w><w>:</w></p><ab><code lang="language-json" xml:id="code_json-and-jq_11" corresp="code_json-and-jq_11.txt" rend="block"/></ab><p><w>To</w><w>see</w><w>other</w><w>types</w><w>of</w><w>rules</w><w>for</w><code rend="inline"><w>select</w><w>(</w><w>)</w></code><w>,</w><ref target="https://stedolan.github.io/jq/manual/#ConditionalsandComparisons"><w>consult</w><w>the</w><w>full</w><w>list</w><w>of</w><w>jq</w><w>conditionals</w><w>and</w><w>comparisons</w><pc>.</pc></ref></p></div><div type="3" n="4.4"><head><w>Create</w><w>new</w><w>JSON</w><w>:</w><code rend="inline"><w>[</w><w>]</w></code><w>and</w><code rend="inline"><w>{</w><w>}</w></code></head><p><w>By</w><w>wrapping</w><code rend="inline"><pc>.</pc></code><w>operators</w><w>within</w><w>either</w><code rend="inline"><w>[</w><w>]</w></code><w>or</w><code rend="inline"><w>{</w><w>}</w></code><w>,</w><w>jq</w><w>can</w><w>synthesize</w><w>new</w><w>JSON</w><w>arrays</w><w>and</w><w>objects</w><pc>.</pc><w>This</w><w>can</w><w>be</w><w>useful</w><w>if</w><w>you</w><w>want</w><w>to</w><w>output</w><w>a</w><w>new</w><w>JSON</w><w>file</w><pc>.</pc><w>As</w><w>we</w><w>will</w><w>see</w><w>below</w><w>,</w><w>this</w><w>can</w><w>also</w><w>be</w><w>a</w><w>crucial</w><w>intermediate</w><w>step</w><w>when</w><w>reshaping</w><w>complex</w><w>JSON</w><pc>.</pc></p><p><w>Create</w><w>a</w><w>new</w><w>set</w><w>of</w><w>JSON</w><w>objects</w><w>with</w><w>the</w><w>following</w><w>filter</w><w>:</w></p><ab><code lang="language-txt" xml:id="code_json-and-jq_12" corresp="code_json-and-jq_12.txt" rend="block"/></ab><p><w>When</w><w>creating</w><w>an</w><w>object</w><w>with</w><code rend="inline"><w>{</w><w>}</w></code><w>,</w><w>you</w><w>specify</w><w>the</w><w>names</w><w>of</w><w>the</w><w>keys</w><w>with</w><w>unquoted</w><w>text</w><w>,</w><w>and</w><w>then</w><w>assign</w><w>the</w><w>values</w><w>with</w><w>regular</w><w>jq</w><w>filters</w><pc>.</pc><w>The</w><w>resulting</w><w>set</w><w>of</w><w>JSON</w><w>objects</w><w>have</w><w>just</w><w>two</w><w>keys</w><w>:</w><code rend="inline"><w>id</w></code><w>and</w><code rend="inline"><w>title</w></code><w>:</w></p><ab><code lang="language-json" xml:id="code_json-and-jq_13" corresp="code_json-and-jq_13.txt" rend="block"/></ab><p><w>We</w><w>can</w><w>also</w><w>create</w><w>arrays</w><w>using</w><code rend="inline"><w>[</w><w>]</w></code><w>:</w></p><ab><code lang="language-txt" xml:id="code_json-and-jq_14" corresp="code_json-and-jq_14.txt" rend="block"/></ab><p><w>The</w><w>results</w><w>:</w></p><ab><code lang="language-json" xml:id="code_json-and-jq_15" corresp="code_json-and-jq_15.txt" rend="block"/></ab><p><w>Unlike</w><w>objects</w><w>made</w><w>using</w><code rend="inline"><w>{</w><w>}</w></code><w>,</w><w>arrays</w><w>have</w><w>no</w><w>keys</w><w>;</w><w>they</w><w>are</w><w>just</w><w>simple</w><w>lists</w><w>of</w><w>values</w><pc>.</pc><w>Creating</w><w>simple</w><w>arrays</w><w>is</w><w>crucial</w><w>,</w><w>however</w><w>,</w><w>for</w><w>mapping</w><w>our</w><w>JSON</w><w>into</w><w>a</w><w>CSV</w><w>file</w><pc>.</pc></p></div><div type="3" n="4.5"><head><w>Output</w><w>a</w><w>CSV</w><w>:</w><code rend="inline"><w>@</w><w>csv</w></code></head><p><w>To</w><w>create</w><w>a</w><w>CSV</w><w>table</w><w>with</w><w>jq</w><w>we</w><w>want</w><w>to</w><w>filter</w><w>our</w><w>input</w><w>JSON</w><w>into</w><w>a</w><w>series</w><w>of</w><w>arrays</w><w>,</w><w>with</w><w>each</w><w>array</w><w>being</w><w>a</w><w>row</w><w>of</w><w>the</w><w>CSV</w><pc>.</pc></p><p><w>The</w><w>previous</w><w>filter</w><w>gave</w><w>us</w><w>an</w><w>array</w><w>with</w><w>the</w><code rend="inline"><w>id</w></code><w>and</w><code rend="inline"><w>title</w></code><w>keys</w><w>of</w><w>each</w><w>painting</w><pc>.</pc><w>Let</w><w>'s</w><w>add</w><w>the</w><w>primary</w><w>artist</w><w>for</w><w>each</w><w>artwork</w><w>as</w><w>well</w><w>:</w></p><ab><code lang="language-txt" xml:id="code_json-and-jq_16" corresp="code_json-and-jq_16.txt" rend="block"/></ab><p><w>The</w><w>results</w><w>:</w></p><ab><code lang="language-json" xml:id="code_json-and-jq_17" corresp="code_json-and-jq_17.txt" rend="block"/></ab><p><w>Note</w><w>that</w><w>,</w><w>to</w><w>access</w><w>the</w><w>url</w><w>nested</w><w>in</w><w>the</w><code rend="inline"><w>webImage</w></code><w>object</w><w>,</w><w>we</w><w>chained</w><w>together</w><code rend="inline"><w>.webImage.url</w></code><pc>.</pc></p><p><w>To</w><w>format</w><w>this</w><w>as</w><w>CSV</w><w>,</w><w>add</w><w>the</w><w>operator</w><code rend="inline"><w>@</w><w>csv</w></code><w>on</w><w>the</w><w>end</w><w>with</w><w>another</w><w>pipe</w><w>and</w><w>check</w><w>the</w><w>``</w><w>Raw</w><w>Output</w><w>''</w><w>box</w><w>in</w><w>the</w><w>upper</w><w>right</w><pc>.</pc><code rend="inline"><w>@</w><w>csv</w></code><w>properly</w><w>joins</w><w>the</w><w>arrays</w><w>with</w><code rend="inline"><w>,</w></code><w>and</w><w>adds</w><w>quotes</w><w>where</w><w>needed</w><pc>.</pc><w>``</w><w>Raw</w><w>Output</w><w>''</w><w>tells</w><w>jq</w><w>that</w><w>we</w><w>want</w><w>to</w><w>produce</w><w>a</w><w>text</w><w>file</w><w>,</w><w>rather</w><w>than</w><w>a</w><w>new</w><w>JSON</w><w>file</w><pc>.</pc></p><ab><code lang="language-txt" xml:id="code_json-and-jq_18" corresp="code_json-and-jq_18.txt" rend="block"/></ab><p><w>The</w><w>results</w><w>:</w></p><ab><code lang="language-txt" xml:id="code_json-and-jq_19" corresp="code_json-and-jq_19.txt" rend="block"/></ab><p><w>This</w><w>is</w><w>a</w><w>valid</w><w>CSV</w><w>file</w><w>,</w><w>which</w><w>we</w><w>could</w><w>now</w><w>import</w><w>into</w><w>an</w><w>analysis</w><w>program</w><pc>.</pc></p></div></div><div type="2" n="5"><head><w>Advanced</w><w>operations</w></head><div type="3" n="5.1"><head><w>JSON</w><w>vs.</w><w>JSON</w><w>Lines</w></head><p><w>You</w><w>may</w><w>encounter</w><w>two</w><w>different</w><w>types</w><w>of</w><w>JSON</w><w>files</w><w>in</w><w>the</w><w>wild</w><w>:</w><w>files</w><w>with</w><w>one</w><w>large</w><w>JSON</w><w>object</w><w>,</w><w>and</w><w>so-called</w><w>``</w><w>JSON</w><w>lines</w><w>''</w><w>files</w><w>,</w><w>which</w><w>have</w><w>multiple</w><w>,</w><w>separate</w><w>JSON</w><w>objects</w><w>each</w><w>on</w><w>one</w><w>single</w><w>line</w><w>,</w><w>not</w><w>wrapped</w><w>by</w><code rend="inline"><w>[</w><w>]</w></code><pc>.</pc></p><p><w>You</w><w>will</w><w>commonly</w><w>find</w><w>larger</w><w>data</w><w>dumps</w><w>of</w><w>JSON</w><w>will</w><w>come</w><w>in</w><w>a</w><w>JSON</w><w>lines</w><w>format</w><pc>.</pc><w>For</w><w>example</w><w>,</w><w>the</w><ref target="https://github.com/NYPL-publicdomain/data-and-utilities/tree/master/items"><w>New</w><w>York</w><w>Public</w><w>Library</w><w>released</w><w>their</w><w>public</w><w>domain</w><w>collections</w><w>in</w><w>multiple</w><w>JSON</w><w>lines-formatted</w><w>files</w></ref><pc>.</pc><w>You</w><w>'ll</w><w>note</w><w>that</w><w>the</w><w>NYPL</w><w>used</w><w>the</w><w>file</w><w>extension</w><code rend="inline"><w>.ndjson</w></code><w>,</w><w>but</w><w>is</w><w>is</w><w>just</w><w>one</w><w>convention</w><w>--</w><w>-</w><w>others</w><w>use</w><code rend="inline"><w>.jsonl</w></code><w>or</w><w>even</w><w>just</w><code rend="inline"><w>.json</w></code><pc>.</pc><w>Because</w><w>there</w><w>is</w><w>no</w><w>standard</w><w>for</w><w>naming</w><w>JSON</w><w>vs</w><pc>.</pc><w>JSON</w><w>lines</w><w>files</w><w>,</w><w>the</w><w>only</w><w>way</w><w>to</w><w>check</w><w>what</w><w>type</w><w>you</w><w>are</w><w>getting</w><w>is</w><w>to</w><w>open</w><w>the</w><w>file</w><w>in</w><w>a</w><w>text</w><w>editor</w><w>(</w><w>or</w><w>use</w><code rend="inline"><w>head</w></code><w>on</w><w>the</w><w>command</w><w>line</w><w>)</w><w>to</w><w>check</w><w>if</w><w>the</w><w>file</w><w>has</w><w>one</w><w>object</w><w>per</w><w>line</w><w>,</w><w>or</w><w>is</w><w>one</w><w>big</w><w>object</w><w>(</w><w>or</w><w>a</w><w>series</w><w>of</w><w>objects</w><w>wrapped</w><w>with</w><code rend="inline"><w>[</w><w>]</w></code><w>)</w><w>spread</w><w>out</w><w>over</w><w>many</w><w>lines</w><pc>.</pc></p><p><w>jq</w><w>will</w><w>repeat</w><w>your</w><w>entire</w><w>filter</w><w>statement</w><emph><w>per</w><w>JSON</w><w>object</w></emph><pc>.</pc><w>This</w><w>means</w><w>that</w><w>it</w><w>will</w><w>run</w><w>your</w><w>filter</w><w>once</w><w>on</w><w>a</w><w>file</w><w>with</w><w>a</w><w>large</w><w>JSON</w><w>object</w><w>,</w><w>and</w><w>run</w><w>it</w><emph><w>once</w><w>per</w><w>line</w></emph><w>on</w><w>a</w><w>``</w><w>JSON</w><w>lines</w><w>''</w><w>file</w><pc>.</pc></p><p><w>The</w><w>Rijksmuseum</w><w>example</w><w>above</w><w>is</w><w>a</w><w>single</w><w>JSON</w><w>object</w><w>that</w><w>contains</w><w>many</w><w>smaller</w><w>sub-objects</w><w>,</w><w>each</w><w>of</w><w>which</w><w>stands</w><w>for</w><w>an</w><w>artwork</w><w>in</w><w>the</w><w>collection</w><pc>.</pc><w>We</w><w>will</w><w>now</w><w>begin</w><w>working</w><w>with</w><w>a</w><w>set</w><w>of</w><w>Twitter</w><w>JSON</w><w>in</w><w>the</w><w>``</w><w>JSON</w><w>lines</w><w>''</w><w>format</w><w>,</w><w>transforming</w><w>complex</w><w>relationships</w><w>into</w><w>usable</w><w>flat</w><w>tables</w><pc>.</pc></p><p><w>Data</w><w>about</w><w>tweets</w><w>can</w><w>be</w><w>accessed</w><w>via</w><w>the</w><ref target="https://dev.twitter.com/overview/api"><w>Twitter</w><w>API</w></ref><w>,</w><w>which</w><w>returns</w><w>JSON</w><w>data</w><pc>.</pc><w>One</w><w>of</w><w>the</w><w>easiest</w><w>ways</w><w>to</w><w>search</w><w>and</w><w>download</w><w>Twitter</w><w>data</w><w>is</w><w>using</w><w>the</w><w>excellent</w><w>utility</w><ref target="https://github.com/edsu/twarc"><w>twarc</w></ref><w>,</w><w>which</w><w>saves</w><w>data</w><w>as</w><w>JSON</w><w>lines</w><pc>.</pc></p><p><w>For</w><w>this</w><w>lesson</w><w>,</w><w>we</w><w>will</w><w>use</w><w>a</w><w>small</w><w>sample</w><w>of</w><w>50</w><w>public</w><w>tweets</w><pc>.</pc><w>Clear</w><w>the</w><w>``</w><w>Filter</w><w>''</w><w>,</w><w>``</w><w>JSON</w><w>''</w><w>and</w><w>``</w><w>Result</w><w>''</w><w>boxes</w><w>on</w><ref target="https://jqplay.org/"><w>jq</w><w>play</w></ref><w>,</w><w>and</w><w>ensure</w><w>all</w><w>the</w><w>checkboxes</w><w>are</w><w>unchecked</w><pc>.</pc><ref target="/assets/jq_twitter.json"><w>Then</w><w>copy</w><w>this</w><w>sample</w><w>Twitter</w><w>data</w></ref><w>into</w><ref target="https://jqplay.org/"><w>jq</w><w>play</w></ref><pc>.</pc></p></div><div type="3" n="5.2"><head><w>One-to-many</w><w>relationships</w><w>:</w><w>Tweet</w><w>hashtags</w></head><p><w>Often</w><w>you</w><w>may</w><w>wish</w><w>to</w><w>create</w><w>a</w><w>table</w><w>that</w><w>expresses</w><w>a</w><w>one-to-many</w><w>relationship</w><w>,</w><w>such</w><w>as</w><w>a</w><w>tweet</w><w>and</w><w>its</w><w>hashtags</w><pc>.</pc><w>A</w><w>tweet</w><w>will</w><w>always</w><w>have</w><w>exactly</w><w>one</w><w>tweet</w><w>ID</w><w>,</w><w>while</w><w>it</w><w>may</w><w>have</w><w>zero</w><w>,</w><w>one</w><w>,</w><w>or</w><w>more</w><w>hashtags</w><pc>.</pc><w>There</w><w>are</w><w>a</w><w>few</w><w>ways</w><w>to</w><w>express</w><w>this</w><w>as</w><w>a</w><w>CSV</w><w>table</w><w>,</w><w>but</w><w>we</w><w>will</w><w>implement</w><w>two</w><w>common</w><w>solutions</w><w>here</w><w>:</w></p><list type="ordered"><item><w>One</w><w>row</w><w>per</w><w>tweet</w><w>,</w><w>with</w><w>multiple</w><w>hashtags</w><w>in</w><w>the</w><w>same</w><w>cell</w></item><item><w>One</w><w>row</w><w>per</w><w>hashtag/tweet</w><w>combination</w><w>(</w><ref target="https://en.wikipedia.org/wiki/Wide_and_narrow_data"><w>also</w><w>known</w><w>as</w><w>``</w><w>long</w><w>''</w><w>or</w><w>``</w><w>narrow</w><w>''</w><w>data</w></ref><w>)</w><w>,</w><w>with</w><w>tweet</w><w>IDs</w><w>and</w><w>hashtags</w><w>repeated</w><w>as</w><w>necessary</w></item></list><div type="4" n="5.2.1"><head><w>One</w><w>row</w><w>per</w><w>tweet</w></head><p><w>Let</w><w>'s</w><w>create</w><w>a</w><w>table</w><w>with</w><w>one</w><w>column</w><w>with</w><w>a</w><w>tweet</w><w>ID</w><w>,</w><w>and</w><w>a</w><w>second</w><w>column</w><w>with</w><w>all</w><w>the</w><w>hashtags</w><w>in</w><w>each</w><w>tweet</w><w>,</w><w>separated</w><w>by</w><w>a</w><w>semicolon</w><w>:</w><code rend="inline"><w>;</w></code></p><p><w>This</w><w>is</w><w>a</w><w>relatively</w><w>complex</w><w>query</w><w>that</w><w>will</w><w>require</w><w>a</w><w>multi-step</w><w>filter</w><pc>.</pc><w>First</w><w>,</w><w>let</w><w>'s</w><w>reduce</w><w>the</w><w>Twitter</w><w>JSON</w><w>to</w><w>just</w><w>ids</w><w>and</w><w>the</w><w>objects</w><w>describing</w><w>the</w><w>hashtags</w><pc>.</pc><w>Paste</w><w>this</w><w>filter</w><w>into</w><ref target="https://jqplay.org/"><w>jq</w><w>play</w></ref><w>:</w></p><ab><code lang="language-txt" xml:id="code_json-and-jq_20" corresp="code_json-and-jq_20.txt" rend="block"/></ab><p><w>The</w><w>results</w><w>:</w></p><ab><code lang="language-json" xml:id="code_json-and-jq_21" corresp="code_json-and-jq_21.txt" rend="block"/></ab><p><w>Note</w><w>that</w><w>we</w><w>do</w><w>not</w><w>have</w><w>to</w><w>start</w><w>this</w><w>query</w><w>by</w><w>breaking</w><w>apart</w><w>an</w><w>array</w><w>like</w><w>we</w><w>did</w><w>with</w><w>the</w><w>Rijskmuseum</w><w>data</w><pc>.</pc><w>This</w><w>is</w><w>because</w><w>the</w><w>Twitter</w><w>data</w><w>comes</w><w>in</w><w>the</w><w>JSON</w><w>lines</w><w>format</w><w>,</w><w>with</w><w>one</w><w>separate</w><w>JSON</w><w>object</w><w>per</w><w>line</w><w>in</w><w>the</w><w>file</w><pc>.</pc><w>jq</w><w>simply</w><w>repeats</w><w>the</w><w>filter</w><w>for</w><w>each</w><w>of</w><w>these</w><w>separate</w><w>objects</w><pc>.</pc><w>This</w><w>has</w><w>created</w><w>a</w><w>set</w><w>of</w><w>JSON</w><w>objects</w><w>(</w><w>wrapped</w><w>in</w><code rend="inline"><w>{</w><w>}</w></code><w>)</w><w>with</w><w>an</w><code rend="inline"><w>id</w></code><w>key</w><w>and</w><w>a</w><code rend="inline"><w>hashtags</w></code><w>key</w><pc>.</pc><w>The</w><w>value</w><w>of</w><code rend="inline"><w>hashtags</w></code><w>is</w><w>the</w><w>array</w><w>(</w><w>wrapped</w><w>in</w><code rend="inline"><w>[</w><w>]</w></code><w>)</w><w>from</w><w>the</w><w>original</w><w>data</w><w>,</w><w>which</w><w>may</w><w>have</w><w>0</w><w>or</w><w>more</w><w>objects</w><w>inside</w><w>it</w><pc>.</pc><w>Let</w><w>'s</w><w>add</w><w>a</w><w>second</w><w>query</w><w>to</w><w>preserve</w><w>just</w><w>the</w><w>text</w><w>of</w><w>those</w><w>hashtags</w><w>:</w></p><ab><code lang="language-txt" xml:id="code_json-and-jq_22" corresp="code_json-and-jq_22.txt" rend="block"/></ab><p><w>The</w><w>results</w><w>:</w></p><ab><code lang="language-json" xml:id="code_json-and-jq_23" corresp="code_json-and-jq_23.txt" rend="block"/></ab><p><code rend="inline"><w>id</w><w>:</w><w>.id</w></code><w>just</w><w>keeps</w><w>the</w><code rend="inline"><w>id</w></code><w>field</w><w>unchanged</w><pc>.</pc><w>The</w><code rend="inline"><w>[</w><w>]</w></code><w>in</w><code rend="inline"><w>.hashtags</w><w>[</w><w>]</w><w>.text</w></code><w>breaks</w><w>open</w><w>the</w><w>array</w><w>of</w><w>hashtags</w><w>in</w><w>each</w><w>tweet</w><w>,</w><w>allowing</w><w>us</w><w>to</w><w>extract</w><w>the</w><w>value</w><w>of</w><w>the</w><code rend="inline"><w>text</w></code><w>key</w><w>from</w><w>each</w><w>one</w><pc>.</pc><w>Note</w><w>,</w><w>however</w><w>,</w><w>that</w><w>tweet</w><w>ID</w><code rend="inline"><w>501064196931330050</w></code><w>shows</w><w>up</w><w>twice</w><w>in</w><w>the</w><w>results</w><w>,</w><w>because</w><w>it</w><w>had</w><w>2</w><w>hashtags</w><w>:</w><code rend="inline"><w>Ferguson</w></code><w>and</w><code rend="inline"><w>MikeBrown</w></code><pc>.</pc><w>We</w><w>want</w><w>the</w><w>tweet</w><w>ID</w><w>to</w><w>only</w><w>show</w><w>up</w><w>once</w><w>,</w><w>with</w><w>an</w><w>array</w><w>of</w><w>hashtags</w><pc>.</pc><w>To</w><w>do</w><w>this</w><w>,</w><w>let</w><w>'s</w><w>edit</w><w>our</w><w>filter</w><w>by</w><w>adding</w><w>another</w><w>set</w><w>of</w><code rend="inline"><w>[</w><w>]</w></code><w>,</w><w>this</w><w>time</w><w>wrapping</w><w>around</w><code rend="inline"><w>.hashtags</w><w>[</w><w>]</w><w>.text</w></code><w>:</w></p><ab><code lang="language-txt" xml:id="code_json-and-jq_24" corresp="code_json-and-jq_24.txt" rend="block"/></ab><p><w>By</w><w>adding</w><code rend="inline"><w>[</w><w>]</w></code><w>around</w><code rend="inline"><w>.hashtags</w><w>[</w><w>]</w><w>.text</w></code><w>,</w><w>we</w><w>tell</w><w>jq</w><w>to</w><w>collect</w><w>the</w><w>individual</w><w>results</w><w>of</w><code rend="inline"><w>.hashtags</w><w>[</w><w>]</w><w>.text</w></code><w>within</w><w>an</w><w>array</w><pc>.</pc><w>If</w><w>it</w><w>finds</w><w>multiple</w><w>results</w><w>,</w><w>it</w><w>will</w><w>put</w><w>them</w><w>together</w><w>in</w><w>the</w><w>same</w><w>array</w><pc>.</pc><w>Note</w><w>that</w><w>tweet</w><w>ID</w><code rend="inline"><w>501064196931330050</w></code><w>now</w><w>has</w><w>just</w><w>one</w><w>object</w><w>,</w><w>with</w><w>an</w><w>embedded</w><w>array</w><w>of</w><w>two</w><w>hashtags</w><w>:</w></p><ab><code lang="language-json" xml:id="code_json-and-jq_25" corresp="code_json-and-jq_25.txt" rend="block"/></ab><p><w>Finally</w><w>,</w><w>we</w><w>want</w><w>to</w><w>express</w><w>this</w><w>as</w><w>a</w><w>CSV</w><w>file</w><w>,</w><w>delimiting</w><w>the</w><w>hashtags</w><w>with</w><code rend="inline"><w>;</w></code><pc>.</pc><w>To</w><w>do</w><w>this</w><w>,</w><w>we</w><w>need</w><w>to</w><w>add</w><w>one</w><w>more</w><w>intermediary</w><w>JSON</w><w>object</w><w>:</w></p><ab><code lang="language-txt" xml:id="code_json-and-jq_26" corresp="code_json-and-jq_26.txt" rend="block"/></ab><p><w>Once</w><w>again</w><w>,</w><w>we</w><w>use</w><code rend="inline"><w>id</w><w>:</w><w>.id</w></code><w>to</w><w>preserve</w><w>the</w><code rend="inline"><w>id</w></code><w>value</w><w>unchanged</w><pc>.</pc><w>However</w><w>,</w><w>we</w><w>change</w><w>the</w><w>value</w><w>of</w><code rend="inline"><w>hashtags</w></code><w>one</w><w>last</w><w>time</w><pc>.</pc><code rend="inline"><w>.hashtags</w><w>|</w><w>join</w><w>(</w><w>``</w><w>;</w><w>''</w><w>)</w></code><w>uses</w><w>the</w><ref target="https://stedolan.github.io/jq/manual/#join(str)"><code rend="inline"><w>join</w><w>(</w><w>)</w></code></ref><w>command</w><w>,</w><w>which</w><w>takes</w><w>an</w><w>array</w><w>as</w><w>input</w><w>and</w><w>joins</w><w>the</w><w>elements</w><w>together</w><w>using</w><w>the</w><w>provided</w><w>string</w><w>(</w><w>in</w><w>this</w><w>case</w><w>,</w><code rend="inline"><w>``</w><w>;</w><w>''</w></code><w>)</w><w>:</w></p><ab><code lang="language-json" xml:id="code_json-and-jq_27" corresp="code_json-and-jq_27.txt" rend="block"/></ab><p><w>Now</w><w>,</w><w>we</w><w>can</w><w>finally</w><w>format</w><w>the</w><w>individual</w><w>rows</w><w>of</w><w>the</w><w>CSV</w><w>and</w><w>output</w><w>it</w><w>(</w><w>remember</w><w>to</w><w>check</w><w>the</w><w>``</w><w>Raw</w><w>Output</w><w>''</w><w>box</w><w>)</w><w>:</w></p><ab><code lang="language-txt" xml:id="code_json-and-jq_28" corresp="code_json-and-jq_28.txt" rend="block"/></ab><p><w>This</w><w>is</w><w>a</w><w>very</w><w>complex</w><w>,</w><w>multipart</w><w>query</w><pc>.</pc><w>Let</w><w>'s</w><w>review</w><w>its</w><w>components</w><w>one</w><w>more</w><w>time</w><w>:</w></p><p><w>|</w><w>1</w><pc>.</pc><code rend="inline"><w>{</w><w>id</w><w>:</w><w>.id</w><w>,</w><w>hashtags</w><w>:</w><w>.entities.hashtags</w><w>}</w><w>|</w></code><w>Create</w><w>a</w><w>new</w><w>set</w><w>of</w><w>JSON</w><w>objects</w><w>by</w><w>extracting</w><w>the</w><code rend="inline"><w>id</w></code><w>field</w><w>from</w><w>each</w><w>tweet</w><w>,</w><w>along</w><w>with</w><w>the</w><w>JSON</w><w>object</w><w>describing</w><w>the</w><w>tweet</w><w>'s</w><w>hashtags</w><pc>.</pc><w>|</w><w>|</w><w>2</w><pc>.</pc><code rend="inline"><w>{</w><w>id</w><w>:</w><w>.id</w><w>,</w><w>hashtags</w><w>:</w><w>[</w><w>.hashtags</w><w>[</w><w>]</w><w>.text</w><w>]</w><w>}</w><w>|</w></code><w>Preserve</w><w>the</w><code rend="inline"><w>id</w></code><w>key</w><w>:</w><w>value</w><w>pair</w><w>,</w><w>and</w><w>collect</w><w>the</w><code rend="inline"><w>text</w></code><w>of</w><w>each</w><code rend="inline"><w>hashtags</w></code><w>object</w><w>in</w><w>an</w><w>array</w><w>,</w><w>which</w><w>we</w><w>reassign</w><w>to</w><w>the</w><w>key</w><code rend="inline"><w>hashtags</w></code><pc>.</pc><w>|</w><w>|</w><w>3</w><pc>.</pc><code rend="inline"><w>{</w><w>id</w><w>:</w><w>.id</w><w>,</w><w>hashtags</w><w>:</w><w>.hashtags</w><w>|</w><w>join</w><w>(</w><w>``</w><w>;</w><w>''</w><w>)</w><w>}</w><w>|</w></code><w>Preserve</w><w>the</w><code rend="inline"><w>id</w></code><w>key</w><w>:</w><w>value</w><w>pair</w><w>,</w><w>and</w><w>join</w><w>the</w><w>contents</w><w>of</w><w>the</w><code rend="inline"><w>hashtags</w></code><w>array</w><w>together</w><w>,</w><w>separated</w><w>by</w><code rend="inline"><w>;</w></code><w>|</w><w>|</w><w>4</w><pc>.</pc><code rend="inline"><w>[</w><w>.id</w><w>,</w><w>.hashtags</w><w>]</w><w>|</w></code><w>Build</w><w>an</w><w>array</w><w>for</w><w>each</w><w>row</w><w>of</w><w>our</w><w>desired</w><w>table</w><w>|</w><w>5</w><pc>.</pc><code rend="inline"><w>@</w><w>csv</w></code><w>Format</w><w>everything</w><w>as</w><w>a</w><w>CSV</w></p><p><w>The</w><w>final</w><w>results</w><w>:</w></p><ab><code lang="language-txt" xml:id="code_json-and-jq_29" corresp="code_json-and-jq_29.txt" rend="block"/></ab><p><w>There</w><w>are</w><w>ways</w><w>to</w><w>get</w><w>the</w><w>same</w><w>results</w><w>using</w><w>an</w><w>even</w><w>shorter</w><w>query</w><w>,</w><w>but</w><w>in</w><w>most</w><w>cases</w><w>,</w><w>it</w><w>pays</w><w>to</w><w>break</w><w>up</w><w>your</w><w>jq</w><w>transformations</w><w>into</w><w>small</w><w>steps</w><pc>.</pc></p></div><div type="4" n="5.2.2"><head><w>One</w><w>row</w><w>per</w><w>hashtag</w></head><p><w>This</w><w>is</w><w>actually</w><w>simpler</w><w>to</w><w>implement</w><w>in</w><w>jq</w><w>,</w><w>because</w><w>we</w><w>can</w><w>take</w><w>advantage</w><w>of</w><w>jq</w><w>'s</w><w>natural</w><w>behavior</w><w>of</w><w>repeating</w><w>filters</w><pc>.</pc></p><p><w>We</w><w>will</w><w>start</w><w>with</w><w>the</w><w>same</w><w>set</w><w>of</w><w>operations</w><w>that</w><w>extract</w><w>the</w><w>tweet</w><w>ID</w><w>and</w><w>the</w><w>hashtag</w><w>objects</w><w>from</w><w>the</w><w>original</w><w>Twitter</w><w>JSON</w><w>:</w></p><ab><code lang="language-txt" xml:id="code_json-and-jq_30" corresp="code_json-and-jq_30.txt" rend="block"/></ab><p><w>This</w><w>results</w><w>in</w><w>a</w><w>long</w><w>series</w><w>of</w><w>JSON</w><w>objects</w><w>with</w><w>one</w><w>id</w><w>and</w><w>one</w><w>hashtag</w><w>per</w><w>object</w><pc>.</pc><w>All</w><w>we</w><w>need</w><w>to</w><w>do</w><w>is</w><w>construct</w><w>the</w><w>CSV</w><w>row</w><w>arrays</w><w>and</w><w>pipe</w><w>them</w><w>through</w><w>the</w><code rend="inline"><w>@</w><w>csv</w></code><w>operator</w><w>:</w></p><ab><code lang="language-txt" xml:id="code_json-and-jq_31" corresp="code_json-and-jq_31.txt" rend="block"/></ab><p><w>The</w><w>results</w><w>:</w></p><ab><code lang="language-txt" xml:id="code_json-and-jq_32" corresp="code_json-and-jq_32.txt" rend="block"/></ab></div></div><div type="3" n="5.3"><head><w>Grouping</w><w>and</w><w>Counting</w></head><p><w>Often</w><w>times</w><w>,</w><w>your</w><w>JSON</w><w>will</w><w>be</w><w>structured</w><w>around</w><w>one</w><w>type</w><w>of</w><w>entity</w><w>(</w><w>say</w><w>,</w><w>artworks</w><w>from</w><w>the</w><w>Rijksmuseum</w><w>API</w><w>,</w><w>or</w><w>tweets</w><w>from</w><w>the</w><w>Twitter</w><w>API</w><w>)</w><w>when</w><w>you</w><w>,</w><w>the</w><w>researcher</w><w>,</w><w>may</w><w>be</w><w>more</w><w>interested</w><w>in</w><w>collecting</w><w>information</w><w>about</w><w>a</w><w>related</w><w>,</w><w>but</w><w>secondary</w><w>entity</w><w>,</w><w>like</w><w>an</w><w>artist</w><w>,</w><w>a</w><w>Twitter</w><w>hashtag</w><w>,</w><w>or</w><w>a</w><w>Twitter</w><w>user</w><pc>.</pc><w>In</w><w>this</w><w>section</w><w>,</w><w>we</w><w>will</w><w>use</w><w>jq</w><w>to</w><w>extract</w><w>a</w><w>table</w><w>of</w><w>information</w><w>about</w><w>Twitter</w><emph><w>users</w></emph><w>from</w><w>the</w><w>tweet-based</w><w>JSON</w><w>,</w><w>as</w><w>well</w><w>as</w><w>grouping</w><w>and</w><w>counting</w><w>tweet</w><emph><w>hashtags</w></emph><pc>.</pc></p><p><w>For</w><w>the</w><w>previous</w><w>examples</w><w>,</w><w>we</w><w>have</w><w>only</w><w>needed</w><w>to</w><w>consider</w><w>each</w><w>tweet</w><w>individually</w><pc>.</pc><w>By</w><w>default</w><w>,</w><w>jq</w><w>will</w><w>look</w><w>at</w><w>one</w><w>JSON</w><w>object</w><w>at</w><w>a</w><w>time</w><w>when</w><w>parsing</w><w>a</w><w>file</w><w>;</w><w>consequently</w><w>,</w><w>it</w><w>can</w><emph><w>stream</w></emph><w>very</w><w>large</w><w>files</w><w>without</w><w>having</w><w>to</w><w>load</w><w>the</w><w>entire</w><w>set</w><w>in</w><w>to</w><w>memory</w><pc>.</pc></p><p><w>However</w><w>,</w><w>in</w><w>cases</w><w>where</w><w>we</w><w>are</w><w>aggregating</w><w>information</w><w>about</w><w>the</w><w>individual</w><w>objects</w><w>in</w><w>a</w><w>JSON</w><w>file</w><w>,</w><w>we</w><w>need</w><w>to</w><w>give</w><w>jq</w><w>access</w><w>to</w><w>every</w><w>JSON</w><w>object</w><w>in</w><w>a</w><w>file</w><w>simultaneously</w><pc>.</pc><w>This</w><w>is</w><w>where</w><w>we</w><w>want</w><w>to</w><w>use</w><w>``</w><w>Slurp</w><w>''</w><w>(</w><w>or</w><w>the</w><code rend="inline"><w>-s</w></code><w>flag</w><w>on</w><w>command-line</w><w>jq</w><w>)</w><pc>.</pc><w>``</w><w>Slurp</w><w>''</w><w>tells</w><w>jq</w><w>to</w><w>read</w><w>every</w><w>line</w><w>of</w><w>the</w><w>input</w><w>JSON</w><w>lines</w><w>and</w><w>treat</w><w>the</w><w>entire</w><w>group</w><w>as</w><w>one</w><w>huge</w><w>array</w><w>of</w><w>objects</w><pc>.</pc></p><p><w>With</w><w>the</w><w>Twitter</w><w>data</w><w>still</w><w>in</w><w>the</w><w>input</w><w>box</w><w>on</w><ref target="https://jqplay.org/"><w>jq</w><w>play</w></ref><w>,</w><w>check</w><w>the</w><w>``</w><w>Slurp</w><w>''</w><w>box</w><w>,</w><w>and</w><w>just</w><w>put</w><code rend="inline"><pc>.</pc></code><w>in</w><w>the</w><w>filter</w><pc>.</pc><w>Note</w><w>that</w><w>it</w><w>'s</w><w>wrapped</w><w>the</w><w>objects</w><w>in</w><code rend="inline"><w>[</w><w>]</w></code><pc>.</pc><w>Now</w><w>we</w><w>can</w><w>build</w><w>even</w><w>more</w><w>complex</w><w>commands</w><w>that</w><w>require</w><w>knowledge</w><w>of</w><w>the</w><w>entire</w><w>input</w><w>file</w><pc>.</pc></p><div type="4" n="5.3.1"><head><w>Extracting</w><w>user</w><w>data</w></head><p><w>Because</w><w>the</w><w>Twitter</w><w>API</w><w>returns</w><w>per-tweet</w><w>information</w><w>,</w><w>info</w><w>about</w><w>the</w><emph><w>users</w></emph><w>who</w><w>send</w><w>those</w><w>tweets</w><w>is</w><w>repeated</w><w>with</w><w>each</w><w>tweet</w><w>within</w><w>an</w><w>object</w><w>assigned</w><w>to</w><w>the</w><w>key</w><code rend="inline"><w>user</w></code><pc>.</pc><w>Let</w><w>'s</w><w>look</w><w>at</w><w>the</w><w>user</w><w>data</w><w>in</w><w>the</w><w>very</w><w>first</w><w>tweet</w><w>in</w><w>this</w><w>dataset</w><w>(</w><w>remember</w><w>to</w><w>keep</w><w>the</w><w>``</w><w>Slurp</w><w>''</w><w>option</w><w>checked</w><pc>.</pc><w>)</w></p><ab><code lang="language-txt" xml:id="code_json-and-jq_33" corresp="code_json-and-jq_33.txt" rend="block"/></ab><p><w>The</w><code rend="inline"><w>[</w><w>0</w><w>]</w></code><w>operator</w><w>accesses</w><w>the</w><w>very</w><w>first</w><w>tweet</w><w>in</w><w>the</w><w>data</w><w>,</w><w>while</w><code rend="inline"><w>.user</w></code><w>extracts</w><w>the</w><w>embedded</w><w>information</w><w>in</w><w>the</w><w>user</w><w>field</w><pc>.</pc><w>The</w><w>results</w><w>will</w><w>look</w><w>like</w><w>this</w><w>:</w></p><ab><code lang="language-json" xml:id="code_json-and-jq_34" corresp="code_json-and-jq_34.txt" rend="block"/></ab><p><w>To</w><w>collect</w><w>information</w><w>about</w><w>users</w><w>,</w><w>we</w><w>will</w><w>want</w><w>to</w><w>use</w><w>the</w><code rend="inline"><w>group_by</w><w>(</w><w>)</w></code><code rend="inline"><w>group_by</w><w>(</w><w>.key</w><w>)</w></code><w>takes</w><w>an</w><w>array</w><w>of</w><w>objects</w><w>as</w><w>its</w><w>input</w><w>,</w><w>and</w><w>returns</w><w>an</w><w>array</w><w>of</w><w>arrays</w><w>,</w><w>with</w><w>those</w><w>sub-arrays</w><w>filled</w><w>with</w><w>objects</w><w>that</w><w>share</w><w>the</w><w>same</w><w>value</w><w>for</w><w>the</w><w>specified</w><code rend="inline"><w>key</w></code><pc>.</pc><w>Because</w><w>we</w><w>have</w><w>read</w><w>the</w><w>input</w><w>JSON</w><w>lines</w><w>using</w><w>the</w><w>``</w><w>Slurp</w><w>''</w><w>option</w><w>,</w><w>we</w><w>already</w><w>start</w><w>with</w><w>an</w><w>array</w><w>of</w><w>tweet</w><w>objects</w><pc>.</pc><w>We</w><w>can</w><w>use</w><code rend="inline"><w>group_by</w><w>(</w><w>.user</w><w>)</w></code><w>to</w><w>collect</w><w>these</w><w>tweets</w><w>into</w><w>sub-arrays</w><w>of</w><w>one</w><w>user</w><w>each</w><pc>.</pc></p><ab><code lang="language-txt" xml:id="code_json-and-jq_35" corresp="code_json-and-jq_35.txt" rend="block"/></ab><p><w>You</w><w>should</w><w>see</w><w>that</w><w>the</w><w>results</w><w>are</w><w>now</w><w>wrapped</w><w>within</w><w>an</w><w>additional</w><w>pair</w><w>of</w><code rend="inline"><w>[</w><w>]</w></code><w>:</w></p><ab><code lang="language-json" xml:id="code_json-and-jq_36" corresp="code_json-and-jq_36.txt" rend="block"/></ab><p><w>We</w><w>can</w><w>now</w><w>create</w><w>a</w><w>table</w><w>of</w><w>users</w><pc>.</pc><w>Let</w><w>'s</w><w>create</w><w>a</w><w>table</w><w>with</w><w>columns</w><w>for</w><w>the</w><w>user</w><w>id</w><w>,</w><w>user</w><w>name</w><w>,</w><w>followers</w><w>count</w><w>,</w><w>and</w><w>a</w><w>column</w><w>of</w><w>their</w><w>tweet</w><w>ids</w><w>separated</w><w>by</w><w>a</w><w>semicolon</w><pc>.</pc></p><ab><code lang="language-txt" xml:id="code_json-and-jq_37" corresp="code_json-and-jq_37.txt" rend="block"/></ab><p><w>The</w><w>results</w><w>should</w><w>look</w><w>like</w><w>:</w></p><ab><code lang="language-json" xml:id="code_json-and-jq_38" corresp="code_json-and-jq_38.txt" rend="block"/></ab><p><w>Let</w><w>'s</w><w>break</w><w>down</w><w>this</w><w>complex</w><w>filter</w><w>:</w></p><p><w>|</w><w>1</w><pc>.</pc><code rend="inline"><w>group_by</w><w>(</w><w>.user</w><w>)</w><w>|</w></code><w>This</w><w>takes</w><w>the</w><w>big</w><w>array</w><w>of</w><w>tweets</w><w>and</w><w>returns</w><w>an</w><w>array</w><w>of</w><w>sub-arrays</w><w>,</w><w>each</w><w>sharing</w><w>the</w><w>exact</w><w>same</w><w>information</w><w>in</w><w>the</w><code rend="inline"><w>user</w></code><w>key</w><pc>.</pc><w>Note</w><w>that</w><w>this</w><w>works</w><w>even</w><w>when</w><w>the</w><w>value</w><w>at</w><w>the</w><code rend="inline"><w>user</w></code><w>key</w><w>is</w><w>itself</w><w>a</w><w>JSON</w><w>object</w><w>wrapped</w><w>in</w><code rend="inline"><w>{</w><w>}</w></code><pc>.</pc><w>|</w><w>|</w><w>1</w><pc>.</pc><code rend="inline"><pc>.</pc><w>[</w><w>]</w><w>|</w></code><w>Having</w><w>created</w><w>an</w><w>array</w><w>of</w><w>sub-arrays</w><w>,</w><w>we</w><w>want</w><w>to</w><w>break</w><w>out</w><w>the</w><w>individual</w><w>sub-arrays</w><pc>.</pc><w>|</w><w>|</w><w>1</w><pc>.</pc><code rend="inline"><w>{</w><w>user_id</w><w>:</w><pc>.</pc><w>[</w><w>0</w><w>]</w><w>.user.id</w><w>,</w><w>user_name</w><w>:</w><pc>.</pc><w>[</w><w>0</w><w>]</w><w>.user.screen_name</w><w>,</w><w>user_followers</w><w>:</w><pc>.</pc><w>[</w><w>0</w><w>]</w><w>.user.followers_count</w><w>,</w><w>tweet_ids</w><w>:</w><w>[</w><pc>.</pc><w>[</w><w>]</w><w>.id</w><w>|</w><w>tostring</w><w>]</w><w>|</w><w>join</w><w>(</w><w>``</w><w>;</w><w>''</w><w>)</w><w>}</w></code><w>This</w><w>next</w><w>bit</w><w>creates</w><w>a</w><w>new</w><w>set</w><w>of</w><w>JSON</w><w>information</w><w>,</w><w>filling</w><w>in</w><w>keys</w><w>and</w><w>values</w><w>with</w><w>the</w><w>following</w><w>sub-commands</w><w>:</w><w>|</w><w>1</w><pc>.</pc><code rend="inline"><w>user_id</w><w>:</w><pc>.</pc><w>[</w><w>0</w><w>]</w><w>.user.id</w><w>,</w></code><w>This</w><w>pulls</w><w>the</w><w>first</w><w>tweet</w><w>in</w><w>the</w><w>sub-array</w><w>and</w><w>access</w><w>the</w><w>user</w><w>id</w><w>,</w><w>assigning</w><w>it</w><w>to</w><w>the</w><w>key</w><code rend="inline"><w>user_id</w></code><w>in</w><w>our</w><w>new</w><w>JSON</w><w>object</w><w>1</w><pc>.</pc><code rend="inline"><w>user_name</w><w>:</w><pc>.</pc><w>[</w><w>0</w><w>]</w><w>.user.screen_name</w><w>,</w></code><w>This</w><w>does</w><w>the</w><w>same</w><w>for</w><w>the</w><w>user</w><w>name</w><pc>.</pc><w>1</w><pc>.</pc><code rend="inline"><w>user_followers</w><w>:</w><pc>.</pc><w>[</w><w>0</w><w>]</w><w>.user.followers_count</w><w>,</w></code><w>This</w><w>does</w><w>the</w><w>same</w><w>for</w><w>the</w><w>number</w><w>of</w><w>followers</w><w>the</w><w>user</w><w>has</w><pc>.</pc><w>|</w><w>1</w><pc>.</pc><code rend="inline"><w>tweet_ids</w><w>:</w><w>[</w><pc>.</pc><w>[</w><w>]</w><w>.id</w><w>|</w><w>tostring</w><w>]</w><w>|</w><w>join</w><w>(</w><w>``</w><w>;</w><w>''</w><w>)</w></code><w>This</w><w>command</w><w>collects</w><w>all</w><w>the</w><w>different</w><w>tweet</w><w>ids</w><w>associated</w><w>with</w><w>this</w><w>user</w><w>and</w><w>sticks</w><w>them</w><w>into</w><w>one</w><w>string</w><w>,</w><w>delimited</w><w>with</w><code rend="inline"><w>;</w></code><pc>.</pc><w>How</w><w>do</w><w>we</w><w>do</w><w>that</w><pc>?</pc><w>|</w><w>1</w><pc>.</pc><code rend="inline"><pc>.</pc><w>[</w><w>]</w><w>.id</w></code><w>While</w><w>we</w><w>know</w><w>that</w><w>the</w><w>user</w><w>id</w><w>,</w><w>name</w><w>,</w><w>and</w><w>followers</w><w>will</w><w>be</w><w>the</w><w>same</w><w>for</w><w>every</w><w>tweet</w><w>the</w><w>user</w><w>makes</w><w>,</w><w>the</w><w>tweet</w><w>ids</w><w>will</w><w>be</w><w>unique</w><w>,</w><w>so</w><w>instead</w><w>of</w><w>using</w><code rend="inline"><pc>.</pc><w>[</w><w>0</w><w>]</w></code><w>to</w><w>get</w><w>values</w><w>from</w><w>just</w><w>the</w><w>first</w><w>tweet</w><w>,</w><w>we</w><w>use</w><code rend="inline"><pc>.</pc><w>[</w><w>]</w><w>.id</w></code><w>here</w><w>to</w><w>get</w><w>the</w><w>ids</w><w>of</w><w>every</w><w>single</w><w>tweet</w><w>in</w><w>a</w><w>user</w><w>'s</w><w>sub-array</w><pc>.</pc><w>|</w><w>1</w><pc>.</pc><w>The</w><w>command</w><code rend="inline"><w>|</w><w>tostring</w></code><w>converts</w><w>the</w><w>tweet</w><w>id</w><w>numbers</w><w>into</w><w>strings</w><w>that</w><w>jq</w><w>can</w><w>then</w><w>paste</w><w>together</w><w>with</w><w>semicolons</w><pc>.</pc><ref target="#one-row-per-tweet"><w>We</w><w>did</w><w>n't</w><w>have</w><w>to</w><w>use</w><w>this</w><w>last</w><w>time</w><w>we</w><w>used</w><code rend="inline"><w>join</w><w>(</w><w>)</w></code><w>to</w><w>create</w><w>a</w><w>column</w><w>of</w><w>semicolon-delimited</w><w>hashtags</w><pc>.</pc></ref><w>Why</w><pc>?</pc><w>Because</w><w>when</w><w>we</w><w>were</w><w>making</w><w>a</w><w>column</w><w>of</w><w>hashtags</w><w>,</w><w>the</w><w>original</w><w>values</w><w>were</w><w>already</w><w>text</w><w>values</w><w>wrapped</w><w>in</w><w>quotation</w><w>marks</w><pc>.</pc><w>Tweet</w><w>ids</w><w>,</w><w>on</w><w>the</w><w>other</w><w>hand</w><w>,</w><w>are</w><w>integers</w><w>that</w><w>are</w><w>not</w><w>wrapped</w><w>in</w><code rend="inline"><w>``</w><w>``</w></code><w>,</w><w>Because</w><w>jq</w><w>can</w><w>be</w><w>very</w><w>picky</w><w>about</w><w>data</w><w>types</w><w>,</w><w>we</w><w>need</w><w>to</w><w>convert</w><w>our</w><w>integers</w><w>into</w><w>strings</w><w>before</w><w>using</w><w>the</w><code rend="inline"><w>join</w><w>(</w><w>)</w></code><w>command</w><w>in</w><w>the</w><w>next</w><w>step</w><pc>.</pc><w>|</w><w>|</w><w>1</w><pc>.</pc><w>Both</w><w>of</w><w>these</w><w>commands</w><w>are</w><w>wrapped</w><w>in</w><code rend="inline"><w>[</w><w>]</w></code><w>which</w><w>tells</w><w>jq</w><w>to</w><w>collect</w><w>every</w><w>result</w><w>into</w><w>one</w><w>single</w><w>array</w><w>,</w><w>which</w><w>is</w><w>passed</w><w>with</w><w>a</w><code rend="inline"><w>|</w></code><w>along</w><w>to</w><w>:</w><w>|</w><w>1</w><pc>.</pc><code rend="inline"><w>join</w><w>(</w><w>``</w><w>;</w><w>''</w><w>)</w></code><w>,</w><w>which</w><w>turns</w><w>that</w><w>array</w><w>into</w><w>one</w><w>single</w><w>character</w><w>string</w><w>,</w><w>with</w><w>semicolon</w><w>delimiters</w><w>between</w><w>multiple</w><w>tweet</w><w>ids</w><pc>.</pc></p><p><w>This</w><w>filter</w><w>created</w><w>new</w><w>JSON</w><pc>.</pc><w>To</w><w>produce</w><w>a</w><w>CSV</w><w>table</w><w>from</w><w>this</w><w>,</w><w>we</w><w>just</w><w>need</w><w>to</w><w>add</w><w>an</w><w>array</w><w>construction</w><w>and</w><w>the</w><code rend="inline"><w>@</w><w>csv</w></code><w>command</w><w>at</w><w>the</w><w>end</w><w>of</w><w>this</w><w>filter</w><pc>.</pc><w>You</w><w>should</w><w>recognize</w><w>the</w><w>way</w><w>that</w><w>we</w><w>combine</w><w>array</w><w>construction</w><w>and</w><code rend="inline"><w>@</w><w>csv</w></code><ref target="#output-a-csv-csv"><w>from</w><w>the</w><w>earlier</w><w>example</w><w>of</w><w>using</w><code rend="inline"><w>@</w><w>csv</w></code></ref><pc>.</pc><w>Do</w><w>n't</w><w>forget</w><w>to</w><w>check</w><w>both</w><w>the</w><w>``</w><w>Slurp</w><w>''</w><w>and</w><w>``</w><w>Raw</w><w>Output</w><w>''</w><w>options</w><w>when</w><w>creating</w><w>a</w><w>CSV</w><w>table</w><w>with</w><w>jq</w><w>:</w></p><ab><code lang="language-txt" xml:id="code_json-and-jq_39" corresp="code_json-and-jq_39.txt" rend="block"/></ab><p><w>The</w><w>results</w><w>should</w><w>start</w><w>like</w><w>this</w><w>:</w></p><ab><code lang="language-txt" xml:id="code_json-and-jq_40" corresp="code_json-and-jq_40.txt" rend="block"/></ab><p><w>Although</w><w>this</w><w>table</w><w>happens</w><w>to</w><w>start</w><w>with</w><w>users</w><w>who</w><w>only</w><w>have</w><w>one</w><w>tweet</w><w>each</w><w>in</w><w>these</w><w>sample</w><w>data</w><w>,</w><w>you</w><w>can</w><w>scroll</w><w>down</w><w>through</w><w>the</w><w>results</w><w>to</w><w>find</w><w>several</w><w>users</w><w>who</w><w>made</w><w>multiple</w><w>tweets</w><pc>.</pc></p></div><div type="4" n="5.3.2"><head><w>Counting</w><w>Twitter</w><w>hashtags</w></head><p><w>In</w><w>the</w><w>previous</w><w>example</w><w>we</w><w>combined</w><code rend="inline"><w>group_by</w><w>(</w><w>)</w></code><w>with</w><code rend="inline"><w>join</w><w>(</w><w>)</w></code><w>to</w><w>collect</w><w>multiple</w><w>values</w><w>into</w><w>a</w><w>text</w><w>field</w><pc>.</pc><w>However</w><w>,</w><w>we</w><w>can</w><w>also</w><w>use</w><code rend="inline"><w>group_by</w><w>(</w><w>)</w></code><w>in</w><w>conjunction</w><w>with</w><code rend="inline"><w>length</w></code><w>to</w><w>compute</w><w>new</w><w>values</w><pc>.</pc><w>In</w><w>this</w><w>final</w><w>exercise</w><w>,</w><w>we</w><w>will</w><w>use</w><w>jq</w><w>to</w><w>count</w><w>the</w><w>number</w><w>of</w><w>times</w><w>unique</w><w>hashtags</w><w>appear</w><w>in</w><w>this</w><w>dataset</w><pc>.</pc></p><p><w>Once</w><w>again</w><w>,</w><w>make</w><w>sure</w><w>that</w><w>the</w><w>``</w><w>Slurp</w><w>''</w><w>option</w><w>is</w><w>checked</w><pc>.</pc><w>(</w><w>However</w><w>,</w><w>uncheck</w><w>the</w><w>``</w><w>Raw</w><w>Output</w><w>''</w><w>option</w><w>until</w><w>we</w><w>are</w><w>ready</w><w>to</w><w>actually</w><w>produce</w><w>the</w><w>final</w><w>CSV</w><w>output</w><pc>.</pc><w>)</w><w>Counterintuitively</w><w>,</w><w>the</w><w>first</w><w>thing</w><w>we</w><w>need</w><w>to</w><w>do</w><w>to</w><w>access</w><w>the</w><w>hashtags</w><w>again</w><w>is</w><w>to</w><w>break</w><w>them</w><emph><w>out</w></emph><w>of</w><w>that</w><w>large</w><w>array</w><w>:</w></p><ab><code lang="language-txt" xml:id="code_json-and-jq_41" corresp="code_json-and-jq_41.txt" rend="block"/></ab><p><w>Adding</w><code rend="inline"><pc>.</pc><w>[</w><w>]</w></code><w>at</w><w>the</w><w>beginning</w><w>splits</w><w>apart</w><w>the</w><w>large</w><w>array</w><w>created</w><w>by</w><w>the</w><w>``</w><w>Slurp</w><w>''</w><w>option</w><pc>.</pc><w>This</w><w>is</w><w>necessary</w><w>because</w><w>,</w><w>while</w><w>tweets</w><w>can</w><w>only</w><w>have</w><w>one</w><w>user</w><w>,</w><w>they</w><w>can</w><w>have</w><w>multiple</w><w>hashtags</w><pc>.</pc><w>Thus</w><w>,</w><w>we</w><w>need</w><w>to</w><w>fully</w><w>break</w><w>out</w><w>all</w><w>the</w><w>possible</w><w>hashtag</w><w>values</w><w>per</w><w>tweet</w><w>,</w><w>and</w><w>then</w><w>collect</w><w>that</w><w>entire</w><w>output</w><w>back</w><w>into</w><w>an</w><w>array</w><w>inside</w><code rend="inline"><w>[</w><w>]</w></code><w>,</w><w>so</w><w>that</w><w>we</w><w>can</w><w>pass</w><w>a</w><w>single</w><w>array</w><w>into</w><w>the</w><code rend="inline"><w>group_by</w><w>(</w><w>)</w></code><w>function</w><w>:</w></p><ab><code lang="language-txt" xml:id="code_json-and-jq_42" corresp="code_json-and-jq_42.txt" rend="block"/></ab><p><w>Note</w><w>the</w><w>change</w><w>at</w><w>the</w><w>start</w><w>of</w><w>the</w><w>filter</w><w>:</w><w>the</w><w>first</w><w>two</w><w>components</w><w>are</w><w>now</w><w>wrapped</w><w>in</w><code rend="inline"><w>[</w><w>]</w></code><pc>.</pc><w>We</w><w>did</w><w>a</w><w>similar</w><w>sort</w><w>of</w><w>wrapping</w><w>in</w><w>the</w><w>previous</w><w>section</w><w>of</w><w>this</w><w>lesson</w><pc>.</pc><w>We</w><w>also</w><w>added</w><w>the</w><code rend="inline"><w>group_by</w><w>(</w><w>.hashtag</w><w>)</w></code><w>command</w><w>at</w><w>the</w><w>end</w><w>of</w><w>the</w><w>filter</w><pc>.</pc><w>The</w><w>results</w><w>:</w></p><ab><code lang="language-json" xml:id="code_json-and-jq_43" corresp="code_json-and-jq_43.txt" rend="block"/></ab><p><w>In</w><w>the</w><w>above</w><w>query</w><w>,</w><w>tweet/hashtag</w><w>pairs</w><w>are</w><w>grouped</w><w>in</w><w>to</w><w>arrays</w><w>based</w><w>on</w><w>the</w><w>value</w><w>of</w><w>their</w><code rend="inline"><w>hashtag</w></code><w>key</w><pc>.</pc><w>To</w><w>count</w><w>the</w><w>number</w><w>of</w><w>times</w><w>each</w><w>hashtag</w><w>is</w><w>used</w><w>,</w><w>we</w><w>only</w><w>have</w><w>to</w><w>count</w><w>the</w><w>size</w><w>of</w><w>each</w><w>of</w><w>these</w><w>sub-arrays</w><pc>.</pc></p><ab><code lang="language-txt" xml:id="code_json-and-jq_44" corresp="code_json-and-jq_44.txt" rend="block"/></ab><p><w>The</w><w>results</w><w>:</w></p><ab><code lang="language-txt" xml:id="code_json-and-jq_45" corresp="code_json-and-jq_45.txt" rend="block"/></ab><p><w>(</w><w>Remember</w><w>,</w><w>to</w><w>format</w><w>CSV</w><w>output</w><w>correctly</w><w>,</w><w>set</w><w>jq</w><w>to</w><w>``</w><w>Raw</w><w>Output</w><w>''</w><w>using</w><w>the</w><code rend="inline"><w>-r</w></code><w>flag</w><w>on</w><w>the</w><w>command</w><w>line</w><w>,</w><w>or</w><w>check</w><w>the</w><w>``</w><w>Raw</w><w>Output</w><w>''</w><w>box</w><w>on</w><ref target="https://jqplay.org/"><w>jq</w><w>play</w></ref><pc>.</pc><w>)</w></p><p><code rend="inline"><pc>.</pc><w>[</w><w>]</w></code><w>once</w><w>again</w><w>breaks</w><w>apart</w><w>the</w><w>large</w><w>array</w><w>,</w><w>so</w><w>we</w><w>are</w><w>left</w><w>only</w><w>with</w><w>the</w><w>sub-arrays</w><w>within</w><pc>.</pc><w>We</w><w>need</w><w>to</w><w>retrieve</w><w>two</w><w>pieces</w><w>of</w><w>information</w><w>:</w><w>first</w><w>,</w><w>the</w><w>name</w><w>of</w><w>the</w><w>hashtag</w><w>for</w><w>each</w><w>sub-array</w><w>,</w><w>which</w><w>we</w><w>can</w><w>get</w><w>by</w><w>accessing</w><w>the</w><w>value</w><w>of</w><w>the</w><code rend="inline"><w>hashtag</w></code><w>key</w><w>in</w><w>the</w><w>first</w><w>tweet/hashtag</w><w>combo</w><w>of</w><w>the</w><w>array</w><w>(</w><w>accessed</w><w>with</w><code rend="inline"><pc>.</pc><w>[</w><w>0</w><w>]</w></code><w>)</w><pc>.</pc><w>|</w><w>Second</w><w>,</w><w>we</w><w>need</w><w>to</w><w>get</w><w>the</w><w>length</w><w>of</w><w>the</w><w>array</w><w>,</w><w>accessed</w><w>with</w><code rend="inline"><pc>.</pc><w>|</w><w>length</w></code><pc>.</pc><w>|</w><w>Finally</w><w>,</w><w>we</w><w>create</w><w>the</w><w>CSV</w><w>and</w><w>format</w><w>the</w><w>CSV</w><w>rows</w><pc>.</pc></p><p><w>To</w><w>review</w><w>:</w></p><p><w>|</w><w>1</w><pc>.</pc><code rend="inline"><w>[</w><pc>.</pc><w>[</w><w>]</w><w>|</w><w>{</w><w>id</w><w>:</w><w>.id</w><w>,</w><w>hashtag</w><w>:</w><w>.entities.hashtags</w><w>}</w><w>|</w><w>{</w><w>id</w><w>:</w><w>.id</w><w>,</w><w>hashtag</w><w>:</w><w>.hashtag</w><w>[</w><w>]</w><w>.text</w><w>}</w><w>]</w><w>|</w></code><w>This</w><w>nested</w><w>filter</w><w>:</w><w>|</w><w>1.</w><w>breaks</w><w>out</w><w>individual</w><w>tweet</w><w>objects</w><w>from</w><w>the</w><w>large</w><w>array</w><w>created</w><w>by</w><w>the</w><w>``</w><w>Slurp</w><w>''</w><w>option</w><w>(</w><code rend="inline"><pc>.</pc><w>[</w><w>]</w></code><w>)</w><w>|</w><w>2.</w><w>retrieves</w><w>the</w><w>tweet</w><w>id</w><w>and</w><w>hashtag</w><w>text</w><w>(</w><code rend="inline"><w>{</w><w>id</w><w>:</w><w>.id</w><w>,</w><w>hashtag</w><w>:</w><w>.entities.hashtags</w><w>}</w><w>|</w><w>{</w><w>id</w><w>:</w><w>.id</w><w>,</w><w>hashtag</w><w>:</w><w>.hashtag</w><w>[</w><w>]</w><w>.text</w><w>}</w></code><w>)</w><w>|</w><w>3</w><pc>.</pc><w>Wraps</w><w>both</w><w>of</w><w>those</w><w>filters</w><w>in</w><code rend="inline"><w>[</w><w>]</w></code><w>in</w><w>order</w><w>to</w><w>collect</w><w>the</w><w>results</w><w>in</w><w>one</w><w>large</w><w>array</w><w>again</w><pc>.</pc><w>|</w><w>1</w><pc>.</pc><code rend="inline"><w>group_by</w><w>(</w><w>.hashtag</w><w>)</w><w>|</w></code><w>Takes</w><w>the</w><w>large</w><w>array</w><w>from</w><w>the</w><w>previous</w><w>step</w><w>and</w><w>sorts</w><w>it</w><w>into</w><w>an</w><w>array</w><w>of</w><w>arrays</w><w>,</w><w>each</w><w>sub-array</w><w>containing</w><w>tweet</w><w>objects</w><w>sharing</w><w>the</w><w>same</w><w>hashtag</w><pc>.</pc><w>|</w><w>|</w><w>1</w><pc>.</pc><code rend="inline"><pc>.</pc><w>[</w><w>]</w><w>|</w></code><w>Break</w><w>the</w><w>large</w><w>array</w><w>produced</w><w>by</w><code rend="inline"><w>group_by</w><w>(</w><w>)</w></code><w>into</w><w>its</w><w>component</w><w>sub-arrays</w><pc>.</pc><w>|</w><w>|</w><w>1</w><pc>.</pc><code rend="inline"><w>{</w><w>tag</w><w>:</w><pc>.</pc><w>[</w><w>0</w><w>]</w><w>.hashtag</w><w>,</w><w>count</w><w>:</w><pc>.</pc><w>|</w><w>length</w><w>}</w><w>|</w></code><w>Get</w><w>the</w><w>hashtag</w><w>representing</w><w>each</w><w>sub-array</w><w>by</w><w>checking</w><w>the</w><w>hashtag</w><w>value</w><w>of</w><w>the</w><w>first</w><w>member</w><w>of</w><w>each</w><w>sub-array</w><w>,</w><w>and</w><w>then</w><w>count</w><w>the</w><w>size</w><w>of</w><w>each</w><w>sub-array</w><w>,</w><w>effectively</w><w>counting</w><w>the</w><w>number</w><w>of</w><w>tweets</w><w>in</w><w>which</w><w>that</w><w>hashtag</w><w>was</w><w>used</w><pc>.</pc><w>|</w><w>|</w><w>1</w><pc>.</pc><code rend="inline"><w>[</w><w>.tag</w><w>,</w><w>.count</w><w>]</w><w>|</w></code><w>Create</w><w>simple</w><w>arrays</w><w>with</w><w>just</w><w>the</w><w>tag</w><w>name</w><w>and</w><w>count</w><w>|</w></p><list type="ordered"><item><code rend="inline"><w>@</w><w>csv</w></code><w>Format</w><w>each</w><w>array</w><w>as</w><w>a</w><w>CSV</w><w>row</w></item></list></div></div><div type="3" n="5.4"><head><w>Challenges</w></head><p><w>These</w><w>final</w><w>challenges</w><w>will</w><w>help</w><w>you</w><w>test</w><w>your</w><w>understanding</w><w>of</w><w>how</w><w>to</w><w>pipe</w><w>together</w><ref target="https://stedolan.github.io/jq/"><w>jq</w></ref><w>commands</w><w>on</w><w>your</w><w>own</w><pc>.</pc></p><div type="4" n="5.4.1"><head><w>Filter</w><w>before</w><w>counting</w></head><p><w>What</w><w>function</w><w>do</w><w>we</w><w>need</w><w>to</w><w>add</w><w>to</w><w>the</w><w>hashtag-counting</w><w>filter</w><w>to</w><w>only</w><w>count</w><w>hashtags</w><w>when</w><w>their</w><w>tweet</w><w>has</w><w>been</w><w>retweeted</w><w>at</w><w>least</w><w>200</w><w>times</w><pc>?</pc><w>Hint</w><w>:</w><w>the</w><w>retweet</w><w>count</w><w>is</w><w>saved</w><w>under</w><w>the</w><w>key</w><code rend="inline"><w>retweet_count</w></code><pc>.</pc></p><p><w>You</w><w>should</w><w>get</w><w>the</w><w>following</w><w>table</w><w>:</w></p><ab><code lang="language-txt" xml:id="code_json-and-jq_46" corresp="code_json-and-jq_46.txt" rend="block"/></ab><p><ref target="/assets/filter_retweets.txt"><w>There</w><w>are</w><w>multiple</w><w>ways</w><w>to</w><w>solve</w><w>this</w><w>with</w><w>jq</w><pc>.</pc><w>See</w><w>my</w><w>answer</w><w>here</w><pc>.</pc></ref></p></div><div type="4" n="5.4.2"><head><w>Count</w><w>total</w><w>retweets</w><w>per</w><w>user</w></head><p><w>One</w><w>more</w><w>challenge</w><w>to</w><w>test</w><w>your</w><w>mastery</w><w>of</w><w>jq</w><w>:</w><w>from</w><w>this</w><w>dataset</w><w>,</w><w>try</w><w>to</w><w>compute</w><w>the</w><w>total</w><w>number</w><w>of</w><w>times</w><w>each</w><w>user</w><w>has</w><w>had</w><w>their</w><w>tweets</w><w>(</w><w>at</w><w>least</w><w>within</w><w>this</w><w>dataset</w><w>)</w><w>retweeted</w><pc>.</pc></p><p><w>Hints</w><w>:</w></p><list type="unordered"><item><w>You</w><w>should</w><w>have</w><w>a</w><w>table</w><w>with</w><w>two</w><w>columns</w><w>:</w><w>one</w><w>for</w><w>user</w><w>id</w><w>,</w><w>and</w><w>one</w><w>for</w><w>the</w><w>total</w><w>number</w><w>of</w><w>retweets</w><pc>.</pc><w>There</w><w>should</w><w>only</w><w>be</w><w>one</w><w>row</w><w>per</w><w>user</w><w>id</w><pc>.</pc></item><item><w>Since</w><w>we</w><w>are</w><w>looking</w><w>at</w><w>per-user</w><w>statistics</w><w>that</w><w>cut</w><w>accross</w><w>individual</w><w>tweets</w><w>,</w><w>we</w><w>'ll</w><w>need</w><w>to</w><w>use</w><code rend="inline"><w>group_by</w><w>(</w><w>)</w></code><w>and</w><w>the</w><w>``</w><w>Slurp</w><w>''</w><w>option</w><pc>.</pc></item><item><w>We</w><w>'ve</w><w>used</w><w>a</w><w>few</w><w>functions</w><w>that</w><w>reduce</w><w>an</w><w>array</w><w>of</w><w>multiple</w><w>values</w><w>into</w><w>one</w><w>value</w><w>:</w><code rend="inline"><w>length</w></code><w>counts</w><w>the</w><w>number</w><w>of</w><w>values</w><w>in</w><w>an</w><w>array</w><w>,</w><w>and</w><code rend="inline"><w>join</w><w>(</w><w>)</w></code><w>pastes</w><w>those</w><w>values</w><w>together</w><w>in</w><w>one</w><w>string</w><pc>.</pc><w>If</w><w>you</w><w>want</w><w>to</w><emph><w>add</w></emph><w>numeric</w><w>values</w><w>together</w><w>,</w><w>though</w><w>,</w><code rend="inline"><w>add</w></code><w>could</w><w>be</w><w>a</w><w>promising</w><w>function</w><w>to</w><w>try</w><w>...</w></item></list><p><w>As</w><w>a</w><w>way</w><w>to</w><w>verify</w><w>your</w><w>results</w><w>,</w><w>user</w><code rend="inline"><w>356854246</w></code><w>should</w><w>have</w><w>a</w><w>total</w><w>retweet</w><w>count</w><w>of</w><code rend="inline"><w>51</w></code><w>based</w><w>on</w><w>this</w><w>dataset</w><pc>.</pc></p><p><ref target="/assets/count_retweets.txt"><w>See</w><w>my</w><w>answer</w><pc>.</pc></ref></p></div></div></div><div type="2" n="6"><head><w>Using</w><w>jq</w><w>on</w><w>the</w><w>command</w><w>line</w></head><p><ref target="https://jqplay.org/"><w>jq</w><w>play</w></ref><w>is</w><w>fine</w><w>when</w><w>you</w><w>have</w><w>under</w><w>100-200</w><w>lines</w><w>of</w><w>JSON</w><w>to</w><w>parse</w><pc>.</pc><w>However</w><w>,</w><w>it</w><w>will</w><w>become</w><w>unusably</w><w>slow</w><w>on</w><w>much</w><w>larger</w><w>files</w><pc>.</pc><w>For</w><w>fast</w><w>processing</w><w>of</w><w>very</w><w>large</w><w>files</w><w>,</w><w>or</w><w>of</w><w>JSON</w><w>lines</w><w>spread</w><w>across</w><w>multiple</w><w>files</w><w>,</w><w>you</w><w>will</w><w>need</w><w>to</w><w>run</w><w>the</w><w>command-line</w><w>version</w><w>of</w><w>jq</w><pc>.</pc></p></div><div type="2" n="7"><head><w>Installation</w></head><div type="3" n="7.1"><head><w>Installation</w><w>on</w><w>OS</w><w>X</w></head><p><w>The</w><w>easiest</w><w>way</w><w>to</w><w>install</w><w>jq</w><w>on</w><w>OS</w><w>X</w><w>is</w><w>to</w><w>use</w><w>the</w><w>package</w><w>management</w><w>system</w><ref target="http://brew.sh/"><w>Homebrew</w></ref><pc>.</pc><w>This</w><w>system</w><w>works</w><w>via</w><w>OS</w><w>X</w><w>'s</w><w>``</w><w>Terminal</w><w>''</w><w>application</w><w>,</w><w>which</w><w>gives</w><w>you</w><w>access</w><w>to</w><w>the</w><w>Bash</w><w>command</w><w>line</w><pc>.</pc><ref target="/lessons/intro-to-bash"><w>For</w><w>an</w><w>introduction</w><w>to</w><w>this</w><w>system</w><w>,</w><w>see</w><w>The</w><w>Programming</w><w>Historian</w><w>'s</w><w>``</w><w>Introduction</w><w>to</w><w>the</w><w>Bash</w><w>Command</w><w>Line</w><w>''</w><pc>.</pc></ref></p><p><w>Follow</w><w>the</w><w>installation</w><w>instructions</w><w>for</w><w>Homebrew</w><w>itself</w><w>,</w><w>and</w><w>then</w><w>use</w><w>this</w><w>command</w><w>to</w><w>install</w><w>jq</w><w>:</w></p><ab><code lang="language-sh" xml:id="code_json-and-jq_47" corresp="code_json-and-jq_47.txt" rend="block"/></ab></div><div type="3" n="7.2"><head><w>Installation</w><w>on</w><w>Windows</w></head><p><w>To</w><w>access</w><w>the</w><w>command</w><w>line</w><w>easily</w><w>on</w><w>Windows</w><w>,</w><w>you</w><w>will</w><w>need</w><w>the</w><w>PowerShell</w><w>application</w><pc>.</pc><ref target="/lessons/intro-to-powershell.html"><w>See</w><w>the</w><w>Programming</w><w>Historian</w><w>'s</w><w>``</w><w>Introduction</w><w>to</w><w>PowerShell</w><w>''</w></ref></p><p><w>From</w><w>PowerShell</w><w>,</w><w>you</w><w>can</w><w>install</w><w>the</w><w>Windows</w><w>package</w><w>manager</w><ref target="https://chocolatey.org/install"><w>Chocolatey</w></ref><w>,</w><w>and</w><w>then</w><w>install</w><w>jq</w><w>with</w><w>the</w><w>following</w><w>command</w><w>:</w></p><ab><code lang="language-sh" xml:id="code_json-and-jq_48" corresp="code_json-and-jq_48.txt" rend="block"/></ab></div><div type="3" n="7.3"><head><w>Invoking</w><w>jq</w></head><ab><code lang="language-sh" xml:id="code_json-and-jq_49" corresp="code_json-and-jq_49.txt" rend="block"/></ab><list type="ordered"><item><code rend="inline"><w>jq</w></code><w>calls</w><w>the</w><w>jq</w><w>program</w><pc>.</pc></item><item><code rend="inline"><w>-r</w></code><w>sets</w><w>the</w><w>``</w><w>Raw</w><w>Output</w><w>''</w><w>option</w><pc>.</pc></item><item><w>The</w><w>actual</w><w>filter</w><w>text</w><w>is</w><w>placed</w><w>between</w><code rend="inline"><w>''</w></code><w>quotes</w><pc>.</pc></item><item><code rend="inline"><w>jq_rkm.json</w></code><w>indicates</w><w>that</w><w>jq</w><w>should</w><w>read</w><w>JSON</w><w>from</w><w>the</w><w>file</w><code rend="inline"><w>jq_rkm.json</w></code><pc>.</pc></item><item><code rend="inline"><w>&gt;</w><w>jq_rkm.csv</w></code><w>tells</w><w>the</w><w>command</w><w>line</w><w>to</w><w>write</w><w>jq</w><w>'s</w><w>output</w><w>into</w><w>a</w><w>file</w><w>named</w><code rend="inline"><w>jq_rkm.csv</w></code><pc>.</pc></item></list><p><w>Alternatively</w><w>,</w><w>you</w><w>can</w><w>use</w><w>bash</w><w>pipes</w><w>to</w><w>send</w><w>text</w><w>from</w><w>the</w><w>output</w><w>of</w><w>one</w><w>function</w><w>into</w><w>jq</w><pc>.</pc><w>This</w><w>can</w><w>be</w><w>useful</w><w>when</w><w>downloading</w><w>JSON</w><w>with</w><w>a</w><w>utility</w><w>like</w><code rend="inline"><w>wget</w></code><w>for</w><w>retrieving</w><w>online</w><w>material</w><pc>.</pc><w>(</w><w>See</w><ref target="/lessons/automated-downloading-with-wget"><w>Automated</w><w>Downloading</w><w>with</w><w>Wget</w></ref><w>to</w><w>learn</w><w>the</w><w>basics</w><w>of</w><w>this</w><w>other</w><w>command</w><w>line</w><w>program</w><pc>.</pc><w>)</w></p><ab><code lang="language-sh" xml:id="code_json-and-jq_50" corresp="code_json-and-jq_50.txt" rend="block"/></ab><p><w>Note</w><w>that</w><w>you</w><w>must</w><w>use</w><w>the</w><code rend="inline"><w>wget</w></code><w>flag</w><code rend="inline"><w>-qO-</w></code><w>in</w><w>order</w><w>to</w><w>send</w><w>the</w><w>output</w><w>of</w><code rend="inline"><w>wget</w></code><w>into</w><code rend="inline"><w>jq</w></code><w>by</w><w>way</w><w>of</w><w>a</w><w>shell</w><w>pipe</w><pc>.</pc><w>You</w><w>can</w><w>read</w><w>more</w><w>about</w><w>command</w><w>line</w><w>pipes</w><w>in</w><ref target="/lessons/intro-to-bash"><w>``</w><w>Introduction</w><w>to</w><w>the</w><w>Bash</w><w>Command</w><w>Line</w><w>''</w></ref><w>(</w><w>OS</w><w>X</w><w>)</w><w>or</w><ref target="/lessons/intro-to-powershell.html"><w>``</w><w>Introduction</w><w>to</w><w>PowerShell</w><w>''</w></ref><w>(</w><w>Windows</w><w>)</w><pc>.</pc></p></div></div><div type="2" n="8"><head><w>Further</w><w>Resources</w></head><p><w>jq</w><w>is</w><w>incredibly</w><w>powerful</w><w>,</w><w>but</w><w>its</w><w>advanced</w><w>features</w><w>can</w><w>get</w><w>quite</w><w>complicated</w><pc>.</pc></p><p><w>It</w><w>is</w><w>possible</w><w>to</w><w>do</w><ref target="https://stedolan.github.io/jq/manual/#Math"><w>other</w><w>basic</w><w>math</w><w>functions</w><w>in</w><w>jq</w></ref><w>,</w><w>however</w><w>given</w><w>the</w><w>complexity</w><w>of</w><w>working</w><w>with</w><w>JSON</w><w>'s</w><w>tree</w><w>data</w><w>model</w><w>,</w><w>I</w><w>would</w><w>suggest</w><w>that</w><w>it</w><w>is</w><w>only</w><w>worth</w><w>doing</w><w>the</w><w>most</w><w>basic</w><w>counting</w><w>operations</w><w>in</w><w>jq</w><pc>.</pc><w>If</w><w>basic</w><w>counting</w><w>is</w><w>all</w><w>you</w><w>need</w><w>to</w><w>do</w><w>with</w><w>your</w><w>JSON</w><w>data</w><w>,</w><w>then</w><w>jq</w><w>can</w><w>help</w><w>you</w><w>avoid</w><w>adding</w><w>another</w><w>tool</w><w>onto</w><w>your</w><w>data</w><w>analysis</w><w>pipeline</w><pc>.</pc><w>For</w><w>more</w><w>involved</w><w>math</w><w>,</w><w>however</w><w>,</w><w>it</w><w>would</w><w>be</w><w>more</w><w>sensible</w><w>to</w><w>create</w><w>table</w><w>(</w><w>s</w><w>)</w><w>with</w><w>jq</w><w>and</w><w>then</w><w>continue</w><w>your</w><w>analysis</w><w>in</w><w>Python</w><w>,</w><w>R</w><w>,</w><w>or</w><w>even</w><w>Excel</w><pc>.</pc></p><p><w>If</w><w>you</w><w>are</w><w>working</w><w>with</w><w>deeply-nested</w><w>JSON</w><w>(</w><w>that</w><w>is</w><w>,</w><w>many</w><w>objects</w><w>within</w><w>objects</w><w>)</w><w>,</w><w>or</w><w>JSON</w><w>where</w><w>objects</w><w>have</w><w>inconsistent</w><w>structure</w><w>,</w><w>you</w><w>may</w><w>need</w><w>to</w><w>use</w><w>features</w><w>not</w><w>covered</w><w>in</w><w>this</w><w>lesson</w><w>,</w><w>including</w><ref target="https://stedolan.github.io/jq/manual/#if-then-else"><w>if-then-else</w><w>statements</w></ref><w>,</w><ref target="https://stedolan.github.io/jq/manual/#Recursion"><w>recursion</w></ref><w>,</w><w>and</w><ref target="https://stedolan.github.io/jq/manual/#Reduce"><w>reduction</w></ref><pc>.</pc><w>If</w><w>you</w><w>ca</w><w>n't</w><w>figure</w><w>out</w><w>the</w><w>filter</w><w>you</w><w>need</w><w>to</w><w>go</w><w>from</w><w>your</w><w>given</w><w>input</w><w>to</w><w>your</w><w>desired</w><w>output</w><w>,</w><w>using</w><w>the</w><w>tag</w><code rend="inline"><w>jq</w></code><w>over</w><w>at</w><ref target="http://stackoverflow.com/questions/tagged/jq"><w>StackOverflow</w></ref><w>can</w><w>often</w><w>get</w><w>you</w><w>a</w><w>speedy</w><w>answer</w><pc>.</pc><w>Make</w><w>sure</w><w>that</w><w>you</w><w>try</w><w>to</w><ref target="http://stackoverflow.com/help/how-to-ask"><w>follow</w><w>best</w><w>practices</w><w>when</w><w>describing</w><w>your</w><w>problem</w></ref><w>and</w><w>provide</w><w>a</w><ref target="http://stackoverflow.com/help/mcve"><w>reproducible</w><w>example</w></ref><pc>.</pc></p></div></body>
    </text>
</TEI>
