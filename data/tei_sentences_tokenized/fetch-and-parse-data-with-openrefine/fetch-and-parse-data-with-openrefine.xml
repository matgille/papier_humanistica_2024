<TEI xmlns="http://www.tei-c.org/ns/1.0" xmlns:xi="http://www.w3.org/2001/XInclude" xml:id="fetch-and-parse-data-with-openrefine" type="original" xml:base="fetch-and-parse-data-with-openrefine/fetch-and-parse-data-with-openrefine/fetch-and-parse-data-with-openrefine.xml">
    <teiHeader>
        <fileDesc>
            <titleStmt>
                <title>Fetching and Parsing Data from the Web with OpenRefine</title>
                <author role="original_author">Evan Peter Williamson</author>
                <editor role="reviewers">
                    <persName>Peggy Griesinger</persName>
                    <persName>Lisa Lowry</persName>
                </editor>
                <editor role="editors">Jeri Wieringa</editor>
            </titleStmt>
            <publicationStmt>
                <distributor>Programming Historian</distributor>
                <idno type="doi">10.46430/phen0065</idno>
                <date type="published">08/12/2017</date>
            </publicationStmt>
            <sourceDesc>
                <p>Born digital, in a markdown format. This lesson is original.</p>
            </sourceDesc>
        </fileDesc>
        <profileDesc>
            <abstract>
                <p>OpenRefine is a powerful tool for exploring, cleaning, and transforming data. In this lesson you will learn how to use Refine to fetch URLs and parse web content.</p>
            </abstract>
            <textClass>
                <keywords>
                    <term xml:lang="en">data-manipulation</term>
                    <term xml:lang="en">web-scraping</term>
                    <term xml:lang="en">api</term>
                </keywords>
            </textClass>
        </profileDesc>
    </teiHeader>
    <text xml:lang="en">
        <body><div type="2" n="1"><head><s xml:id="s_Eagjle"><w>Lesson</w><w>Goals</w></s></head><p><s xml:id="s_ZrceRI"><w>OpenRefine</w><w>is</w><w>a</w><w>powerful</w><w>tool</w><w>for</w><w>exploring</w><w>,</w><w>cleaning</w><w>,</w><w>and</w><w>transforming</w><w>data</w><pc>.</pc></s><s xml:id="s_tgOjIW"><w>An</w><w>earlier</w><w>Programming</w><w>Historian</w><w>lesson</w><w>,</w><ref target="/lessons/cleaning-data-with-openrefine"><w>``</w><w>Cleaning</w><w>Data</w><w>with</w><w>OpenRefine</w><w>''</w></ref><w>,</w><w>introduced</w><w>the</w><w>basic</w><w>functionality</w><w>of</w><w>Refine</w><w>to</w><w>efficiently</w><w>discover</w><w>and</w><w>correct</w><w>inconsistency</w><w>in</w><w>a</w><w>data</w><w>set</w><pc>.</pc></s><s xml:id="s_tjJPTB"><w>Building</w><w>on</w><w>those</w><w>essential</w><w>data</w><w>wrangling</w><w>skills</w><w>,</w><w>this</w><w>lesson</w><w>focuses</w><w>on</w><w>Refine</w><w>'s</w><w>ability</w><w>to</w><w>fetch</w><w>URLs</w><w>and</w><w>parse</w><w>web</w><w>content</w><pc>.</pc></s><s xml:id="s_7o1BSH"><w>Examples</w><w>introduce</w><w>some</w><w>of</w><w>the</w><w>advanced</w><w>features</w><w>to</w><w>transform</w><w>and</w><w>enhance</w><w>a</w><w>data</w><w>set</w><w>including</w><w>:</w></s></p><list type="unordered"><item><s xml:id="s_PSdxEc"><w>fetch</w><w>URLs</w><w>using</w><w>Refine</w></s></item><item><s xml:id="s_Nw17Ud"><w>construct</w><w>URL</w><w>queries</w><w>to</w><w>retrieve</w><w>information</w><w>from</w><w>a</w><w>simple</w><w>web</w><w>API</w></s></item><item><s xml:id="s_wAMjXm"><w>parse</w><w>HTML</w><w>and</w><w>JSON</w><w>responses</w><w>to</w><w>extract</w><w>relevant</w><w>data</w></s></item><item><s xml:id="s_N7ctON"><w>use</w><w>array</w><w>functions</w><w>to</w><w>manipulate</w><w>string</w><w>values</w></s></item><item><s xml:id="s_lvVEZB"><w>use</w><w>Jython</w><w>to</w><w>extend</w><w>Refine</w><w>'s</w><w>functionality</w></s></item></list><p><s xml:id="s_6tOJqu"><w>It</w><w>will</w><w>be</w><w>helpful</w><w>to</w><w>have</w><w>basic</w><w>familiarity</w><w>with</w><ref target="/lessons/cleaning-data-with-openrefine"><w>OpenRefine</w></ref><w>,</w><ref target="/lessons/viewing-html-files"><w>HTML</w></ref><w>,</w><w>and</w><w>programming</w><w>concepts</w><w>such</w><w>as</w><w>variables</w><w>and</w><w>loops</w><w>to</w><w>complete</w><w>this</w><w>lesson</w><pc>.</pc></s></p><div type="3" n="1.1"><head><s xml:id="s_NlAv2R"><w>Why</w><w>Use</w><w>OpenRefine</w><pc>?</pc></s></head><p><s xml:id="s_VP15H4"><w>The</w><w>ability</w><w>to</w><w>create</w><w>data</w><w>sets</w><w>from</w><w>unstructured</w><w>documents</w><w>available</w><w>on</w><w>the</w><w>web</w><w>opens</w><w>possibilities</w><w>for</w><w>research</w><w>using</w><w>digitized</w><w>primary</w><w>materials</w><w>,</w><w>web</w><w>archives</w><w>,</w><w>texts</w><w>,</w><w>and</w><w>contemporary</w><w>media</w><w>streams</w><pc>.</pc></s><s xml:id="s_AhTfcQ"><w>Programming</w><w>Historian</w><w>lessons</w><w>introduce</w><w>a</w><w>number</w><w>of</w><w>methods</w><w>to</w><w>gather</w><w>and</w><w>interact</w><w>with</w><w>this</w><w>content</w><w>,</w><w>from</w><ref target="/lessons/applied-archival-downloading-with-wget"><w>wget</w></ref><w>to</w><ref target="/lessons/intro-to-beautiful-soup"><w>Python</w></ref><pc>.</pc></s><s xml:id="s_TKbePL"><w>When</w><w>working</w><w>with</w><w>text</w><w>documents</w><w>,</w><w>Refine</w><w>is</w><w>particularly</w><w>suited</w><w>for</w><w>this</w><w>task</w><w>,</w><w>allowing</w><w>users</w><w>to</w><w>fetch</w><w>urls</w><w>and</w><w>directly</w><w>process</w><w>the</w><w>results</w><w>in</w><w>an</w><w>iterative</w><w>,</w><w>exploratory</w><w>manner</w><pc>.</pc></s></p><p><s xml:id="s_aY6bxw"><w>David</w><w>Huynh</w><w>,</w><w>the</w><w>creator</w><w>of</w><w>Freebase</w><w>Gridworks</w><w>(</w><w>2009</w><w>)</w><w>which</w><w>became</w><w>GoogleRefine</w><w>(</w><w>2010</w><w>)</w><w>and</w><w>then</w><w>OpenRefine</w><w>(</w><w>2012+</w><w>)</w><w>,</w><w>describes</w><w>Refine</w><w>as</w><w>:</w></s></p><list type="unordered"><item><s xml:id="s_eSChst"><w>more</w><w>powerful</w><w>than</w><w>a</w><w>spreadsheet</w></s></item><item><s xml:id="s_c23DaU"><w>more</w><w>interactive</w><w>and</w><w>visual</w><w>than</w><w>scripting</w></s></item><item><s xml:id="s_0z5x34"><w>more</w><w>provisional</w><w>/</w><w>exploratory</w><w>/</w><w>experimental</w><w>/</w><w>playful</w><w>than</w><w>a</w><w>database</w><ref type="footnotemark" target="#en_note_huynh"/></s></item></list><p><s xml:id="s_6GtxsH"><w>Refine</w><w>is</w><w>a</w><w>unique</w><w>tool</w><w>that</w><w>combines</w><w>the</w><w>power</w><w>of</w><w>databases</w><w>and</w><w>scripting</w><w>languages</w><w>into</w><w>an</w><w>interactive</w><w>and</w><w>user</w><w>friendly</w><w>visual</w><w>interface</w><pc>.</pc></s><s xml:id="s_E3prlu"><w>Because</w><w>of</w><w>this</w><w>flexibility</w><w>it</w><w>has</w><w>been</w><w>embraced</w><w>by</w><ref target="https://www.propublica.org/nerds/item/using-google-refine-for-data-cleaning"><w>journalists</w></ref><w>,</w><ref target="http://web.archive.org/web/20180129051941/http://data-lessons.github.io/library-openrefine/"><w>librarians</w></ref><w>,</w><ref target="http://www.datacarpentry.org/OpenRefine-ecology-lesson/"><w>scientists</w></ref><w>,</w><w>and</w><w>others</w><w>needing</w><w>to</w><w>wrangle</w><w>data</w><w>from</w><w>diverse</w><w>sources</w><w>and</w><w>formats</w><w>into</w><w>structured</w><w>information</w><pc>.</pc></s></p><figure><desc><s xml:id="s_VoJdyW"><w>OpenRefine</w><w>terminal</w><w>and</w><w>GUI</w></s></desc><graphic url="openrefine.png"/></figure><quote><p><s xml:id="s_3w79cQ"><w>OpenRefine</w><w>is</w><w>a</w><ref target="https://www.gnu.org/philosophy/free-sw.en.html"><w>free</w></ref><w>and</w><ref target="https://github.com/OpenRefine/OpenRefine"><w>open</w><w>source</w></ref><w>Java</w><w>application</w><pc>.</pc></s><s xml:id="s_AKkBiM"><w>The</w><w>user</w><w>interface</w><w>is</w><w>rendered</w><w>by</w><w>your</w><w>web</w><w>browser</w><w>,</w><w>but</w><w>Refine</w><w>is</w><w>not</w><w>a</w><w>web</w><w>application</w><pc>.</pc></s><s xml:id="s_XDHXFY"><w>No</w><w>information</w><w>is</w><w>sent</w><w>online</w><w>and</w><w>no</w><w>internet</w><w>connection</w><w>is</w><w>necessary</w><pc>.</pc></s><s xml:id="s_vjrSbL"><w>Full</w><w>documentation</w><w>is</w><w>available</w><w>on</w><w>the</w><ref target="https://github.com/OpenRefine/OpenRefine/wiki/"><w>official</w><w>wiki</w></ref><pc>.</pc></s><s xml:id="s_mI2vaW"><w>For</w><w>installation</w><w>and</w><w>staring</w><w>Refine</w><w>check</w><w>this</w><ref target="https://uidaholib.github.io/clean-your-data/3-start.html"><w>workshop</w><w>page</w></ref><pc>.</pc></s></p><p><s xml:id="s_MQQ3p0"><w>Note</w><w>:</w><w>this</w><w>lesson</w><w>was</w><w>written</w><w>using</w><w>openrefine-2.7</w><pc>.</pc></s><s xml:id="s_d1l1aJ"><w>Although</w><w>almost</w><w>all</w><w>functionality</w><w>is</w><w>interchangeable</w><w>between</w><w>versions</w><w>,</w><w>I</w><w>suggest</w><w>using</w><w>the</w><w>newest</w><w>version</w><pc>.</pc></s></p></quote></div><div type="3" n="1.2"><head><s xml:id="s_9NUKIX"><w>Lesson</w><w>Outline</w></s></head><p><s xml:id="s_ABptWd"><w>This</w><w>lesson</w><w>presents</w><w>three</w><w>examples</w><w>demonstrating</w><w>workflows</w><w>to</w><w>harvest</w><w>and</w><w>process</w><w>data</w><w>from</w><w>the</w><w>web</w><w>:</w></s></p><list type="ordered"><item><s xml:id="s_SxZws0"><emph><ref target="#example-1-fetching-and-parsing-html"><w>Example</w><w>1</w><w>:</w><w>Fetching</w><w>and</w><w>Parsing</w><w>HTML</w></ref></emph><w>transforms</w><w>an</w><w>ebook</w><w>into</w><w>a</w><w>structured</w><w>data</w><w>set</w><w>by</w><w>parsing</w><w>the</w><w>HTML</w><w>and</w><w>using</w><w>string</w><w>array</w><w>functions</w><pc>.</pc></s></item><item><s xml:id="s_CLGCDz"><emph><ref target="#example-2-url-queries-and-parsing-json"><w>Example</w><w>2</w><w>:</w><w>URL</w><w>Queries</w><w>and</w><w>Parsing</w><w>JSON</w></ref></emph><w>interacts</w><w>with</w><w>a</w><w>simple</w><w>web</w><w>API</w><w>to</w><w>construct</w><w>a</w><w>full</w><w>text</w><w>data</w><w>set</w><w>of</w><w>historic</w><w>newspaper</w><w>front</w><w>pages</w><pc>.</pc></s></item><item><s xml:id="s_uhrY4t"><emph><ref target="#example-3-advanced-apis"><w>Example</w><w>3</w><w>:</w><w>Advanced</w><w>APIs</w></ref></emph><w>demonstrates</w><w>using</w><w>Jython</w><w>to</w><w>implement</w><w>a</w><w>POST</w><w>request</w><w>to</w><w>a</w><w>natural</w><w>language</w><w>processing</w><w>web</w><w>service</w><pc>.</pc></s></item></list></div></div><div type="2" n="2"><head><s xml:id="s_CZWE7n"><w>Example</w><w>1</w><w>:</w><w>Fetching</w><w>and</w><w>Parsing</w><w>HTML</w></s></head><p><s xml:id="s_4kzneX"><w>This</w><w>example</w><w>downloads</w><w>a</w><w>single</w><w>web</w><w>page</w><w>and</w><w>parses</w><w>it</w><w>into</w><w>a</w><w>structured</w><w>table</w><w>using</w><w>Refine</w><w>'s</w><w>built</w><w>in</w><w>functions</w><pc>.</pc></s><s xml:id="s_sMvtZh"><w>A</w><w>similar</w><w>workflow</w><w>can</w><w>be</w><w>applied</w><w>to</w><w>a</w><w>list</w><w>of</w><w>URLs</w><w>,</w><w>often</w><w>generated</w><w>by</w><w>parsing</w><w>another</w><w>web</w><w>page</w><w>,</w><w>creating</w><w>a</w><w>flexible</w><w>web</w><w>harvesting</w><w>tool</w><pc>.</pc></s></p><p><s xml:id="s_5Nkc0a"><w>The</w><w>raw</w><w>data</w><w>for</w><w>this</w><w>example</w><w>is</w><w>an</w><w>HTML</w><w>copy</w><w>of</w><w>Shakespeare</w><w>'s</w><ref target="http://www.gutenberg.org/ebooks/1105"><w>Sonnets</w></ref><w>from</w><ref target="http://www.gutenberg.org/"><w>Project</w><w>Gutenberg</w></ref><pc>.</pc></s><s xml:id="s_KWCVCG"><w>Processing</w><w>a</w><w>book</w><w>of</w><w>poems</w><w>into</w><w>structured</w><w>data</w><w>enables</w><w>new</w><w>ways</w><w>of</w><w>reading</w><w>text</w><w>,</w><w>allowing</w><w>us</w><w>to</w><w>sort</w><w>,</w><w>manipulate</w><w>,</w><w>and</w><w>connect</w><w>with</w><w>other</w><w>information</w><pc>.</pc></s></p><p style="alert alert-warning"><s xml:id="s_xTfkYc"><w>Please</w><w>note</w><w>that</w><w>Project</w><w>Gutenberg</w><w>provides</w><ref target="http://www.gutenberg.org/wiki/Gutenberg:Feeds"><w>feeds</w></ref><w>to</w><w>bulk</w><w>download</w><w>catalog</w><w>data</w><pc>.</pc></s><s xml:id="s_ecB65Y"><w>Their</w><w>public</w><w>website</w><w>should</w><w>not</w><w>be</w><w>used</w><w>for</w><w>web</w><w>scraping</w><w>purposes</w><pc>.</pc></s><s xml:id="s_DbcPiZ"><w>A</w><w>copy</w><w>of</w><w>the</w><w>HTML</w><w>ebook</w><w>is</w><w>hosted</w><w>on</w><w>GitHub</w><w>for</w><w>this</w><w>example</w><w>to</w><w>avoid</w><w>redirects</w><w>built</w><w>in</w><w>to</w><w>the</w><w>Gutenberg</w><w>site</w><pc>.</pc></s></p><div type="3" n="2.1"><head><s xml:id="s_v0r1XC"><w>Start</w><w>``</w><w>Sonnets</w><w>''</w><w>Project</w></s></head><p><s xml:id="s_fo2NlP"><w>Start</w><w>OpenRefine</w><w>and</w><w>select</w><emph><w>Create</w><w>Project</w></emph><pc>.</pc></s><s xml:id="s_lfyEOb"><w>Refine</w><w>can</w><w>import</w><w>data</w><w>from</w><w>a</w><w>wide</w><w>variety</w><w>of</w><w>formats</w><w>and</w><w>sources</w><w>,</w><w>from</w><w>a</w><w>local</w><w>Excel</w><w>file</w><w>to</w><w>web</w><w>accessible</w><w>RDF</w><pc>.</pc></s><s xml:id="s_tG0XEc"><w>One</w><w>often</w><w>over</w><w>looked</w><w>method</w><w>is</w><w>the</w><emph><w>Clipboard</w></emph><w>,</w><w>which</w><w>allows</w><w>entering</w><w>data</w><w>via</w><w>copy</w><w>&amp;</w><w>paste</w><pc>.</pc></s><s xml:id="s_7tuN5J"><w>Under</w><w>``</w><w>Get</w><w>Data</w><w>From</w><w>''</w><w>,</w><w>click</w><emph><w>Clipboard</w></emph><w>,</w><w>and</w><w>paste</w><w>this</w><w>URL</w><w>into</w><w>the</w><w>text</w><w>box</w><w>:</w></s></p><ab><code xml:id="code_fetch-and-parse-data-with-openrefine_0" corresp="code_fetch-and-parse-data-with-openrefine_0.txt" rend="block"/></ab><figure><desc><s xml:id="s_317msZ"><w>Start</w><w>project</w><w>with</w><w>clipboard</w></s></desc><graphic url="refine-clipboard1.png"/></figure><p><s xml:id="s_Wig7YD"><w>After</w><w>clicking</w><emph><w>Next</w></emph><w>,</w><w>Refine</w><w>should</w><w>automatically</w><w>identify</w><w>the</w><w>content</w><w>as</w><w>a</w><w>line-based</w><w>text</w><w>file</w><w>and</w><w>the</w><w>default</w><w>parsing</w><w>options</w><w>should</w><w>be</w><w>correct</w><pc>.</pc></s><s xml:id="s_TF9aY7"><w>Add</w><w>the</w><w>project</w><w>name</w><w>``</w><w>Sonnets</w><w>''</w><w>at</w><w>the</w><w>top</w><w>right</w><w>and</w><w>click</w><emph><w>Create</w><w>project</w></emph><pc>.</pc></s><s xml:id="s_nesICi"><w>This</w><w>will</w><w>result</w><w>in</w><w>a</w><w>project</w><w>with</w><w>one</w><w>column</w><w>and</w><w>one</w><w>row</w><pc>.</pc></s></p></div><div type="3" n="2.2"><head><s xml:id="s_gnyahz"><w>Fetch</w><w>HTML</w></s></head><p><s xml:id="s_nif4SI"><w>Refine</w><w>'s</w><w>built-in</w><w>function</w><w>to</w><w>retrieve</w><w>a</w><w>list</w><w>of</w><w>URLs</w><w>is</w><w>done</w><w>by</w><w>creating</w><w>a</w><w>new</w><w>column</w><pc>.</pc></s><s xml:id="s_yTjv0t"><w>Click</w><w>on</w><w>the</w><w>menu</w><w>arrow</w><w>of</w><emph><w>Column</w><w>1</w></emph><w>&gt;</w><emph><w>Edit</w><w>column</w></emph><w>&gt;</w><emph><w>Add</w><w>column</w><w>by</w><w>fetching</w><w>urls</w></emph><pc>.</pc></s></p><p><s xml:id="s_yeeL1O"><w>{</w><w>%</w><w>include</w><w>figure.html</w><w>caption=</w><w>''</w><w>Edit</w><w>column</w><w>&gt;</w><w>Add</w><w>column</w><w>by</w><w>fetching</w><w>URL</w><w>''</w><w>filename=</w><w>''</w><w>refine-fetch1.png</w><w>''</w><w>%</w><w>}</w></s></p><p><s xml:id="s_Y0IxSH"><w>Name</w><w>the</w><w>new</w><w>column</w><w>``</w><w>fetch</w><w>''</w><pc>.</pc></s><s xml:id="s_83QQ6c"><w>The</w><emph><w>Throttle</w><w>delay</w></emph><w>option</w><w>sets</w><w>a</w><w>pause</w><w>time</w><w>between</w><w>requests</w><w>to</w><w>avoid</w><w>being</w><w>blocked</w><w>by</w><w>a</w><w>server</w><pc>.</pc></s><s xml:id="s_ojnEeU"><w>The</w><w>default</w><w>is</w><w>conservative</w><pc>.</pc></s></p><p><s xml:id="s_NJCnrt"><w>{</w><w>%</w><w>include</w><w>figure.html</w><w>caption=</w><w>''</w><w>Add</w><w>column</w><w>by</w><w>fetch</w><w>dialog</w><w>box</w><w>''</w><w>filename=</w><w>''</w><w>refine-fetch1.2.png</w><w>''</w><w>%</w><w>}</w></s></p><p><s xml:id="s_FFSEnb"><w>After</w><w>clicking</w><w>``</w><w>OK</w><w>''</w><w>,</w><w>Refine</w><w>will</w><w>start</w><w>requesting</w><w>the</w><w>URLs</w><w>from</w><w>the</w><w>base</w><w>column</w><w>as</w><w>if</w><w>you</w><w>were</w><w>opening</w><w>the</w><w>pages</w><w>in</w><w>your</w><w>browser</w><w>,</w><w>and</w><w>will</w><w>store</w><w>each</w><w>response</w><w>in</w><w>the</w><w>cells</w><w>of</w><w>the</w><w>new</w><w>column</w><pc>.</pc></s><s xml:id="s_ImoBnN"><w>In</w><w>this</w><w>case</w><w>,</w><w>there</w><w>is</w><w>one</w><w>URL</w><w>in</w><emph><w>Column</w><w>1</w></emph><w>resulting</w><w>in</w><w>one</w><w>cell</w><w>in</w><w>the</w><emph><w>fetch</w></emph><w>column</w><w>containing</w><w>the</w><w>full</w><w>HTML</w><w>source</w><w>for</w><w>the</w><w>Sonnets</w><w>web</w><w>page</w><pc>.</pc></s></p><p><s xml:id="s_xHs0yd"><w>{</w><w>%</w><w>include</w><w>figure.html</w><w>caption=</w><w>''</w><w>Fetch</w><w>results</w><w>''</w><w>filename=</w><w>''</w><w>refine-fetch1.3.png</w><w>''</w><w>%</w><w>}</w></s></p></div><div type="3" n="2.3"><head><s xml:id="s_zhcNps"><w>Parse</w><w>HTML</w></s></head><p><s xml:id="s_tYOocg"><w>Much</w><w>of</w><w>the</w><w>web</w><w>page</w><w>is</w><w>not</w><w>sonnet</w><w>text</w><w>and</w><w>must</w><w>be</w><w>removed</w><w>to</w><w>create</w><w>a</w><w>clean</w><w>data</w><w>set</w><pc>.</pc></s><s xml:id="s_TvP0eN"><w>First</w><w>,</w><w>it</w><w>is</w><w>necessary</w><w>to</w><w>identify</w><w>a</w><w>pattern</w><w>that</w><w>can</w><w>isolate</w><w>the</w><w>desired</w><w>content</w><pc>.</pc></s><s xml:id="s_VQW1wP"><w>Items</w><w>will</w><w>often</w><w>be</w><w>nested</w><w>in</w><w>a</w><w>unique</w><w>container</w><w>or</w><w>given</w><w>a</w><w>meaningful</w><w>class</w><w>or</w><w>id</w><pc>.</pc></s></p><p><s xml:id="s_Ylpkrj"><w>To</w><w>make</w><w>examining</w><w>the</w><w>HTML</w><w>easier</w><w>,</w><w>click</w><w>on</w><w>the</w><w>URL</w><w>in</w><emph><w>Column</w><w>1</w></emph><w>to</w><w>open</w><w>the</w><w>link</w><w>in</w><w>a</w><w>new</w><w>tab</w><w>,</w><w>then</w><w>right</w><w>click</w><w>on</w><w>the</w><w>page</w><w>to</w><w>``</w><w>View</w><w>Page</w><w>Source</w><w>''</w><pc>.</pc></s><s xml:id="s_z6IvTB"><w>In</w><w>this</w><w>case</w><w>the</w><w>sonnets</w><w>page</w><w>does</w><w>not</w><w>have</w><w>distinctive</w><w>semantic</w><w>markup</w><w>,</w><w>but</w><w>each</w><w>poem</w><w>is</w><w>contained</w><w>inside</w><w>a</w><w>single</w><code rend="inline"><w>&lt;</w><w>p</w><w>&gt;</w></code><w>element</w><pc>.</pc></s><s xml:id="s_WHGLyq"><w>Thus</w><w>,</w><w>if</w><w>all</w><w>the</w><w>paragraphs</w><w>are</w><w>selected</w><w>,</w><w>the</w><w>sonnets</w><w>can</w><w>be</w><w>extracted</w><w>from</w><w>the</w><w>group</w><pc>.</pc></s></p><p><s xml:id="s_v1ea0B"><w>{</w><w>%</w><w>include</w><w>figure.html</w><w>caption=</w><w>''</w><w>Each</w><w>sonnet</w><w>is</w><w>a</w><w>&lt;</w><w>p</w><w>&gt;</w><w>with</w><w>lines</w><w>separated</w><w>by</w><w>&lt;</w><w>br</w><w>/</w><w>&gt;</w><w>''</w><w>filename=</w><w>''</w><w>refine-sonnet-markup.png</w><w>''</w><w>%</w><w>}</w></s></p><p><s xml:id="s_gTaghd"><w>On</w><w>the</w><emph><w>fetch</w></emph><w>column</w><w>,</w><w>click</w><w>on</w><w>the</w><w>menu</w><w>arrow</w><w>&gt;</w><emph><w>edit</w><w>column</w></emph><w>&gt;</w><emph><w>Add</w><w>column</w><w>based</w><w>on</w><w>this</w><w>column</w></emph><pc>.</pc></s><s xml:id="s_6fz00a"><w>Give</w><w>the</w><w>new</w><w>column</w><w>the</w><w>name</w><w>``</w><w>parse</w><w>''</w><w>,</w><w>then</w><w>click</w><w>in</w><w>the</w><emph><w>Expression</w></emph><w>text</w><w>box</w><pc>.</pc></s></p><p><s xml:id="s_1ht7aJ"><w>{</w><w>%</w><w>include</w><w>figure.html</w><w>caption=</w><w>''</w><w>Edit</w><w>column</w><w>&gt;</w><w>Add</w><w>column</w><w>based</w><w>on</w><w>this</w><w>column</w><w>''</w><w>filename=</w><w>''</w><w>refine-expression-box.png</w><w>''</w><w>%</w><w>}</w></s></p><p><s xml:id="s_6PSoYk"><w>Data</w><w>in</w><w>Refine</w><w>can</w><w>be</w><w>transformed</w><w>using</w><w>the</w><ref target="https://github.com/OpenRefine/OpenRefine/wiki/General-Refine-Expression-Language"><w>General</w><w>Refine</w><w>Expression</w><w>Language</w></ref><w>(</w><w>GREL</w><w>)</w><pc>.</pc></s><s xml:id="s_hGoN8J"><w>The</w><emph><w>Expression</w></emph><w>box</w><w>accepts</w><w>GREL</w><w>functions</w><w>that</w><w>will</w><w>be</w><w>applied</w><w>to</w><w>each</w><w>cell</w><w>in</w><w>the</w><w>existing</w><w>column</w><w>to</w><w>create</w><w>values</w><w>for</w><w>the</w><w>new</w><w>one</w><pc>.</pc></s><s xml:id="s_3BVGuL"><w>The</w><emph><w>Preview</w></emph><w>window</w><w>below</w><w>the</w><emph><w>Expression</w></emph><w>box</w><w>displays</w><w>the</w><w>current</w><w>value</w><w>on</w><w>the</w><w>left</w><w>and</w><w>the</w><w>value</w><w>for</w><w>the</w><w>new</w><w>column</w><w>on</w><w>the</w><w>right</w><pc>.</pc></s></p><p><s xml:id="s_DPFX7v"><w>The</w><w>default</w><w>expression</w><w>is</w><code rend="inline"><w>value</w></code><w>,</w><w>the</w><ref target="https://github.com/OpenRefine/OpenRefine/wiki/Variables"><w>GREL</w><w>variable</w></ref><w>representing</w><w>the</w><w>current</w><w>contents</w><w>of</w><w>a</w><w>cell</w><pc>.</pc></s><s xml:id="s_nrx7ZA"><w>This</w><w>means</w><w>that</w><w>each</w><w>cell</w><w>is</w><w>simply</w><w>copied</w><w>to</w><w>the</w><w>new</w><w>column</w><w>,</w><w>which</w><w>is</w><w>reflected</w><w>in</w><w>the</w><emph><w>Preview</w></emph><pc>.</pc></s><s xml:id="s_Ej9skL"><w>GREL</w><w>variables</w><w>and</w><w>functions</w><w>are</w><w>strung</w><w>together</w><w>in</w><w>sequence</w><w>using</w><w>a</w><w>period</w><w>,</w><w>called</w><w>dot</w><w>notation</w><pc>.</pc></s><s xml:id="s_n2s8lb"><w>This</w><w>allows</w><w>complex</w><w>operations</w><w>to</w><w>be</w><w>constructed</w><w>by</w><w>passing</w><w>the</w><w>results</w><w>of</w><w>each</w><w>function</w><w>to</w><w>the</w><w>next</w><pc>.</pc></s></p><p><s xml:id="s_GC4Joo"><w>GREL</w><w>'s</w><code rend="inline"><w>parseHtml</w><w>(</w><w>)</w></code><w>function</w><w>can</w><w>read</w><w>HTML</w><w>content</w><w>,</w><w>allowing</w><w>elements</w><w>to</w><w>be</w><w>accessed</w><w>using</w><w>the</w><code rend="inline"><w>select</w><w>(</w><w>)</w></code><w>function</w><w>and</w><w>the</w><ref target="https://jsoup.org/cookbook/extracting-data/selector-syntax"><w>jsoup</w><w>selector</w><w>syntax</w></ref><pc>.</pc></s><s xml:id="s_DColyv"><w>Starting</w><w>with</w><code rend="inline"><w>value</w></code><w>,</w><w>add</w><w>the</w><w>functions</w><code rend="inline"><w>parseHtml</w><w>(</w><w>)</w></code><w>and</w><code rend="inline"><w>select</w><w>(</w><w>``</w><w>p</w><w>''</w><w>)</w></code><w>in</w><w>the</w><emph><w>Expression</w></emph><w>box</w><w>using</w><w>dot</w><w>notation</w><w>,</w><w>resulting</w><w>in</w><w>:</w></s></p><ab><code xml:id="code_fetch-and-parse-data-with-openrefine_1" corresp="code_fetch-and-parse-data-with-openrefine_1.txt" rend="block"/></ab><p><s xml:id="s_tS9MIP"><w>Do</w><w>not</w><w>click</w><emph><w>OK</w></emph><w>at</w><w>this</w><w>point</w><w>,</w><w>simply</w><w>look</w><w>at</w><w>the</w><emph><w>Preview</w></emph><w>to</w><w>see</w><w>the</w><w>result</w><w>of</w><w>the</w><w>expression</w><pc>.</pc></s></p><p><s xml:id="s_CR6npL"><w>{</w><w>%</w><w>include</w><w>figure.html</w><w>caption=</w><w>''</w><w>Edit</w><w>the</w><w>GREL</w><w>expression</w><w>,</w><w>parseHtml</w><w>function</w><w>''</w><w>filename=</w><w>''</w><w>refine-parse-html.png</w><w>''</w><w>%</w><w>}</w></s></p><p><s xml:id="s_frywtP"><w>Notice</w><w>that</w><w>the</w><w>output</w><w>on</w><w>the</w><w>right</w><w>no</w><w>longer</w><w>starts</w><w>with</w><w>the</w><w>HTML</w><w>root</w><w>elements</w><w>(</w><code rend="inline"><w>&lt;</w><pc>!</pc><w>DOCTYPE</w><w>html</w></code><w>etc.</w><w>)</w><w>seen</w><w>on</w><w>the</w><w>left</w><pc>.</pc></s><s xml:id="s_QOXa8j"><w>Instead</w><w>,</w><w>it</w><w>starts</w><w>with</w><w>a</w><w>square</w><w>bracket</w><code rend="inline"><w>[</w></code><w>,</w><w>displaying</w><w>an</w><ref target="https://en.wikipedia.org/wiki/Array_data_type"><w>array</w></ref><w>of</w><w>all</w><w>the</w><code rend="inline"><w>p</w></code><w>elements</w><w>found</w><w>in</w><w>the</w><w>page</w><pc>.</pc></s><s xml:id="s_KAGApk"><w>Refine</w><w>represents</w><w>an</w><w>array</w><w>as</w><w>a</w><w>comma</w><w>separated</w><w>list</w><w>enclosed</w><w>in</w><w>square</w><w>brackets</w><w>,</w><w>for</w><w>example</w><code rend="inline"><w>[</w><w>``</w><w>one</w><w>''</w><w>,</w><w>``</w><w>two</w><w>''</w><w>,</w><w>``</w><w>three</w><w>''</w><w>]</w></code><pc>.</pc></s></p><p><s xml:id="s_EYTFqx"><w>Refine</w><w>is</w><w>visual</w><w>and</w><w>iterative</w><w>;</w><w>it</w><w>is</w><w>common</w><w>to</w><w>gradually</w><w>build</w><w>up</w><w>an</w><w>expression</w><w>while</w><w>checking</w><w>the</w><w>preview</w><w>to</w><w>see</w><w>the</w><w>result</w><pc>.</pc></s><s xml:id="s_yp4zJU"><w>In</w><w>addition</w><w>to</w><w>helping</w><w>debug</w><w>your</w><w>GREL</w><w>,</w><w>this</w><w>provides</w><w>an</w><w>opportunity</w><w>learn</w><w>more</w><w>about</w><w>the</w><w>data</w><w>set</w><w>before</w><w>adding</w><w>more</w><w>functions</w><pc>.</pc></s><s xml:id="s_KpSbvE"><w>Try</w><w>the</w><w>following</w><w>GREL</w><w>statements</w><w>in</w><w>the</w><emph><w>Expression</w></emph><w>box</w><w>without</w><w>clicking</w><emph><w>OK</w></emph><pc>.</pc></s><s xml:id="s_MB310t"><w>Watch</w><w>the</w><w>preview</w><w>window</w><w>to</w><w>understand</w><w>how</w><w>they</w><w>function</w><w>:</w></s></p><list type="unordered"><item><s xml:id="s_fkcmWY"><w>Adding</w><w>an</w><w>index</w><w>number</w><w>to</w><w>the</w><w>expression</w><w>selects</w><w>one</w><w>element</w><w>from</w><w>the</w><w>array</w><w>,</w><w>for</w><w>example</w><code rend="inline"><w>value.parseHtml</w><w>(</w><w>)</w><w>.select</w><w>(</w><w>``</w><w>p</w><w>''</w><w>)</w><w>[</w><w>0</w><w>]</w></code><pc>.</pc></s><s xml:id="s_jbWFMp"><w>The</w><w>beginning</w><w>of</w><w>the</w><w>sonnets</w><w>file</w><w>contains</w><w>many</w><w>paragraphs</w><w>of</w><w>license</w><w>information</w><w>that</w><w>are</w><w>unnecessary</w><w>for</w><w>the</w><w>data</w><w>set</w><pc>.</pc></s><s xml:id="s_BSqnUH"><w>Skipping</w><w>ahead</w><w>through</w><w>the</w><w>index</w><w>numbers</w><w>,</w><w>the</w><w>first</w><w>sonnet</w><w>is</w><w>found</w><w>at</w><code rend="inline"><w>value.parseHtml</w><w>(</w><w>)</w><w>.select</w><w>(</w><w>``</w><w>p</w><w>''</w><w>)</w><w>[</w><w>37</w><w>]</w></code><pc>.</pc></s></item><item><s xml:id="s_oHuhML"><w>GREL</w><w>also</w><w>supports</w><w>using</w><w>negative</w><w>index</w><w>numbers</w><w>,</w><w>thus</w><code rend="inline"><w>value.parseHtml</w><w>(</w><w>)</w><w>.select</w><w>(</w><w>``</w><w>p</w><w>''</w><w>)</w><w>[</w><w>-1</w><w>]</w></code><w>will</w><w>return</w><w>the</w><w>last</w><w>item</w><w>in</w><w>the</w><w>array</w><pc>.</pc></s><s xml:id="s_WbSxde"><w>Working</w><w>backwards</w><w>,</w><w>the</w><w>last</w><w>sonnet</w><w>is</w><w>at</w><w>index</w><code rend="inline"><w>[</w><w>-3</w><w>]</w></code><pc>.</pc></s></item><item><s xml:id="s_vrPsi2"><w>Using</w><w>these</w><w>index</w><w>numbers</w><w>,</w><w>it</w><w>is</w><w>possible</w><w>to</w><w>slice</w><w>the</w><w>array</w><w>,</w><w>extracting</w><w>only</w><w>the</w><w>range</w><w>of</w><code rend="inline"><w>p</w></code><w>that</w><w>contain</w><w>sonnets</w><pc>.</pc></s><s xml:id="s_H1k2N6"><w>Add</w><w>the</w><code rend="inline"><w>slice</w><w>(</w><w>)</w></code><w>function</w><w>to</w><w>the</w><w>expression</w><w>to</w><w>preview</w><w>the</w><w>sub-set</w><w>:</w><code rend="inline"><w>value.parseHtml</w><w>(</w><w>)</w><w>.select</w><w>(</w><w>``</w><w>p</w><w>''</w><w>)</w><w>.slice</w><w>(</w><w>37</w><w>,</w><w>-2</w><w>)</w></code><pc>.</pc></s></item></list><p><s xml:id="s_cEsHW4"><w>Clicking</w><emph><w>OK</w></emph><w>with</w><w>the</w><w>expression</w><w>above</w><w>will</w><w>result</w><w>in</w><w>a</w><w>blank</w><w>column</w><w>,</w><w>a</w><w>common</w><w>cause</w><w>of</w><w>confusion</w><w>when</w><w>working</w><w>with</w><w>arrays</w><pc>.</pc></s><s xml:id="s_W5lk2h"><w>Refine</w><w>will</w><w>not</w><w>store</w><w>an</w><w>array</w><w>object</w><w>as</w><w>a</w><w>cell</w><w>value</w><pc>.</pc></s><s xml:id="s_bMOP1m"><w>It</w><w>is</w><w>necessary</w><w>to</w><w>use</w><code rend="inline"><w>toString</w><w>(</w><w>)</w></code><w>or</w><code rend="inline"><w>join</w><w>(</w><w>)</w></code><w>to</w><w>convert</w><w>the</w><w>array</w><w>into</w><w>a</w><w>string</w><w>variable</w><pc>.</pc></s><s xml:id="s_hLlIeb"><w>The</w><code rend="inline"><w>join</w><w>(</w><w>)</w></code><w>function</w><w>concatenates</w><w>an</w><w>array</w><w>with</w><w>the</w><w>specified</w><w>separator</w><pc>.</pc></s><s xml:id="s_N6GhUU"><w>For</w><w>example</w><w>,</w><w>the</w><w>expression</w><code rend="inline"><w>[</w><w>``</w><w>one</w><w>''</w><w>,</w><w>``</w><w>two</w><w>''</w><w>,</w><w>``</w><w>three</w><w>''</w><w>]</w><w>.join</w><w>(</w><w>``</w><w>;</w><w>''</w><w>)</w></code><w>will</w><w>result</w><w>in</w><w>the</w><w>string</w><w>``</w><w>one</w><w>;</w><w>two</w><w>;</w><w>three</w><w>''</w><pc>.</pc></s><s xml:id="s_uo2bSA"><w>Thus</w><w>,</w><w>the</w><w>final</w><w>expression</w><w>to</w><w>create</w><w>the</w><emph><w>parse</w></emph><w>column</w><w>is</w><w>:</w></s></p><ab><code xml:id="code_fetch-and-parse-data-with-openrefine_2" corresp="code_fetch-and-parse-data-with-openrefine_2.txt" rend="block"/></ab><p><s xml:id="s_ZUIUHE"><w>Click</w><emph><w>OK</w></emph><w>to</w><w>create</w><w>the</w><w>new</w><w>column</w><w>using</w><w>the</w><w>expression</w><pc>.</pc></s></p><p style="alert alert-warning"><s xml:id="s_YoAh6c"><w>Test</w><w>out</w><w>a</w><w>transformation</w><w>to</w><w>see</w><w>what</w><w>happens</w><w>--</w><w>it</w><w>is</w><w>very</w><w>easy</w><w>to</w><w>undo</w><pc>!</pc></s><s xml:id="s_gkm7GI"><w>The</w><w>full</w><w>history</w><w>of</w><w>operations</w><w>is</w><w>recorded</w><w>in</w><w>the</w><w>``</w><w>Undo</w><w>/</w><w>Redo</w><w>''</w><w>tab</w><pc>.</pc></s></p></div><div type="3" n="2.4"><head><s xml:id="s_AHInuu"><w>Split</w><w>Cells</w></s></head><p><s xml:id="s_6WYtn8"><w>|</w><w>The</w><emph><w>parse</w></emph><w>column</w><w>now</w><w>contains</w><w>all</w><w>the</w><w>sonnets</w><w>separated</w><w>by</w><w>``</w><w>|</w><w>''</w><w>,</w><w>but</w><w>the</w><w>project</w><w>still</w><w>contains</w><w>only</w><w>one</w><w>row</w><pc>.</pc></s><s xml:id="s_lIbhB1"><w>|</w><w>Individual</w><w>rows</w><w>for</w><w>each</w><w>sonnet</w><w>can</w><w>be</w><w>created</w><w>by</w><w>splitting</w><w>the</w><w>cell</w><pc>.</pc></s><s xml:id="s_xZbofq"><w>Click</w><w>the</w><w>menu</w><w>arrow</w><w>on</w><w>the</w><emph><w>parse</w></emph><w>column</w><w>&gt;</w><emph><w>Edit</w><w>cells</w></emph><w>&gt;</w><emph><w>Split</w><w>multi-valued</w><w>cells</w></emph><pc>.</pc></s><s xml:id="s_dyMHHP"><w>|</w><w>Enter</w><w>the</w><w>separator</w><code rend="inline"><w>|</w></code><w>that</w><w>was</w><w>used</w><w>to</w><code rend="inline"><w>join</w></code><w>in</w><w>the</w><w>last</w><w>step</w><pc>.</pc></s><s xml:id="s_eN8wg3"><w>|</w></s></p><p><s xml:id="s_qWkPsD"><w>{</w><w>%</w><w>include</w><w>figure.html</w><w>caption=</w><w>''</w><w>Edit</w><w>cells</w><w>&gt;</w><w>Split</w><w>multivalued</w><w>cells</w><w>''</w><w>filename=</w><w>''</w><w>refine-split-multivalued.png</w><w>''</w><w>%</w><w>}</w></s></p><p><s xml:id="s_ui0TEY"><w>After</w><w>this</w><w>operation</w><w>,</w><w>the</w><w>top</w><w>of</w><w>the</w><w>project</w><w>table</w><w>should</w><w>now</w><w>read</w><w>154</w><w>rows</w><pc>.</pc></s><s xml:id="s_r4WZN0"><w>Below</w><w>the</w><w>number</w><w>is</w><w>an</w><w>option</w><w>toggle</w><w>``</w><w>Show</w><w>as</w><w>:</w><emph><w>rows</w></emph><emph><w>records</w></emph><w>``</w><pc>.</pc></s><s xml:id="s_wvq4XD"><w>Clicking</w><w>on</w><emph><w>records</w></emph><w>will</w><w>group</w><w>the</w><w>rows</w><w>based</w><w>on</w><w>the</w><w>original</w><w>table</w><w>,</w><w>in</w><w>this</w><w>case</w><w>it</w><w>will</w><w>read</w><w>1</w><pc>.</pc></s><s xml:id="s_naVrey"><w>Keeping</w><w>track</w><w>of</w><w>these</w><w>numbers</w><w>is</w><w>an</w><w>important</w><w>``</w><w>sanity</w><w>check</w><w>''</w><w>when</w><w>transforming</w><w>data</w><w>in</w><w>Refine</w><pc>.</pc></s><s xml:id="s_Ur3vqU"><w>The</w><w>154</w><w>rows</w><w>make</w><w>sense</w><w>because</w><w>the</w><w>ebook</w><w>contained</w><w>154</w><w>sonnets</w><w>,</w><w>while</w><w>1</w><w>record</w><w>represents</w><w>the</w><w>original</w><w>table</w><w>with</w><w>only</w><w>one</w><w>row</w><pc>.</pc></s><s xml:id="s_QusRRk"><w>An</w><w>unexpected</w><w>number</w><w>would</w><w>indicate</w><w>a</w><w>problem</w><w>with</w><w>the</w><w>transformation</w><pc>.</pc></s></p><p><s xml:id="s_6wzX7p"><w>{</w><w>%</w><w>include</w><w>figure.html</w><w>caption=</w><w>''</w><w>Project</w><w>rows</w><w>''</w><w>filename=</w><w>''</w><w>refine-rows.png</w><w>''</w><w>%</w><w>}</w></s></p><p><s xml:id="s_EACu4X"><w>Each</w><w>cell</w><w>in</w><w>the</w><emph><w>parse</w></emph><w>column</w><w>now</w><w>contains</w><w>one</w><w>sonnet</w><w>surround</w><w>by</w><w>a</w><code rend="inline"><w>&lt;</w><w>p</w><w>&gt;</w></code><w>tag</w><pc>.</pc></s><s xml:id="s_NfJJBV"><w>The</w><w>tags</w><w>can</w><w>be</w><w>cleaned</w><w>up</w><w>by</w><w>parsing</w><w>the</w><w>HTML</w><w>again</w><pc>.</pc></s><s xml:id="s_wj3BwO"><w>Click</w><w>on</w><w>the</w><emph><w>parse</w></emph><w>column</w><w>and</w><w>select</w><emph><w>Edit</w><w>cells</w></emph><w>&gt;</w><emph><w>Transform</w></emph><pc>.</pc></s><s xml:id="s_BOukP4"><w>This</w><w>will</w><w>bring</w><w>up</w><w>a</w><w>dialog</w><w>box</w><w>similar</w><w>to</w><w>creating</w><w>a</w><w>new</w><w>column</w><pc>.</pc></s><s xml:id="s_17GK5e"><w>Transform</w><w>will</w><w>overwrite</w><w>the</w><w>cells</w><w>of</w><w>the</w><w>current</w><w>column</w><w>rather</w><w>than</w><w>creating</w><w>a</w><w>new</w><w>one</w><pc>.</pc></s></p><p><s xml:id="s_lmye2r"><w>In</w><w>the</w><w>expression</w><w>box</w><w>,</w><w>type</w><code rend="inline"><w>value.parseHtml</w><w>(</w><w>)</w></code><pc>.</pc></s><s xml:id="s_zQDxPj"><w>The</w><w>preview</w><w>will</w><w>show</w><w>a</w><w>complete</w><w>HTML</w><w>tree</w><w>starting</w><w>with</w><w>the</w><code rend="inline"><w>&lt;</w><w>html</w><w>&gt;</w></code><w>element</w><pc>.</pc></s><s xml:id="s_ikL18f"><w>It</w><w>is</w><w>important</w><w>to</w><w>note</w><w>that</w><code rend="inline"><w>parseHtml</w><w>(</w><w>)</w></code><w>will</w><w>automatically</w><w>fill</w><w>in</w><w>missing</w><w>tags</w><w>,</w><w>allowing</w><w>it</w><w>to</w><w>parse</w><w>these</w><w>cell</w><w>values</w><w>despite</w><w>not</w><w>being</w><w>valid</w><w>HTML</w><w>documents</w><pc>.</pc></s><s xml:id="s_xBAYeO"><w>Select</w><w>the</w><code rend="inline"><w>p</w></code><w>tag</w><w>,</w><w>add</w><w>an</w><w>index</w><w>number</w><w>,</w><w>and</w><w>use</w><w>the</w><w>function</w><code rend="inline"><w>innerHtml</w><w>(</w><w>)</w></code><w>to</w><w>extract</w><w>the</w><w>sonnet</w><w>text</w><w>:</w></s></p><ab><code xml:id="code_fetch-and-parse-data-with-openrefine_3" corresp="code_fetch-and-parse-data-with-openrefine_3.txt" rend="block"/></ab><p><s xml:id="s_npnWCd"><w>Click</w><emph><w>OK</w></emph><w>to</w><w>transform</w><w>all</w><w>154</w><w>cells</w><w>in</w><w>the</w><w>column</w><pc>.</pc></s></p><p><s xml:id="s_BGXlVG"><w>{</w><w>%</w><w>include</w><w>figure.html</w><w>caption=</w><w>''</w><w>Edit</w><w>cells</w><w>&gt;</w><w>Transform</w><w>''</w><w>filename=</w><w>''</w><w>refine-innerhtml.png</w><w>''</w><w>%</w><w>}</w></s></p><p style="alert alert-warning"><s xml:id="s_05X72f"><w>In</w><w>the</w><w>expression</w><w>above</w><code rend="inline"><w>select</w></code><w>returns</w><w>an</w><w>array</w><w>of</w><code rend="inline"><w>p</w></code><w>elements</w><w>even</w><w>though</w><w>there</w><w>is</w><w>only</w><w>one</w><w>in</w><w>each</w><w>cell</w><pc>.</pc></s><s xml:id="s_DULlAZ"><w>Attempting</w><w>to</w><w>pass</w><w>an</w><w>array</w><w>to</w><code rend="inline"><w>innerHtml</w><w>(</w><w>)</w></code><w>will</w><w>raise</w><w>an</w><w>error</w><pc>.</pc></s><s xml:id="s_WhKGov"><w>Thus</w><w>,</w><w>an</w><w>index</w><w>number</w><w>is</w><w>necessary</w><w>to</w><w>select</w><w>the</w><w>first</w><w>(</w><w>and</w><w>only</w><w>)</w><w>item</w><w>in</w><w>the</w><w>array</w><w>to</w><w>pass</w><w>the</w><w>correct</w><w>object</w><w>type</w><w>to</w><code rend="inline"><w>innerHtml</w><w>(</w><w>)</w></code><pc>.</pc></s></p></div><div type="3" n="2.5"><head><s xml:id="s_vwP7cD"><w>Unescape</w></s></head><p><s xml:id="s_lrEUrn"><w>Notice</w><w>that</w><w>each</w><w>cell</w><w>has</w><w>dozens</w><w>of</w><code rend="inline"><w>&amp;</w><w>nbsp</w><w>;</w></code><w>,</w><w>an</w><w>HTML</w><w>entity</w><w>used</w><w>to</w><w>represent</w><w>``</w><w>no-break</w><w>space</w><w>''</w><w>since</w><w>browsers</w><w>ignore</w><w>extra</w><w>white</w><w>space</w><w>in</w><w>the</w><w>source</w><pc>.</pc></s><s xml:id="s_etmI3A"><w>These</w><w>entities</w><w>are</w><w>common</w><w>when</w><w>harvesting</w><w>web</w><w>pages</w><w>and</w><w>can</w><w>be</w><w>quickly</w><w>replaced</w><w>with</w><w>the</w><w>corresponding</w><w>plain</w><w>text</w><w>characters</w><w>using</w><w>the</w><code rend="inline"><w>unescape</w><w>(</w><w>)</w></code><w>function</w><pc>.</pc></s><s xml:id="s_3q7XSM"><w>On</w><w>the</w><emph><w>parse</w></emph><w>column</w><w>,</w><w>select</w><emph><w>Edit</w><w>cells</w></emph><w>&gt;</w><emph><w>Transform</w></emph><w>and</w><w>type</w><w>the</w><w>following</w><w>in</w><w>the</w><w>expression</w><w>box</w><w>:</w></s></p><ab><code xml:id="code_fetch-and-parse-data-with-openrefine_4" corresp="code_fetch-and-parse-data-with-openrefine_4.txt" rend="block"/></ab><p><s xml:id="s_XVk6TX"><w>The</w><w>entities</w><w>will</w><w>be</w><w>replaced</w><w>with</w><w>normal</w><w>whitespace</w><pc>.</pc></s></p></div><div type="3" n="2.6"><head><s xml:id="s_3g0u2O"><w>Extract</w><w>Information</w><w>with</w><w>Array</w><w>Functions</w></s></head><p><s xml:id="s_Hwk0qg"><ref target="https://github.com/OpenRefine/OpenRefine/wiki/GREL-Array-Functions"><w>GREL</w><w>array</w><w>functions</w></ref><w>provide</w><w>a</w><w>powerful</w><w>way</w><w>to</w><w>manipulate</w><w>text</w><w>data</w><w>and</w><w>can</w><w>be</w><w>used</w><w>to</w><w>finish</w><w>processing</w><w>the</w><w>sonnets</w><pc>.</pc></s><s xml:id="s_0qvR7d"><w>Any</w><w>string</w><w>value</w><w>can</w><w>be</w><w>turned</w><w>into</w><w>an</w><w>array</w><w>using</w><w>the</w><code rend="inline"><w>split</w><w>(</w><w>)</w></code><w>function</w><w>by</w><w>providing</w><w>the</w><w>character</w><w>or</w><w>expression</w><w>that</w><w>separates</w><w>the</w><w>items</w><w>(</w><w>basically</w><w>the</w><w>opposite</w><w>of</w><code rend="inline"><w>join</w><w>(</w><w>)</w></code><w>)</w><pc>.</pc></s></p><p><s xml:id="s_Tx6xZA"><w>In</w><w>the</w><w>sonnets</w><w>each</w><w>line</w><w>ends</w><w>with</w><code rend="inline"><w>&lt;</w><w>br</w><w>&gt;</w></code><w>,</w><w>providing</w><w>a</w><w>convenient</w><w>separator</w><w>for</w><w>splitting</w><pc>.</pc></s><s xml:id="s_iwvBvP"><w>The</w><w>expression</w><code rend="inline"><w>value.split</w><w>(</w><w>``</w><w>&lt;</w><w>br</w><w>&gt;</w><w>''</w><w>)</w></code><w>will</w><w>create</w><w>an</w><w>array</w><w>of</w><w>the</w><w>lines</w><w>of</w><w>each</w><w>sonnet</w><pc>.</pc></s><s xml:id="s_2ijm22"><w>Index</w><w>numbers</w><w>and</w><w>slices</w><w>can</w><w>then</w><w>be</w><w>used</w><w>to</w><w>populate</w><w>new</w><w>columns</w><pc>.</pc></s><s xml:id="s_emt3xv"><w>Keep</w><w>in</w><w>mind</w><w>that</w><w>Refine</w><w>will</w><w>not</w><w>output</w><w>an</w><w>array</w><w>directly</w><w>to</w><w>a</w><w>cell</w><pc>.</pc></s><s xml:id="s_rlyMn4"><w>Be</w><w>sure</w><w>to</w><w>select</w><w>one</w><w>element</w><w>from</w><w>the</w><w>array</w><w>using</w><w>an</w><w>index</w><w>number</w><w>or</w><w>convert</w><w>it</w><w>back</w><w>to</w><w>a</w><w>string</w><w>with</w><code rend="inline"><w>join</w><w>(</w><w>)</w></code><pc>.</pc></s></p><p><s xml:id="s_V4MZo3"><w>Furthermore</w><w>,</w><w>the</w><w>sonnet</w><w>text</w><w>contains</w><w>a</w><w>huge</w><w>amount</w><w>of</w><w>unnecessary</w><w>white</w><w>space</w><w>that</w><w>was</w><w>used</w><w>to</w><w>layout</w><w>the</w><w>poems</w><w>in</w><w>the</w><w>ebook</w><pc>.</pc></s><s xml:id="s_YFcQZ3"><w>This</w><w>can</w><w>be</w><w>cut</w><w>from</w><w>each</w><w>line</w><w>using</w><w>the</w><code rend="inline"><w>trim</w><w>(</w><w>)</w></code><w>function</w><pc>.</pc></s><s xml:id="s_m8cpQ7"><w>Trim</w><w>automatically</w><w>removes</w><w>all</w><w>leading</w><w>and</w><w>trailing</w><w>white</w><w>space</w><w>in</w><w>a</w><w>cell</w><w>,</w><w>an</w><w>essential</w><w>for</w><w>data</w><w>cleaning</w><pc>.</pc></s></p><p><s xml:id="s_QClw0k"><w>Using</w><w>these</w><w>concepts</w><w>,</w><w>a</w><w>single</w><w>line</w><w>can</w><w>be</w><w>extracted</w><w>and</w><w>trimmed</w><w>to</w><w>create</w><w>clean</w><w>columns</w><w>representing</w><w>the</w><w>sonnet</w><w>number</w><w>and</w><w>first</w><w>line</w><pc>.</pc></s><s xml:id="s_zMpqj4"><w>Create</w><w>two</w><w>new</w><w>columns</w><w>from</w><w>the</w><emph><w>parse</w></emph><w>column</w><w>using</w><w>these</w><w>names</w><w>and</w><w>expressions</w><w>:</w></s></p><list type="unordered"><item><s xml:id="s_0Mna1o"><w>``</w><w>number</w><w>''</w><w>,</w><code rend="inline"><w>value.split</w><w>(</w><w>``</w><w>&lt;</w><w>br</w><w>&gt;</w><w>''</w><w>)</w><w>[</w><w>0</w><w>]</w><w>.trim</w><w>(</w><w>)</w></code></s></item><item><s xml:id="s_ZwNMdX"><w>``</w><w>first</w><w>''</w><w>,</w><code rend="inline"><w>value.split</w><w>(</w><w>``</w><w>&lt;</w><w>br</w><w>&gt;</w><w>''</w><w>)</w><w>[</w><w>1</w><w>]</w><w>.trim</w><w>(</w><w>)</w></code></s></item></list><p><s xml:id="s_iuWwRX"><w>{</w><w>%</w><w>include</w><w>figure.html</w><w>caption=</w><w>''</w><w>GREL</w><w>split</w><w>and</w><w>trim</w><w>''</w><w>filename=</w><w>''</w><w>refine-add-num-column.png</w><w>''</w><w>%</w><w>}</w></s></p><p><s xml:id="s_V6Rkqo"><w>The</w><w>next</w><w>column</w><w>to</w><w>create</w><w>is</w><w>the</w><w>full</w><w>sonnet</w><w>text</w><w>which</w><w>contains</w><w>multiple</w><w>lines</w><pc>.</pc></s><s xml:id="s_m08iuj"><w>However</w><w>,</w><code rend="inline"><w>trim</w><w>(</w><w>)</w></code><w>will</w><w>only</w><w>clean</w><w>the</w><w>beginning</w><w>and</w><w>end</w><w>of</w><w>the</w><w>cell</w><w>,</w><w>leaving</w><w>unnecessary</w><w>whitespace</w><w>in</w><w>the</w><w>body</w><w>of</w><w>the</w><w>sonnet</w><pc>.</pc></s><s xml:id="s_SPzxTs"><w>To</w><w>trim</w><w>each</w><w>line</w><w>individually</w><w>use</w><w>the</w><ref target="https://github.com/OpenRefine/OpenRefine/wiki/GREL-Controls"><w>GREL</w><w>control</w></ref><code rend="inline"><w>forEach</w><w>(</w><w>)</w></code><w>,</w><w>a</w><w>handy</w><w>loop</w><w>that</w><w>iterates</w><w>over</w><w>an</w><w>array</w><pc>.</pc></s></p><p><s xml:id="s_Mr1TMU"><w>From</w><w>the</w><emph><w>parse</w></emph><w>column</w><w>,</w><w>create</w><w>a</w><w>new</w><w>column</w><w>named</w><w>``</w><w>text</w><w>''</w><w>,</w><w>and</w><w>click</w><w>in</w><w>the</w><emph><w>Expression</w></emph><w>box</w><pc>.</pc></s><s xml:id="s_E1LKDk"><w>A</w><code rend="inline"><w>forEach</w><w>(</w><w>)</w></code><w>statement</w><w>asks</w><w>for</w><w>an</w><w>array</w><w>,</w><w>a</w><w>variable</w><w>name</w><w>,</w><w>and</w><w>an</w><w>expression</w><w>applied</w><w>to</w><w>the</w><w>variable</w><pc>.</pc></s><s xml:id="s_lza7GR"><w>Following</w><w>the</w><w>form</w><code rend="inline"><w>forEach</w><w>(</w><w>array</w><w>,</w><w>variable</w><w>,</w><w>expression</w><w>)</w></code><w>,</w><w>construct</w><w>the</w><w>loop</w><w>using</w><w>these</w><w>parameters</w><w>:</w></s></p><list type="unordered"><item><s xml:id="s_y5PtQM"><w>array</w><w>:</w><code rend="inline"><w>value.split</w><w>(</w><w>``</w><w>&lt;</w><w>br</w><w>&gt;</w><w>''</w><w>)</w></code><w>,</w><w>creates</w><w>an</w><w>array</w><w>from</w><w>the</w><w>lines</w><w>of</w><w>the</w><w>sonnet</w><w>in</w><w>each</w><w>cell</w><pc>.</pc></s></item><item><s xml:id="s_oeEYoR"><w>variable</w><w>:</w><code rend="inline"><w>line</w></code><w>,</w><w>each</w><w>item</w><w>in</w><w>the</w><w>array</w><w>is</w><w>then</w><w>represented</w><w>as</w><w>the</w><w>variable</w><w>(</w><w>it</w><w>could</w><w>be</w><w>anything</w><w>,</w><code rend="inline"><w>v</w></code><w>is</w><w>often</w><w>used</w><w>)</w><pc>.</pc></s></item><item><s xml:id="s_ZC6eZf"><w>expression</w><w>:</w><code rend="inline"><w>line.trim</w><w>(</w><w>)</w></code><w>,</w><w>each</w><w>item</w><w>is</w><w>then</w><w>evaluated</w><w>separately</w><w>with</w><w>the</w><w>specified</w><w>expression</w><pc>.</pc></s><s xml:id="s_Nq4f4s"><w>In</w><w>this</w><w>case</w><w>,</w><code rend="inline"><w>trim</w><w>(</w><w>)</w></code><w>cleans</w><w>the</w><w>white</w><w>space</w><w>from</w><w>each</w><w>sonnet</w><w>line</w><w>in</w><w>the</w><w>array</w><pc>.</pc></s></item></list><p><s xml:id="s_zvEaBs"><w>At</w><w>this</w><w>point</w><w>,</w><w>the</w><w>statement</w><w>should</w><w>look</w><w>like</w><code rend="inline"><w>forEach</w><w>(</w><w>value.split</w><w>(</w><w>``</w><w>&lt;</w><w>br</w><w>&gt;</w><w>''</w><w>)</w><w>,</w><w>line</w><w>,</w><w>line.trim</w><w>(</w><w>)</w><w>)</w></code><w>in</w><w>the</w><emph><w>Expression</w></emph><w>box</w><pc>.</pc></s><s xml:id="s_YJE4ar"><w>Notice</w><w>that</w><w>the</w><emph><w>Preview</w></emph><w>now</w><w>shows</w><w>an</w><w>array</w><w>where</w><w>the</w><w>first</w><w>element</w><w>is</w><w>the</w><w>sonnet</w><w>number</w><pc>.</pc></s><s xml:id="s_txMmxn"><w>Since</w><w>the</w><w>results</w><w>of</w><w>the</w><code rend="inline"><w>forEach</w><w>(</w><w>)</w></code><w>are</w><w>returned</w><w>as</w><w>a</w><w>new</w><w>array</w><w>,</w><w>additional</w><w>array</w><w>functions</w><w>can</w><w>be</w><w>applied</w><w>,</w><w>such</w><w>as</w><w>slice</w><w>and</w><w>join</w><pc>.</pc></s><s xml:id="s_ZJRtHs"><w>Add</w><code rend="inline"><w>slice</w><w>(</w><w>1</w><w>)</w></code><w>to</w><w>remove</w><w>the</w><w>sonnet</w><w>number</w><w>,</w><w>and</w><code rend="inline"><w>join</w><w>(</w><w>``</w><w>\n</w><w>''</w><w>)</w></code><w>to</w><w>concatenate</w><w>the</w><w>lines</w><w>in</w><w>to</w><w>a</w><w>string</w><w>value</w><w>(</w><code rend="inline"><w>\n</w></code><w>is</w><w>the</w><w>symbol</w><w>for</w><w>new</w><w>line</w><w>in</w><w>plain</w><w>text</w><w>)</w><pc>.</pc></s><s xml:id="s_4lXKFD"><w>Thus</w><w>,</w><w>the</w><w>final</w><w>expression</w><w>to</w><w>extract</w><w>and</w><w>clean</w><w>the</w><w>full</w><w>sonnet</w><w>text</w><w>is</w><w>:</w></s></p><ab><code xml:id="code_fetch-and-parse-data-with-openrefine_5" corresp="code_fetch-and-parse-data-with-openrefine_5.txt" rend="block"/></ab><p><s xml:id="s_IxUIKe"><w>{</w><w>%</w><w>include</w><w>figure.html</w><w>caption=</w><w>''</w><w>GREL</w><w>forEach</w><w>expression</w><w>''</w><w>filename=</w><w>''</w><w>refine-foreach.png</w><w>''</w><w>%</w><w>}</w></s></p><p><s xml:id="s_880LYf"><w>Click</w><w>``</w><w>OK</w><w>''</w><w>to</w><w>create</w><w>the</w><w>column</w><pc>.</pc></s><s xml:id="s_cmcGoi"><w>Following</w><w>the</w><w>same</w><w>technique</w><w>,</w><w>add</w><w>another</w><w>new</w><w>column</w><w>from</w><emph><w>parse</w></emph><w>named</w><w>``</w><w>last</w><w>''</w><w>to</w><w>represent</w><w>the</w><w>final</w><w>couplet</w><w>lines</w><w>using</w><w>:</w></s></p><ab><code xml:id="code_fetch-and-parse-data-with-openrefine_6" corresp="code_fetch-and-parse-data-with-openrefine_6.txt" rend="block"/></ab><p><s xml:id="s_bjiZFa"><w>Finally</w><w>,</w><w>numeric</w><w>columns</w><w>can</w><w>be</w><w>added</w><w>using</w><w>the</w><code rend="inline"><w>length</w><w>(</w><w>)</w></code><w>function</w><pc>.</pc></s><s xml:id="s_Hhu5U0"><w>Create</w><w>new</w><w>columns</w><w>from</w><emph><w>text</w></emph><w>with</w><w>the</w><w>names</w><w>and</w><w>expressions</w><w>below</w><w>:</w></s></p><list type="unordered"><item><s xml:id="s_UpOjK5"><w>``</w><w>characters</w><w>''</w><w>,</w><code rend="inline"><w>value.length</w><w>(</w><w>)</w></code></s></item><item><s xml:id="s_NCfq80"><w>``</w><w>lines</w><w>''</w><w>,</w><code rend="inline"><w>value.split</w><w>(</w><w>/\n/</w><w>)</w><w>.length</w><w>(</w><w>)</w></code></s></item></list></div><div type="3" n="2.7"><head><s xml:id="s_ejKC7j"><w>Cleanup</w><w>and</w><w>Export</w></s></head><p><s xml:id="s_PJOHDf"><w>In</w><w>this</w><w>example</w><w>,</w><w>we</w><w>used</w><w>a</w><w>number</w><w>of</w><w>operations</w><w>to</w><w>create</w><w>new</w><w>columns</w><w>with</w><w>clean</w><w>data</w><pc>.</pc></s><s xml:id="s_765PQE"><w>This</w><w>is</w><w>a</w><w>typical</w><w>Refine</w><w>workflow</w><w>,</w><w>allowing</w><w>each</w><w>transformation</w><w>to</w><w>be</w><w>easily</w><w>checked</w><w>against</w><w>the</w><w>existing</w><w>data</w><pc>.</pc></s><s xml:id="s_FWjwFx"><w>At</w><w>this</w><w>point</w><w>the</w><w>unnecessary</w><w>columns</w><w>can</w><w>be</w><w>removed</w><pc>.</pc></s><s xml:id="s_GIEsEw"><w>Click</w><w>on</w><w>the</w><emph><w>All</w></emph><w>column</w><w>&gt;</w><emph><w>Edit</w><w>columns</w></emph><w>&gt;</w><emph><w>Re-order</w><w>/</w><w>remove</w><w>columns</w></emph><pc>.</pc></s></p><p><s xml:id="s_A5eEpR"><w>{</w><w>%</w><w>include</w><w>figure.html</w><w>caption=</w><w>''</w><w>All</w><w>&gt;</w><w>Edit</w><w>columns</w><w>''</w><w>filename=</w><w>''</w><w>refine-reorder.png</w><w>''</w><w>%</w><w>}</w></s></p><p><s xml:id="s_x6e2VJ"><w>Drag</w><w>unwanted</w><w>column</w><w>names</w><w>to</w><w>the</w><w>right</w><w>side</w><w>of</w><w>the</w><w>dialog</w><w>box</w><w>,</w><w>in</w><w>this</w><w>case</w><emph><w>Column</w><w>1</w></emph><w>,</w><emph><w>fetch</w></emph><w>,</w><w>and</w><emph><w>parse</w></emph><pc>.</pc></s><s xml:id="s_4xzvNt"><w>Drag</w><w>the</w><w>remaining</w><w>columns</w><w>into</w><w>the</w><w>desired</w><w>order</w><w>on</w><w>the</w><w>left</w><w>side</w><pc>.</pc></s><s xml:id="s_cg1c50"><w>Click</w><emph><w>Ok</w></emph><w>to</w><w>remove</w><w>and</w><w>reorder</w><w>the</w><w>data</w><w>set</w><pc>.</pc></s></p><p><s xml:id="s_OrD5eb"><w>{</w><w>%</w><w>include</w><w>figure.html</w><w>caption=</w><w>''</w><w>Re-order</w><w>/</w><w>Remove</w><w>columns</w><w>''</w><w>filename=</w><w>''</w><w>refine-reorder2.png</w><w>''</w><w>%</w><w>}</w></s></p><p><s xml:id="s_xC6pLb"><w>Use</w><w>filters</w><w>and</w><w>facets</w><w>to</w><w>explore</w><w>and</w><w>subset</w><w>the</w><w>collection</w><w>of</w><w>sonnets</w><pc>.</pc></s><s xml:id="s_wxOGIE"><w>Then</w><w>click</w><w>the</w><w>export</w><w>button</w><w>to</w><w>generate</w><w>a</w><w>version</w><w>of</w><w>the</w><w>new</w><w>sonnet</w><w>table</w><w>for</w><w>use</w><w>outside</w><w>of</w><w>Refine</w><pc>.</pc></s><s xml:id="s_cYiqjZ"><w>Only</w><w>the</w><w>currently</w><w>selected</w><w>subset</w><w>will</w><w>be</w><w>exported</w><pc>.</pc></s></p><p><s xml:id="s_UqQ9uI"><w>{</w><w>%</w><w>include</w><w>figure.html</w><w>caption=</w><w>''</w><w>Export</w><w>CSV</w><w>''</w><w>filename=</w><w>''</w><w>refine-export.png</w><w>''</w><w>%</w><w>}</w></s></p></div></div><div type="2" n="3"><head><s xml:id="s_62nOyp"><w>Example</w><w>2</w><w>:</w><w>URL</w><w>Queries</w><w>and</w><w>Parsing</w><w>JSON</w></s></head><p><s xml:id="s_f5lPmv"><w>Many</w><w>cultural</w><w>institutions</w><w>provide</w><w>web</w><w>APIs</w><w>allowing</w><w>users</w><w>to</w><w>access</w><w>information</w><w>about</w><w>their</w><w>collections</w><w>via</w><w>simple</w><ref target="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol"><w>HTTP</w></ref><w>requests</w><pc>.</pc></s><s xml:id="s_7d55xa"><w>These</w><w>sources</w><w>enable</w><w>new</w><w>queries</w><w>and</w><w>aggregations</w><w>of</w><w>text</w><w>that</w><w>were</w><w>previously</w><w>impossible</w><w>,</w><w>cutting</w><w>across</w><w>boundaries</w><w>of</w><w>repositories</w><w>and</w><w>collections</w><w>to</w><w>support</w><w>large</w><w>scale</w><w>analysis</w><w>of</w><w>both</w><w>content</w><w>and</w><w>metadata</w><pc>.</pc></s><s xml:id="s_6jQyAf"><w>This</w><w>example</w><w>will</w><w>harvest</w><w>data</w><w>from</w><w>the</w><ref target="https://chroniclingamerica.loc.gov/"><w>Chronicling</w><w>America</w></ref><w>project</w><w>to</w><w>assemble</w><w>a</w><w>small</w><w>set</w><w>of</w><w>newspaper</w><w>front</w><w>pages</w><w>with</w><w>full</w><w>text</w><pc>.</pc></s><s xml:id="s_RINOn6"><w>Following</w><w>a</w><w>common</w><w>web</w><w>scraping</w><w>workflow</w><w>,</w><w>Refine</w><w>is</w><w>used</w><w>to</w><w>construct</w><w>the</w><w>query</w><w>URL</w><w>,</w><w>fetch</w><w>the</w><w>information</w><w>,</w><w>and</w><w>parse</w><w>the</w><w>JSON</w><w>response</w><pc>.</pc></s></p><p style="alert alert-warning"><s xml:id="s_raq6VW"><w>Chronicling</w><w>America</w><w>is</w><w>fully</w><w>open</w><w>,</w><w>thus</w><w>no</w><w>key</w><w>or</w><w>account</w><w>is</w><w>needed</w><w>to</w><w>access</w><w>the</w><w>API</w><w>and</w><w>there</w><w>are</w><w>no</w><w>limits</w><w>on</w><w>the</w><w>use</w><pc>.</pc></s><s xml:id="s_Hekds4"><w>Other</w><w>aggregators</w><w>are</w><w>often</w><w>proprietary</w><w>and</w><w>restricted</w><pc>.</pc></s><s xml:id="s_UiZnt1"><w>Please</w><w>review</w><w>the</w><w>specific</w><w>terms</w><w>of</w><w>use</w><w>before</w><w>web</w><w>scraping</w><w>or</w><w>using</w><w>the</w><w>information</w><w>in</w><w>research</w><pc>.</pc></s></p><div type="3" n="3.1"><head><s xml:id="s_Zc7G1j"><w>Start</w><w>``</w><w>Chronicling</w><w>America</w><w>''</w><w>Project</w></s></head><p><s xml:id="s_NjsZ2F"><w>To</w><w>get</w><w>started</w><w>after</w><w>completing</w><emph><w>Example</w><w>1</w></emph><w>,</w><w>click</w><w>the</w><emph><w>Open</w></emph><w>button</w><w>in</w><w>the</w><w>upper</w><w>right</w><pc>.</pc></s><s xml:id="s_a6E0Yc"><w>A</w><w>new</w><w>tab</w><w>will</w><w>open</w><w>with</w><w>the</w><w>Refine</w><w>start</w><w>project</w><w>view</w><pc>.</pc></s><s xml:id="s_g9HgHC"><w>The</w><w>tab</w><w>with</w><w>the</w><w>Sonnets</w><w>project</w><w>can</w><w>be</w><w>left</w><w>open</w><w>without</w><w>impacting</w><w>performance</w><pc>.</pc></s><s xml:id="s_thUhz9"><w>Create</w><w>a</w><w>project</w><w>from</w><emph><w>Clipboard</w></emph><w>by</w><w>pasting</w><w>this</w><w>CSV</w><w>into</w><w>the</w><w>text</w><w>box</w><w>:</w></s></p><ab><code xml:id="code_fetch-and-parse-data-with-openrefine_7" corresp="code_fetch-and-parse-data-with-openrefine_7.txt" rend="block"/></ab><p><s xml:id="s_x5GB8m"><w>After</w><w>clicking</w><emph><w>Next</w></emph><w>,</w><w>Refine</w><w>should</w><w>automatically</w><w>identify</w><w>the</w><w>content</w><w>as</w><w>a</w><w>CSV</w><w>with</w><w>the</w><w>correct</w><w>parsing</w><w>options</w><pc>.</pc></s><s xml:id="s_iAum3r"><w>Add</w><w>the</w><emph><w>Project</w><w>name</w></emph><w>``</w><w>ChronAm</w><w>''</w><w>at</w><w>the</w><w>top</w><w>right</w><w>and</w><w>click</w><emph><w>Create</w><w>project</w></emph><pc>.</pc></s></p><p><s xml:id="s_NwajoD"><w>{</w><w>%</w><w>include</w><w>figure.html</w><w>caption=</w><w>''</w><w>Create</w><w>project</w><w>''</w><w>filename=</w><w>''</w><w>refine-start-project.png</w><w>''</w><w>%</w><w>}</w></s></p></div><div type="3" n="3.2"><head><s xml:id="s_8w9zFE"><w>Construct</w><w>a</w><w>Query</w></s></head><p><s xml:id="s_3SXFly"><w>Chronicling</w><w>America</w><w>provides</w><ref target="https://chroniclingamerica.loc.gov/about/api/"><w>documentation</w></ref><w>for</w><w>their</w><w>API</w><w>and</w><w>URL</w><w>patterns</w><pc>.</pc></s><s xml:id="s_6RhnaJ"><w>In</w><w>addition</w><w>to</w><w>formal</w><w>documentation</w><w>,</w><w>information</w><w>about</w><w>alternative</w><w>formats</w><w>and</w><w>search</w><w>API</w><w>are</w><w>sometimes</w><w>given</w><w>in</w><w>the</w><code rend="inline"><w>&lt;</w><w>head</w><w>&gt;</w></code><w>element</w><w>of</w><w>a</w><w>web</w><w>page</w><pc>.</pc></s><s xml:id="s_8ThzkV"><w>Check</w><w>for</w><code rend="inline"><w>&lt;</w><w>link</w><w>rel=</w><w>''</w><w>alternate</w><w>''</w></code><w>,</w><code rend="inline"><w>&lt;</w><w>link</w><w>rel=</w><w>''</w><w>search</w><w>''</w></code><w>,</w><w>or</w><code rend="inline"><w>&lt;</w><pc>!</pc><w>--</w></code><w>comments</w><w>which</w><w>provide</w><w>hints</w><w>on</w><w>how</w><w>to</w><w>interact</w><w>with</w><w>the</w><w>site</w><pc>.</pc></s><s xml:id="s_t3bMkf"><w>These</w><w>clues</w><w>provide</w><w>a</w><w>recipe</w><w>book</w><w>for</w><w>interacting</w><w>with</w><w>the</w><w>server</w><w>using</w><w>public</w><w>links</w><pc>.</pc></s></p><p><s xml:id="s_57L688"><w>The</w><w>basic</w><w>components</w><w>of</w><w>the</w><w>ChromAm</w><w>API</w><w>are</w><w>:</w></s></p><list type="unordered"><item><s xml:id="s_WLTWLA"><w>the</w><w>base</w><w>URL</w><w>,</w><code rend="inline"><w>https</w><w>:</w><w>//chroniclingamerica.loc.gov/</w></code></s></item><item><s xml:id="s_eOwXH4"><w>the</w><w>search</w><w>service</w><w>location</w><w>for</w><w>individual</w><w>newspaper</w><w>pages</w><w>,</w><code rend="inline"><w>search/pages/results</w></code></s></item><item><s xml:id="s_xwtzuy"><w>a</w><w>query</w><w>string</w><w>,</w><w>starting</w><w>with</w><code rend="inline"><pc>?</pc></code><w>and</w><w>made</w><w>up</w><w>of</w><w>value</w><w>pairs</w><w>(</w><code rend="inline"><w>fieldname=value</w></code><w>)</w><w>separated</w><w>by</w><code rend="inline"><w>&amp;</w></code><pc>.</pc></s><s xml:id="s_v0dDnO"><w>Much</w><w>like</w><w>using</w><w>the</w><ref target="https://chroniclingamerica.loc.gov/#tab=tab_advanced_search"><w>advanced</w><w>search</w><w>form</w></ref><w>,</w><w>the</w><w>value</w><w>pairs</w><w>of</w><w>the</w><w>query</w><w>string</w><w>set</w><w>the</w><ref target="https://chroniclingamerica.loc.gov/search/pages/opensearch.xml"><w>search</w><w>options</w></ref><pc>.</pc></s></item></list><p><s xml:id="s_Dh8GdE"><w>Using</w><w>a</w><w>GREL</w><w>expression</w><w>,</w><w>these</w><w>components</w><w>can</w><w>be</w><w>combined</w><w>with</w><w>the</w><w>values</w><w>in</w><w>the</w><w>``</w><w>ChronAm</w><w>''</w><w>project</w><w>to</w><w>construct</w><w>a</w><w>search</w><w>query</w><w>URL</w><pc>.</pc></s><s xml:id="s_AwbDVr"><w>The</w><w>contents</w><w>of</w><w>the</w><w>data</w><w>table</w><w>can</w><w>be</w><w>accessed</w><w>using</w><ref target="https://github.com/OpenRefine/OpenRefine/wiki/Variables"><w>GREL</w><w>variables</w></ref><pc>.</pc></s><s xml:id="s_1OBuaB"><w>As</w><w>introduced</w><w>in</w><emph><w>Example</w><w>1</w></emph><w>,</w><w>the</w><w>value</w><w>of</w><w>each</w><w>cell</w><w>in</w><w>the</w><w>current</w><w>column</w><w>is</w><w>represented</w><w>by</w><code rend="inline"><w>value</w></code><pc>.</pc></s><s xml:id="s_QbaCgk"><w>Values</w><w>in</w><w>the</w><w>same</w><w>row</w><w>can</w><w>be</w><w>retrieved</w><w>using</w><w>the</w><code rend="inline"><w>cells</w></code><w>variable</w><w>plus</w><w>the</w><w>column</w><w>name</w><pc>.</pc></s><s xml:id="s_MQdX7N"><w>There</w><w>are</w><w>two</w><w>ways</w><w>to</w><w>write</w><w>a</w><code rend="inline"><w>cells</w></code><w>statement</w><w>:</w><w>bracket</w><w>notation</w><code rend="inline"><w>cells</w><w>[</w><w>'column</w><w>name</w><w>'</w><w>]</w><w>.value</w></code><w>which</w><w>allows</w><w>column</w><w>names</w><w>that</w><w>include</w><w>a</w><w>space</w><w>,</w><w>or</w><w>dot</w><w>notation</w><code rend="inline"><w>cells.column_name.value</w></code><w>which</w><w>allows</w><w>only</w><w>single</w><w>word</w><w>column</w><w>names</w><pc>.</pc></s></p><p><s xml:id="s_wlcODZ"><w>In</w><w>GREL</w><w>,</w><w>strings</w><w>are</w><w>concatenated</w><w>using</w><w>the</w><w>plus</w><w>sign</w><pc>.</pc></s><s xml:id="s_53dvbd"><w>For</w><w>example</w><w>,</w><w>the</w><w>expression</w><code rend="inline"><w>``</w><w>one</w><w>''</w><w>+</w><w>``</w><w>two</w><w>''</w></code><w>would</w><w>result</w><w>in</w><w>``</w><w>onetwo</w><w>''</w><pc>.</pc></s></p><p><s xml:id="s_Pz2Ilp"><w>To</w><w>create</w><w>the</w><w>set</w><w>of</w><w>search</w><w>queries</w><w>,</w><w>from</w><w>the</w><emph><w>state</w></emph><w>column</w><w>,</w><w>add</w><w>a</w><w>column</w><w>named</w><w>``</w><w>url</w><w>''</w><w>with</w><w>this</w><w>expression</w><w>:</w></s></p><ab><code xml:id="code_fetch-and-parse-data-with-openrefine_8" corresp="code_fetch-and-parse-data-with-openrefine_8.txt" rend="block"/></ab><p><s xml:id="s_QMpZJg"><w>{</w><w>%</w><w>include</w><w>figure.html</w><w>caption=</w><w>''</w><w>Create</w><w>query</w><w>URL</w><w>''</w><w>filename=</w><w>''</w><w>refine-chronam-url.png</w><w>''</w><w>%</w><w>}</w></s></p><p><s xml:id="s_RJoC30"><w>The</w><w>expression</w><w>concatenates</w><w>the</w><w>constants</w><w>(</w><w>base</w><w>URL</w><w>,</w><w>search</w><w>service</w><w>,</w><w>and</w><w>query</w><w>field</w><w>names</w><w>)</w><w>together</w><w>with</w><w>the</w><w>values</w><w>in</w><w>each</w><w>row</w><pc>.</pc></s><s xml:id="s_C7Nlsm"><w>The</w><code rend="inline"><w>escape</w><w>(</w><w>)</w></code><w>function</w><w>is</w><w>added</w><w>to</w><w>the</w><w>cell</w><w>variables</w><w>to</w><w>ensure</w><w>the</w><w>string</w><w>will</w><w>be</w><w>safe</w><w>in</w><w>a</w><w>URL</w><w>(</w><w>the</w><w>opposite</w><w>of</w><w>the</w><code rend="inline"><w>unescape</w><w>(</w><w>)</w></code><w>function</w><w>introduced</w><w>in</w><emph><w>Example</w><w>1</w></emph><w>)</w><pc>.</pc></s></p><p><s xml:id="s_Cwy89A"><w>Look</w><w>at</w><w>the</w><w>value</w><w>pairs</w><w>after</w><w>the</w><code rend="inline"><pc>?</pc></code><w>to</w><w>understand</w><w>the</w><w>parameters</w><w>of</w><w>the</w><w>search</w><pc>.</pc></s><s xml:id="s_hmLjoa"><w>Explicitly</w><w>,</w><w>the</w><w>first</w><w>query</w><w>URL</w><w>will</w><w>ask</w><w>for</w><w>newspapers</w><w>:</w></s></p><list type="unordered"><item><s xml:id="s_K4qzP2"><w>from</w><w>Idaho</w><w>(</w><code rend="inline"><w>state=Idaho</w></code><w>)</w></s></item><item><s xml:id="s_PIrQvx"><w>from</w><w>the</w><w>year</w><w>1865</w><w>,</w><w>(</w><code rend="inline"><w>date1=1865</w><w>&amp;</w><w>date2=1865</w><w>&amp;</w><w>dateFilterType=yearRange</w></code><w>)</w></s></item><item><s xml:id="s_ljgDKm"><w>only</w><w>the</w><w>front</w><w>pages</w><w>(</w><code rend="inline"><w>sequence=1</w></code><w>)</w></s></item><item><s xml:id="s_lyXuby"><w>sorting</w><w>by</w><w>date</w><w>(</w><code rend="inline"><w>sort=date</w></code><w>)</w></s></item><item><s xml:id="s_uRHZIJ"><w>returning</w><w>a</w><w>maximum</w><w>of</w><w>five</w><w>(</w><code rend="inline"><w>rows=5</w></code><w>)</w></s></item><item><s xml:id="s_AWlwW6"><w>in</w><w>JSON</w><w>(</w><code rend="inline"><w>format=json</w></code><w>)</w></s></item></list></div><div type="3" n="3.3"><head><s xml:id="s_mtPAHL"><w>Fetch</w><w>URLs</w></s></head><p><s xml:id="s_12C2OA"><w>The</w><emph><w>url</w></emph><w>column</w><w>is</w><w>a</w><w>list</w><w>of</w><w>web</w><w>queries</w><w>that</w><w>could</w><w>be</w><w>accessed</w><w>with</w><w>a</w><w>browser</w><pc>.</pc></s><s xml:id="s_S3WXoj"><w>To</w><w>test</w><w>,</w><w>click</w><w>one</w><w>of</w><w>the</w><w>links</w><pc>.</pc></s><s xml:id="s_FkC7Rg"><w>The</w><w>url</w><w>will</w><w>open</w><w>in</w><w>a</w><w>new</w><w>tab</w><w>,</w><w>returning</w><w>a</w><w>JSON</w><w>response</w><pc>.</pc></s></p><p><s xml:id="s_XpHhsA"><w>Fetch</w><w>the</w><w>URLs</w><w>using</w><emph><w>url</w></emph><w>column</w><w>by</w><w>selecting</w><emph><w>Edit</w><w>column</w></emph><w>&gt;</w><emph><w>Add</w><w>column</w><w>by</w><w>fetching</w><w>urls</w></emph><pc>.</pc></s><s xml:id="s_ovFaE9"><w>Name</w><w>the</w><w>new</w><w>column</w><w>``</w><w>fetch</w><w>''</w><w>and</w><w>click</w><emph><w>OK</w></emph><pc>.</pc></s><s xml:id="s_B8PREn"><w>In</w><w>a</w><w>few</w><w>seconds</w><w>,</w><w>the</w><w>operation</w><w>should</w><w>complete</w><w>and</w><w>the</w><emph><w>fetch</w></emph><w>column</w><w>will</w><w>be</w><w>filled</w><w>with</w><ref target="http://www.json.org/"><w>JSON</w></ref><w>data</w><pc>.</pc></s></p></div><div type="3" n="3.4"><head><s xml:id="s_pQNQ3J"><w>Parse</w><w>JSON</w><w>to</w><w>Get</w><w>Items</w></s></head><p><s xml:id="s_xQN57M"><w>The</w><w>first</w><w>name/value</w><w>pairs</w><w>of</w><w>the</w><w>query</w><w>response</w><w>look</w><w>like</w><code rend="inline"><w>``</w><w>totalItems</w><w>''</w><w>:</w><w>52</w><w>,</w><w>``</w><w>endIndex</w><w>''</w><w>:</w><w>5</w></code><pc>.</pc></s><s xml:id="s_7QHvb1"><w>This</w><w>indicates</w><w>that</w><w>the</w><w>search</w><w>resulted</w><w>in</w><w>52</w><w>total</w><w>items</w><w>,</w><w>but</w><w>the</w><w>response</w><w>contains</w><w>only</w><w>five</w><w>(</w><w>since</w><w>it</w><w>was</w><w>limited</w><w>by</w><w>the</w><code rend="inline"><w>rows=5</w></code><w>option</w><w>)</w><pc>.</pc></s><s xml:id="s_xqBtFq"><w>The</w><w>JSON</w><w>key</w><code rend="inline"><w>items</w></code><w>contains</w><w>an</w><w>array</w><w>of</w><w>the</w><w>individual</w><w>newspapers</w><w>returned</w><w>by</w><w>the</w><w>search</w><pc>.</pc></s><s xml:id="s_5zKucL"><w>To</w><w>construct</w><w>a</w><w>orderly</w><w>data</w><w>set</w><w>,</w><w>it</w><w>is</w><w>necessary</w><w>to</w><w>parse</w><w>the</w><w>JSON</w><w>and</w><w>split</w><w>each</w><w>newspaper</w><w>into</w><w>its</w><w>own</w><w>row</w><pc>.</pc></s></p><p><s xml:id="s_F5UEzk"><w>GREL</w><w>'s</w><code rend="inline"><w>parseJson</w><w>(</w><w>)</w></code><w>function</w><w>allows</w><w>us</w><w>to</w><w>select</w><w>a</w><w>key</w><w>name</w><w>to</w><w>retrieve</w><w>the</w><w>corresponding</w><w>values</w><pc>.</pc></s><s xml:id="s_WC6Pum"><w>Add</w><w>a</w><w>new</w><w>column</w><w>based</w><w>on</w><emph><w>fetch</w></emph><w>with</w><w>the</w><w>name</w><w>``</w><w>items</w><w>''</w><w>and</w><w>enter</w><w>this</w><w>expression</w><w>:</w></s></p><ab><code xml:id="code_fetch-and-parse-data-with-openrefine_9" corresp="code_fetch-and-parse-data-with-openrefine_9.txt" rend="block"/></ab><p><s xml:id="s_wym7Wa"><w>{</w><w>%</w><w>include</w><w>figure.html</w><w>caption=</w><w>''</w><w>parse</w><w>json</w><w>items</w><w>''</w><w>filename=</w><w>''</w><w>refine-parse-items.png</w><w>''</w><w>%</w><w>}</w></s></p><p><s xml:id="s_zLmh9H"><w>Selecting</w><code rend="inline"><w>[</w><w>'items</w><w>'</w><w>]</w></code><w>exposes</w><w>the</w><w>array</w><w>of</w><w>newspaper</w><w>records</w><w>nested</w><w>inside</w><w>the</w><w>JSON</w><w>response</w><pc>.</pc></s><s xml:id="s_OBXDdV"><w>The</w><code rend="inline"><w>join</w><w>(</w><w>)</w></code><w>function</w><w>concatenates</w><w>the</w><w>array</w><w>with</w><w>the</w><w>given</w><w>separator</w><w>resulting</w><w>in</w><w>a</w><w>string</w><w>value</w><pc>.</pc></s><s xml:id="s_snmouR"><w>Since</w><w>the</w><w>newspaper</w><w>records</w><w>contain</w><w>an</w><w>OCR</w><w>text</w><w>field</w><w>,</w><w>the</w><w>strange</w><w>separator</w><w>``</w><w>^^^</w><w>''</w><w>is</w><w>necessary</w><w>to</w><w>ensure</w><w>that</w><w>it</w><w>is</w><w>unique</w><w>and</w><w>can</w><w>be</w><w>used</w><w>to</w><w>split</w><w>the</w><w>values</w><pc>.</pc></s></p></div><div type="3" n="3.5"><head><s xml:id="s_8k1ju3"><w>Split</w><w>Multivalued</w><w>Cells</w></s></head><p><s xml:id="s_JcP7MY"><w>With</w><w>the</w><w>individual</w><w>newspapers</w><w>isolated</w><w>,</w><w>separate</w><w>rows</w><w>can</w><w>be</w><w>created</w><w>by</w><w>splitting</w><w>the</w><w>cells</w><pc>.</pc></s><s xml:id="s_iiCEbJ"><w>On</w><w>the</w><emph><w>items</w></emph><w>column</w><w>,</w><w>select</w><emph><w>Edit</w><w>cells</w></emph><w>&gt;</w><emph><w>Split</w><w>multivalued</w><w>cells</w></emph><w>,</w><w>and</w><w>enter</w><w>the</w><w>join</w><w>used</w><w>in</w><w>the</w><w>last</w><w>step</w><w>,</w><code rend="inline"><w>^^^</w></code><pc>.</pc></s><s xml:id="s_DOvESv"><w>After</w><w>the</w><w>operation</w><w>,</w><w>the</w><w>top</w><w>of</w><w>the</w><w>project</w><w>table</w><w>should</w><w>read</w><w>20</w><w>rows</w><pc>.</pc></s><s xml:id="s_OoagRZ"><w>Clicking</w><w>on</w><w>Show</w><w>as</w><emph><w>records</w></emph><w>should</w><w>read</w><w>4</w><w>,</w><w>representing</w><w>the</w><w>original</w><w>CSV</w><w>rows</w><pc>.</pc></s></p><p><s xml:id="s_vr2v63"><w>Notice</w><w>that</w><w>the</w><w>new</w><w>rows</w><w>are</w><w>empty</w><w>in</w><w>all</w><w>columns</w><w>except</w><emph><w>items</w></emph><pc>.</pc></s><s xml:id="s_4NYDHV"><w>To</w><w>ensure</w><w>the</w><w>state</w><w>is</w><w>available</w><w>with</w><w>each</w><w>newspaper</w><w>issue</w><w>,</w><w>the</w><w>empty</w><w>values</w><w>can</w><w>be</w><w>filled</w><w>using</w><w>the</w><code rend="inline"><w>Fill</w><w>down</w></code><w>function</w><pc>.</pc></s><s xml:id="s_l5E8HY"><w>Click</w><w>on</w><w>the</w><emph><w>state</w></emph><w>column</w><w>&gt;</w><emph><w>Edit</w><w>cells</w></emph><w>&gt;</w><emph><w>Fill</w><w>down</w></emph><pc>.</pc></s></p><p><s xml:id="s_KaFzKJ"><w>{</w><w>%</w><w>include</w><w>figure.html</w><w>caption=</w><w>''</w><w>fill</w><w>down</w><w>''</w><w>filename=</w><w>''</w><w>refine-fill-down.png</w><w>''</w><w>%</w><w>}</w></s></p><p><s xml:id="s_4yAlIR"><w>This</w><w>is</w><w>a</w><w>good</w><w>point</w><w>to</w><w>clean</w><w>up</w><w>the</w><w>unnecessary</w><w>columns</w><pc>.</pc></s><s xml:id="s_XiPbB7"><w>Click</w><w>on</w><w>the</w><emph><w>All</w></emph><w>column</w><w>&gt;</w><emph><w>Edit</w><w>columns</w></emph><w>&gt;</w><emph><w>Re-order</w><w>/</w><w>remove</w><w>columns</w></emph><pc>.</pc></s><s xml:id="s_uE7QKU"><w>Drag</w><w>all</w><w>columns</w><w>except</w><emph><w>state</w></emph><w>and</w><emph><w>items</w></emph><w>to</w><w>the</w><w>right</w><w>side</w><w>,</w><w>then</w><w>click</w><emph><w>OK</w></emph><w>to</w><w>remove</w><w>them</w><pc>.</pc></s></p><p><s xml:id="s_e8y6rD"><w>{</w><w>%</w><w>include</w><w>figure.html</w><w>caption=</w><w>''</w><w>Re-order</w><w>/</w><w>remove</w><w>columns</w><w>''</w><w>filename=</w><w>''</w><w>refine-chronam-reorder.png</w><w>''</w><w>%</w><w>}</w></s></p><p><s xml:id="s_UZRuZM"><w>Sanity</w><w>check</w><w>:</w><w>with</w><w>the</w><w>original</w><w>columns</w><w>removed</w><w>,</w><w>both</w><emph><w>records</w></emph><w>and</w><emph><w>rows</w></emph><w>will</w><w>read</w><w>20</w><pc>.</pc></s><s xml:id="s_voZjIk"><w>This</w><w>makes</w><w>sense</w><w>,</w><w>as</w><w>the</w><w>project</w><w>started</w><w>with</w><w>four</w><w>states</w><w>and</w><w>fetched</w><w>five</w><w>records</w><w>for</w><w>each</w><pc>.</pc></s></p></div><div type="3" n="3.6"><head><s xml:id="s_b1fTKj"><w>Parse</w><w>JSON</w><w>Values</w></s></head><p><s xml:id="s_2U6v85"><w>To</w><w>complete</w><w>the</w><w>data</w><w>set</w><w>,</w><w>it</w><w>is</w><w>necessary</w><w>to</w><w>parse</w><w>each</w><w>newspaper</w><w>'s</w><w>JSON</w><w>record</w><w>into</w><w>individual</w><w>columns</w><pc>.</pc></s><s xml:id="s_mzaqJ7"><w>This</w><w>is</w><w>a</w><w>common</w><w>task</w><w>,</w><w>as</w><w>many</w><w>web</w><w>APIs</w><w>return</w><w>information</w><w>in</w><w>JSON</w><w>format</w><pc>.</pc></s><s xml:id="s_7fjXBd"><w>Again</w><w>,</w><w>GREL</w><w>'s</w><code rend="inline"><w>parseJson</w><w>(</w><w>)</w></code><w>function</w><w>makes</w><w>this</w><w>easy</w><pc>.</pc></s><s xml:id="s_eeCGlN"><w>Create</w><w>a</w><w>new</w><w>column</w><w>from</w><emph><w>items</w></emph><w>for</w><w>each</w><w>newspaper</w><w>metadata</w><w>element</w><w>by</w><w>parsing</w><w>the</w><w>JSON</w><w>and</w><w>selecting</w><w>the</w><w>key</w><w>:</w></s></p><list type="unordered"><item><s xml:id="s_EchbY8"><w>``</w><w>date</w><w>''</w><w>,</w><code rend="inline"><w>value.parseJson</w><w>(</w><w>)</w><w>[</w><w>'date</w><w>'</w><w>]</w></code></s></item><item><s xml:id="s_bA4lV9"><w>``</w><w>title</w><w>''</w><w>,</w><code rend="inline"><w>value.parseJson</w><w>(</w><w>)</w><w>[</w><w>'title</w><w>'</w><w>]</w></code></s></item><item><s xml:id="s_e5tI7M"><w>``</w><w>city</w><w>''</w><w>,</w><code rend="inline"><w>value.parseJson</w><w>(</w><w>)</w><w>[</w><w>'city</w><w>'</w><w>]</w><w>.join</w><w>(</w><w>``</w><w>,</w><w>``</w><w>)</w></code></s></item><item><s xml:id="s_JBTF4g"><w>``</w><w>lccn</w><w>''</w><w>,</w><code rend="inline"><w>value.parseJson</w><w>(</w><w>)</w><w>[</w><w>'lccn</w><w>'</w><w>]</w></code></s></item><item><s xml:id="s_UQh9m5"><w>``</w><w>text</w><w>''</w><w>,</w><code rend="inline"><w>value.parseJson</w><w>(</w><w>)</w><w>[</w><w>'ocr_eng</w><w>'</w><w>]</w></code></s></item></list><p style="alert alert-info"><s xml:id="s_w3xXay"><w>Some</w><w>users</w><w>of</w><w>this</w><w>lesson</w><w>have</w><w>noted</w><w>that</w><w>a</w><w>recent</w><w>change</w><w>to</w><w>the</w><w>output</w><w>of</w><w>OCR'ed</w><w>text</w><w>from</w><w>the</w><w>Library</w><w>of</w><w>Congress</w><w>introduces</w><w>unexpected</w><w>line</w><w>breaks</w><w>in</w><w>the</w><w>text</w><w>column</w><pc>.</pc></s><s xml:id="s_99heig"><w>These</w><w>can</w><w>be</w><w>removed</w><w>using</w><w>the</w><w>Expression</w><code rend="inline"><w>value.replace</w><w>(</w><w>``</w><w>\n</w><w>''</w><w>,</w><w>''</w><w>''</w><w>)</w></code><pc>.</pc></s><s xml:id="s_lcBNOd"><w>(</w><w>Nov</w><pc>.</pc></s><s xml:id="s_V4vIkP"><w>2022</w><w>)</w></s></p><p><s xml:id="s_lwFLGM"><w>After</w><w>the</w><w>desired</w><w>information</w><w>is</w><w>extracted</w><w>,</w><w>the</w><emph><w>items</w></emph><w>column</w><w>can</w><w>be</w><w>removed</w><w>by</w><w>selecting</w><emph><w>Edit</w><w>column</w></emph><w>&gt;</w><emph><w>Remove</w><w>this</w><w>column</w></emph><pc>.</pc></s></p><p><s xml:id="s_9rbAnU"><w>{</w><w>%</w><w>include</w><w>figure.html</w><w>caption=</w><w>''</w><w>Final</w><w>ChronAm</w><w>project</w><w>columns</w><w>''</w><w>filename=</w><w>''</w><w>refine-chronam-final.png</w><w>''</w><w>%</w><w>}</w></s></p><p><s xml:id="s_FjnuVO"><w>Each</w><w>column</w><w>could</w><w>be</w><w>further</w><w>refined</w><w>using</w><w>other</w><w>GREL</w><w>transformations</w><pc>.</pc></s><s xml:id="s_ANlRlq"><w>For</w><w>example</w><w>,</w><w>to</w><w>convert</w><emph><w>date</w></emph><w>to</w><w>a</w><w>more</w><w>readable</w><w>format</w><w>,</w><w>use</w><ref target="https://github.com/OpenRefine/OpenRefine/wiki/GREL-Date-Functions"><w>GREL</w><w>date</w><w>functions</w></ref><pc>.</pc></s><s xml:id="s_QxdGct"><w>Transform</w><w>the</w><emph><w>date</w></emph><w>column</w><w>with</w><w>the</w><w>expression</w><code rend="inline"><w>value.toDate</w><w>(</w><w>``</w><w>yyyymmdd</w><w>''</w><w>)</w><w>.toString</w><w>(</w><w>``</w><w>yyyy-MM-dd</w><w>''</w><w>)</w></code><pc>.</pc></s></p><p><s xml:id="s_SSdvx8"><w>Another</w><w>common</w><w>workflow</w><w>is</w><w>to</w><w>extend</w><w>the</w><w>data</w><w>with</w><w>further</w><w>URL</w><w>queries</w><pc>.</pc></s><s xml:id="s_4p4AoH"><w>For</w><w>example</w><w>,</w><w>a</w><w>link</w><w>to</w><w>full</w><w>information</w><w>about</w><w>each</w><w>issue</w><w>can</w><w>be</w><w>formed</w><w>based</w><w>on</w><w>the</w><emph><w>lccn</w></emph><pc>.</pc></s><s xml:id="s_nJTXkA"><w>Create</w><w>a</w><w>new</w><w>column</w><w>based</w><w>on</w><emph><w>lccn</w></emph><w>using</w><w>the</w><w>expression</w><code rend="inline"><w>``</w><w>https</w><w>:</w><w>//chroniclingamerica.loc.gov/lccn/</w><w>''</w><w>+</w><w>value</w><w>+</w><w>``</w><w>/</w><w>''</w><w>+</w><w>cells</w><w>[</w><w>'date</w><w>'</w><w>]</w><w>.value</w><w>+</w><w>``</w><w>/ed-1.json</w><w>''</w></code><pc>.</pc></s><s xml:id="s_NyRSOC"><w>Fetching</w><w>this</w><w>URL</w><w>returns</w><w>a</w><w>complete</w><w>list</w><w>of</w><w>the</w><w>issue</w><w>'s</w><w>pages</w><w>,</w><w>which</w><w>could</w><w>in</w><w>turn</w><w>be</w><w>harvested</w><pc>.</pc></s></p><p><s xml:id="s_adhRjv"><w>For</w><w>now</w><w>,</w><w>the</w><w>headlines</w><w>of</w><w>1865</w><w>from</w><w>the</w><w>Northwest</w><w>are</w><w>ready</w><w>to</w><w>enjoy</w><pc>!</pc></s></p></div></div><div type="2" n="4"><head><s xml:id="s_KdD2qp"><w>Example</w><w>3</w><w>:</w><w>Advanced</w><w>APIs</w></s></head><p><s xml:id="s_D8yl2S"><emph><ref target="#example-2-url-queries-and-parsing-json"><w>Example</w><w>2</w></ref></emph><w>demonstrated</w><w>Refine</w><w>'s</w><w>fetch</w><w>function</w><w>with</w><w>a</w><w>simple</w><w>web</w><w>API</w><w>,</w><w>essentially</w><w>utilizing</w><w>URL</w><w>patterns</w><w>to</w><w>request</w><w>information</w><w>from</w><w>a</w><w>server</w><pc>.</pc></s><s xml:id="s_FBfn5v"><w>This</w><w>workflow</w><w>uses</w><w>the</w><w>HTTP</w><w>GET</w><w>protocol</w><w>,</w><w>meaning</w><w>the</w><w>query</w><w>is</w><w>encoded</w><w>in</w><w>the</w><w>URL</w><w>string</w><w>,</w><w>thus</w><w>limited</w><w>in</w><w>length</w><w>(</w><w>2048</w><w>ASCII</w><w>characters</w><w>)</w><w>,</w><w>complexity</w><w>,</w><w>and</w><w>security</w><pc>.</pc></s><s xml:id="s_d5fhlY"><w>Instead</w><w>,</w><w>many</w><w>API</w><w>services</w><w>used</w><w>to</w><w>enhance</w><w>text</w><w>data</w><w>,</w><w>such</w><w>as</w><ref target="https://en.wikipedia.org/wiki/Geocoding"><w>geocoding</w></ref><w>or</w><ref target="https://en.wikipedia.org/wiki/Named-entity_recognition"><w>named</w><w>entity</w><w>recognition</w></ref><w>,</w><w>use</w><w>HTTP</w><w>POST</w><w>to</w><w>transfer</w><w>information</w><w>to</w><w>the</w><w>server</w><w>for</w><w>processing</w><pc>.</pc></s></p><p><s xml:id="s_NpUYDR"><w>GREL</w><w>does</w><w>not</w><w>have</w><w>a</w><w>built</w><w>in</w><w>function</w><w>to</w><w>use</w><w>this</w><w>type</w><w>of</w><w>API</w><pc>.</pc></s><s xml:id="s_gSTKXh"><w>However</w><w>,</w><w>the</w><w>expression</w><w>window</w><w>language</w><w>can</w><w>be</w><w>changed</w><w>to</w><ref target="http://www.jython.org/"><w>Jython</w></ref><w>,</w><w>providing</w><w>a</w><w>more</w><w>complete</w><w>scripting</w><w>environment</w><w>where</w><w>it</w><w>is</w><w>possible</w><w>to</w><w>implement</w><w>a</w><w>POST</w><w>request</w><pc>.</pc></s></p><quote><p><s xml:id="s_0TunA2"><ref target="http://www.jython.org/"><w>Jython</w></ref><w>is</w><w>Python</w><w>implemented</w><w>for</w><w>the</w><w>Java</w><w>VM</w><w>and</w><w>comes</w><w>bundled</w><w>with</w><w>Refine</w><pc>.</pc></s><s xml:id="s_T2M74Q"><w>This</w><w>means</w><ref target="https://docs.python.org/2.7/"><w>Python</w><w>2</w></ref><w>scripts</w><w>using</w><w>the</w><w>Standard</w><w>Library</w><w>can</w><w>be</w><w>written</w><w>or</w><w>loaded</w><w>into</w><w>the</w><w>expression</w><w>window</w><w>,</w><w>and</w><w>Refine</w><w>will</w><w>apply</w><w>them</w><w>to</w><w>each</w><w>cell</w><w>in</w><w>the</w><w>transformation</w><pc>.</pc></s><s xml:id="s_LkkSHJ"><w>The</w><ref target="https://github.com/OpenRefine/OpenRefine/wiki/Jython"><w>official</w><w>documentation</w></ref><w>is</w><w>sparse</w><w>,</w><w>but</w><w>the</w><w>built-in</w><w>Jython</w><w>can</w><w>be</w><w>extended</w><w>with</w><w>non-standard</w><w>libraries</w><w>using</w><w>a</w><ref target="https://github.com/OpenRefine/OpenRefine/wiki/Extending-Jython-with-pypi-modules"><w>work</w><w>around</w></ref><pc>.</pc></s></p><p><s xml:id="s_0iLWjR"><w>Keep</w><w>in</w><w>mind</w><w>that</w><w>spending</w><w>time</w><w>writing</w><w>complex</w><w>scripts</w><w>moves</w><w>away</w><w>from</w><w>the</w><w>strengths</w><w>of</w><w>Refine</w><pc>.</pc></s><s xml:id="s_MDX4g9"><w>If</w><w>it</w><w>is</w><w>necessary</w><w>to</w><w>develop</w><w>a</w><w>lengthy</w><w>Jython</w><w>routine</w><w>,</w><w>it</w><w>will</w><w>likely</w><w>be</w><w>more</w><w>efficient</w><w>to</w><w>process</w><w>the</w><w>data</w><w>directly</w><w>in</w><w>Python</w><pc>.</pc></s><s xml:id="s_XSx5wO"><w>On</w><w>the</w><w>other</w><w>hand</w><w>,</w><w>if</w><w>you</w><w>know</w><w>a</w><w>handy</w><w>method</w><w>to</w><w>process</w><w>data</w><w>in</w><w>Python</w><w>2</w><w>,</w><w>Jython</w><w>is</w><w>a</w><w>easy</w><w>way</w><w>to</w><w>apply</w><w>it</w><w>in</w><w>a</w><w>Refine</w><w>project</w><pc>.</pc></s></p></quote><div type="3" n="4.1"><head><s xml:id="s_4jQnWw"><w>Jython</w><w>in</w><w>the</w><w>Expression</w><w>Window</w></s></head><p><s xml:id="s_Qc2aK5"><w>Return</w><w>to</w><w>the</w><w>``</w><w>Sonnets</w><w>''</w><w>project</w><w>completed</w><w>in</w><emph><ref target="#example-1-fetching-and-parsing-html"><w>Example</w><w>1</w></ref></emph><pc>.</pc></s><s xml:id="s_54UO7B"><w>If</w><w>the</w><w>tab</w><w>was</w><w>closed</w><w>,</w><w>click</w><emph><w>Open</w></emph><w>&gt;</w><emph><w>Open</w><w>Project</w></emph><w>and</w><w>find</w><w>the</w><w>Sonnets</w><w>example</w><w>(</w><w>Refine</w><w>saves</w><w>everything</w><w>for</w><w>you</w><pc>!</pc></s><s xml:id="s_8Qv2Xa"><w>)</w><pc>.</pc></s></p><p><s xml:id="s_pb15n3"><w>Add</w><w>a</w><w>new</w><w>column</w><w>based</w><w>on</w><w>the</w><emph><w>first</w></emph><w>column</w><w>named</w><w>``</w><w>sentiment</w><w>''</w><pc>.</pc></s><s xml:id="s_BXsVgt"><w>We</w><w>will</w><w>use</w><w>this</w><w>window</w><w>to</w><w>test</w><w>out</w><w>a</w><w>series</w><w>of</w><w>expressions</w><w>,</w><w>so</w><w>leave</w><w>it</w><w>open</w><w>until</w><w>we</w><w>get</w><w>to</w><w>the</w><w>final</w><w>iteration</w><w>of</w><w>the</w><w>request</w><pc>.</pc></s></p><p><s xml:id="s_tNtPaW"><w>On</w><w>the</w><w>right</w><w>side</w><w>of</w><w>the</w><emph><w>Expression</w></emph><w>box</w><w>is</w><w>a</w><w>drop</w><w>down</w><w>to</w><w>change</w><w>the</w><w>expression</w><w>language</w><pc>.</pc></s><s xml:id="s_OgByPZ"><w>Select</w><emph><w>Python</w><w>/</w><w>Jython</w></emph><w>from</w><w>the</w><w>list</w><pc>.</pc></s></p><p><s xml:id="s_Vra0wX"><w>{</w><w>%</w><w>include</w><w>figure.html</w><w>caption=</w><w>''</w><w>Jython</w><w>expression</w><w>''</w><w>filename=</w><w>''</w><w>refine-jython.png</w><w>''</w><w>%</w><w>}</w></s></p><p><s xml:id="s_gmEI2C"><w>Notice</w><w>that</w><w>the</w><w>preview</w><w>now</w><w>shows</w><code rend="inline"><w>null</w></code><w>for</w><w>the</w><w>output</w><pc>.</pc></s><s xml:id="s_4HTSUq"><w>A</w><w>Jython</w><w>expression</w><w>in</w><w>Refine</w><w>must</w><w>have</w><w>a</w><code rend="inline"><w>return</w></code><w>statement</w><w>to</w><w>add</w><w>the</w><w>output</w><w>to</w><w>the</w><w>new</w><w>cells</w><w>in</w><w>the</w><w>transformation</w><pc>.</pc></s><s xml:id="s_V3ToML"><w>Type</w><code rend="inline"><w>return</w><w>value</w></code><w>into</w><w>the</w><emph><w>Expression</w></emph><w>box</w><pc>.</pc></s><s xml:id="s_xjcSU3"><w>The</w><w>preview</w><w>will</w><w>update</w><w>showing</w><w>the</w><w>current</w><w>cells</w><w>copied</w><w>to</w><w>the</w><w>output</w><pc>.</pc></s><s xml:id="s_WosSR2"><w>The</w><w>basic</w><ref target="https://github.com/OpenRefine/OpenRefine/wiki/Variables"><w>GREL</w><w>variables</w></ref><w>can</w><w>be</w><w>used</w><w>in</w><w>Jython</w><w>by</w><w>substituting</w><w>brackets</w><w>instead</w><w>of</w><w>periods</w><pc>.</pc></s><s xml:id="s_kEM7e0"><w>For</w><w>example</w><w>,</w><w>the</w><w>GREL</w><code rend="inline"><w>cells.column-name.value</w></code><w>would</w><w>be</w><w>Jython</w><code rend="inline"><w>cells</w><w>[</w><w>'column-name</w><w>'</w><w>]</w><w>[</w><w>'value</w><w>'</w><w>]</w></code><pc>.</pc></s></p></div><div type="3" n="4.2"><head><s xml:id="s_G4n91T"><w>Jython</w><w>GET</w><w>Request</w></s></head><p><s xml:id="s_wjgw5F"><w>To</w><w>create</w><w>a</w><w>HTTP</w><w>request</w><w>in</w><w>Jython</w><w>,</w><w>use</w><w>the</w><w>standard</w><w>library</w><ref target="https://docs.python.org/2/library/urllib2.html"><w>urllib2</w></ref><pc>.</pc></s><s xml:id="s_tDPALT"><w>Refine</w><w>'s</w><w>fetch</w><w>function</w><w>can</w><w>be</w><w>recreated</w><w>with</w><w>Jython</w><w>to</w><w>demonstrate</w><w>the</w><w>basics</w><w>of</w><w>the</w><w>library</w><pc>.</pc></s><s xml:id="s_My58y0"><w>In</w><w>the</w><w>expression</w><w>box</w><w>,</w><w>type</w><w>:</w></s></p><ab><code xml:id="code_fetch-and-parse-data-with-openrefine_10" corresp="code_fetch-and-parse-data-with-openrefine_10.txt" rend="block"/></ab><p><s xml:id="s_2j6nW1"><w>{</w><w>%</w><w>include</w><w>figure.html</w><w>caption=</w><w>''</w><w>Jython</w><w>GET</w><w>request</w><w>''</w><w>filename=</w><w>''</w><w>refine-jython-expression.png</w><w>''</w><w>%</w><w>}</w></s></p><p><s xml:id="s_auttfr"><w>The</w><w>preview</w><w>should</w><w>display</w><w>the</w><w>HTML</w><w>source</w><w>of</w><w>the</w><w>Jython</w><w>home</w><w>page</w><w>,</w><w>this</w><w>is</w><w>an</w><w>HTTP</w><w>GET</w><w>request</w><w>as</w><w>in</w><w>previous</w><w>fetch</w><w>examples</w><pc>.</pc></s><s xml:id="s_mzENeP"><w>Notice</w><w>that</w><w>similar</w><w>to</w><w>opening</w><w>and</w><w>reading</w><w>a</w><w>text</w><w>file</w><w>with</w><w>Python</w><w>,</w><code rend="inline"><w>urlopen</w><w>(</w><w>)</w></code><w>returns</w><w>a</w><w>file-like</w><w>object</w><w>that</w><w>must</w><w>be</w><code rend="inline"><w>read</w><w>(</w><w>)</w></code><w>into</w><w>a</w><w>string</w><pc>.</pc></s><s xml:id="s_g15FDW"><w>The</w><w>URL</w><w>could</w><w>be</w><w>replaced</w><w>with</w><w>cell</w><w>variables</w><w>to</w><w>construct</w><w>a</w><w>query</w><w>similar</w><w>to</w><w>the</w><w>fetch</w><w>used</w><w>in</w><emph><w>Example</w><w>2</w></emph><pc>.</pc></s></p></div><div type="3" n="4.3"><head><s xml:id="s_jXdkKf"><w>POST</w><w>Request</w></s></head><p><s xml:id="s_LwiKSd"><w>Urllib2</w><w>will</w><w>automatically</w><w>send</w><w>a</w><w>POST</w><w>if</w><w>data</w><w>is</w><w>added</w><w>to</w><w>the</w><w>request</w><w>object</w><pc>.</pc></s><s xml:id="s_Synxxt"><w>For</w><w>example</w><w>,</w><ref target="http://text-processing.com/"><w>Text</w><w>Processing</w></ref><w>provides</w><w>natural</w><w>language</w><w>processing</w><w>APIs</w><w>based</w><w>on</w><ref target="http://www.nltk.org/"><w>Python</w><w>NLTK</w></ref><pc>.</pc></s><s xml:id="s_OJdQc9"><w>The</w><w>documentation</w><w>for</w><w>the</w><ref target="http://text-processing.com/docs/sentiment.html"><w>Sentiment</w><w>Analysis</w><w>service</w></ref><w>provides</w><w>a</w><w>base</w><w>URL</w><w>and</w><w>the</w><w>name</w><w>of</w><w>the</w><w>key</w><w>used</w><w>for</w><w>the</w><w>data</w><w>to</w><w>be</w><w>analyzed</w><pc>.</pc></s><s xml:id="s_BfJaGU"><w>No</w><w>authentication</w><w>is</w><w>required</w><w>and</w><w>1,000</w><w>calls</w><w>per</w><w>day</w><w>are</w><w>free</w><w>for</w><w>non-commercial</w><w>use</w><pc>.</pc></s><ref type="footnotemark" target="#en_note_use"/></p><p><s xml:id="s_XoAbHa"><w>This</w><w>type</w><w>of</w><w>API</w><w>is</w><w>often</w><w>demonstrated</w><w>using</w><ref target="https://curl.haxx.se/"><w>curl</w></ref><w>on</w><w>the</w><w>commandline</w><pc>.</pc></s><s xml:id="s_HyIhfQ"><w>Text</w><w>Processing</w><w>gives</w><w>the</w><w>example</w><code rend="inline"><w>curl</w><w>-d</w><w>``</w><w>text=great</w><w>''</w><w>http</w><w>:</w><w>//text-processing.com/api/sentiment/</w></code><w>which</w><w>can</w><w>be</w><w>recreated</w><w>in</w><w>Jython</w><w>to</w><w>test</w><w>the</w><w>service</w><pc>.</pc></s><s xml:id="s_ZaXgeY"><w>Building</w><w>on</w><w>the</w><w>GET</w><w>expression</w><w>above</w><w>,</w><w>the</w><w>POST</w><w>data</w><w>is</w><w>added</w><w>as</w><w>the</w><w>second</w><w>parameter</w><w>of</w><emph><w>urlopen</w></emph><w>,</w><w>thus</w><w>the</w><w>request</w><w>will</w><w>be</w><w>in</w><w>the</w><w>form</w><code rend="inline"><w>urllib2.urlopen</w><w>(</w><w>url</w><w>,</w><w>data</w><w>)</w></code><pc>.</pc></s><s xml:id="s_FOJWgf"><w>Type</w><w>this</w><w>script</w><w>into</w><w>the</w><w>expression</w><w>window</w><w>:</w></s></p><ab><code xml:id="code_fetch-and-parse-data-with-openrefine_11" corresp="code_fetch-and-parse-data-with-openrefine_11.txt" rend="block"/></ab><p><s xml:id="s_JIASFO"><w>The</w><w>preview</w><w>should</w><w>show</w><w>a</w><w>JSON</w><w>response</w><w>with</w><w>sentiment</w><w>probability</w><w>values</w><pc>.</pc></s><s xml:id="s_Tmdl7K"><w>To</w><w>retrieve</w><w>sentiment</w><w>analysis</w><w>data</w><w>for</w><w>the</w><w>first</w><w>lines</w><w>of</w><w>the</w><w>sonnets</w><w>(</w><w>remember</w><w>we</w><w>are</w><w>still</w><w>adding</w><w>a</w><w>column</w><w>based</w><w>on</w><emph><w>first</w></emph><pc>!</pc></s><s xml:id="s_9j0JAO"><w>)</w><w>,</w><w>put</w><w>the</w><w>basic</w><w>Jython</w><w>pattern</w><w>together</w><w>with</w><w>the</w><w>values</w><w>of</w><w>the</w><w>cells</w><w>:</w></s></p><ab><code xml:id="code_fetch-and-parse-data-with-openrefine_12" corresp="code_fetch-and-parse-data-with-openrefine_12.txt" rend="block"/></ab><p><s xml:id="s_rChbAR"><w>{</w><w>%</w><w>include</w><w>figure.html</w><w>caption=</w><w>''</w><w>jython</w><w>request</w><w>''</w><w>filename=</w><w>''</w><w>refine-jython-request.png</w><w>''</w><w>%</w><w>}</w></s></p><p><s xml:id="s_wqbypl"><w>Click</w><emph><w>OK</w></emph><w>and</w><w>the</w><w>Jython</w><w>script</w><w>will</w><w>run</w><w>for</w><w>every</w><w>row</w><w>in</w><w>the</w><w>column</w><pc>.</pc></s><s xml:id="s_wj4KR2"><w>The</w><w>JSON</w><w>response</w><w>can</w><w>then</w><w>be</w><w>parsed</w><w>with</w><w>GREL</w><w>using</w><w>the</w><w>methods</w><w>demonstrated</w><w>in</w><emph><w>Example</w><w>2</w></emph><w>(</w><w>for</w><w>example</w><w>,</w><code rend="inline"><w>value.parseJson</w><w>(</w><w>)</w><w>[</w><w>'label</w><w>'</w><w>]</w></code><w>)</w><pc>.</pc></s></p><p><s xml:id="s_7X53cn"><w>Given</w><w>the</w><w>small</w><w>expression</w><w>window</w><w>and</w><w>uniform</w><w>data</w><w>,</w><w>the</w><w>script</w><w>above</w><w>is</w><w>pragmatically</w><w>simplified</w><w>and</w><w>compressed</w><pc>.</pc></s><s xml:id="s_rjbeNF"><w>When</w><w>Refine</w><w>is</w><w>encountering</w><w>problems</w><w>,</w><w>it</w><w>is</w><w>better</w><w>to</w><w>implement</w><w>a</w><w>more</w><w>complete</w><w>script</w><w>with</w><w>error</w><w>handling</w><pc>.</pc></s><s xml:id="s_eTFWaS"><w>If</w><w>necessary</w><w>,</w><w>a</w><w>throttle</w><w>delay</w><w>can</w><w>be</w><w>implemented</w><w>by</w><w>importing</w><code rend="inline"><w>time</w></code><w>and</w><w>adding</w><code rend="inline"><w>time.sleep</w><w>(</w><w>)</w></code><w>to</w><w>the</w><w>script</w><pc>.</pc></s><s xml:id="s_jUkWNV"><w>For</w><w>example</w><w>,</w><w>the</w><w>POST</w><w>request</w><w>could</w><w>be</w><w>rewritten</w><w>:</w></s></p><ab><code xml:id="code_fetch-and-parse-data-with-openrefine_13" corresp="code_fetch-and-parse-data-with-openrefine_13.txt" rend="block"/></ab><quote><p><s xml:id="s_p9ikWn"><w>Some</w><w>APIs</w><w>require</w><w>authentication</w><w>tokens</w><w>to</w><w>be</w><w>passed</w><w>with</w><w>the</w><w>POST</w><w>request</w><w>as</w><w>data</w><w>or</w><w>headers</w><pc>.</pc></s><s xml:id="s_N4faWV"><w>Headers</w><w>can</w><w>be</w><w>added</w><w>as</w><w>the</w><w>third</w><w>parameter</w><w>of</w><code rend="inline"><w>urllib2.Request</w><w>(</w><w>)</w></code><w>similar</w><w>to</w><w>how</w><w>data</w><w>was</w><w>added</w><w>in</w><w>the</w><w>example</w><w>above</w><pc>.</pc></s><s xml:id="s_RTc2vG"><w>Check</w><w>the</w><w>Python</w><ref target="https://docs.python.org/2/library/urllib2.html"><w>urllib2</w><w>documentation</w></ref><w>and</w><ref target="https://docs.python.org/2/howto/urllib2.html"><w>how-to</w></ref><w>for</w><w>advanced</w><w>options</w><pc>.</pc></s></p><p><s xml:id="s_dLljdO"><w>When</w><w>harvesting</w><w>web</w><w>content</w><w>,</w><w>character</w><w>encoding</w><w>issues</w><w>commonly</w><w>produce</w><w>errors</w><w>in</w><w>Python</w><pc>.</pc></s><s xml:id="s_YczCMl"><w>Trimming</w><w>whitespace</w><w>,</w><w>using</w><w>GREL</w><code rend="inline"><w>escape</w><w>(</w><w>)</w></code><w>/</w><code rend="inline"><w>unescape</w><w>(</w><w>)</w></code><w>,</w><w>or</w><w>Jython</w><code rend="inline"><w>encode</w><w>(</w><w>``</w><w>utf-8</w><w>''</w><w>)</w></code><w>will</w><w>often</w><w>fix</w><w>the</w><w>problem</w><pc>.</pc></s></p></quote></div><div type="3" n="4.4"><head><s xml:id="s_odWQIP"><w>Compare</w><w>Sentiment</w></s></head><p><s xml:id="s_PTYitj"><w>To</w><w>practice</w><w>constructing</w><w>a</w><w>POST</w><w>request</w><w>,</w><w>read</w><w>the</w><w>documentation</w><w>for</w><ref target="http://sentiment.vivekn.com/docs/api/"><w>Sentiment</w><w>Tool</w></ref><w>,</w><w>another</w><w>free</w><w>API</w><pc>.</pc></s><s xml:id="s_KoHhno"><w>Find</w><w>the</w><w>service</w><w>URL</w><w>and</w><w>data</w><w>key</w><w>necessary</w><w>to</w><w>modify</w><w>the</w><w>Jython</w><w>pattern</w><w>above</w><pc>.</pc></s><s xml:id="s_gIQXkd"><w>Create</w><w>a</w><w>new</w><w>column</w><w>from</w><emph><w>first</w></emph><w>named</w><code rend="inline"><w>sentiment2</w></code><w>and</w><w>test</w><w>the</w><w>script</w><pc>.</pc></s></p><p><s xml:id="s_dPVyUM"><w>There</w><w>are</w><w>many</w><w>possible</w><w>ways</w><w>to</w><w>create</w><w>the</w><w>request</w><w>,</w><w>for</w><w>example</w><w>:</w></s></p><ab><code xml:id="code_fetch-and-parse-data-with-openrefine_14" corresp="code_fetch-and-parse-data-with-openrefine_14.txt" rend="block"/></ab><p><s xml:id="s_zYAtHt"><w>The</w><w>JSON</w><w>response</w><w>contains</w><w>different</w><w>metrics</w><w>,</w><w>but</w><w>it</w><w>will</w><w>be</w><w>obvious</w><w>that</w><w>the</w><w>APIs</w><w>disagree</w><w>on</w><w>many</w><w>of</w><w>the</w><w>sentiment</w><w>``</w><w>labels</w><w>''</w><w>(</w><w>for</w><w>example</w><w>,</w><w>use</w><code rend="inline"><w>value.parseJson</w><w>(</w><w>)</w><w>[</w><w>'result</w><w>'</w><w>]</w><w>[</w><w>'sentiment</w><w>'</w><w>]</w></code><w>to</w><w>extract</w><w>a</w><w>label</w><w>comparable</w><w>to</w><w>the</w><w>first</w><w>API</w><w>)</w><pc>.</pc></s><s xml:id="s_lvVR0p"><w>These</w><w>are</w><w>simple</w><w>free</w><w>APIs</w><w>for</w><w>demonstration</w><w>purposes</w><w>,</w><w>but</w><w>it</w><w>is</w><w>important</w><w>to</w><w>critically</w><w>investigate</w><w>services</w><w>to</w><w>more</w><w>fully</w><w>understand</w><w>the</w><w>potential</w><w>of</w><w>the</w><w>metrics</w><pc>.</pc></s></p><p><s xml:id="s_hawEWK"><w>Both</w><w>APIs</w><w>use</w><w>a</w><ref target="https://en.wikipedia.org/wiki/Naive_Bayes_classifier"><w>naive</w><w>bayes</w><w>classifier</w></ref><w>to</w><w>categorize</w><w>text</w><w>input</w><pc>.</pc></s><s xml:id="s_QD3zau"><w>These</w><w>models</w><w>must</w><w>be</w><w>trained</w><w>on</w><w>pre-labeled</w><w>data</w><w>and</w><w>will</w><w>be</w><w>most</w><w>accurate</w><w>on</w><w>similar</w><w>content</w><pc>.</pc></s><s xml:id="s_mcufpR"><w>Text</w><w>Processing</w><w>is</w><w>trained</w><w>on</w><w>twitter</w><w>and</w><w>movie</w><w>reviews</w><ref type="footnotemark" target="#en_note_1"/><w>,</w><w>and</w><w>Sentiment</w><w>Tool</w><w>on</w><w>IMDb</w><w>movie</w><w>reviews</w><ref type="footnotemark" target="#en_note_2"/><pc>.</pc></s><s xml:id="s_IuPHZJ"><w>Thus</w><w>both</w><w>are</w><w>optimized</w><w>for</w><w>small</w><w>chunks</w><w>of</w><w>modern</w><w>English</w><w>language</w><w>similar</w><w>to</w><w>a</w><w>review</w><w>,</w><w>with</w><w>a</w><w>limited</w><w>bag</w><w>of</w><w>words</w><w>used</w><w>to</w><w>determine</w><w>the</w><w>sentiment</w><w>probabilities</w><pc>.</pc></s></p><p><s xml:id="s_g9fsvp"><w>Archaic</w><w>words</w><w>and</w><w>phrases</w><w>contribute</w><w>significantly</w><w>to</w><w>the</w><w>sonnets</w><w>'</w><w>sentiment</w><w>,</w><w>yet</w><w>are</w><w>unlikely</w><w>to</w><w>be</w><w>given</w><w>any</w><w>weight</w><w>in</w><w>these</w><w>models</w><w>since</w><w>they</w><w>are</w><w>not</w><w>present</w><w>in</w><w>the</w><w>training</w><w>data</w><pc>.</pc></s><s xml:id="s_4BAjFu"><w>While</w><w>comparing</w><w>the</w><w>metrics</w><w>is</w><w>fascinating</w><w>,</w><w>neither</w><w>is</w><w>likely</w><w>to</w><w>produce</w><w>quality</w><w>results</w><w>for</w><w>this</w><w>data</w><w>set</w><pc>.</pc></s><s xml:id="s_oxELE1"><w>Rather</w><w>than</w><w>an</w><w>accurate</w><w>sentiment</w><w>,</w><w>we</w><w>might</w><w>be</w><w>surprised</w><w>to</w><w>find</w><w>a</w><w>quantifiable</w><w>dissonance</w><w>between</w><w>the</w><w>sonnet</w><w>'s</w><w>English</w><w>and</w><w>our</w><w>modern</w><w>web</w><w>usage</w><pc>.</pc></s><s xml:id="s_ipEXOn"><w>However</w><w>,</w><w>a</w><w>model</w><w>optimized</w><w>to</w><w>Shakespeare</w><w>'s</w><w>words</w><w>could</w><w>be</w><w>developed</w><w>using</w><w>more</w><w>appropriate</w><w>training</w><w>data</w><pc>.</pc></s><s xml:id="s_lYeoSo"><w>To</w><w>learn</w><w>more</w><w>about</w><w>classifiers</w><w>and</w><w>how</w><w>to</w><w>implement</w><w>one</w><w>,</w><w>see</w><w>Vilja</w><w>Hulden</w><w>'s</w><w>PH</w><w>lesson</w><ref target="/lessons/naive-bayesian"><w>``</w><w>Supervised</w><w>Classification</w><w>:</w><w>The</w><w>Naive</w><w>Bayesian</w><w>Returns</w><w>to</w><w>the</w><w>Old</w><w>Bailey</w><w>''</w></ref><w>or</w><w>Steven</w><w>Bird</w><w>,</w><w>Ewan</w><w>Klein</w><w>,</w><w>and</w><w>Edward</w><w>Loper</w><w>'s</w><ref target="http://www.nltk.org/book/ch06.html"><w>``</w><w>Learning</w><w>to</w><w>Classify</w><w>Text</w><w>''</w></ref><w>in</w><w>the</w><ref target="http://www.nltk.org/book/"><w>NTLK</w><w>Book</w></ref><pc>.</pc></s></p><p><s xml:id="s_4NhKlt"><w>Accessing</w><w>data</w><w>and</w><w>services</w><w>on</w><w>the</w><w>web</w><w>opens</w><w>new</w><w>possibilities</w><w>and</w><w>efficiencies</w><w>for</w><w>humanities</w><w>research</w><pc>.</pc></s><s xml:id="s_AmTKRd"><w>While</w><w>powerful</w><w>,</w><w>these</w><w>APIs</w><w>are</w><w>often</w><w>not</w><w>aimed</w><w>at</w><w>humanities</w><w>scholarship</w><w>and</w><w>may</w><w>not</w><w>be</w><w>appropriate</w><w>or</w><w>optimized</w><w>for</w><w>our</w><w>inquiries</w><pc>.</pc></s><s xml:id="s_wl9xbz"><w>The</w><w>training</w><w>data</w><w>may</w><w>be</w><w>incomplete</w><w>,</w><w>biased</w><w>,</w><w>or</w><w>secret</w><pc>.</pc></s><s xml:id="s_2dAoGz"><w>We</w><w>should</w><w>always</w><w>be</w><w>asking</w><w>questions</w><w>about</w><w>these</w><w>aggregations</w><w>and</w><w>algorithms</w><w>,</w><w>thinking</w><w>critically</w><w>about</w><w>the</w><w>metrics</w><w>they</w><w>are</w><w>capable</w><w>of</w><w>producing</w><pc>.</pc></s><s xml:id="s_mApUJC"><w>This</w><w>is</w><w>not</w><w>a</w><w>new</w><w>technical</w><w>skill</w><w>,</w><w>but</w><w>an</w><w>application</w><w>of</w><w>the</w><w>historian</w><w>'s</w><w>traditional</w><w>expertise</w><w>,</w><w>not</w><w>unlike</w><w>interrogating</w><w>physical</w><w>primary</w><w>materials</w><w>to</w><w>unravel</w><w>bias</w><w>and</w><w>read</w><w>between</w><w>the</w><w>lines</w><pc>.</pc></s><s xml:id="s_Ea9Rb6"><w>Humanities</w><w>scholars</w><w>routinely</w><w>synthesize</w><w>and</w><w>evaluate</w><w>convoluted</w><w>sources</w><w>to</w><w>tell</w><w>important</w><w>narratives</w><w>,</w><w>and</w><w>must</w><w>carry</w><w>that</w><w>skill</w><w>into</w><w>digital</w><w>realm</w><pc>.</pc></s><s xml:id="s_lPHKde"><w>We</w><w>can</w><w>critically</w><w>evaluate</w><w>data</w><w>sources</w><w>,</w><w>algorithms</w><w>,</w><w>and</w><w>API</w><w>services</w><w>,</w><w>as</w><w>well</w><w>as</w><w>create</w><w>new</w><w>ones</w><w>more</w><w>suited</w><w>to</w><w>our</w><w>questions</w><w>and</w><w>methods</w><pc>.</pc></s></p><p><s xml:id="s_FwCjzk"><w>With</w><w>its</w><w>unique</w><w>ability</w><w>to</w><w>interactively</w><w>wrangle</w><w>data</w><w>from</w><w>raw</w><w>aggregation</w><w>to</w><w>analysis</w><w>,</w><w>Refine</w><w>supports</w><w>exploratory</w><w>research</w><w>and</w><w>offers</w><w>a</w><w>wonderfully</w><w>fluid</w><w>and</w><w>playful</w><w>approach</w><w>to</w><w>tabular</w><w>data</w><pc>.</pc></s><s xml:id="s_KlTp0k"><w>OpenRefine</w><w>is</w><w>a</w><w>flexible</w><w>,</w><w>pragmatic</w><w>tool</w><w>that</w><w>simplifies</w><w>routine</w><w>tasks</w><w>and</w><w>,</w><w>when</w><w>combined</w><w>with</w><w>domain</w><w>knowledge</w><w>,</w><w>extends</w><w>research</w><w>capabilities</w><pc>.</pc></s></p><p><s xml:id="s_8A9LTh"><ref type="footnotemark" target="#en_note_1"/><w>:</w><w>Jacob</w><w>Perkins</w><w>,</w><w>``</w><w>Sentiment</w><w>Analysis</w><w>with</w><w>Python</w><w>NLTK</w><w>Text</w><w>Classification</w><w>''</w><w>,</w><ref target="http://text-processing.com/demo/sentiment/"><w>http</w><w>:</w><w>//text-processing.com/demo/sentiment/</w></ref><pc>.</pc></s><note xml:id="en_note_huynh"><s xml:id="s_OuRzxX"><w>David</w><w>Huynh</w><w>,</w><w>``</w><w>Google</w><w>Refine</w><w>''</w><w>,</w><w>Computer-Assisted</w><w>Reporting</w><w>Conference</w><w>2011</w><w>,</w><ref target="http://web.archive.org/web/20150528125345/http://davidhuynh.net/spaces/nicar2011/tutorial.pdf"><w>http</w><w>:</w><w>//web.archive.org/web/20150528125345/http</w><w>:</w><w>//davidhuynh.net/spaces/nicar2011/tutorial.pdf</w></ref><pc>.</pc></s></note><note xml:id="en_note_use"><s xml:id="s_G7ZZSk"><w>As</w><w>of</w><w>July</w><w>2017</w><w>,</w><w>see</w><ref target="http://text-processing.com/docs/index.html"><w>API</w><w>Documentation</w></ref><pc>.</pc></s></note><s xml:id="s_UIdp6U"><ref type="footnotemark" target="#en_note_2"/><w>:</w><w>Vivek</w><w>Narayanan</w><w>,</w><w>Ishan</w><w>Arora</w><w>,</w><w>and</w><w>Arjun</w><w>Bhatia</w><w>,</w><w>``</w><w>Fast</w><w>and</w><w>accurate</w><w>sentiment</w><w>classification</w><w>using</w><w>an</w><w>enhanced</w><w>Naive</w><w>Bayes</w><w>model</w><w>''</w><w>,</w><w>2013</w><w>,</w><ref target="https://arxiv.org/abs/1305.6143"><w>arXiv:1305.6143</w></ref><pc>.</pc></s></p></div></div></body>
    </text>
</TEI>
