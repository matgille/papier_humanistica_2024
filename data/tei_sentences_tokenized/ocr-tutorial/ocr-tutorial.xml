<TEI xmlns="http://www.tei-c.org/ns/1.0" xmlns:xi="http://www.w3.org/2001/XInclude" xml:id="ocr-tutorial" type="original" xml:base="ocr-tutorial/ocr-tutorial/ocr-tutorial.xml">
    <teiHeader>
        <fileDesc>
            <titleStmt>
                <title>OCR Tutorial</title>
            </titleStmt>
            <publicationStmt>
                <distributor>Programming Historian</distributor>
            </publicationStmt>
            <sourceDesc>
                <p>Born digital, in a markdown format. This lesson is original.</p>
            </sourceDesc>
        </fileDesc>
        <profileDesc/>
    </teiHeader>
    <text xml:lang="en">
        <body><div type="2" n="1"><head><w>Cleaning</w><w>OCR</w><w>Output</w></head><p><w>It</w><w>is</w><w>often</w><w>the</w><w>case</w><w>that</w><w>historians</w><w>involved</w><w>in</w><w>digital</w><w>projects</w><w>wish</w><w>to</w><w>work</w><w>with</w><w>digitized</w><w>texts</w><w>,</w><w>so</w><w>they</w><w>think</w><w>``</w><w>OK</w><w>,</w><w>I</w><w>'ll</w><w>just</w><w>scan</w><w>this</w><w>fabulously</w><w>rich</w><w>and</w><w>useful</w><w>collection</w><w>of</w><w>original</w><w>source</w><w>material</w><w>and</w><w>do</w><w>wonderful</w><w>things</w><w>with</w><w>the</w><w>digital</w><w>text</w><w>that</w><w>results</w><w>''</w><pc>.</pc><w>(</w><w>Those</w><w>of</w><w>us</w><w>who</w><w>have</w><w>done</w><w>this</w><w>,</w><w>now</w><w>smile</w><w>ruefully</w><w>)</w><pc>.</pc><w>Such</w><w>historians</w><w>quickly</w><w>discover</w><w>that</w><w>even</w><w>the</w><w>best</w><w>OCR</w><w>results</w><w>in</w><w>unacceptably</w><w>high</w><w>error</w><w>rates</w><pc>.</pc><w>So</w><w>the</w><w>historian</w><w>now</w><w>thinks</w><w>``</w><w>OK</w><w>I</w><w>'ll</w><w>get</w><w>some</w><w>grant</w><w>money</w><w>,</w><w>and</w><w>I</w><w>'ll</w><w>enlist</w><w>the</w><w>help</w><w>of</w><w>an</w><w>army</w><w>of</w><w>RAs/Grad</w><w>students/Undergrads/Barely</w><w>literate</w><w>street</w><w>urchins</w><w>,</w><w>to</w><w>correct</w><w>errors</w><w>in</w><w>my</w><w>OCR</w><w>output</w><pc>.</pc><w>(</w><w>We</w><w>smile</w><w>again</w><w>,</w><w>even</w><w>more</w><w>sadly</w><w>now</w><w>)</w><pc>.</pc></p><p><w>A.</w><w>there</w><w>is</w><w>little</w><w>funding</w><w>for</w><w>this</w><w>kind</w><w>of</w><w>thing</w><pc>.</pc><w>Creating</w><w>digital</w><w>texts</w><w>is</w><w>SO</w><w>1990s</w><pc>.</pc><w>Today</w><w>,</w><w>all</w><w>the</w><w>funding</w><w>for</w><w>projects</w><w>in</w><w>the</w><w>``</w><w>Digital</w><w>Humanities</w><w>''</w><w>is</w><w>devoted</w><w>to</w><w>NLP/Data</w><w>Mining/Machine</w><w>Learning/Graph</w><w>Analysis</w><w>,</w><w>or</w><w>what-have-you</w><pc>.</pc><w>And</w><w>besides</w><w>,</w><w>Google</w><w>scanned</w><w>all</w><w>that</w><w>stuff</w><w>did</w><w>n't</w><w>they</w><pc>?</pc><w>What</w><w>'s</w><w>the</w><w>matter</w><w>with</w><w>their</w><w>scans</w><pc>?</pc><w>(</w><w>see</w><w>2</w><w>)</w></p><p><w>and</w></p><p><w>2</w><pc>.</pc><w>Even</w><w>if</w><w>you</w><w>had</w><w>such</w><w>an</w><w>army</w><w>of</w><w>helpers</w><w>,</w><w>proof-reading</w><w>the</w><w>OCR</w><w>output</w><w>of</w><w>,</w><w>say</w><w>,</w><w>a</w><w>collection</w><w>of</w><w>twelfth</w><w>century</w><w>Italian</w><w>charters</w><w>transcribed</w><w>and</w><w>published</w><w>in</w><w>1935</w><w>,</w><w>will</w><w>quickly</w><w>drive</w><w>them</w><w>all</w><w>mad</w><w>,</w><w>make</w><w>their</w><w>eyes</w><w>bleed</w><w>,</w><w>and</w><w>the</w><w>result</w><w>will</w><w>still</w><w>be</w><w>a</w><w>great</w><w>wadj</w><w>of</w><w>text</w><w>containing</w><w>a</w><w>great</w><w>many</w><w>errors</w><w>,</w><w>and</w><w>you</w><w>will</w><hi rend="bold"><w>still</w></hi><w>have</w><w>to</w><w>do</w><hi rend="bold"><w>something</w></hi><w>to</w><w>it</w><w>before</w><w>it</w><w>becomes</w><w>useful</w><w>in</w><w>any</w><w>context</w><pc>.</pc></p><p><w>Going</w><w>through</w><w>a</w><w>text</w><w>file</w><w>line</w><w>by</w><w>line</w><w>and</w><w>correcting</w><w>OCR</w><w>errors</w><w>one</w><w>at</w><w>a</w><w>time</w><w>is</w><w>hugely</w><w>error-prone</w><w>,</w><w>as</w><w>any</w><w>proof</w><w>reader</w><w>will</w><w>tell</w><w>you</w><pc>.</pc><w>If</w><w>you</w><w>are</w><w>dealing</w><w>with</w><w>a</w><w>narrative</w><w>,</w><w>a</w><w>monograph</w><w>,</w><w>a</w><w>diary</w><w>,</w><w>or</w><w>something</w><w>like</w><w>that</w><w>,</w><w>a</w><w>great</w><w>deal</w><w>of</w><w>that</w><w>kind</w><w>of</w><w>proofing</w><w>will</w><w>be</w><w>unavoidable</w><w>;</w><w>however</w><w>,</w><w>if</w><w>what</w><w>you</w><w>have</w><w>is</w><w>an</w><w>ordered</w><w>collection</w><w>of</w><w>primary</w><w>source</w><w>documents</w><w>,</w><w>a</w><w>legal</w><w>code</w><w>say</w><w>,</w><w>or</w><w>a</w><w>cartulary</w><w>,</w><w>you</w><w>are</w><w>far</w><w>better</w><w>served</w><w>by</w><w>creating</w><w>an</w><w>ordered</w><w>data</w><w>structure</w><w>out</w><w>of</w><w>it</w><hi rend="bold"><w>first</w></hi><pc>.</pc><w>You</w><w>will</w><w>wind</w><w>up</w><w>with</w><w>data</w><w>that</w><w>is</w><w>useful</w><w>in</w><w>a</w><w>variety</w><w>of</w><w>contexts</w><w>,</w><w>even</w><w>before</w><w>your</w><w>army</w><w>of</w><w>street</w><w>urchins</w><w>starts</w><w>correcting</w><w>specific</w><w>OCR</w><w>typos</w><pc>.</pc></p><p><w>This</w><w>is</w><w>where</w><w>a</w><w>scripting</w><w>language</w><w>like</w><w>Python</w><w>comes</w><w>very</w><w>much</w><w>in</w><w>handy</w><pc>.</pc><w>For</w><w>our</w><w>project</w><w>we</w><w>wanted</w><w>to</w><w>prepare</w><w>some</w><w>of</w><w>the</w><w>documents</w><w>from</w><w>a</w><w>12th</w><w>century</w><w>collection</w><w>of</w><emph><w>imbreviatura</w></emph><w>from</w><w>the</w><w>Italian</w><w>scribe</w><w>known</w><w>as</w><ref target="http://www.worldcat.org/oclc/17591390"><w>Giovanni</w><w>Scriba</w></ref><w>so</w><w>that</w><w>they</w><w>could</w><w>be</w><w>marked</w><w>up</w><w>by</w><w>historians</w><w>for</w><w>subsequent</w><w>NLP</w><w>analysis</w><w>or</w><w>potentially</w><w>for</w><w>other</w><w>purposes</w><w>as</w><w>well</w><pc>.</pc><w>The</w><w>pages</w><w>of</w><w>the</w><w>1935</w><w>published</w><w>edition</w><w>look</w><w>like</w><w>this</w><pc>.</pc></p><p><figure><figDesc><w>GS</w><w>page</w><w>110</w></figDesc><graphic url="gs_pg110.png"/></figure></p><p><w>The</w><w>OCR</w><w>output</w><w>from</w><w>such</w><w>scans</w><w>look</w><w>like</w><w>this</w><w>even</w><w>after</w><w>some</w><w>substantial</w><w>clean-up</w><w>(</w><w>I</w><w>'ve</w><w>wrapped</w><w>the</w><w>longest</w><w>lines</w><w>so</w><w>that</w><w>they</w><w>fit</w><w>here</w><w>)</w><w>:</w></p><ab><code xml:id="code_ocr-tutorial_0" corresp="code_ocr-tutorial_0.txt" rend="block"/></ab><p><w>Not</w><w>pretty</w><w>eh</w><pc>?</pc></p><p><w>You</w><w>can</w><w>see</w><w>from</w><w>the</w><w>scan</w><w>that</w><w>each</w><w>charter</w><w>has</w><w>the</w><w>following</w><w>metadata</w><w>associated</w><w>with</w><w>it</w></p><list type="unordered"><item><w>Charter</w><w>number</w></item><item><w>Page</w><w>number</w></item><item><w>Folio</w><w>number</w></item><item><w>An</w><w>Italian</w><w>summary</w><w>,</w><w>ending</w><w>in</w><w>a</w><w>date</w><w>of</w><w>some</w><w>kind</w></item><item><w>A</w><w>line</w><w>,</w><w>usually</w><w>ending</w><w>with</w><w>a</w><w>'</w><w>]</w><w>'</w><w>that</w><w>marks</w><w>a</w><w>marginal</w><w>notation</w><w>in</w><w>the</w><w>original</w></item><item><w>Frequently</w><w>a</w><w>collection</w><w>of</w><w>in-text</w><w>numbered</w><w>footnote</w><w>markers</w><w>,</w><w>whose</w><w>text</w><w>appears</w><w>at</w><w>the</w><w>bottom</w><w>of</w><w>each</w><w>page</w><w>,</w><w>sequentially</w><w>numbered</w><w>,</w><w>and</w><w>restarting</w><w>from</w><w>1</w><w>on</w><w>each</w><w>new</w><w>page</w><pc>.</pc></item><item><w>The</w><w>Latin</w><w>text</w><w>of</w><w>the</w><w>charter</w><w>itself</w></item></list><p><w>This</w><w>is</w><w>typical</w><w>of</w><w>such</w><w>resources</w><w>,</w><w>though</w><w>editorial</w><w>conventions</w><w>will</w><w>vary</w><w>widely</w><pc>.</pc><w>The</w><w>point</w><w>is</w><w>:</w><w>this</w><w>is</w><w>an</w><hi rend="bold"><w>ordered</w></hi><w>data</w><w>set</w><w>,</w><w>not</w><w>just</w><w>a</w><w>great</w><w>big</w><w>string</w><w>of</w><w>characters</w><pc>.</pc><w>With</w><w>some</w><w>fairly</w><w>straightforward</w><w>Python</w><w>scripts</w><w>,</w><w>we</w><w>can</w><w>turn</w><w>our</w><w>OCR</w><w>output</w><w>into</w><w>an</w><w>ordered</w><w>data</w><w>set</w><w>,</w><w>in</w><w>this</w><w>case</w><w>,</w><w>a</w><w>python</w><w>dictionary</w><w>,</w><hi rend="bold"><w>before</w></hi><w>we</w><w>start</w><w>trying</w><w>to</w><w>proofread</w><w>the</w><w>Latin</w><w>charter</w><w>texts</w><pc>.</pc><w>With</w><w>such</w><w>an</w><w>ordered</w><w>data</w><w>set</w><w>in</w><w>hand</w><w>,</w><w>we</w><w>can</w><w>undertake</w><w>that</w><w>task</w><w>,</w><w>and</w><w>potentially</w><w>others</w><w>as</w><w>well</w><w>,</w><w>much</w><w>more</w><w>effectively</w><pc>.</pc></p><div type="3" n="1.1"><head><w>A</w><w>few</w><w>useful</w><w>functions</w><w>before</w><w>we</w><w>start</w><w>:</w></head><div type="4" n="1.1.1"><head><w>Levenshtein</w><w>distance</w></head><p><w>You</w><w>will</w><w>note</w><w>that</w><w>some</w><w>of</w><w>this</w><w>metadata</w><w>is</w><w>page-bound</w><w>and</w><w>some</w><w>of</w><w>it</w><w>is</w><w>charter-bound</w><pc>.</pc><w>Getting</w><w>these</w><w>untangled</w><w>from</w><w>each</w><w>other</w><w>is</w><w>our</w><w>aim</w><pc>.</pc><w>There</w><w>is</w><w>a</w><w>class</w><w>of</w><w>page-bound</w><w>data</w><w>that</w><w>is</w><w>useless</w><w>for</w><w>our</w><w>purposes</w><w>,</w><w>and</w><w>only</w><w>meaningful</w><w>in</w><w>the</w><w>context</w><w>of</w><w>a</w><w>physical</w><w>book</w><w>:</w><w>page</w><w>headers</w><w>and</w><w>footers</w><pc>.</pc><w>Unfortunately</w><w>,</w><w>regular</w><w>expressions</w><w>wo</w><w>n't</w><w>help</w><w>you</w><w>much</w><w>here</w><pc>.</pc><w>This</w><w>text</w><w>can</w><w>appear</w><w>on</w><w>any</w><w>line</w><w>,</w><w>and</w><w>the</w><w>ways</w><w>in</w><w>which</w><w>OCR</w><w>software</w><w>can</w><w>foul</w><w>it</w><w>up</w><w>are</w><w>effectively</w><w>limitless</w><pc>.</pc><w>Here</w><w>are</w><w>some</w><w>examples</w><w>of</w><w>page</w><w>headers</w><w>,</w><w>both</w><emph><w>recto</w></emph><w>and</w><emph><w>verso</w></emph><w>in</w><w>our</w><w>raw</w><w>OCR</w><w>output</w><pc>.</pc></p><ab><code xml:id="code_ocr-tutorial_1" corresp="code_ocr-tutorial_1.txt" rend="block"/></ab><p><w>These</w><w>strings</w><w>are</w><w>not</w><w>regular</w><w>enough</w><w>to</w><w>reliably</w><w>find</w><w>with</w><w>regular</w><w>expressions</w><w>;</w><w>however</w><w>,</w><w>if</w><w>you</w><w>know</w><w>what</w><w>the</w><w>strings</w><w>are</w><w>supposed</w><w>to</w><w>look</w><w>like</w><w>,</w><w>you</w><w>can</w><w>compose</w><w>some</w><w>kind</w><w>of</w><w>string</w><w>similarity</w><w>algorithm</w><w>to</w><w>test</w><w>each</w><w>string</w><w>against</w><w>an</w><w>exemplar</w><w>and</w><w>measure</w><w>the</w><w>likelihood</w><w>that</w><w>it</w><w>is</w><w>a</w><w>page</w><w>header</w><pc>.</pc><w>Fortunately</w><w>,</w><w>I</w><w>did</w><w>n't</w><w>have</w><w>to</w><w>compose</w><w>such</w><w>an</w><w>algorithm</w><w>,</w><w>Vladimir</w><w>Levenshtein</w><w>did</w><w>it</w><w>for</w><w>us</w><w>in</w><w>1965</w><w>(</w><w>see</w><w>:</w><ref target="http://en.wikipedia.org/wiki/Levenshtein_distance"><w>http</w><w>:</w><w>//en.wikipedia.org/wiki/Levenshtein_distance</w></ref><w>)</w><pc>.</pc><w>A</w><w>computer</w><w>language</w><w>can</w><w>encode</w><w>this</w><w>algorithm</w><w>in</w><w>any</w><w>number</w><w>of</w><w>ways</w><w>,</w><w>here</w><w>'s</w><w>an</w><w>effective</w><w>Python</w><w>function</w><w>that</w><w>will</w><w>work</w><w>for</w><w>us</w><w>:</w></p><ab><code lang="language-python" xml:id="code_ocr-tutorial_2" corresp="code_ocr-tutorial_2.txt" rend="block"/></ab><p><w>There</w><w>'s</w><w>a</w><w>lot</w><w>of</w><w>calculation</w><w>going</w><w>on</w><w>there</w><pc>.</pc><w>It</w><w>is</w><w>n't</w><w>very</w><w>efficient</w><w>to</w><w>call</w><code rend="inline"><w>lev</w><w>(</w><w>)</w></code><w>on</w><w>every</w><w>line</w><w>in</w><w>our</w><w>text</w><w>,</w><w>but</w><w>we</w><w>do</w><w>n't</w><w>really</w><w>care</w><pc>.</pc><w>We</w><w>'ve</w><w>only</w><w>got</w><w>803</w><w>charters</w><w>in</w><w>vol</w><pc>.</pc><w>1</w><pc>.</pc><w>That</w><w>'s</w><w>a</w><w>pretty</w><w>small</w><w>number</w><pc>.</pc><w>If</w><w>it</w><w>takes</w><w>30</w><w>seconds</w><w>to</w><w>run</w><w>our</w><w>script</w><w>,</w><w>so</w><w>be</w><w>it</w><pc>.</pc></p></div><div type="4" n="1.1.2"><head><w>Roman</w><w>to</w><w>Arabic</w><w>numerals</w></head><p><w>You</w><w>'ll</w><w>also</w><w>note</w><w>that</w><w>the</w><w>published</w><w>edition</w><w>numbers</w><w>the</w><w>charters</w><w>with</w><w>roman</w><w>numerals</w><pc>.</pc><w>Converting</w><w>roman</w><w>numerals</w><w>into</w><w>arabic</w><w>is</w><w>an</w><w>instructive</w><w>puzzle</w><w>to</w><w>work</w><w>out</w><w>in</w><w>Python</w><pc>.</pc><w>Here</w><w>'s</w><w>the</w><w>cleanest</w><w>and</w><w>most</w><w>elegant</w><w>solution</w><w>I</w><w>know</w><w>:</w></p><ab><code lang="language-python" xml:id="code_ocr-tutorial_3" corresp="code_ocr-tutorial_3.txt" rend="block"/></ab></div></div><div type="3" n="1.2"><head><w>A</w><w>couple</w><w>of</w><w>other</w><w>things</w><w>we</w><w>'ll</w><w>need</w><w>:</w></head><p><w>At</w><w>the</w><w>top</w><w>of</w><w>your</w><w>Python</w><w>module</w><w>,</w><w>you</w><w>'re</w><w>going</w><w>to</w><w>want</w><w>to</w><code rend="inline"><w>import</w><w>re</w></code><pc>.</pc><w>Regular</w><w>expressions</w><w>are</w><w>your</w><w>friend</w><pc>.</pc><w>However</w><w>,</w><w>bear</w><w>in</w><w>mind</w><w>Jamie</w><w>Zawinski</w><w>'s</w><w>quip</w><w>:</w></p><quote><p><w>Some</w><w>people</w><w>,</w><w>when</w><w>confronted</w><w>with</w><w>a</w><w>problem</w><w>,</w><w>think</w><w>``</w><w>I</w><w>know</w><w>,</w><w>I</w><w>'ll</w><w>use</w><w>regular</w><w>expressions</w><pc>.</pc><w>''</w><w>Now</w><w>they</w><w>have</w><w>two</w><w>problems</w><pc>.</pc></p></quote><p><w>Also</w><w>:</w><code rend="inline"><w>from</w><w>pprint</w><w>import</w><w>pprint</w></code><w>because</w><w>python</w><w>dictionaries</w><w>are</w><w>much</w><w>easier</w><w>to</w><w>read</w><w>if</w><w>they</w><w>are</w><w>formatted</w><pc>.</pc></p><p><w>And</w><w>:</w><code rend="inline"><w>from</w><w>collections</w><w>import</w><w>Counter</w></code><pc>.</pc><w>Not</w><w>really</w><w>necessary</w><w>,</w><w>but</w><w>the</w><w>collections</w><w>module</w><w>in</w><w>the</w><w>standard</w><w>Python</w><w>library</w><w>has</w><w>lots</w><w>of</w><w>time-saving</w><w>stuff</w><w>like</w><w>this</w><pc>.</pc></p><div type="4" n="1.2.1"><head><w>some</w><w>global</w><w>variables</w><w>:</w></head><p><code rend="inline"><w>romstr</w></code><w>is</w><w>crude</w><w>,</w><w>You</w><w>'ll</w><w>think</w><w>of</w><w>something</w><w>better</w><pc>.</pc><w>By</w><w>using</w><w>romstr.match</w><w>(</w><w>)</w><w>we</w><w>can</w><w>find</w><w>only</w><w>matches</w><w>at</w><w>the</w><w>beginning</w><w>of</w><w>lines</w><pc>.</pc><w>And</w><w>searching</w><w>line</w><w>by</w><w>line</w><w>,</w><w>we</w><w>can</w><w>find</w><w>Roman</w><w>numerals</w><w>that</w><w>are</w><w>on</w><w>a</w><w>line</w><w>by</w><w>themselves</w><w>,</w><w>which</w><w>is</w><w>what</w><w>we</w><w>want</w><pc>.</pc></p><ab><code lang="language-python" xml:id="code_ocr-tutorial_4" corresp="code_ocr-tutorial_4.txt" rend="block"/></ab><p><w>Once</w><w>we</w><w>'ve</w><w>figured</w><w>out</w><w>our</w><w>charter</w><w>numbers</w><w>,</w><w>we</w><w>'re</w><w>going</w><w>to</w><w>provide</w><w>each</w><w>charter</w><w>with</w><w>an</w><w>easy-to-find</w><w>slug</w><w>to</w><w>chunk</w><w>the</w><w>text</w><w>up</w><w>with</w><w>:</w></p><ab><code lang="language-python" xml:id="code_ocr-tutorial_5" corresp="code_ocr-tutorial_5.txt" rend="block"/></ab><p><code rend="inline"><w>fol</w></code><w>is</w><w>a</w><w>description</w><w>of</w><w>how</w><w>folio</w><w>markers</w><hi rend="bold"><w>should</w></hi><w>look</w><pc>.</pc><w>OCR</w><w>can</w><w>mangle</w><w>them</w><w>in</w><w>surprising</w><w>ways</w></p><ab><code lang="language-python" xml:id="code_ocr-tutorial_6" corresp="code_ocr-tutorial_6.txt" rend="block"/></ab><p><code rend="inline"><w>n</w></code><w>is</w><w>an</w><w>all-purpose</w><w>counter</w></p><ab><code lang="language-python" xml:id="code_ocr-tutorial_7" corresp="code_ocr-tutorial_7.txt" rend="block"/></ab></div></div></div><div type="2" n="2"><head><w>Iterative</w><w>processing</w><w>of</w><w>text</w><w>files</w></head><p><w>For</w><w>the</w><w>first</w><w>several</w><w>operations</w><w>we</w><w>'re</w><w>going</w><w>to</w><w>want</w><w>to</w><w>produce</w><w>new</w><w>and</w><w>revised</w><w>text</w><w>files</w><w>to</w><w>use</w><w>as</w><w>input</w><w>for</w><w>our</w><w>subsequent</w><w>operations</w><w>in</w><w>order</w><w>to</w><w>keep</w><w>track</w><w>of</w><w>our</w><w>progress</w><w>,</w><w>and</w><w>go</w><w>back</w><w>to</w><w>an</w><w>earlier</w><w>stage</w><w>when</w><w>things</w><w>go</w><w>haywire</w><w>,</w><w>as</w><w>they</w><w>certainly</w><w>will</w><w>do</w><pc>.</pc><w>The</w><w>code</w><w>here</w><w>is</w><w>highly</w><w>edited</w><pc>.</pc><w>As</w><w>you</w><w>continue</w><w>to</w><w>refine</w><w>your</w><w>text</w><w>files</w><w>,</w><w>you</w><w>will</w><w>write</w><w>lots</w><w>of</w><w>little</w><emph><w>ad</w><w>hoc</w></emph><w>scripts</w><w>to</w><w>check</w><w>on</w><w>the</w><w>efficacy</w><w>of</w><w>what</w><w>you</w><w>'ve</w><w>done</w><w>so</w><w>far</w><pc>.</pc></p><div type="3" n="2.1"><head><w>Chunk</w><w>up</w><w>the</w><w>text</w><w>by</w><w>pages</w></head><p><w>We</w><w>want</w><w>to</w><w>find</w><w>all</w><w>the</w><w>page</w><w>headers</w><w>,</w><w>both</w><emph><w>recto</w></emph><w>and</w><emph><w>verso</w></emph><w>and</w><w>replace</w><w>them</w><w>with</w><w>consistent</w><w>strings</w><w>that</w><w>we</w><w>can</w><w>easily</w><w>find</w><w>with</w><w>a</w><w>regular</w><w>expression</w><pc>.</pc><w>The</w><w>following</w><w>code</w><w>looks</w><w>for</w><w>lines</w><w>that</w><w>are</w><w>similar</w><w>to</w><w>what</w><w>we</w><w>know</w><w>are</w><w>our</w><w>page</w><w>headers</w><w>to</w><w>within</w><w>a</w><w>certain</w><w>threshold</w><pc>.</pc><w>It</w><w>will</w><w>take</w><w>some</w><w>experimentation</w><w>to</w><w>find</w><w>what</w><w>this</w><w>threshold</w><w>is</w><w>for</w><w>your</w><w>text</w><pc>.</pc><w>Since</w><w>my</w><emph><w>recto</w></emph><w>and</w><emph><w>verso</w></emph><w>headers</w><w>are</w><w>roughly</w><w>the</w><w>same</w><w>length</w><w>,</w><w>both</w><w>have</w><w>the</w><w>same</w><w>similarity</w><w>score</w><w>of</w><w>26</w><pc>.</pc><w>Your</w><w>milage</w><w>will</w><w>vary</w><pc>.</pc><w>Nota</w><w>Bene</w><w>:</w><w>the</w><w>shorter</w><w>the</w><w>page</w><w>header</w><w>string</w><w>,</w><w>the</w><w>more</w><w>likely</w><w>it</w><w>is</w><w>that</w><w>this</w><w>trick</w><w>will</w><w>not</w><w>work</w><pc>.</pc></p><p><w>the</w><code rend="inline"><w>print</w></code><w>statements</w><w>will</w><w>write</w><w>to</w><w>std</w><w>out</w><pc>.</pc><w>Use</w><w>them</w><w>to</w><w>test</w><w>until</w><w>you</w><w>have</w><w>a</w><w>Levenshtein</w><w>score</w><w>that</w><w>finds</w><w>all</w><w>,</w><w>or</w><w>most</w><w>,</w><w>of</w><w>the</w><w>page</w><w>headers</w><pc>.</pc><w>Once</w><w>you</w><w>'ve</w><w>got</w><w>that</w><w>,</w><w>then</w><w>uncomment</w><w>the</w><code rend="inline"><w>fout.write</w><w>(</w><w>)</w></code><w>lines</w><w>and</w><w>write</w><w>your</w><w>result</w><w>out</w><w>to</w><w>a</w><w>new</w><w>file</w><pc>.</pc></p><ab><code lang="language-python" xml:id="code_ocr-tutorial_8" corresp="code_ocr-tutorial_8.txt" rend="block"/></ab><p><w>Note</w><w>that</w><w>for</w><w>many</w><w>of</w><w>these</w><w>operations</w><w>,</w><w>we</w><w>use</w><code rend="inline"><w>GScriba</w><w>=</w><w>fin.readlines</w><w>(</w><w>)</w></code><w>so</w><code rend="inline"><w>GScriba</w></code><w>will</w><w>be</w><w>a</w><hi rend="bold"><w>python</w><w>list</w></hi><w>of</w><w>the</w><w>lines</w><w>in</w><w>our</w><w>input</w><w>text</w><pc>.</pc><w>Keep</w><w>this</w><w>firmly</w><w>in</w><w>mind</w><w>,</w><w>as</w><w>the</w><code rend="inline"><w>for</w></code><w>loops</w><w>that</w><w>we</w><w>will</w><w>use</w><w>will</w><w>depend</w><w>on</w><w>the</w><w>fact</w><w>that</w><w>we</w><w>will</w><w>iterate</w><w>through</w><w>the</w><w>lines</w><w>of</w><w>our</w><w>text</w><hi rend="bold"><w>In</w><w>Document</w><w>Order</w></hi><pc>.</pc></p></div><div type="3" n="2.2"><head><w>Chunk</w><w>up</w><w>the</w><w>text</w><w>by</w><w>charter</w><w>(</w><w>or</w><w>sections</w><w>,</w><w>or</w><w>letters</w><w>,</w><w>or</w><w>what-have-you</w><w>)</w></head><p><w>This</w><w>script</w><w>will</w><w>look</w><w>for</w><w>capital</w><w>roman</w><w>numerals</w><w>that</w><w>appear</w><w>on</w><w>a</w><w>line</w><w>by</w><w>itself</w><pc>.</pc><w>Many</w><w>of</w><w>our</w><w>charter</w><w>numbers</w><w>will</w><w>fail</w><w>that</w><w>test</w><w>and</w><w>the</w><w>script</w><w>will</w><w>report</w><code rend="inline"><w>there</w><w>'s</w><w>a</w><w>charter</w><w>roman</w><w>numeral</w><w>missing</w><pc>?</pc></code><w>,</w><w>often</w><w>because</w><w>there</w><w>'s</w><w>something</w><w>before</w><w>or</w><w>after</w><w>it</w><w>on</w><w>the</w><w>line</w><w>;</w><w>or</w><w>,</w><code rend="inline"><w>KeyError</w></code><w>,</w><w>often</w><w>because</w><w>the</w><w>OCR</w><w>has</w><w>garbled</w><w>the</w><w>characters</w><w>(</w><w>e.g</w><pc>.</pc><w>CCG</w><w>for</w><w>300</w><w>,</w><w>or</w><w>XVIIl</w><w>for</w><w>18</w><w>etc</w><w>)</w><pc>.</pc><w>Run</w><w>this</w><w>script</w><w>repeatedly</w><w>,</w><w>correcting</w><code rend="inline"><w>out1.txt</w></code><w>as</w><w>you</w><w>do</w><w>until</w><w>all</w><w>the</w><w>charters</w><w>are</w><w>accounted</w><w>for</w><pc>.</pc></p><ab><code lang="language-python" xml:id="code_ocr-tutorial_9" corresp="code_ocr-tutorial_9.txt" rend="block"/></ab><p><w>Then</w><w>write</w><w>out</w><w>a</w><w>new</w><w>file</w><w>with</w><w>an</w><w>easy-to-find-by-regex</w><w>string</w><w>for</w><w>each</w><w>charter</w><w>in</w><w>place</w><w>of</w><w>the</w><w>bare</w><w>Roman</w><w>Numeral</w></p><ab><code lang="language-python" xml:id="code_ocr-tutorial_10" corresp="code_ocr-tutorial_10.txt" rend="block"/></ab><p><w>While</w><w>it</w><w>'s</w><w>important</w><w>in</w><w>itself</w><w>for</w><w>us</w><w>to</w><w>have</w><w>our</w><w>OCR</w><w>output</w><w>reliably</w><w>divided</w><w>up</w><w>by</w><w>page</w><w>and</w><w>by</w><w>charter</w><w>,</w><w>the</w><w>most</w><w>important</w><w>thing</w><w>about</w><w>these</w><w>initial</w><w>operations</w><w>is</w><w>that</w><w>you</w><w>know</w><w>how</w><w>many</w><w>pages</w><w>there</w><w>are</w><w>,</w><w>and</w><w>how</w><w>many</w><w>charters</w><w>there</w><w>are</w><w>,</w><w>and</w><w>you</w><w>can</w><w>use</w><w>that</w><w>knowledge</w><w>to</w><w>check</w><w>on</w><w>subsequent</w><w>operations</w><pc>.</pc><w>If</w><w>you</w><w>want</w><w>to</w><w>do</w><w>something</w><w>to</w><w>every</w><w>charter</w><w>,</w><w>you</w><w>can</w><w>reliably</w><w>test</w><w>whether</w><w>or</w><w>not</w><w>it</w><w>worked</w><w>because</w><w>you</w><w>can</w><w>count</w><w>the</w><w>number</w><w>of</w><w>charters</w><w>that</w><w>it</w><w>worked</w><w>on</w><pc>.</pc></p></div><div type="3" n="2.3"><head><w>A</w><w>very</w><w>brief</w><w>review</w><w>of</w><w>regular</w><w>expressions</w><w>as</w><w>they</w><w>are</w><w>implemented</w><w>in</w><w>python</w></head><p><w>L.T</w><pc>.</pc><w>O'Hara</w><w>'s</w><ref target="/lessons/cleaning-ocrd-text-with-regular-expressions.html"><w>introduction</w></ref><w>to</w><w>using</w><w>python</w><w>flavored</w><w>regular</w><w>expressions</w><w>is</w><w>invaluable</w><pc>.</pc><w>In</w><w>this</w><w>context</w><w>we</w><w>should</w><w>review</w><w>a</w><w>couple</w><w>of</w><w>basic</w><w>facts</w><w>about</w><w>Python</w><w>'s</w><w>implementation</w><w>of</w><w>regular</w><w>expressions</w><w>,</w><w>the</w><code rend="inline"><w>re</w></code><w>module</w><w>,</w><w>which</w><w>is</w><w>part</w><w>of</w><w>Python</w><w>'s</w><w>standard</w><w>library</w><pc>.</pc></p><list type="ordered"><item><code rend="inline"><w>re.compile</w><w>(</w><w>)</w></code><w>creates</w><w>a</w><w>regular</w><w>expression</w><w>object</w><w>that</w><w>has</w><w>a</w><w>number</w><w>of</w><w>methods</w><pc>.</pc><w>You</w><w>should</w><w>be</w><w>familiar</w><w>with</w><code rend="inline"><w>.match</w><w>(</w><w>)</w></code><w>,</w><w>and</w><code rend="inline"><w>.search</w><w>(</w><w>)</w></code><w>,</w><w>but</w><w>also</w><code rend="inline"><w>.findall</w><w>(</w><w>)</w></code><w>and</w><code rend="inline"><w>.finditer</w><w>(</w><w>)</w></code></item><item><w>Bear</w><w>in</w><w>mind</w><w>the</w><w>difference</w><w>between</w><code rend="inline"><w>.match</w><w>(</w><w>)</w></code><w>and</w><code rend="inline"><w>.search</w><w>(</w><w>)</w></code><w>:</w><code rend="inline"><w>.match</w><w>(</w><w>)</w></code><w>will</w><w>only</w><w>match</w><w>at</w><w>the</w><hi rend="bold"><w>beginning</w></hi><w>of</w><w>a</w><w>line</w><w>,</w><w>whereas</w><code rend="inline"><w>.search</w><w>(</w><w>)</w></code><w>will</w><w>match</w><w>anywhere</w><w>in</w><w>the</w><w>line</w><hi rend="bold"><w>but</w><w>then</w><w>it</w><w>stops</w></hi><w>,</w><w>it</w><w>'ll</w><hi rend="bold"><w>only</w></hi><w>return</w><w>the</w><w>first</w><w>match</w><w>it</w><w>finds</w><pc>.</pc></item><item><code rend="inline"><w>.match</w><w>(</w><w>)</w></code><w>and</w><code rend="inline"><w>.search</w><w>(</w><w>)</w></code><w>return</w><w>match</w><w>objects</w><w>,</w><w>to</w><w>retrieve</w><w>the</w><w>matched</w><w>string</w><w>you</w><w>need</w><code rend="inline"><w>match.group</w><w>(</w><w>0</w><w>)</w></code><pc>.</pc><w>If</w><w>your</w><w>compiled</w><w>regular</w><w>expression</w><w>has</w><w>grouping</w><w>parentheses</w><w>in</w><w>it</w><w>(</w><w>like</w><w>our</w><w>'slug</w><w>'</w><w>regex</w><w>above</w><w>)</w><w>,</w><w>you</w><w>can</w><w>retrieve</w><w>those</w><w>substrings</w><w>of</w><w>the</w><w>matched</w><w>string</w><w>using</w><code rend="inline"><w>match.group</w><w>(</w><w>1</w><w>)</w></code><w>etc</w><pc>.</pc></item><item><code rend="inline"><w>.findall</w><w>(</w><w>)</w></code><w>and</w><code rend="inline"><w>.finditer</w><w>(</w><w>)</w></code><w>will</w><w>return</w><hi rend="bold"><w>all</w></hi><w>occurances</w><w>of</w><w>the</w><w>matched</w><w>string</w><w>;</w><code rend="inline"><w>.findall</w><w>(</w><w>)</w></code><w>returns</w><w>them</w><w>as</w><w>a</w><w>list</w><w>of</w><w>strings</w><w>,</w><w>but</w><w>.finditer</w><w>(</w><w>)</w><w>returns</w><w>an</w><hi rend="bold"><w>iterator</w><w>of</w><w>match</w><w>objects</w></hi><pc>.</pc></item></list></div><div type="3" n="2.4"><head><w>Find</w><w>and</w><w>normalize</w><w>folio</w><w>markers</w></head><p><w>Many</w><w>of</w><w>the</w><w>folio</w><w>markers</w><w>(</w><w>e.g</w><pc>.</pc><w>[</w><w>fo</w><pc>.</pc><w>16</w><w>v.</w><w>]</w><w>)</w><w>appear</w><w>on</w><w>the</w><w>same</w><w>line</w><w>as</w><w>the</w><w>roman</w><w>numeral</w><w>for</w><w>the</w><w>charter</w><w>heading</w><pc>.</pc><w>To</w><w>normalize</w><w>those</w><w>charter</w><w>headings</w><w>for</w><w>the</w><w>operation</w><w>above</w><w>we</w><w>had</w><w>to</w><w>put</w><w>a</w><w>line</w><w>break</w><w>between</w><w>the</w><w>folio</w><w>marker</w><w>and</w><w>the</w><w>charter</w><w>number</w><w>,</w><w>so</w><w>many</w><w>of</w><w>the</w><w>folio</w><w>markers</w><w>are</w><w>on</w><w>their</w><w>own</w><w>line</w><w>already</w><pc>.</pc><w>However</w><w>,</w><w>sometimes</w><w>the</w><w>folio</w><w>changes</w><w>in</w><w>the</w><w>middle</w><w>of</w><w>the</w><w>charter</w><w>text</w><w>somewhere</w><pc>.</pc><w>We</w><w>want</w><w>these</w><w>markers</w><w>to</w><w>stay</w><w>where</w><w>they</w><w>are</w><pc>.</pc><w>We</w><w>need</w><w>to</w><w>make</w><w>sure</w><w>all</w><w>the</w><w>folio</w><w>markers</w><w>are</w><w>free</w><w>of</w><w>errors</w><w>so</w><w>that</w><w>we</w><w>can</w><w>find</w><w>them</w><w>by</w><w>means</w><w>of</w><w>a</w><w>regular</w><w>expression</w><pc>.</pc><w>Again</w><w>,</w><w>since</w><w>we</w><w>know</w><w>how</w><w>many</w><w>folios</w><w>there</w><w>are</w><w>,</w><w>we</w><w>can</w><w>know</w><w>if</w><w>we</w><w>'ve</w><w>found</w><w>them</w><w>all</w><pc>.</pc><w>Note</w><w>that</w><w>since</w><w>we</w><w>used</w><code rend="inline"><w>.readlines</w><w>(</w><w>)</w></code><w>,</w><w>GScriba</w><w>is</w><w>a</w><w>list</w><w>,</w><w>so</w><w>the</w><w>script</w><w>below</w><w>will</w><w>print</w><w>the</w><w>line</w><w>number</w><w>from</w><w>the</w><w>sourcefile</w><w>as</w><w>well</w><w>as</w><w>the</w><w>line</w><w>itself</w><pc>.</pc><w>This</w><w>will</w><w>report</w><w>all</w><w>the</w><w>correctly</w><w>formated</w><w>folio</w><w>markers</w><w>,</w><w>so</w><w>that</w><w>you</w><w>can</w><w>find</w><w>and</w><w>fix</w><w>the</w><w>ones</w><w>that</w><w>are</w><w>broken</w><pc>.</pc></p><ab><code lang="language-python" xml:id="code_ocr-tutorial_11" corresp="code_ocr-tutorial_11.txt" rend="block"/></ab><p><w>We</w><w>would</w><w>also</w><w>like</w><w>to</w><w>ensure</w><w>that</w><w>no</w><w>line</w><w>has</w><w>more</w><w>than</w><w>one</w><w>folio</w><w>marker</w><pc>.</pc><w>We</w><w>can</w><w>test</w><w>that</w><w>like</w><w>this</w><w>:</w></p><ab><code lang="language-python" xml:id="code_ocr-tutorial_12" corresp="code_ocr-tutorial_12.txt" rend="block"/></ab></div><div type="3" n="2.5"><head><w>Find</w><w>and</w><w>normalize</w><w>the</w><w>Italian</w><w>summary</w><w>lines</w><pc>.</pc></head><p><w>This</w><w>important</w><w>line</w><w>is</w><w>invariably</w><w>the</w><w>first</w><w>one</w><w>after</w><w>the</w><w>charter</w><w>heading</w><pc>.</pc><w>Since</w><w>those</w><w>headings</w><w>are</w><w>now</w><w>reliably</w><w>findable</w><w>,</w><w>we</w><w>can</w><w>look</w><w>at</w><w>the</w><w>line</w><w>that</w><w>appears</w><w>immediately</w><w>after</w><w>it</w><pc>.</pc><w>We</w><w>also</w><w>know</w><w>that</w><w>the</w><w>summaries</w><w>always</w><w>end</w><w>with</w><w>some</w><w>kind</w><w>of</w><w>parenthesized</w><w>date</w><w>expression</w><pc>.</pc><w>So</w><w>,</w><w>we</w><w>can</w><w>compose</w><w>a</w><w>regular</w><w>expression</w><w>to</w><w>find</w><w>the</w><w>slug</w><w>and</w><w>the</w><w>line</w><w>following</w><w>:</w></p><ab><code lang="language-python" xml:id="code_ocr-tutorial_13" corresp="code_ocr-tutorial_13.txt" rend="block"/></ab><p><w>Because</w><w>our</w><w>OCR</w><w>has</w><w>a</w><w>lot</w><w>of</w><w>mysterious</w><w>whitespace</w><w>(</w><w>newlines</w><w>,</w><w>tabs</w><w>,</w><w>spaces</w><w>,</w><w>all</w><w>mixed</w><w>up</w><w>without</w><w>rhyme</w><w>or</w><w>reason</w><w>)</w><w>,</w><w>we</w><w>want</w><w>to</w><w>hunt</w><w>for</w><w>these</w><w>as</w><w>substrings</w><w>of</w><w>a</w><w>great</w><w>big</w><w>string</w><w>,</w><w>so</w><w>we</w><w>'re</w><w>going</w><w>to</w><w>use</w><code rend="inline"><w>.read</w><w>(</w><w>)</w></code><w>instead</w><w>of</w><code rend="inline"><w>.readlines</w><w>(</w><w>)</w></code><pc>.</pc><w>And</w><w>we</w><w>'ll</w><w>also</w><w>need</w><w>a</w><w>counter</w><w>to</w><w>keep</w><w>track</w><w>of</w><w>the</w><w>lines</w><w>we</w><w>find</w><pc>.</pc><w>This</w><w>script</w><w>will</w><w>report</w><w>the</w><w>charter</w><w>numbers</w><w>where</w><w>the</w><w>first</w><w>line</w><w>does</w><w>not</w><w>conform</w><w>to</w><w>our</w><w>regex</w><w>model</w><pc>.</pc></p><ab><code lang="language-python" xml:id="code_ocr-tutorial_14" corresp="code_ocr-tutorial_14.txt" rend="block"/></ab></div><div type="3" n="2.6"><head><w>Find</w><w>and</w><w>normalize</w><w>footnote</w><w>markers</w><w>and</w><w>texts</w></head><p><w>One</w><w>of</w><w>the</w><w>trickiest</w><w>bits</w><w>to</w><w>untangle</w><w>,</w><w>is</w><w>the</w><w>infuriating</w><w>editorial</w><w>convention</w><w>of</w><w>restarting</w><w>the</w><w>foonote</w><w>numbering</w><w>with</w><w>each</w><w>new</w><w>page</w><pc>.</pc><w>This</w><w>makes</w><w>it</w><w>hard</w><w>to</w><w>associate</w><w>a</w><w>footnote</w><w>text</w><w>(</w><w>page-bound</w><w>data</w><w>)</w><w>,</w><w>with</w><w>a</w><w>footnote</w><w>marker</w><w>(</w><w>charter-bound</w><w>data</w><w>)</w><pc>.</pc><w>Before</w><w>we</w><w>can</w><w>do</w><w>that</w><w>we</w><w>have</w><w>to</w><w>ensure</w><w>that</w><w>each</w><w>footnote</w><w>text</w><w>that</w><w>appears</w><w>at</w><w>the</w><w>bottom</w><w>of</w><w>the</w><w>page</w><w>,</w><w>appears</w><w>in</w><w>our</w><w>sourcefile</w><w>on</w><w>its</w><w>own</w><w>separate</w><w>line</w><w>with</w><w>no</w><w>leading</w><w>white-space</w><pc>.</pc><w>And</w><w>that</w><hi rend="bold"><w>none</w></hi><w>of</w><w>the</w><w>footnote</w><w>markers</w><w>within</w><w>the</w><w>text</w><w>appears</w><w>at</w><w>the</w><w>beginning</w><w>of</w><w>a</w><w>line</w><pc>.</pc><w>And</w><w>we</w><w>must</w><w>ensure</w><w>that</w><w>every</w><w>footnote</w><w>string</w><w>,</w><w>``</w><w>(</w><w>1</w><w>)</w><w>''</w><w>for</w><w>example</w><w>,</w><w>appears</w><hi rend="bold"><w>exactly</w></hi><w>twice</w><w>on</w><w>a</w><w>page</w><w>:</w><w>once</w><w>as</w><w>an</w><w>in-text</w><w>marker</w><w>,</w><w>and</w><w>once</w><w>at</w><w>the</w><w>bottom</w><w>for</w><w>the</w><w>footnote</w><w>text</w><pc>.</pc><w>The</w><w>following</w><w>script</w><w>reports</w><w>the</w><w>page</w><w>number</w><w>of</w><w>any</w><w>page</w><w>that</w><w>fails</w><w>that</w><w>test</w><w>,</w><w>along</w><w>with</w><w>a</w><w>list</w><w>of</w><w>the</w><w>footnote</w><w>strings</w><w>it</w><w>found</w><w>on</w><w>that</w><w>page</w><pc>.</pc></p><ab><code lang="language-python" xml:id="code_ocr-tutorial_15" corresp="code_ocr-tutorial_15.txt" rend="block"/></ab></div></div><div type="2" n="3"><head><w>Generating</w><w>an</w><w>ordered</w><w>data</w><w>set</w><w>from</w><w>a</w><w>text</w><w>file</w></head><p><w>Now</w><w>that</w><w>we</w><w>'ve</w><w>cleaned</w><w>up</w><hi rend="bold"><w>only</w></hi><w>those</w><w>OCR</w><w>errors</w><w>that</w><w>we</w><w>have</w><w>to</w><w>,</w><w>we</w><w>can</w><w>sort</w><w>the</w><w>various</w><w>bits</w><w>of</w><w>the</w><w>meta-data</w><w>,</w><w>and</w><w>the</w><w>charter</w><w>text</w><w>itself</w><w>into</w><w>their</w><w>own</w><w>separate</w><w>fields</w><w>of</w><w>a</w><w>Python</w><w>dictionary</w><pc>.</pc><w>We</w><w>have</w><w>a</w><w>number</w><w>of</w><w>things</w><w>to</w><w>do</w><w>:</w><w>correctly</w><w>number</w><w>each</w><w>charter</w><w>as</w><w>to</w><w>charter</w><w>number</w><w>,</w><w>folio</w><w>,</w><w>and</w><w>page</w><w>;</w><w>separate</w><w>out</w><w>the</w><w>Italian</w><w>summary</w><w>and</w><w>the</w><w>marginal</w><w>notation</w><w>lines</w><w>;</w><w>and</w><w>associate</w><w>the</w><w>footnote</w><w>texts</w><w>with</w><w>their</w><w>appropriate</w><w>charter</w><pc>.</pc></p><p><w>The</w><w>following</w><code rend="inline"><w>for</w></code><w>loop</w><w>will</w><w>generate</w><w>a</w><w>python</w><w>dictionary</w><w>for</w><w>each</w><w>charter</w><w>and</w><w>then</w><w>populate</w><w>it</w><w>with</w><w>the</w><w>available</w><w>metadata</w><w>fields</w><pc>.</pc><w>Once</w><w>this</w><w>loop</w><w>disposes</w><w>of</w><w>the</w><w>easily</w><w>searched</w><w>lines</w><w>(</w><w>folio</w><w>,</w><w>page</w><w>,</w><w>and</w><w>charter</w><w>header</w><w>)</w><w>,</w><w>the</w><w>fall-through</w><w>default</w><w>will</w><w>be</w><w>to</w><w>add</w><w>the</w><w>remaining</w><w>lines</w><w>to</w><w>the</w><w>text</w><w>field</w><w>,</w><w>which</w><w>is</w><w>a</w><w>python</w><w>list</w><pc>.</pc></p><ab><code lang="language-python" xml:id="code_ocr-tutorial_16" corresp="code_ocr-tutorial_16.txt" rend="block"/></ab><div type="3" n="3.1"><head><w>Find</w><w>and</w><w>normalize</w><w>the</w><w>'marginal</w><w>notation</w><w>'</w><w>and</w><w>Italian</w><w>summary</w><w>lines</w></head><p><w>Now</w><w>that</w><w>we</w><w>have</w><w>a</w><w>python</w><w>dictionary</w><w>to</w><w>work</w><w>with</w><w>,</w><w>rather</w><w>than</w><w>a</w><w>list</w><w>of</w><w>lines</w><w>of</w><w>text</w><w>,</w><w>we</w><w>'re</w><w>not</w><w>bound</w><w>to</w><w>work</w><w>in</w><w>document</w><w>order</w><pc>.</pc><w>Once</w><w>we</w><w>have</w><w>a</w><w>data</w><w>structure</w><w>like</w><w>that</w><w>,</w><w>we</w><w>can</w><w>iterate</w><w>through</w><w>each</w><w>of</w><w>the</w><w>charter</w><w>dictionaries</w><w>and</w><w>look</w><w>at</w><w>the</w><w>lines</w><w>in</w><w>the</w><w>text</w><w>field</w><w>by</w><w>index</w><w>number</w><pc>.</pc><w>We</w><w>can</w><w>do</w><w>that</w><w>with</w><w>a</w><w>loop</w><w>like</w><w>the</w><w>one</w><w>below</w><pc>.</pc><w>In</w><w>all</w><w>cases</w><w>,</w><w>the</w><w>first</w><w>line</w><w>of</w><w>each</w><w>charter</w><w>'s</w><w>text</w><w>field</w><w>should</w><w>be</w><w>the</w><w>Italian</w><w>summary</w><w>as</w><w>we</w><w>have</w><w>insured</w><w>above</w><pc>.</pc><w>The</w><w>second</w><w>line</w><w>in</w><w>MOST</w><w>cases</w><w>,</w><w>represents</w><w>a</w><w>kind</w><w>of</w><w>marginal</w><w>notation</w><w>usually</w><w>ended</w><w>by</w><w>the</w><w>'</w><w>]</w><w>'</w><w>character</w><w>(</w><w>which</w><w>OCR</w><w>misreads</w><w>a</w><w>lot</w><w>)</w><pc>.</pc><w>We</w><w>have</w><w>to</w><w>find</w><w>the</w><w>cases</w><w>that</w><w>do</w><w>not</w><w>meet</w><w>this</w><w>criterion</w><w>,</w><w>supply</w><w>or</w><w>correct</w><w>the</w><w>missing</w><w>'</w><w>]</w><w>'</w><w>,</w><w>and</w><w>in</w><w>the</w><w>cases</w><w>where</w><w>there</w><w>is</w><w>no</w><w>marginal</w><w>notation</w><w>I</w><w>'ve</w><w>supplied</w><w>``</w><w>no</w><w>marginal</w><w>]</w><w>''</w><w>in</w><w>my</w><w>working</w><w>text</w><pc>.</pc><w>The</w><w>following</w><w>script</w><w>will</w><w>print</w><w>the</w><w>charter</w><w>number</w><w>and</w><w>first</w><w>two</w><w>lines</w><w>of</w><w>the</w><w>text</w><w>field</w><w>for</w><w>those</w><w>charters</w><w>that</w><w>do</w><w>not</w><w>meet</w><w>these</w><w>criteria</w><pc>.</pc></p><ab><code lang="language-python" xml:id="code_ocr-tutorial_17" corresp="code_ocr-tutorial_17.txt" rend="block"/></ab><p><w>The</w><code rend="inline"><w>try</w><w>:</w><w>except</w><w>:</w></code><w>blocks</w><w>are</w><w>made</w><w>necessary</w><w>by</w><w>the</w><w>fact</w><w>that</w><w>in</w><w>my</w><w>OCR</w><w>output</w><w>,</w><w>the</w><w>data</w><w>for</w><w>pg</w><w>214</w><w>somehow</w><w>got</w><w>missed</w><w>out</w><w>,</w><w>but</w><w>they</w><w>'re</w><w>generally</w><w>a</w><w>good</w><w>idea</w><pc>.</pc><w>You</w><w>will</w><w>inevitably</w><w>have</w><w>anomalies</w><w>in</w><w>your</w><w>text</w><w>that</w><w>you</w><w>will</w><w>have</w><w>to</w><w>isolate</w><w>and</w><w>work</w><w>around</w><pc>.</pc><w>Python</w><w>is</w><w>very</w><w>helpful</w><w>here</w><w>in</w><w>that</w><w>you</w><w>can</w><w>do</w><w>a</w><w>lot</w><w>more</w><w>in</w><w>the</w><code rend="inline"><w>except</w><w>:</w></code><w>clause</w><w>beyond</w><w>just</w><w>printing</w><w>``</w><w>oops</w><w>''</w><pc>.</pc><w>You</w><w>could</w><w>call</w><w>a</w><w>function</w><w>that</w><w>performs</w><w>a</w><w>whole</w><w>separate</w><w>operation</w><w>on</w><w>those</w><w>anomalous</w><w>bits</w><pc>.</pc></p><p><w>Once</w><w>we</w><w>'re</w><w>satisfied</w><w>that</w><w>line</w><w>1</w><w>and</w><w>line</w><w>2</w><w>in</w><w>the</w><w>'text</w><w>'</w><w>field</w><w>for</w><w>each</w><w>charter</w><w>are</w><w>the</w><w>Italian</w><w>Summary</w><w>and</w><w>the</w><w>marginal</w><w>notation</w><w>respectively</w><w>,</w><w>we</w><w>can</w><w>make</w><w>another</w><w>iteration</w><w>of</w><w>the</w><w>charters</w><w>dictionary</w><w>,</w><w>removing</w><w>those</w><w>lines</w><w>from</w><w>the</w><w>text</w><w>field</w><w>and</w><w>creating</w><w>new</w><w>fields</w><w>in</w><w>the</w><w>charter</w><w>entry</w><w>for</w><w>them</w><pc>.</pc><w>NOTA</w><w>BENE</w><w>:</w><w>we</w><w>are</w><w>now</w><w>modifying</w><w>a</w><w>data</w><w>structure</w><w>in</w><w>memory</w><w>rather</w><w>than</w><w>editing</w><w>successive</w><w>text</w><w>files</w><pc>.</pc></p><ab><code lang="language-python" xml:id="code_ocr-tutorial_18" corresp="code_ocr-tutorial_18.txt" rend="block"/></ab><p><w>#</w><w>#</w><w>Assign</w><w>footnotes</w><w>to</w><w>their</w><w>respective</w><w>charters</w><w>and</w><w>add</w><w>to</w><w>metadata</w><w>The</w><w>trickiest</w><w>part</w><w>is</w><w>to</w><w>get</w><w>the</w><w>footnote</w><w>texts</w><w>appearing</w><w>at</w><w>the</w><w>bottom</w><w>of</w><w>the</w><w>page</w><w>associated</w><w>with</w><w>their</w><w>appropriate</w><w>charters</w><pc>.</pc><w>For</w><w>this</w><w>we</w><w>go</w><w>back</w><w>to</w><w>the</w><w>same</w><w>list</w><w>of</w><w>lines</w><w>that</w><w>we</w><w>built</w><w>the</w><w>dictionary</w><w>from</w><pc>.</pc><w>We</w><w>'re</w><w>depending</w><w>on</w><w>all</w><w>the</w><w>footnote</w><w>markers</w><w>appearing</w><w>within</w><w>the</w><w>charter</w><w>text</w><w>,</w><w>i.e</w><pc>.</pc><w>none</w><w>of</w><w>them</w><w>are</w><w>at</w><w>the</w><w>beginning</w><w>of</w><w>a</w><w>line</w><pc>.</pc><w>And</w><w>,</w><w>each</w><w>of</w><w>the</w><w>footnote</w><w>texts</w><w>is</w><w>on</w><w>a</w><w>separate</w><w>line</w><w>beginning</w><w>with</w><w>'</w><w>(</w><w>1</w><w>)</w><w>'</w><w>etc</w><pc>.</pc><w>We</w><w>design</w><w>regexes</w><w>that</w><w>can</w><w>distinguish</w><w>between</w><w>the</w><w>two</w><w>and</w><w>construct</w><w>a</w><w>container</w><w>to</w><w>hold</w><w>them</w><w>as</w><w>we</w><w>iterate</w><w>over</w><w>the</w><w>lines</w><pc>.</pc><w>As</w><w>we</w><w>iterate</w><w>over</w><w>the</w><w>lines</w><w>of</w><w>the</w><w>text</w><w>file</w><w>,</w><w>we</w><w>find</w><w>and</w><w>assign</w><w>markers</w><w>and</w><w>texts</w><w>to</w><w>our</w><w>temporary</w><w>container</w><w>,</w><w>and</w><w>then</w><w>,</w><w>each</w><w>time</w><w>we</w><w>reach</w><w>a</w><w>page</w><w>break</w><w>,</w><w>we</w><w>assign</w><w>them</w><w>to</w><w>their</w><w>appropriate</w><w>fields</w><w>in</w><w>our</w><w>existing</w><w>Python</w><w>dictionary</w><code rend="inline"><w>charters</w></code><w>and</w><w>reset</w><w>our</w><w>temporary</w><w>container</w><w>to</w><w>the</w><w>empty</w><code rend="inline"><w>dict</w></code><pc>.</pc></p><ab><code lang="language-python" xml:id="code_ocr-tutorial_19" corresp="code_ocr-tutorial_19.txt" rend="block"/></ab><p><w>Note</w><w>that</w><w>we</w><w>use</w><code rend="inline"><w>eval</w><w>(</w><w>)</w></code><w>because</w><w>we</w><w>want</w><w>to</w><w>turn</w><w>strings</w><w>like</w><w>this</w><w>'</w><w>(</w><w>1</w><w>)</w><w>'</w><w>into</w><w>integers</w><w>like</w><w>this</w><w>:</w><w>1</w><pc>.</pc></p></div><div type="3" n="3.2"><head><w>The</w><w>resulting</w><w>dictionary</w><w>looks</w><w>like</w><w>this</w></head><p><w>Print</w><w>out</w><w>our</w><w>resulting</w><w>dictionary</w><w>using</w><code rend="inline"><w>pprint</w><w>(</w><w>charters</w><w>)</w></code><w>and</w><w>you</w><w>'ll</w><w>see</w><w>something</w><w>like</w><w>this</w><w>:</w></p><ab><code lang="language-python" xml:id="code_ocr-tutorial_20" corresp="code_ocr-tutorial_20.txt" rend="block"/></ab><p><w>Printing</w><w>out</w><w>your</w><w>Python</w><w>dictionary</w><w>as</w><w>a</w><w>literal</w><w>string</w><w>is</w><w>not</w><w>a</w><w>bad</w><w>thing</w><w>to</w><w>do</w><pc>.</pc><w>For</w><w>a</w><w>text</w><w>this</w><w>size</w><w>,</w><w>the</w><w>resulting</w><w>file</w><w>is</w><w>perfectly</w><w>manageable</w><w>,</w><w>can</w><w>be</w><w>mailed</w><w>around</w><w>usefully</w><w>and</w><w>read</w><w>into</w><w>a</w><w>python</w><w>repl</w><w>session</w><w>very</w><w>simply</w><w>using</w><code rend="inline"><w>eval</w><w>(</w><w>)</w></code><w>,</w><w>or</w><w>pasted</w><w>directly</w><w>into</w><w>a</w><w>Python</w><w>module</w><w>file</w><pc>.</pc><w>On</w><w>the</w><w>other</w><w>hand</w><w>,</w><w>if</w><w>you</w><w>want</w><w>an</w><w>even</w><w>more</w><w>reliable</w><w>way</w><w>to</w><w>serialize</w><w>it</w><w>in</w><w>an</w><w>exclusively</w><w>Python</w><w>context</w><w>,</w><w>look</w><w>into</w><ref target="https://docs.python.org/2/library/pickle.html"><code rend="inline"><w>Pickle</w></code></ref><pc>.</pc><w>If</w><w>you</w><w>need</w><w>to</w><w>move</w><w>it</w><w>to</w><w>some</w><w>other</w><w>context</w><w>,</w><w>JavaScript</w><w>for</w><w>example</w><w>,</w><w>or</w><w>some</w><code rend="inline"><w>RDF</w></code><w>triple</w><w>stores</w><w>,</w><w>Python</w><w>'s</w><ref target="https://docs.python.org/2/library/json.html#module-json"><code rend="inline"><w>json</w></code></ref><w>module</w><w>will</w><w>translate</w><w>effectively</w><pc>.</pc><w>If</w><w>you</w><w>have</w><w>to</w><w>get</w><w>some</w><w>kind</w><w>of</w><w>XML</w><w>output</w><w>,</w><w>I</w><w>will</w><w>be</w><w>very</w><w>sorry</w><w>for</w><w>you</w><w>,</w><w>but</w><w>the</w><ref target="http://lxml.de/"><code rend="inline"><w>lxml</w></code></ref><w>python</w><w>module</w><w>may</w><w>ease</w><w>the</w><w>pain</w><w>a</w><w>little</w><pc>.</pc></p></div><div type="3" n="3.3"><head><w>Order</w><w>from</w><w>disorder</w><w>,</w><w>huzzah</w><pc>.</pc></head><p><w>Now</w><w>that</w><w>we</w><w>have</w><w>an</w><w>ordered</w><w>data</w><w>structure</w><w>,</w><w>we</w><w>can</w><w>do</w><w>many</w><w>things</w><w>with</w><w>it</w><pc>.</pc><w>As</w><w>a</w><w>very</w><w>simple</w><w>example</w><w>,</w><w>lets</w><w>just</w><w>print</w><w>it</w><w>out</w><w>as</w><w>html</w><w>for</w><w>display</w><w>on</w><w>a</w><w>web-site</w><w>:</w></p><ab><code lang="language-python" xml:id="code_ocr-tutorial_21" corresp="code_ocr-tutorial_21.txt" rend="block"/></ab><p><w>Drop</w><w>the</w><w>resulting</w><w>file</w><w>on</w><w>a</w><w>web</w><w>browser</w><w>,</w><w>and</w><w>you</w><w>'ve</w><w>got</w><w>a</w><w>nicely</w><w>formated</w><w>electronic</w><w>edition</w><pc>.</pc><w>Being</w><w>able</w><w>to</w><w>do</w><w>this</w><w>with</w><w>your</w><w>,</w><w>mostly</w><w>uncorrected</w><w>,</w><w>OCR</w><w>output</w><w>is</w><w>not</w><w>a</w><w>trivial</w><w>advantage</w><pc>.</pc><w>If</w><w>you</w><w>'re</w><w>serious</w><w>about</w><w>creating</w><w>a</w><w>clean</w><w>,</w><w>error</w><w>free</w><w>,</w><w>electronic</w><w>edition</w><w>of</w><w>anything</w><w>,</w><w>you</w><w>'ve</w><w>got</w><w>to</w><w>do</w><w>some</w><w>serious</w><w>proofreading</w><pc>.</pc><w>Having</w><w>a</w><w>source</w><w>text</w><w>formatted</w><w>for</w><w>reading</w><w>is</w><w>crucial</w><w>;</w><w>moreover</w><w>,</w><w>if</w><w>your</w><w>proofreader</w><w>can</w><w>change</w><w>the</w><w>font</w><w>,</w><w>spacing</w><w>,</w><w>color</w><w>,</w><w>layout</w><w>,</w><w>and</w><w>so</w><w>forth</w><w>at</w><w>will</w><w>,</w><w>you</w><w>can</w><w>increase</w><w>their</w><w>accuracy</w><w>and</w><w>productivity</w><w>substantially</w><pc>.</pc><w>With</w><w>this</w><w>example</w><w>in</w><w>a</w><w>modern</w><w>web</w><w>browser</w><w>,</w><w>tweaking</w><w>those</w><w>parameters</w><w>with</w><w>some</w><w>simple</w><w>css</w><w>declarations</w><w>is</w><w>easy</w><pc>.</pc><w>Also</w><w>,</w><w>with</w><w>some</w><w>ordered</w><w>HTML</w><w>to</w><w>work</w><w>with</w><w>,</w><w>you</w><w>might</w><w>crowd-source</w><w>the</w><w>OCR</w><w>error</w><w>correction</w><w>,</w><w>instead</w><w>of</w><w>hiring</w><w>that</w><w>army</w><w>of</w><w>illiterate</w><w>street</w><w>urchins</w><pc>.</pc></p><p><w>Beyond</w><w>this</w><w>though</w><w>,</w><w>there</w><w>'s</w><w>lots</w><w>you</w><w>can</w><w>do</w><w>with</w><w>an</w><w>ordered</w><w>data</w><w>set</w><w>,</w><w>including</w><w>feeding</w><w>it</w><w>back</w><w>through</w><w>a</w><w>markup</w><w>tool</w><w>like</w><w>the</w><ref target="http://brat.nlplab.org"><w>brat</w></ref><w>as</w><w>we</w><w>did</w><w>for</w><w>the</w><w>ChartEx</w><w>project</w><pc>.</pc><w>Domain</w><w>experts</w><w>can</w><w>then</w><w>start</w><w>adding</w><w>layers</w><w>of</w><w>semantic</w><w>tagging</w><w>even</w><w>if</w><w>you</w><w>do</w><w>n't</w><w>do</w><w>any</w><w>further</w><w>OCR</w><w>error</w><w>correction</w><pc>.</pc></p><p><w>The</w><w>bits</w><w>of</w><w>code</w><w>above</w><w>are</w><w>in</w><w>no</w><w>way</w><w>a</w><w>turn-key</w><w>solution</w><w>for</w><w>cleaning</w><w>arbitrary</w><w>OCR</w><w>output</w><pc>.</pc><w>There</w><w>is</w><w>no</w><w>such</w><w>magic</w><w>wand</w><pc>.</pc><w>The</w><w>Google</w><w>approach</w><w>to</w><w>scanning</w><w>the</w><w>contents</w><w>of</w><w>research</w><w>libraries</w><w>threatens</w><w>to</w><w>drown</w><w>us</w><w>in</w><w>an</w><w>ocean</w><w>of</w><w>bad</w><w>data</w><pc>.</pc><w>Worse</w><w>,</w><w>it</w><w>elides</w><w>a</w><w>fundamental</w><w>fact</w><w>of</w><w>digital</w><w>scholarship</w><w>:</w><w>digital</w><w>sources</w><w>are</w><w>hard</w><w>to</w><w>get</w><pc>.</pc><w>Reliable</w><w>,</w><w>flexible</w><w>,</w><w>and</w><w>useful</w><w>digital</w><w>texts</w><w>require</w><w>careful</w><w>redaction</w><w>and</w><w>persistent</w><w>curation</w><pc>.</pc><w>Google</w><w>,</w><w>Amazon</w><w>,</w><w>Facebook</w><w>,</w><emph><w>et</w><w>alia</w></emph><w>do</w><w>not</w><w>have</w><w>to</w><w>concern</w><w>themselves</w><w>with</w><w>the</w><w>quality</w><w>of</w><w>their</w><w>data</w><w>,</w><w>just</w><w>its</w><w>quantity</w><pc>.</pc><w>Historians</w><w>,</w><w>on</w><w>the</w><w>other</w><w>hand</w><w>,</w><w>must</w><w>care</w><w>first</w><w>for</w><w>the</w><w>integrity</w><w>of</w><w>their</w><w>sources</w><pc>.</pc></p><p><w>The</w><w>vast</w><w>18th</w><w>and</w><w>19th</w><w>century</w><w>publishing</w><w>projects</w><w>,</w><w>the</w><emph><w>Rolls</w><w>Series</w></emph><w>,</w><w>the</w><emph><w>Monumenta</w><w>Germaniae</w><w>Historica</w></emph><w>,</w><w>and</w><w>many</w><w>others</w><w>,</w><w>bequeathed</w><w>a</w><w>treasure</w><w>trove</w><w>of</w><w>source</w><w>material</w><w>to</w><w>us</w><w>by</w><w>dint</w><w>of</w><w>a</w><w>huge</w><w>amount</w><w>of</w><w>very</w><w>painstaking</w><w>and</w><w>detailed</w><w>work</w><w>by</w><w>armies</w><w>of</w><w>dedicated</w><w>and</w><w>knowledgeable</w><w>scholars</w><pc>.</pc><w>Their</w><w>task</w><w>was</w><w>the</w><w>same</w><w>as</w><w>ours</w><w>:</w><w>to</w><w>faithfully</w><w>transmit</w><w>history</w><w>'s</w><w>legacy</w><w>from</w><w>its</w><w>earlier</w><w>forms</w><w>into</w><w>a</w><w>more</w><w>modern</w><w>form</w><w>,</w><w>thereby</w><w>making</w><w>it</w><w>more</w><w>widely</w><w>accessible</w><pc>.</pc><w>We</w><w>can</w><w>do</w><w>no</w><w>less</w><pc>.</pc><w>We</w><w>have</w><w>powerful</w><w>tools</w><w>at</w><w>our</w><w>disposal</w><w>,</w><w>but</w><w>while</w><w>that</w><w>may</w><w>change</w><w>the</w><w>scale</w><w>of</w><w>the</w><w>task</w><w>,</w><w>it</w><w>does</w><w>not</w><w>change</w><w>its</w><w>nature</w><pc>.</pc></p></div></div></body>
    </text>
</TEI>
