<TEI xmlns="http://www.tei-c.org/ns/1.0" xml:id="visualizacao-animacao-tabelas-historicas-R">
    <teiHeader>
        <fileDesc>
            <titleStmt>
                <title>Visualização e animação de tabelas históricas com R</title>
                <author role="original_author">Marcelo Raimundo</author>
                <editor role="reviewers">
                    <persName>Jennifer Isasi</persName>
                    <persName>Basthian Medina</persName>
                </editor>
                <author role="translators">Diana Rebelo Rodriguez</author>
                <editor role="translation-reviewers">
                    <persName>Felipe Lamarca</persName>
                    <persName>Ana Giulia Aldgeire</persName>
                </editor>
                <editor role="editors">Riva Quiroga</editor>
            </titleStmt>
            <publicationStmt>
                <distributor>Programming Historian</distributor>
                <date type="translated">11/19/2021</date>
                <idno type="doi">10.46430/phpt0021</idno>
                <date type="published">06/28/2021</date>
            </publicationStmt>
            <sourceDesc>
                <p>Born digital, in a markdown format. Original file: <ref type="original_file" target="#visualizacion-y-animacion-de-tablas-historicas-con-R"/>.</p>
            </sourceDesc>
        </fileDesc>
        <profileDesc>
            <abstract>
                <p>Esta lição lhe mostrará como cruzar referências, produzir gráficos e animar um conjunto de dados históricos disponíveis numa tabela.</p>
            </abstract>
            <textClass>
                <keywords>
                    <term xml:lang="en">distant-reading</term>
                    <term xml:lang="en">r</term>
                    <term xml:lang="en">data-visualization</term>
                </keywords>
            </textClass>
        </profileDesc>
    </teiHeader>
    <text xml:lang="pt">
        <body>
            <div type="2">
                <head>Conteúdos</head>
                <p>{:.no_toc}</p>
                <list type="unordered">
                    <item>TOC
{:toc}</item>
                </list>
                <div type="1">
                    <head>Resumo</head>
                    <p>Esta lição lhe mostrará como cruzar, traçar e animar um conjunto de dados históricos. Vamos aprender como importar dados disponíveis em uma tabela eletrônica em <emph>RStudio</emph> e como utilizar funções que permitam transformar esses dados para representá-los como uma tabela de contingência. Também veremos como utilizar funções de novas bibliotecas que lhe permitirão visualizar os seus dados cruzados em forma gráfica e até mesmo animá-los em perspectiva de tempo.</p>
                </div>
                <div type="1">
                    <head>Objetivos</head>
                    <p>Nesta lição, aprenderemos a:</p>
                    <list type="ordered">
                        <item>Classificar e transformar tabelas históricas para realizar análises exploratórias;</item>
                        <item>Gerar gráficos estáticos e animados para visualizar dados históricos.</item>
                    </list>
                </div>
                <div type="1">
                    <head>Introdução</head>
                    <p>Não há dúvida de que em uma disciplina como a História, predomina o tratamento qualitativo dos documentos e das fontes que o passado nos legou. Mas, como Roderick Floud salientou, “embora estejamos basicamente mais interessados nas questões ‘qualitativas’ do que nas ‘quantitativas’, as duas estão inextricavelmente ligadas”<ref type="footnotemark" target="#pt_note_1"/>. Ou seja, elas não competem, não se substituem, mas se complementam. Uma maneira de combinar ambas as metodologias é através da busca de regularidades ou padrões ocultos ou, inversamente, de anomalias. Isto aproxima aqueles que fazem pesquisa histórica de uma melhor compreensão das coordenadas nas quais situar as suas interpretações. Se esta compreensão global dos dados puder ser visualizada graficamente, é possível “que o pesquisador descubra facilmente as relações, semelhanças e diferenças entre os seus casos”. Desde que Floud escreveu - em meados dos anos 70 - a tecnologia e a programação de computadores avançaram de tal forma que é muito fácil cruzar perspectivas metodológicas. Assim, se um trabalho histórico qualitativo visa aprofundar aspectos dos fenômenos que aconteceram no passado, um trabalho quantitativo permitirá saber com que frequência eles aconteceram, observar padrões e anomalias, e estabelecer relações temporais entre as diferentes categorias de análise existentes. </p>
                    <p>Quem pretende realizar uma análise histórica quantitativa deve começar com um exercício de codificação das fontes documentais que o passado nos legou e traduzi-las em uma matriz de dados. Em outras palavras, isto requer um processo de conversão de nossas fontes de informação, a fim de transformar dados textuais (palavras) em dados simbólicos (números) operáveis digitalmente. Isto consiste de várias etapas: 1) <emph>classificar</emph> os documentos que foram acessados de forma a permitir que sejam reunidos de acordo com determinados critérios, 2) <emph>categorizar</emph> o conteúdo das fontes de forma descritiva, interpretativa ou analítica, com ideias, categorias ou conceitos, 3) <emph>codificar</emph>, dando às diferentes expressões particulares de cada caso um símbolo (números, palavras), 4) <emph>tabular</emph>, ou seja, representar os casos organizados sob a forma de uma matriz em um meio de computador, geralmente uma tabela de cálculo.</p>
                    <p>Nesta lição, mostraremos uma das muitas maneiras pelas quais ficheiros que reúnem informações sistemáticas e seriadas (como casos de produtores de documentação permanente como o Estado, empresas ou a imprensa) podem ser analisados quantitativamente usando a linguagem de programação R. O objetivo é que se adquira conhecimentos que lhe permitam realizar uma análise exploratória dos dados, trabalhando principalmente na distribuição de frequências de diferentes variáveis através de tabelas de contingência, para depois visualizá-las, gerar gráficos e, finalmente, criar uma animação das mesmas em perspectiva temporal.</p>
                </div>
                <div type="1">
                    <head>Pré-requisitos</head>
                    <p>Esta lição exige um entendimento básico de R, que pode ser obtido nas lições <ref target="/pt/licoes/nocoes-basicas-R-dados-tabulares">Noções básicas de R com dados tabulares</ref> de Trayn Dewar e <ref target="/en/lessons/data_wrangling_and_management_in_R">Manipulação e transformação de dados em R</ref> (em inglês) de Nabeel Siddiqui.</p>
                    <p>Além do R, será necessário possuir o ambiente de desenvolvimento <ref target="https://www.rstudio.com/products/rstudio/download/#download">RStudio</ref> instalado. Se ainda não o tiver, <ref target="https://www.youtube.com/watch?v=A8A-OU_nlsw">este vídeo</ref> fornece um guia sobre como baixá-lo e instalá-lo.</p>
                </div>
                <head>Os dados explorados</head>
                <p>O conjunto de dados aqui apresentado nos ajudará a ver como R pode ajudá-lo a analisar a dinâmica da violência política na Argentina no final dos anos 50, com base em documentos de espionagem policial. Normalmente estes ficheiros de inteligência têm sido utilizados para o estudo histórico de casos particulares, mas raramente o objetivo tem sido alcançar graus de agregação que permitam fazer comparações entre diferentes casos. Dispor de alguns elementos básicos de programação facilita a tomada de medidas nessa direção.</p>
                <p>A fonte que propomos codificar é um ficheiro muito especial do acervo da antiga Diretoria de Inteligência da Polícia de Buenos Aires (Argentina). Ele contém vários relatórios de inteligência que dão conta de “atos terroristas” durante os anos do período de conflito político e social conhecido na história argentina como a “Resistência Peronista”<ref type="footnotemark" target="#pt_note_2"/>. Uma imagem digitalizada de um dos ficheiros é apresentada na Figura 1. O interessante é que a informação bruta é apresentada de uma forma que facilita sua tabulação.</p>
                <figure>
                    <desc>Figura 1. Imagem de um ficheiro com dados sobre os ataques</desc>
                    <graphic url="visualizacion-y-animacion-de-tablas-historicas-con-R1.jpg"/>
                </figure>
                <p>Este documento foi transformado em um conjunto de dados quantitativamente processáveis. Uma tabela foi construída a partir de informações sobre algumas localidades da província de Buenos Aires em 1959, um ano em que o número de "atos terroristas" ou ataques foi muito alto. Os dados representam os valores de certas variáveis de análise comuns a todos os registros, tais como a <emph>ciudad</emph> (onde) e a <emph>fecha</emph> do ataque (quando). A partir das informações descritivas da polícia (atributos do ataque), foi possível gerar variáveis como: <emph>objeto</emph> utilizado no ataque (com que elemento foi realizado), <emph>sitio</emph> (lugar/espaço) e <emph>objetivo</emph> (contra quem). Com esta categorização, procuramos salvar um passo, pois a tabela segue os preceitos de “dados ordenados” (<emph>tidy data</emph>): cada variável forma uma coluna, cada observação forma uma linha, cada valor tem a sua própria célula, cada tipo de unidade observacional forma uma tabela<ref type="footnotemark" target="#pt_note_3"/>.</p>
                <table>
                    <row>
                        <cell role="label">fecha</cell>
                        <cell role="label">ciudad</cell>
                        <cell role="label">objeto</cell>
                        <cell role="label">sitio</cell>
                        <cell role="label">objetivo</cell>
                    </row>
                    <row>
                        <cell>18/01/1959</cell>
                        <cell>La Plata</cell>
                        <cell>bomba</cell>
                        <cell>sede</cell>
                        <cell>institucion extranjera</cell>
                    </row>
                    <row>
                        <cell>19/01/1959</cell>
                        <cell>La Plata</cell>
                        <cell>petardo</cell>
                        <cell>vias ffcc</cell>
                        <cell>ferrocarril</cell>
                    </row>
                    <row>
                        <cell>19/01/1959</cell>
                        <cell>Matanza</cell>
                        <cell>bomba</cell>
                        <cell>vias ffcc</cell>
                        <cell>ferrocarril</cell>
                    </row>
                    <row>
                        <cell>20/01/1959</cell>
                        <cell>Avellaneda</cell>
                        <cell>molotov</cell>
                        <cell>comercio</cell>
                        <cell>comercio</cell>
                    </row>
                    <row>
                        <cell>20/01/1959</cell>
                        <cell>Avellaneda</cell>
                        <cell>bomba</cell>
                        <cell>vias ffcc</cell>
                        <cell>ferrocarril</cell>
                    </row>
                    <row>
                        <cell>20/01/1959</cell>
                        <cell>Lomas</cell>
                        <cell>bomba</cell>
                        <cell>vias ffcc</cell>
                        <cell>ferrocarril</cell>
                    </row>
                    <row>
                        <cell>20/01/1959</cell>
                        <cell>Matanza</cell>
                        <cell>bomba</cell>
                        <cell>vias ffcc</cell>
                        <cell>ferrocarril</cell>
                    </row>
                </table>
                <p>Para esta lição usaremos a tabela correspondente aos ataques em cinco cidades da Argentina durante 1959, que está disponível no ficheiro <ref target="/assets/visualizacion-y-animacion-de-tablas-historicas-con-R/atentados1959.xlsx">atentados1959.xlsx</ref>.</p>
                <div type="1">
                    <head>Processamento e limpeza de dados com R</head>
                    <p>Nesta seção mostraremos como carregar os dados no RStudio para começar a processá-los. Não espere que tudo esteja pronto para funcionar uma vez que a tabela tenha sido importada; sempre precisaremos ajustar seus dados para que R possa interpretá-los. Neste caso, por exemplo, após a importação, precisaremos atribuir um tipo às variáveis, convertê-las, fazer algumas modificações nos dados e, em seguida, ordená-las temporariamente.</p>
                    <p>O primeiro passo é importá-los de seu formato de tabela para o ambiente RStudio. Para fazer isso, será necessário primeiro instalar o pacote que lhe dará os recursos necessários: <ref target="https://readxl.tidyverse.org/">readxl</ref>^[4]. Este pacote faz parte da coleção de pacotes conhecidos como <ref target="https://www.tidyverse.org/">Tidyverse</ref>^[5], um dos mais utilizados para o tipo de análise que estamos propondo, pois permite realizar facilmente tarefas como leitura, transformação, processamento, manipulação, organização e visualização de diferentes tipos de dados. Além do <emph>readxl</emph>, ele contém vários dos pacotes que talvez sejam necessários mais tarde.</p>
                    <ab>
                        <code lang="language-R" xml:id="code_visualizacao-animacao-tabelas-historicas-R_0" corresp="code_visualizacao-animacao-tabelas-historicas-R_0.txt" rend="block"/>
                    </ab>
                    <p>A seguir, precisamos carregar tanto o pacote <emph>readxl</emph> quanto o pacote <emph>tidyverse</emph>. Embora o pacote <emph>readxl</emph> esteja contido dentro do último, ele precisa ser carregado separadamente.</p>
                    <ab>
                        <code lang="language-R" xml:id="code_visualizacao-animacao-tabelas-historicas-R_1" corresp="code_visualizacao-animacao-tabelas-historicas-R_1.txt" rend="block"/>
                    </ab>
                    <p>Agora temos condições de importar o conjunto de dados, usando a função <code rend="inline">read_excel()</code>. Esta função toma como argumento o nome do ficheiro onde está armazenada a tabela, assumindo que ela esteja em seu diretório de trabalho atual. Se não estiver em seu diretório de trabalho, será necessário especificar o caminho completo para o ficheiro. O conteúdo do ficheiro será atribuído a um novo objeto chamado <code rend="inline">at59</code>:</p>
                    <ab>
                        <code lang="language-R" xml:id="code_visualizacao-animacao-tabelas-historicas-R_2" corresp="code_visualizacao-animacao-tabelas-historicas-R_2.txt" rend="block"/>
                    </ab>
                    <p>É essencial entender de que forma as informações foram armazenadas. Em R tudo é um objeto e, dependendo das características dos dados importados, ele corresponderá a uma certa <emph>estrutura de dados</emph>. R lida com várias estruturas que diferem por terem diferentes números de dimensões e por poderem ou não armazenar dados de diferentes tipos. O mais conhecido é o <emph>vetor</emph>, que é uma coleção unidimensional de dados do mesmo tipo. Outra estrutura é a <emph>matriz</emph>, que é semelhante ao vetor, mas permite trabalhar em duas dimensões.</p>
                    <p>Além disso, R tem uma forma particular de estrutura de dados, que tem duas dimensões e nos dá a possibilidade de conter dados de diferentes tipos (inteiros junto com datas, caracteres, etc.). Esta estrutura é chamada <emph>data frame</emph>, e é composta de linhas e colunas; cada linha corresponde a uma observação ou registro, enquanto cada coluna é um vetor representando uma variável de análise. O <emph>data frame</emph> é uma das estruturas mais utilizadas em R e os dados que importamos de tabelas serão armazenados desta forma. É importante notar que muitas das funções Tidyverse (como <code rend="inline">read_excel()</code>) retornam um tipo particular de quadro de dados chamado <emph>tibble</emph>. A principal diferença entre os dois tipos é a forma como os dados são exibidos no console. O <emph>tibble</emph>, por exemplo, mostra abaixo do nome de cada variável qual é o seu tipo. É possível ver isso usando a função <code rend="inline">head()</code>, que exibe os seis primeiros registros de <code rend="inline">at59</code>. Então vemos que a data está no formato <emph>datetime</emph> (data e hora) e o resto das colunas são do tipo <emph>character</emph> (caractere).</p>
                    <ab>
                        <code lang="language-R" xml:id="code_visualizacao-animacao-tabelas-historicas-R_3" corresp="code_visualizacao-animacao-tabelas-historicas-R_3.txt" rend="block"/>
                    </ab>
                    <p>Com a tabela já carregada no <emph>RStudio</emph>, podemos começar a processar os dados. Assim, por exemplo, podemos começar a substituir certos valores da estrutura de dados para corrigir ou alterar maciçamente o conteúdo. Para este fim, usaremos a função <code rend="inline">ifelse()</code>, que permite selecionar elementos de uma estrutura de dados de acordo com o cumprimento ou não de uma condição. Esta função tira proveito da vetorização da linguagem R e permite que, ao aplicar uma função a um objeto, ela o faça em todos os seus elementos. Isto evita a necessidade de usar estruturas de repetição (<code rend="inline">for</code> ou <code rend="inline">while</code>, por exemplo) para atravessar as linhas. Recomenda-se realizar estas operações sobre os dados antes de realizar qualquer conversão sobre seu tipo.</p>
                    <p>Suponha que desejamos substituir todos os casos em que o objeto é listado como ”bomba” pelo termo “explosivo”. Para este fim, podemos usar a função <code rend="inline">ifelse()</code>, passando por apenas três argumentos. Primeiro, indicamos a condição a ser preenchida, neste caso, os valores “bomba” na coluna de <emph>objeto</emph> de <emph>at59</emph>, que é selecionada com o símbolo <code rend="inline">$</code>. O segundo argumento corresponde ao que a função atribuirá caso a condição seja cumprida: ela a substituirá por ”explosivo”. O terceiro argumento é o valor atribuído no caso negativo. Neste caso, manteremos o valor original:</p>
                    <ab>
                        <code lang="language-R" xml:id="code_visualizacao-animacao-tabelas-historicas-R_4" corresp="code_visualizacao-animacao-tabelas-historicas-R_4.txt" rend="block"/>
                    </ab>
                    <p>Caso se arrependa das mudanças, é possível fazer a mesma operação ao contrário:</p>
                    <ab>
                        <code lang="language-R" xml:id="code_visualizacao-animacao-tabelas-historicas-R_5" corresp="code_visualizacao-animacao-tabelas-historicas-R_5.txt" rend="block"/>
                    </ab>
                    <p>Em seguida, seria conveniente transformar os <emph>tipos</emph> de variáveis. Nesse caso, as alterações permitirão que se aproveite melhor as funções de visualização. Primeiro, como não importa que as datas também tenham a hora, podemos ajustar essa variável usando a função <code rend="inline">as.Date()</code> na coluna de <emph>data</emph>. Em segundo lugar, podemos transformar o resto das variáveis de análise em fatores, que é o tipo de dados que <emph>R</emph> fornece para trabalhar com <emph>variáveis categóricas</emph>, ou seja, aqueles que representam um conjunto fixo e conhecido de valores possíveis. Em seguida, devemos fazer algo idêntico com cada uma das quatro colunas restantes (<emph>ciudad</emph>, <emph>objeto</emph>, <emph>sitio</emph> e <emph>objetivo</emph>) e aplicar a função <code rend="inline">factor()</code> a elas. Em princípio, isso envolveria escrever cinco afirmações (uma para cada variável): <code rend="inline">variável &lt;- factor (variável)</code>. Se houver interesse em escrever um código limpo, um dos preceitos é evitar a repetição de sentenças caso elas não sejam necessárias e aproveitar o potencial oferecido pela linguagem que estamos usando. No caso de R, podemos fazer isso com funções que permitem que outras funções sejam aplicadas de forma generalizada a uma estrutura de dados.</p>
                    <p>Entre várias opções, lhe convidamos a usar <code rend="inline">map_df()</code> do pacote <emph>purrr</emph>^[6], que também faz parte do Tidyverse. <code rend="inline">map_df()</code> permite que se atribua uma função - que neste caso será a de alterar o tipo de dado - a vários elementos de um <emph>data frame</emph> e armazenar o resultado em um objeto dessa mesma classe. Como argumentos da função, primeiro indicamos o nome das colunas - em um formato vetorial com <code rend="inline">c()</code> - e, em seguida, a função que deseja aplicar a essas colunas. Para juntar o código de ambas as transformações em uma única instrução, usamos a função <code rend="inline">tibble()</code>. Isso resultará em um <emph>tibble</emph> com as colunas convertidas e organizadas como estavam originalmente:</p>
                    <ab>
                        <code lang="language-R" xml:id="code_visualizacao-animacao-tabelas-historicas-R_6" corresp="code_visualizacao-animacao-tabelas-historicas-R_6.txt" rend="block"/>
                    </ab>
                    <p>Para terminar esta etapa de limpeza e transformação de dados, é necessário organizar os dados cronologicamente. Para fazer isso, existe a função <code rend="inline">arrange()</code>, do pacote <emph>dplyr</emph>^[7], também parte do Tidyverse, o que lhe permitirá reordenar as linhas do quadro de dados. Por padrão, ele o faz em ordem ascendente, embora, como a maioria das funções em R, ele seja parametrizável e permita variações. Neste caso, a ordem ascendente é relevante, portanto não é possível usar a função diretamente. O primeiro argumento é o seu objeto de dados e o segundo argumento é a variável a ser usada como critério computacional. Se fizer isso por data, será necessário entrar:</p>
                    <ab>
                        <code lang="language-R" xml:id="code_visualizacao-animacao-tabelas-historicas-R_7" corresp="code_visualizacao-animacao-tabelas-historicas-R_7.txt" rend="block"/>
                    </ab>
                    <p>Com <code rend="inline">head()</code> podemos ver como o conjunto de dados está reorganizado e pronto para que possamos começar a analisá-lo.</p>
                    <ab>
                        <code lang="language-R" xml:id="code_visualizacao-animacao-tabelas-historicas-R_8" corresp="code_visualizacao-animacao-tabelas-historicas-R_8.txt" rend="block"/>
                    </ab>
                </div>
                <div type="1">
                    <head>Explorando os dados</head>
                    <p>Faremos agora uma <emph>análise exploratória</emph> básica de nossos dados históricos a fim de encontrar relações entre os casos de ataque incluídos no conjunto de dados. A ideia deste tipo de metodologia é identificar as principais características de um conjunto de dados (padrões, diferenças, tendências, anomalias, descontinuidades e distribuições), a fim de compreender sua <emph>variabilidade</emph>. Ao representar esta variabilidade numericamente, e especialmente na forma de gráficos e visualizações, a análise exploratória de dados torna-se um meio para desenvolver novos insights analíticos, perguntas ou hipóteses: num relance podemos estar cientes das concentrações de dados, valores atípicos, saltos e assim por diante.</p>
                    <p>Com nosso banco de dados, vamos trabalhar com uma das principais formas pelas quais a variabilidade das informações se manifesta: a distribuição de frequência. Faremos isso em modo bivariado, ou seja, veremos como tabelas de contingência podem ser construídas para contar os casos resultantes do cruzamento de duas variáveis dentro do conjunto de ataques realizados durante 1959.</p>
                    <p>Para este fim, há uma função simples chamada <code rend="inline">table()</code> que toma as variáveis de fatores como parâmetros e retorna a frequência de ocorrência das categorias da variável. Um aspecto interessante desta função é que ela também permite que se passe uma única coluna como argumento. Por exemplo, se quisermos saber quantos ataques existem por cidade, podemos descobrir o número com a declaração:</p>
                    <ab>
                        <code lang="language-R" xml:id="code_visualizacao-animacao-tabelas-historicas-R_9" corresp="code_visualizacao-animacao-tabelas-historicas-R_9.txt" rend="block"/>
                    </ab>
                    <p>Se quiser começar a testar as capacidades gráficas que a base R lhe oferece, é possível transformar essa tabela unidimensional em um gráfico de barras, com uma função chamada <code rend="inline">barplot()</code>:</p>
                    <ab>
                        <code lang="language-R" xml:id="code_visualizacao-animacao-tabelas-historicas-R_10" corresp="code_visualizacao-animacao-tabelas-historicas-R_10.txt" rend="block"/>
                    </ab>
                    <p>O gráfico resultante (Figura 2) vai aparecer na aba <emph>Plots</emph> da janela de utilidades.</p>
                    <figure>
                        <desc>Figura 2. Gráfico de barras mostrando a frequência dos ataques por cidade. Neste caso, Avellaneda e La Plata têm o maior número de ataques.</desc>
                        <graphic url="visualizacion-y-animacion-de-tablas-historicas-con-R2.png"/>
                    </figure>
                    <p>Para analisar as possíveis relações entre variáveis e categorias, podemos estabelecer uma tabela de contingência. Para isso, precisamos aplicar as duas colunas nas quais estamos interessados em cruzar para a função de <code rend="inline">table()</code> como um argumento. Por exemplo, se quisermos saber com que tipo de elementos ou objetos os ataques foram perpetrados, de acordo com a cidade de ocorrência do evento, devemos entrar no console:</p>
                    <ab>
                        <code lang="language-R" xml:id="code_visualizacao-animacao-tabelas-historicas-R_11" corresp="code_visualizacao-animacao-tabelas-historicas-R_11.txt" rend="block"/>
                    </ab>
                    <p>Como resultado, obteremos a seguinte tabela:</p>
                    <ab>
                        <code lang="language-R" xml:id="code_visualizacao-animacao-tabelas-historicas-R_12" corresp="code_visualizacao-animacao-tabelas-historicas-R_12.txt" rend="block"/>
                    </ab>
                    <p>Há muitas maneiras de tornar a visualização das tabelas de contingência mais fácil, usando pacotes disponíveis no <emph>CRAN</emph>. Um que, sem ser complicado, lhe dará tabelas esteticamente melhoradas é o <ref target="https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_html.html">kableExtra</ref>^[8]^[9]. O procedimento tem duas partes. Primeiro, é preciso formatar a tabela em formato <emph>html</emph> com a função <code rend="inline">kable()</code> e armazená-la em uma variável (por exemplo, <code rend="inline">a59k</code>). Então, deve-se usar esse objeto como argumento para a função <code rend="inline">kable_styling()</code>, que lhe permitirá exibir a tabela e lidar com vários atributos de estilo, tais como tamanho da fonte e cor. Dito isto, tente instalar, carregar e testar esse pacote, e aproveite a oportunidade para adicionar um título à sua tabela com o argumento <code rend="inline">caption</code>:</p>
                    <ab>
                        <code lang="language-R" xml:id="code_visualizacao-animacao-tabelas-historicas-R_13" corresp="code_visualizacao-animacao-tabelas-historicas-R_13.txt" rend="block"/>
                    </ab>
                    <p>O resultado aparecerá no <emph>Viewer</emph> e teremos a possibilidade de salvá-lo como uma imagem ou como código html, através da aba <emph>Export</emph>.</p>
                    <figure>
                        <desc>Figura 3. A mesma tabela de contingência criada acima, mas com o formato dado pelo pacote kableExtra.</desc>
                        <graphic url="visualizacion-y-animacion-de-tablas-historicas-con-R3.png"/>
                    </figure>
                </div>
                <div type="1">
                    <head>Visualização de tabelas com ggplot2</head>
                    <p>Como mostramos com os gráficos gerados nesta lição, R se sobressai na ilustração de conjuntos de dados. O pacote <ref target="https://ggplot2.tidyverse.org/">ggplot2</ref> ^[10] é um dos pacotes gráficos mais utilizados para aqueles que usam esta linguagem de programação. Tem uma lógica inspirada na chamada gramática dos gráficos (<emph>grammar of graphics</emph>) ^[11] , que consiste no uso de camadas (<emph>layers</emph>), que são ajustadas de acordo com certos parâmetros. Um gráfico é a combinação de camadas, onde cada uma cumpre uma função específica sobre os dados, seus aspectos estéticos (tamanho, forma, cor, etc.), os objetos geométricos que vão representar os dados (pontos, linhas, polígonos, áreas, etc.). Estas três camadas (dados, parâmetros estéticos e representação geométrica) são essenciais, ou seja, não podem estar ausentes. Opcionalmente, é possível modificar os valores padrão de outras camadas, o que lhe permitirá facetar os dados em subgrupos, modificar o tipo de coordenadas, usar funções estatísticas e modificar a aparência geral do gráfico. O pacote <emph>ggplot2</emph> está incluído no Tidyverse e é carregado quando se executa <code rend="inline">library(tidyverse)</code>, portanto, nenhuma instalação adicional é necessária.</p>
                    <p>Em termos abstratos, uma declaração básica desta gramática gráfica tem a seguinte estrutura: <code rend="inline">ggplot(dados, variáveis) + função geométrica</code>. Os dados correspondem ao objeto de dados que contém as variáveis que queremos visualizar, que para ggplot2 deve estar no formato <emph>data frame</emph>. As variáveis são interpretadas aqui como os parâmetros estéticos (<code rend="inline">aes</code>) nos quais as colunas escolhidas serão representadas (por exemplo, posição nos eixos x e y, tamanho, cor). A função geométrica (<code rend="inline">geom</code>) nos permite escolher o objeto visual com o qual os dados serão representados. Por ser uma lógica de camadas, o sinal <code rend="inline">+</code> permite adicionar tantas camadas quantas forem consideradas necessárias para que o gráfico inclua os elementos entendidos como relevantes.</p>
                    <p>Se quiser visualizar graficamente a tabela de contingência construída anteriormente, é possível começar fazendo a equivalência de um ataque = um ponto no plano, ao qual a sentença mínima corresponderia:</p>
                    <ab>
                        <code lang="language-R" xml:id="code_visualizacao-animacao-tabelas-historicas-R_14" corresp="code_visualizacao-animacao-tabelas-historicas-R_14.txt" rend="block"/>
                    </ab>
                    <p>Com o código acima, o resultado será semelhante ao da Figura 4.</p>
                    <figure>
                        <desc>Figura 4. Gráfico de pontos mostrando o cruzamento das variáveis objeto e cidade.</desc>
                        <graphic url="visualizacion-y-animacion-de-tablas-historicas-con-R4.png"/>
                    </figure>
                    <p>Entretanto, deve-se reconhecer que a acumulação de pontos, um em cima do outro, na mesma coordenada (fenômeno conhecido como <emph>overplotting</emph>), resulta em uma visualização pouco útil, pois, ao contrário da tabela, não consegue representar as frequências. Mostra apenas a existência de cruzamentos de variáveis, não quantas vezes elas ocorrem. Em casos como este, é aconselhável substituir a função <code rend="inline">geom_point()</code> por uma que conte o número de ocorrências de cada combinação, para obter uma imagem que lhe dê uma rápida pista sobre as variações na freqüência dos ataques. Para este fim, a <code rend="inline">geom_count()</code> está disponível, o que, além do efeito visual, adiciona uma escala de frequência ao gráfico.</p>
                    <p>Se também estiver interessado em enriquecer a visualização adicionando etiquetas ao gráfico (dando-lhe um título, mudando os nomes das variáveis nos eixos, etc.), é possível adicionar uma camada com a função <code rend="inline">labs()</code>. Ainda, existe a possibilidade de alterar a aparência geral adicionando uma camada com uma das variantes fornecidas pelas funções <code rend="inline">theme_()</code>, que lhe permitem controlar os elementos não-dados do gráfico. Assim, o resultado obtido será semelhante ao da Figura 5.</p>
                    <ab>
                        <code lang="language-R" xml:id="code_visualizacao-animacao-tabelas-historicas-R_15" corresp="code_visualizacao-animacao-tabelas-historicas-R_15.txt" rend="block"/>
                    </ab>
                    <figure>
                        <desc>Figura 5. Gráfico de pontos representando a frequência dos ataques, por objeto e cidade. O tamanho dos pontos depende do número de combinações entre o objeto do ataque e a cidade. Pode-se ver que as cidades de Avellaneda e La Plata têm o maior número de ataques, e que foram utilizados explosivos na maioria deles.</desc>
                        <graphic url="visualizacion-y-animacion-de-tablas-historicas-con-R5.png"/>
                    </figure>
                    <p>Para armazenar o gráfico em um ficheiro, há a função <code rend="inline">ggsave()</code>, que salvará sua imagem em seu diretório de trabalho:</p>
                    <ab>
                        <code lang="language-R" xml:id="code_visualizacao-animacao-tabelas-historicas-R_16" corresp="code_visualizacao-animacao-tabelas-historicas-R_16.txt" rend="block"/>
                    </ab>
                    <p>Outra maneira de aproveitar os benefícios de visualização de R e evitar a sobreposição de pontos é usar a propriedade <emph>jitter</emph>, que afeta a posição dos pontos. A função gráfica <code rend="inline">geom_jitter()</code> permite adicionar uma pequena variação aleatória à localização de cada ponto; isto é muito útil se estivermos trabalhando com posições discretas e pequenos conjuntos de dados. Para explorar outras capacidades estéticas, tente, por exemplo, definir a cor dos pontos a serem diferentes por cidade, usando o argumento <code rend="inline">colour</code>. Como o argumento deve estar em formato numérico, devemos convertê-lo com <code rend="inline">as.numeric()</code>. Além de definir a coloração, temos a possibilidade de manipular o tamanho dos pontos com o argumento <code rend="inline">size</code>, sua transparência com <code rend="inline">alpha</code> e a distância vertical ou horizontal entre pontos com <code rend="inline">width</code> ou <code rend="inline">height</code>. O gráfico obtido será semelhante ao da Figura 6.</p>
                    <ab>
                        <code lang="language-R" xml:id="code_visualizacao-animacao-tabelas-historicas-R_17" corresp="code_visualizacao-animacao-tabelas-historicas-R_17.txt" rend="block"/>
                    </ab>
                    <figure>
                        <desc>Figura 6. Gráfico resultante da aplicação da função geom_jitter(). Ele permite visualizar a mesma tendência do gráfico anterior (mais explosivos em Avellaneda e La Plata), mas atribuindo um ponto para cada combinação objeto/cidade para evitar sobreposições.</desc>
                        <graphic url="visualizacion-y-animacion-de-tablas-historicas-con-R6.png"/>
                    </figure>
                </div>
                <div type="1">
                    <head>Animando a visualização dos dados com gganimate</head>
                    <p>Embora existam diferentes pacotes para animar visualizações em R, nós o convidamos a fazê-lo com <ref target="https://gganimate.com/">gganimate</ref>^[12]], que é uma extensão do pacote <emph>ggplot2</emph> que lhe permitirá criar uma animação a partir de um gráfico <emph>ggplot</emph> e ver dinamicamente como seus dados evoluem de acordo com os estados ou com o tempo. As funções centrais do <emph>gganimate</emph> são as funções de transição (<code rend="inline">transition_*()</code>), que permitem especificar como os dados devem ser interpretados em termos de sua animação, ou seja, de acordo com que critérios os quadros (<emph>frames</emph>) a serem animados serão criados.</p>
                    <p>Para instalar e ativar o pacote, use o código abaixo. Sugerimos também a instalação da última versão do pacote <emph>gifski</emph>. Algumas pessoas relataram problemas gerando animações ao usar uma versão mais antiga que 0.8.6.</p>
                    <ab>
                        <code lang="language-R" xml:id="code_visualizacao-animacao-tabelas-historicas-R_18" corresp="code_visualizacao-animacao-tabelas-historicas-R_18.txt" rend="block"/>
                    </ab>
                    <p>Se quiser gerar uma animação que represente a ocorrência de ataques de acordo com uma progressão no tempo, a função indicada é <code rend="inline">transiton_time()</code>. O procedimento é muito simples: ao código que escrevemos para fazer o gráfico, adicionamos esta função, colocando como argumento a variável temporal, neste caso, a <emph>fecha</emph> (data). Entretanto, a fim de fazer uma visualização mais clara de seus dados, é conveniente que acrescentemos alguns elementos ao código.</p>
                    <p>Por um lado, como no <emph>gganimate</emph> a animação resultante é um conjunto de imagens (instantâneas) exibidas em séries consecutivas, cada novo quadro (<emph>frame</emph>) - se não dissermos o contrário - quando exibido esconde o anterior e só veremos pontos piscando. Para lidar com isto, temos o grupo de funções <emph>shadow</emph> (sombras), que lhe permite escolher como exibir dados que não correspondem mais ao quadro (<emph>frame</emph>) atual. No caso deste gráfico, a fim de manter todos os dados anteriores em segundo plano, precisamos usar <code rend="inline">shadow_mark(past = TRUE)</code>, o que permite deixar visíveis os quadros já apresentados. Por outro lado, como pode ser bastante difícil entender uma animação sem qualquer indicação do significado de cada ponto de tempo, <emph>gganimate</emph> fornece um conjunto de variáveis para cada <emph>frame (frame variables)</emph>, que podemos inserir nas etiquetas dos gráficos usando a própria sintaxe do pacote <emph>glue</emph>, que usa os símbolos <code rend="inline">{}</code>. Isto lhe fornecerá um conjunto de metadados, dependendo da variante de transição que se tentar. Para <code rend="inline">transition_time()</code>, há <code rend="inline">{frame_time}</code>, que retornará o valor do argumento processado pela função durante o frame atual, ou seja, permitirá visualizar a data correspondente. O código ficaria assim:</p>
                    <ab>
                        <code lang="language-R" xml:id="code_visualizacao-animacao-tabelas-historicas-R_19" corresp="code_visualizacao-animacao-tabelas-historicas-R_19.txt" rend="block"/>
                    </ab>
                    <p>Quando inserimos o código diretamente no console, o processo de geração da animação, chamado <emph>rendering</emph> (renderização), começa. Este processo tem uma duração relativa, dependendo do volume de dados e de seu processamento. Neste caso, deve levar apenas alguns segundos, durante os quais vemos uma barra de progresso indicando quanto tempo ainda resta. Quando terminar, na aba <emph>Viewer</emph> da janela de utilidades, poderemos assistir a animação. Se pressionamos o ícone <emph>Show in new window</emph> (mostrar em nova janela), um <emph>gif</emph> será aberto em seu navegador padrão associado, de onde poderemos salvá-lo. Caso se deseje continuar praticando com o console, também é possível salvá-lo com a função <code rend="inline">anim_save()</code>, que salva a última animação em seu diretório de trabalho:</p>
                    <ab>
                        <code lang="language-R" xml:id="code_visualizacao-animacao-tabelas-historicas-R_20" corresp="code_visualizacao-animacao-tabelas-historicas-R_20.txt" rend="block"/>
                    </ab>
                    <p>Para explorar mais possibilidades do pacote <emph>gganimate</emph>, a sugestão é que se atribua o bloco de código para gerar o gráfico a um objeto. Isto lhe dará a possibilidade de lidar com parâmetros como velocidade e pausas na animação por meio da função <code rend="inline">animate()</code>. Com ele, também podemos ajustar o número total de quadros, a duração total e os quadros por segundo. Para experimentar, dê aos <code rend="inline">fps</code> um parâmetro de 5 quadros por segundo e acrescente uma pausa final de 15 segundos com <code rend="inline">end_pause</code>. Isto lhe dará uma animação semelhante à Figura 7.</p>
                    <ab>
                        <code lang="language-R" xml:id="code_visualizacao-animacao-tabelas-historicas-R_21" corresp="code_visualizacao-animacao-tabelas-historicas-R_21.txt" rend="block"/>
                    </ab>
                    <figure>
                        <desc>Figura 7. Versão animada do gráfico criado com a função geom_jitter.</desc>
                        <graphic url="visualizacion-y-animacion-de-tablas-historicas-con-R7.gif"/>
                    </figure>
                    <p>Neste ponto e com estes resultados, podemos considerar que foi realizada uma análise exploratória de seus dados e que está em condições de apresentar hipóteses a este respeito. No caso de ter trabalhado, e se o (a) pesquisador (a) se dedica à história das lutas sociais e políticas na Argentina contemporânea, as tabelas de contingência e gráficos estáticos trabalhados nesta lição, por exemplo, permitem encontrar semelhanças entre Avellaneda e La Plata, tanto em termos da frequência dos ataques quanto de seu tipo (em termos do objeto utilizado). Além disso, temos o ritmo temporal (intensidade) dos ataques, o que nos convida a nos concentrar em possíveis padrões ou relações de natureza mais histórica entre casos que normalmente não estão conectados na pesquisa devido a sua diferente estrutura sócio-econômica na época.</p>
                </div>
                <div type="1">
                    <head>Conclusão</head>
                    <p>Esta lição procurou oferecer uma ideia geral das várias tarefas que devem ser seguidas a fim de preparar e realizar uma primeira análise exploratória de dados sobre uma série de documentos históricos. Este procedimento permite realizar cálculos básicos com estes dados e analisá-los visualmente a fim de pensar, gerar perguntas e hipóteses a partir deles.</p>
                    <p>Nesta lição, oferecemos apenas um ponto de partida para a análise de suas tabelas históricas. Como um desafio, e com base no que se aprendeu neste tutorial, propomos que se continue a tentar outros cruzamentos de variáveis. Finalmente, te convidamos a descobrir por si próprio o poder do <emph>ggplot</emph> e do <emph>gganimate</emph>, explorando a <ref target="https://gganimate.com/index.html">documentação</ref> deste último pacote para aprender sobre as outras opções disponíveis.</p>
                </div>
                <div type="1">
                    <head>Notas</head>
                    <p>
                        <ref type="footnotemark" target="#pt_note_1"/> : Roderick Floud, <emph>Métodos cuantitativos para historiadores</emph> (Madrid: Alianza, 1983).</p>
                    <p>
                        <ref type="footnotemark" target="#pt_note_2"/> : Para encontrar uma referência detalhada do ficheiro no local da Comissão Provincial pela Memória da Província de Buenos Aires: <ref target="https://www.comisionporlamemoria.org/extra/archivo/cuadroclasificacion/">https://www.comisionporlamemoria.org/extra/archivo/cuadroclasificacion/</ref>
                    </p>
                    <p>
                        <ref type="footnotemark" target="#pt_note_3"/> : Os fundamentos e o significado da noção de “dados ordenados” podem ser encontrados em: Hadley Wickham, "Tidy Data", <emph>Journal of Statistical Software</emph>, Volume 59, Issue 10, 2019,https://www.jstatsoft.org/index.php/jss/article/view/v059i10/v59i10.pdf)</p>
                    <p>
                        <ref type="footnotemark" target="#pt_note_4"/> : Hadley Wickham and Jennifer Bryan, "readxl: Read Excel Files. R package version 1.3.1", 2019, <ref target="https://CRAN.R-project.org/package=readxl">https://CRAN.R-project.org/package=readxl</ref>
                    </p>
                    <p>
                        <ref type="footnotemark" target="#pt_note_5"/> : Hadley Wickham et al.,"Welcome to the tidyverse", <emph>Journal of Open Source Software</emph>, 4(43), 1686 (2019): 1-5, <ref target="https://doi.org/10.21105/joss.01686">https://doi.org/10.21105/joss.01686</ref>
                    </p>
                    <p>
                        <ref type="footnotemark" target="#pt_note_6"/> : Lionel Henry and Hadley Wickham, "purrr: Functional Programming Tools. R package version 0.3.4", 2020, <ref target="https://CRAN.R-project.org/package=purrr">https://CRAN.R-project.org/package=purrr</ref>
                    </p>
                    <p>
                        <ref type="footnotemark" target="#pt_note_7"/> : Hadley Wickham, Romain François, Lionel Henry and Kirill Müller, "dplyr: A Grammar of Data Manipulation. R package version 1.0.6", CRAN R Project, 2021, <ref target="https://CRAN.R-project.org/package=dplyr">https://CRAN.R-project.org/package=dplyr</ref>
                    </p>
                    <p>
                        <ref type="footnotemark" target="#pt_note_8"/> : Hao Zhu, "kableExtra: Construct Complex Table with 'kable' and Pipe Syntax. R package version 1.3.2", 2021, <ref target="https://CRAN.R-project.org/package=kableExtra">https://CRAN.R-project.org/package=kableExtra</ref>
                    </p>
                    <p>
                        <ref type="footnotemark" target="#pt_note_9"/> : Nota da Tradutora: ao instalar o pacote <emph>kableExtra</emph>, pode ser que o R demande a atualização do pacote <emph>htmltools</emph>
                    </p>
                    <p>
                        <ref type="footnotemark" target="#pt_note_10"/> : Hadley Wickham, "ggplot2: Create Elegant Data Visualisations Using the Grammar of Graphics", Springer-Verlag New York, 2016, <ref target="https://ggplot2.tidyverse.org">https://ggplot2.tidyverse.org</ref>
                    </p>
                    <p>
                        <ref type="footnotemark" target="#pt_note_11"/> : A referência para o conceito é Leland Wilkinson, com seu trabalho <emph>The Grammar of Graphics</emph>, algumas páginas podem ser consultadas em: <ref target="https://www.springer.com/gp/book/9780387245447">https://www.springer.com/gp/book/9780387245447</ref>
                    </p>
                    <p>
                        <ref type="footnotemark" target="#pt_note_12"/> : Thomas Lin Pedersen and David Robinson, "gganimate: A Grammar of Animated Graphics. R package version 1.0.7", 2020, <ref target="https://CRAN.R-project.org/package=gganimate">https://CRAN.R-project.org/package=gganimate</ref>
                    </p>
                </div>
            </div>
        </body>
    </text>
</TEI>
