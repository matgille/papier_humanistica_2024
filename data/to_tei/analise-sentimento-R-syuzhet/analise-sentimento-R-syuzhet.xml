<TEI xmlns="http://www.tei-c.org/ns/1.0" xml:id="analise-sentimento-R-syuzhet" type="translation">
    <teiHeader>
        <fileDesc>
            <titleStmt>
                <title>Análise de sentimentos em R com 'syuzhet'</title>
                <author role="original_author">Jennifer Isasi</author>
                <editor role="reviewers">Riva Quiroga</editor>
                <author role="translators">Diana Rebelo Rodriguez</author>
                <editor role="translation-reviewers">
                    <persName>Ana Giulia Aldgeire</persName>
                    <persName>Ian Araujo</persName>
                </editor>
                <editor role="editors">Maria José Afanador-Llach</editor>
            </titleStmt>
            <publicationStmt>
                <distributor>Programming Historian</distributor>
                <date type="translated">03/02/2022</date>
                <idno type="doi">10.46430/phpt0022</idno>
                <date type="published">03/23/2021</date>
            </publicationStmt>
            <sourceDesc>
                <p>Born digital, in a markdown format. Original file: <ref type="original_file" target="#analisis-de-sentimientos-r"/>.</p>
                <p>There are other translations: <ref target="#sentiment-analysis-syuzhet"/>
                </p>
            </sourceDesc>
        </fileDesc>
        <profileDesc>
            <abstract>
                <p>Esta lição ensina uma maneira de obter e analisar dados sobre emoções e sentimentos em uma narrativa.</p>
            </abstract>
            <textClass>
                <keywords>
                    <term xml:lang="en">distant-reading</term>
                    <term xml:lang="en">r</term>
                    <term xml:lang="en">data-visualization</term>
                </keywords>
            </textClass>
        </profileDesc>
    </teiHeader>
    <text xml:lang="pt">
        <body>
            <div type="2">
                <head>Objetivos</head>
                <p>Esta lição usa a metodologia de análise de sentimentos e emoções através da linguagem de programação R para investigar documentos textuais de modo individual. Embora a lição não seja destinada a usuários avançados de R, é necessário que se tenha algum conhecimento dessa linguagem; assumimos que se tenha o R instalado e saiba como importar pacotes. Também recomendamos o download do RStudio. Se não estiver familiarizado com R, é melhor trabalhar primeiro através das lições <ref target="/pt/licoes/processamento-basico-texto-r">Processamento básico de texto em R</ref>, <ref target="/pt/licoes/nocoes-basicas-R-dados-tabulares">Noções básicas de R com dados tabulares</ref> ou <ref target="/en/lessons/data_wrangling_and_management_in_R">Data Wrangling and Management in R</ref> (em inglês). Ao final desta lição, o(a) pesquisador(a) será capaz de:</p>
                <list type="unordered">
                    <item>Colocar perguntas de pesquisa com base na análise quantitativa de sentimentos em textos de tipo ensaístico e/ou narrativo.</item>
                    <item>Usar a linguagem de programação R, o ambiente RStudio e o pacote <code rend="inline">syuzhet</code> com o dicionário NRC para gerar o indicador de sentimento de um texto em diferentes linguagens. </item>
                    <item>Analisar criticamente os resultados do processamento de texto.</item>
                    <item>Visualizar os dados gerais e sua evolução ao longo de um texto.</item>
                </list>
                <p>Esta lição foi construída com a versão R 4.0.2, mas acreditamos que funcionará corretamente em versões futuras do programa.</p>
                <quote>
                    <p>O uso do R é geralmente o mesmo para Windows, Mac e Linux. Entretanto, como vamos trabalhar com textos em português, precisaremos escrever algum código extra para indicar o formato UTF-8 em máquinas Windows. Nesses casos, o código para o sistema operacional correspondente é exibido.</p>
                </quote>
            </div>
            <div type="2">
                <head>Antes de começar</head>
                <div type="3">
                    <head>Análise de sentimentos</head>
                    <p>A <ref target="https://myrabr.com/blog/analise-de-sentimento/">análise dos sentimentos ou a mineração de opinião</ref> é utilizada para extrair automaticamente informações sobre a conotação negativa ou positiva da linguagem de um documento. Embora seja uma tarefa que vem sendo utilizada há muito tempo no campo do marketing ou da política, em estudos literários ainda é uma abordagem recente e não há um método único. Além disso, há a possibilidade de extrair a polaridade dos sentimentos e também das emoções.</p>
                    <p>É importante especificar o que estamos procurando com os termos “sentimento” e “emoções”, pois eles são frequentemente usados de forma intercambiável, de modo geral, mas são diferentes. Para Antonio R. Damasio, as emoções são reações corporais instigantes de nosso corpo, determinadas por estímulos ambientais e derivadas do desenvolvimento da regulamentação biológica (12). Elas podem ser divididas em primárias e secundárias. Embora não haja um acordo final sobre o número de emoções básicas, geralmente são seis: raiva, alegria, repugnância, medo, tristeza e surpresa, embora Damasio considere esta última como sendo secundária. Além disso, no caso do sistema automático que utilizaremos, as emoções secundárias de antecipação e confiança também aparecem.</p>
                    <p>Por outro lado, podemos definir sentimento como a ação e o efeito de sentir uma emoção ou, em outras palavras, é o resultado do fato de que “quando um objeto, uma pessoa, uma situação ou um pensamento provoca em nós a emoção da alegria, começa um processo que pode concluir no sentimento de estar alegre ou feliz” (Pereira Zazo 32) porque é uma emoção positiva. Durante a lição faremos uma distinção entre os dois termos, pois usaremos o resultado do sentimento para ver a sua evolução ao longo do texto e as emoções para ver o uso das palavras em geral.</p>
                </div>
                <div type="3">
                    <head>Dicionário de léxicos NRC</head>
                    <p>O pacote <code rend="inline">syuzhet</code> funciona com quatro dicionários de sentimentos: Bing, Afinn, Stanford e NRC. Nesta lição, trabalharemos com este último, pois é o único disponível em vários idiomas, incluindo o português. Este vocabulário com valores de sentimentos negativos ou positivos e oito emoções foi desenvolvido por Saif M. Mohammad, um cientista do Conselho Nacional de Pesquisa do Canadá (NRC). O conjunto de dados foi construído manualmente através de pesquisas usando a técnica Maximum Difference Scaling ou MaxDiff, que avalia a preferência por uma série de alternativas (Mohammad e Turney). Assim, o léxico tem 14.182 palavras com as categorias de sentimentos positivos e negativos e as emoções de raiva, antecipação, repugnância, medo, alegria, tristeza, surpresa e confiança. Além disso, está disponível em mais de 100 idiomas (através de tradução automática).</p>
                    <p>Seus termos de uso estabelecem que o vocabulário pode ser usado gratuitamente para fins de pesquisa, portanto, todos os dados estão disponíveis para download.</p>
                    <p>Se trabalhamos com o inglês, podemos interagir com as diferentes categorias no site do <ref target="http://saifmohammad.com/WebPages/NRC-Emotion-Lexicon.htm">NRC Word-Emotion Association Lexicon</ref>. Lá também podemos encontrar trabalhos publicados sobre a obtenção dos valores para o vocabulário, sua organização, extensão, etc.</p>
                </div>
                <head>Pacote <code rend="inline">syuzhet</code>
                </head>
                <p>O <ref target="https://cran.r-project.org/web/packages/syuzhet/vignettes/syuzhet-vignette.html">pacote <code rend="inline">syuzhet</code>
                    </ref> foi desenvolvido em 2015 por Matthew Jockers; que o mantém funcionando até hoje e continuamente apresenta novas versões (no momento da preparação desta lição, foi usada a versão de dezembro de 2017). Uma série de posts no blog acompanham o desenvolvimento do pacote, e estão disponíveis no blog do professor desde <ref target="http://www.matthewjockers.net/page/2/">5 de junho de 2014</ref> (em inglês).</p>
                <p>Naturalmente, o pacote foi desenvolvido com testes em textos escritos ou traduzidos para o inglês e não sem debate sobre sua utilidade, para atribuir valores a textos literários que muitas vezes são, por natureza, bastante subjetivos.  </p>
                <quote>
                    <p>Atenção: A lista de palavras do dicionário está sendo preparada em inglês como língua principal e os dados quantitativos atribuídos a cada palavra são o resultado da avaliação humana pelos participantes americanos. Portanto, vários fatores devem ser levados em consideração ao utilizar esta metodologia:</p>
                    <list type="unordered">
                        <item>O léxico em português é uma tradução direta realizada por tradução automática (estes sistemas já são muito confiáveis entre o inglês e o português, mas não em outros idiomas que o NRC afirma ser capaz de analisar como, por exemplo, o basco).</item>
                        <item>A pontuação de cada palavra, ou seja, a valência sentimental e emocional, tem um viés cultural e temporal que deve ser levado em conta, e um termo que pareceu positivo para os participantes da pesquisa pode nos parecer negativo.  </item>
                        <item>O uso desta metodologia não é recomendado para textos que são altamente metafóricos e simbólicos.</item>
                        <item>O método não vai captar a negação de um sentimento positivo como, por exemplo, a frase “Eu não estou feliz”.</item>
                    </list>
                    <p>Seguindo o espírito de adaptabilidade das lições do <emph>Programming Historian</emph> a outras línguas, foi decidido usar <code rend="inline">syuzhet</code> em sua forma original, mas ao final da lição indicamos algumas funções avançadas para usar seu próprio dicionário de sentimentos com o mesmo pacote.</p>
                </quote>
                <p>Como os resultados nos <emph>dataframes</emph> aparecerão em inglês, se achar necessário, dedique um momento para aprender esta tradução:</p>
                <table>
                    <row>
                        <cell role="label">anger</cell>
                        <cell role="label">anticipation</cell>
                        <cell role="label">disgust</cell>
                        <cell role="label">fear</cell>
                        <cell role="label">joy</cell>
                        <cell role="label">sadness</cell>
                        <cell role="label">surprise</cell>
                        <cell role="label">trust</cell>
                        <cell role="label">negative</cell>
                        <cell role="label">positive</cell>
                    </row>
                    <row>
                        <cell>raiva</cell>
                        <cell>anticipação</cell>
                        <cell>desgosto</cell>
                        <cell>medo</cell>
                        <cell>alegria</cell>
                        <cell>tristeza</cell>
                        <cell>surpresa</cell>
                        <cell>confiança</cell>
                        <cell>negativo</cell>
                        <cell>positivo</cell>
                    </row>
                </table>
                <div type="3">
                    <head>Um pequeno exemplo</head>
                    <p>Antes de começar a realizar a análise de nossos textos, é útil saber de forma geral qual é o processo de análise realizado pela função de obter sentimentos de <code rend="inline">syuzhet</code>, com o dicionário NRC e os resultados obtidos sobre os quais trabalharemos.</p>
                    <p>O sistema irá processar nosso texto e transformá-lo em um vetor de caracteres (aqui palavras), para analisá-los individualmente (também é possível fazê-lo por sentenças). Sem entrar ainda no código para realizar a análise, dê uma olhada neste breve exemplo (nota de tradução: para a versão em português foi usado o texto <emph>Dom Casmurro</emph> de Machado de Assis, mantendo o tipo de exercícios e o código da lição original):</p>
                    <quote>
                        <p>“Contando aquela crise do meu amor adolescente, sinto uma coisa que não sei se explico bem, e é que as dores daquela quadra, a tal ponto se espiritualizaram com o tempo, que chegam a diluir-se no prazer. Não é claro isto, mas nem tudo é claro na vida ou nos livros. A verdade é que sinto um gosto particular em referir tal aborrecimento, quando é certo que ele me lembra outros que não quisera lembrar por nada.”</p>
                        <p>
                            <emph>Dom Casmurro</emph> de Machado de Assis.</p>
                    </quote>
                    <p>Este fragmento é transformado em um vetor de caracteres:</p>
                    <ab>
                        <code lang="language-R" xml:id="code_analise-sentimento-R-syuzhet_0" corresp="code_analise-sentimento-R-syuzhet_0.txt" rend="block"/>
                    </ab>
                    <p>Com a função de obter sentimentos, obtém-se a valência positiva e negativa de cada palavra, assim como a valência das oito emoções classificadas pelo NRC. O resultado para este fragmento é o seguinte:</p>
                    <ab>
                        <code lang="language-R" xml:id="code_analise-sentimento-R-syuzhet_1" corresp="code_analise-sentimento-R-syuzhet_1.txt" rend="block"/>
                    </ab>
                    <quote>
                        <p>Nota de tradução: na lição original, os autores não explicaram o passo a passo para se obter esses resultados em um primeiro momento. Apesar de a lição explicar detalhadamente o processo, julguei ser interessante demonstrar aqui como obtive esses outputs:</p>
                    </quote>
                    <ab>
                        <code lang="language-R" xml:id="code_analise-sentimento-R-syuzhet_2" corresp="code_analise-sentimento-R-syuzhet_2.txt" rend="block"/>
                    </ab>
                    <p>Como podemos ver nos resultados deste objeto tipo <emph>data frame</emph> ou tabela, cada palavra ou ficha tem um valor padrão de 0 nas dez colunas. Se houver um valor maior que 0 significa, em primeiro lugar, que este termo existe no dicionário NRC e, em segundo lugar, que tem um valor atribuído para alguma emoção e/ou sentimento. Neste exemplo, podemos ver que a palavra “amor” é entendida de forma positiva, ainda que represente tristeza (<emph>sadness</emph>). Por outro lado, a palavra “crise” possui uma conotação negativa muito forte, pois há menos margem para dúvidas.</p>
                    <p>As possibilidades de explorar, analisar e visualizar estes resultados dependem, em grande parte, das suas habilidades de programação mas, acima de tudo, da sua questão de pesquisa. Para ajudar o pesquisador, nesta lição introdutória aprenderemos como analisar os dados utilizando várias formas de visualização.   </p>
                </div>
                <div type="3">
                    <head>Pergunta de pesquisa</head>
                    <p>Para essa lição, vamos utilizar o romance Dom Casmurro, escrito por <ref target="https://pt.wikipedia.org/wiki/Machado_de_Assis">Machado de Assis</ref>, publicado em 1899, de caráter realista e ambientado no Rio de Janeiro na segunda metade do século XIX. O protagonista e narrador é Bento Santiago (também conhecido como Bentinho ou Dom Casmurro), que apresenta relatos desde a sua juventude até à sua vida adulta, quando escreve. Nesse intervalo de tempo passa por experiências como viver em um seminário e se preparar para ser Padre, mas também desistir dessa vida ao se apaixonar por Capitu. O enredo central da trama é o ciúme envolvido nessa relação.</p>
                    <p>É possível observar a queda emocional desta trama ao se extrair automaticamente os valores de sentimento do romance? Ou, em outras palavras, nossa recepção dos ciúmes de Bentinho coincide com os resultados desse cálculo automático? Além disso, quais são as palavras mais usadas na descrição das emoções do texto?</p>
                </div>
            </div>
            <div type="2">
                <head>Obter valores de sentimentos e emoções</head>
                <div type="3">
                    <head>Instalar e carregar pacotes</head>
                    <p>A primeira coisa que precisamos fazer para poder obter o sentimento de nosso texto, é instalar e carregar o pacote R correspondente, neste caso, o <code rend="inline">syuzhet</code>. Além disso, para facilitar a visualização dos dados, vamos utilizar os pacotes <code rend="inline">RColorBrewer</code>, <code rend="inline">wordcloud</code>, <code rend="inline">tm</code> e <code rend="inline">NLP</code>. Para fazer isto, digite e execute os dois comandos seguintes em seu console; o primeiro para instalar o pacote e o segundo para carregá-lo (se já os tiver instalado, só precisa carregá-los). Note que a instalação destes pacotes pode levar alguns minutos.</p>
                    <ab>
                        <code lang="language-R" xml:id="code_analise-sentimento-R-syuzhet_3" corresp="code_analise-sentimento-R-syuzhet_3.txt" rend="block"/>
                    </ab>
                </div>
                <div type="3">
                    <head>Carregar e preparar o texto</head>
                    <p>Faça o download do texto do romance <ref target="/assets/domCasmurro.txt">Dom Casmurro</ref>. Como podemos ver, o documento está em formato de texto simples, pois isto é essencial para realizar seu processamento e análise em R.</p>
                    <p>Com o texto em mãos, a primeira coisa que vamos fazer é carregá-lo como um objeto de <emph>string</emph>. Certifique-se de mudar o caminho para o texto para corresponder ao seu computador.  </p>
                    <p>
                        <hi rend="bold">Em Mac e Linux</hi>
                    </p>
                    <p>Em sistemas Mac podemos usar a função <code rend="inline">get_text_as_string</code> integrada no pacote <code rend="inline">syuzhet</code>:</p>
                    <ab>
                        <code lang="language-R" xml:id="code_analise-sentimento-R-syuzhet_4" corresp="code_analise-sentimento-R-syuzhet_4.txt" rend="block"/>
                    </ab>
                    <p>
                        <hi rend="bold">Em Windows</hi>
                    </p>
                    <p>Os sistemas Windows não lêem diretamente caracteres com acentos ou outras marcações típicas do espanhol, português ou francês, então temos que dizer ao sistema que o nosso texto está no formato UTF-8 usando a função <code rend="inline">scan</code>.</p>
                    <ab>
                        <code lang="language-R" xml:id="code_analise-sentimento-R-syuzhet_5" corresp="code_analise-sentimento-R-syuzhet_5.txt" rend="block"/>
                    </ab>
                    <p>Como a análise que vamos realizar precisa de uma lista, seja de palavras ou de frases (aqui só prestaremos atenção a palavras individuais), precisamos de um passo intermediário entre o carregamento do texto e a extração dos valores de sentimento. Assim, vamos dividir o texto (<emph>string</emph>) em uma lista de palavras (<emph>tokens</emph>). Isto é muito comum na análise distante de textos.</p>
                    <p>Para isso, usamos a função <code rend="inline">get_tokens()</code> do pacote e geramos um novo objeto, neste caso um vetor de <emph>tokens</emph> (palavras). Conforme veremos, com esta função nos livramos da pontuação no texto e temos uma lista de palavras.</p>
                    <ab>
                        <code lang="language-R" xml:id="code_analise-sentimento-R-syuzhet_6" corresp="code_analise-sentimento-R-syuzhet_6.txt" rend="block"/>
                    </ab>
                    <p>Agora podemos ver quantas palavras ou tokens estão neste texto com a função <code rend="inline">length()</code>:</p>
                    <ab>
                        <code lang="language-R" xml:id="code_analise-sentimento-R-syuzhet_7" corresp="code_analise-sentimento-R-syuzhet_7.txt" rend="block"/>
                    </ab>
                    <p>Se quiser realizar a análise para orações, utilize a função <code rend="inline">get_sentences()</code> e siga o mesmo processo, com exceção da criação da nuvem de palavras:</p>
                    <ab>
                        <code lang="language-R" xml:id="code_analise-sentimento-R-syuzhet_8" corresp="code_analise-sentimento-R-syuzhet_8.txt" rend="block"/>
                    </ab>
                </div>
                <div type="3">
                    <head>Extração de dados com o NRC Sentiment Lexicon</head>
                    <p>Agora podemos executar a função <code rend="inline">get_nrc_sentiment</code> para obter os sentimentos no romance <emph>Dom Casmurro</emph>. Como a função executa por padrão o vocabulário inglês, nós a escrevemos com o argumento “lang” (de <emph>language</emph>, ou idioma) para usar o vocabulário português (“portuguese”). Por sua vez, criamos um novo objeto para armazenar os dados extraídos. Este será um objeto do tipo <emph>data frame</emph>. Esta função procura a presença das oito emoções e dos dois sentimentos para cada palavra em nosso vetor, e atribui um número maior que 0 se elas existirem. Dependendo do desempenho de seu computador e de acordo com as características de nosso texto, este processo pode levar de 15 a 30 minutos.</p>
                    <ab>
                        <code lang="language-R" xml:id="code_analise-sentimento-R-syuzhet_9" corresp="code_analise-sentimento-R-syuzhet_9.txt" rend="block"/>
                    </ab>
                    <p>Quando o código terminar de ser executado, um aviso aparecerá porque o <code rend="inline">syuzhet</code> usa uma função que é descontinuada dentro de sua função <code rend="inline">get_nrc_sentiment</code>:</p>
                    <ab>
                        <code lang="language-R" xml:id="code_analise-sentimento-R-syuzhet_10" corresp="code_analise-sentimento-R-syuzhet_10.txt" rend="block"/>
                    </ab>
                    <p>Quando o processo terminar, se desejarmos, podemos ler os resultados no novo objeto, simplesmente selecionando o objeto e executando-o. Mas para evitar “imprimir” milhares de linhas no console, também podemos usar a função <code rend="inline">head()</code> para ver os primeiros seis <emph>tokens</emph>. No caso do texto que estamos usando, quando executarmos essa função, devemos ver o seguinte, que não é nada interessante:</p>
                    <ab>
                        <code lang="language-R" xml:id="code_analise-sentimento-R-syuzhet_11" corresp="code_analise-sentimento-R-syuzhet_11.txt" rend="block"/>
                    </ab>
                </div>
                <div type="3">
                    <head>Resumo do texto</head>
                    <p>O que é interessante é ver um resumo de cada um dos valores que obtivemos utilizando a função geral <code rend="inline">summary()</code>. Isto pode ser muito útil ao comparar vários textos, pois permite ver diferentes medidas, tais como a média dos resultados para cada uma das emoções e os dois sentimentos. Por exemplo, podemos ver que o romance <emph>Dom Casmurro</emph> é, em <ref target="https://pt.wikipedia.org/wiki/M%C3%A9dia">média</ref> (<emph>mean</emph>), um pouco mais positivo (0,03892) do que negativo (0,03559). Mas se olharmos para as emoções, parece que a tristeza (0,02116) aparece em mais momentos do que a alegria (0,01593). Vários dos valores fornecidos pela função de resumo do texto aparecem com um valor igual a 0, incluindo a <ref target="https://pt.wikipedia.org/wiki/Mediana_(estat%C3%ADstica)">mediana</ref> (<emph>median</emph>). Isto indica que poucas palavras do romance aparecem no dicionário que estamos usando (NRC) ou, inversamente, que poucas têm uma atribuição de sentimento ou emoção no dicionário.</p>
                    <ab>
                        <code lang="language-R" xml:id="code_analise-sentimento-R-syuzhet_12" corresp="code_analise-sentimento-R-syuzhet_12.txt" rend="block"/>
                    </ab>
                    <quote>
                        <p>Parabéns! Já temos os resultados da análise de sentimentos! E, agora, o que podemos fazer com esses números?</p>
                    </quote>
                </div>
            </div>
            <div type="2">
                <head>Análise das emoções em um texto</head>
                <div type="3">
                    <head>Gráfico de barras</head>
                    <p>Para ver quais as emoções que estão mais presentes no texto, a maneira mais simples é criar um <emph>barplot</emph>. Para isso, usamos a função <code rend="inline">barplot()</code> com o resumo das colunas 1 a 8, ou seja, as colunas de raiva (<emph>anger</emph>), antecipação (<emph>antecipation</emph>), desgosto (<emph>disgust</emph>), medo (<emph>fear</emph>), alegria (<emph>joy</emph>), tristeza (<emph>sadness</emph>), surpresa (<emph>surprise</emph>) e confiança (<emph>trust</emph>). Os resultados obtidos vêm do processamento da função <code rend="inline">prop.table()</code> dos resultados das oito colunas com cada uma das palavras da tabela.</p>
                    <quote>
                        <p>Para cada barra, todos os valores da coluna de emoções correspondentes são somados. Então, o resultado de todas as emoções que adicionamos na saída do gráfico é somado. No final, a soma de cada emoção é dividida pelo total de todas as colunas ou emoções. Isto não acrescenta as colunas negativas e positivas. <ref type="footnotemark" target="#pt_note_1"/>
                        </p>
                    </quote>
                    <ab>
                        <code lang="language-R" xml:id="code_analise-sentimento-R-syuzhet_13" corresp="code_analise-sentimento-R-syuzhet_13.txt" rend="block"/>
                    </ab>
                    <p>O resto dos parâmetros que vemos no código são “extras”, pois são uma forma de configurar o formato visual do gráfico. Assim, indicamos um espaço (<emph>space</emph>) de 0,2 entre as barras, que estará na posição vertical ao indicar falsamente (<emph>FALSE</emph>) sua horizontalidade (<emph>horiz</emph>) e, ao contrário, a horizontalidade para os valores no eixo Y com <code rend="inline">las = 1</code>. Além disso, reduzimos o tamanho do nome de cada barra (<emph>cex.names</emph>) para 0,7 para evitar que elas desapareçam, por exemplo, se fizermos um pequeno gráfico. Graças ao pacote que instalamos no início, <code rend="inline">RColorBrewer</code>, podemos dar cor às colunas automaticamente, neste caso, com a paleta de cores (<emph>brewer.pal</emph>) do conjunto número 3 do pacote, com oito cores, uma para cada coluna. Finalmente, vamos colocar um título e subtítulo em nosso gráfico com os parâmetros <code rend="inline">main</code> e <code rend="inline">sub</code>, assim como a palavra “emoções” no eixo X e nada no eixo Y.</p>
                    <figure>
                        <figDesc>Gráfico de barras com os valores das seis emoções capturadas em Dom Casmurro por Machado de Assis</figDesc>
                        <graphic url="/images/analisis-de-sentimientos-r/analise-sentimento-R-syuzhet-01.png"/>
                    </figure>
                    <p>Se esses parâmetros não forem do seu interesse, basta executar o seguinte código para obter o gráfico padrão:</p>
                    <ab>
                        <code lang="language-R" xml:id="code_analise-sentimento-R-syuzhet_14" corresp="code_analise-sentimento-R-syuzhet_14.txt" rend="block"/>
                    </ab>
                    <quote>
                        <p>Certifique-se de que há espaço suficiente na seção de exibição de gráficos do R para poder ver os nomes de cada coluna.</p>
                    </quote>
                    <p>Estas informações já indicam que as emoções de tristeza e confiança prevalecem mais do que as de desgosto ou surpresa. Mas quais são as palavras usadas por Machado na expressão dessa tristeza? Com que frequência cada uma aparece no romance como um todo?</p>
                </div>
                <div type="3">
                    <head>Contando o número de palavras com cada emoção</head>
                    <p>A fim de realizar uma análise do texto, é muito interessante saber quais são as palavras usadas com mais frequência no texto em relação à sua identificação com cada emoção. Para isso, primeiro temos que criar um objeto de caracteres com todas as palavras que tenham um valor maior que 0 na coluna “tristeza” (<emph>sadness</emph>). Para selecionar somente essa coluna, usamos o sinal de dólar após o nome do <emph>data frame</emph>:</p>
                    <ab>
                        <code lang="language-R" xml:id="code_analise-sentimento-R-syuzhet_15" corresp="code_analise-sentimento-R-syuzhet_15.txt" rend="block"/>
                    </ab>
                    <p>O conteúdo de <code rend="inline">palavras_tristeza</code> nos indica que esta lista não diz muito, pois retorna apenas a listagem de palavras sem maiores informações. Para obter a contagem das vezes que cada palavra relacionada à tristeza aparece no romance, geramos uma tabela do primeiro conjunto de caracteres com as funções <code rend="inline">unlist</code>  e <code rend="inline">table</code>, que depois ordenamos em ordem decrescente (se quisermos uma ordem ascendente mudamos TRUE para FALSE); criamos um novo objeto de tipo tabela e imprimimos as primeiras 12 palavras da lista com sua frequência:</p>
                    <ab>
                        <code lang="language-R" xml:id="code_analise-sentimento-R-syuzhet_16" corresp="code_analise-sentimento-R-syuzhet_16.txt" rend="block"/>
                    </ab>
                    <p>Se quisermos saber quantas palavras únicas foram relacionadas à tristeza, basta usar a função <code rend="inline">length</code> no objeto que agora agrupa as palavras em ordem:</p>
                    <ab>
                        <code lang="language-R" xml:id="code_analise-sentimento-R-syuzhet_17" corresp="code_analise-sentimento-R-syuzhet_17.txt" rend="block"/>
                    </ab>
                    <p>Podemos repetir a mesma operação com o resto das emoções ou com aquela que nos interessa, assim como com os sentimentos positivos e negativos. Tente obter os resultados para a emoção “alegria” e compare os resultados <ref type="footnotemark" target="#pt_note_2"/>.</p>
                    <p>Dependendo do tipo de análise que se deseje fazer, tal resultado é eficiente. Agora, para o propósito introdutório da lição, vamos gerar uma nuvem de palavras que ajuda a visualizar facilmente os termos associados a cada emoção (embora iremos visualizar aqui apenas quatro para facilitar a leitura).</p>
                </div>
                <div type="3">
                    <head>Nuvem de emoções</head>
                    <p>A fim de gerar uma nuvem com as palavras que correspondem a cada emoção em <emph>Dom Casmurro</emph>, criaremos primeiro um vetor no qual armazenaremos todas as palavras que, nas colunas que indicamos após o símbolo <code rend="inline">$</code>, têm um valor maior que 0. É gerado um novo objeto do tipo vetor, que contém um elemento para a lista de cada emoção.</p>
                    <p>Neste caso, devemos indicar novamente à função que temos caracteres acentuados se for uma máquina Windows.</p>
                    <p>
                        <hi rend="bold">Em Mac e Linux</hi>
                    </p>
                    <ab>
                        <code lang="language-R" xml:id="code_analise-sentimento-R-syuzhet_18" corresp="code_analise-sentimento-R-syuzhet_18.txt" rend="block"/>
                    </ab>
                    <p>
                        <hi rend="bold">Em Windows</hi>
                    </p>
                    <p>Uma vez gerado o vetor, deve convertê-lo em caracteres UTF-8 utilizando a função <code rend="inline">iconv</code>.</p>
                    <ab>
                        <code lang="language-R" xml:id="code_analise-sentimento-R-syuzhet_19" corresp="code_analise-sentimento-R-syuzhet_19.txt" rend="block"/>
                    </ab>
                    <p>Agora que temos o vetor, criamos um <emph>corpus</emph> de palavras com quatro “documentos” para a nuvem:</p>
                    <ab>
                        <code lang="language-R" xml:id="code_analise-sentimento-R-syuzhet_20" corresp="code_analise-sentimento-R-syuzhet_20.txt" rend="block"/>
                    </ab>
                    <p>Em seguida, transformamos este corpus em uma matriz termo-documento com a função <code rend="inline">TermDocumentMatrix()</code>. Com isto, agora usamos a função <code rend="inline">as.matrix()</code> para converter o TDM em uma matriz que, como podemos ver, lista os termos no texto com um valor maior que zero para cada uma das quatro emoções que extraímos aqui. Para ver o início desta informação, use novamente a função <code rend="inline">head</code>:</p>
                    <ab>
                        <code lang="language-R" xml:id="code_analise-sentimento-R-syuzhet_21" corresp="code_analise-sentimento-R-syuzhet_21.txt" rend="block"/>
                    </ab>
                    <p>Agora, atribua um nome a cada um dos grupos de palavras ou documentos (<emph>Docs</emph>) em nossa matriz. Aqui vamos usar o termo em português para as colunas que selecionamos para exibir na nuvem. Mais uma vez, podemos ver a mudança feita ao executar a função <code rend="inline">head</code>.</p>
                    <ab>
                        <code lang="language-R" xml:id="code_analise-sentimento-R-syuzhet_22" corresp="code_analise-sentimento-R-syuzhet_22.txt" rend="block"/>
                    </ab>
                    <p>Finalmente, podemos visualizar a nuvem de palavras que estamos acostumados a ver na mídia ou em estudos académicos. O tamanho e a localização da palavra correspondem à sua maior ou menor ocorrência com valor emocional atribuído no texto. Primeiro, executamos a função <code rend="inline">set.seed()</code> para que quando reproduzirmos o resultado visual seja o mesmo que o nosso (se não o fizer, será o mesmo, mas as palavras aparecerão em posições diferentes). E, para gerar a nuvem, vamos usar a função <code rend="inline">comparison.cloud</code> do pacote <code rend="inline">wordcloud</code>. Indicamos o objeto a representar, aqui ‘nuvem_tdm’, indicamos uma ordem não aleatória das palavras, atribuímos uma cor para cada grupo de palavras e damos tamanhos ao título e à escala geral, e atribuímos um número máximo de termos que serão exibidos.</p>
                    <ab>
                        <code lang="language-R" xml:id="code_analise-sentimento-R-syuzhet_23" corresp="code_analise-sentimento-R-syuzhet_23.txt" rend="block"/>
                    </ab>
                    <p>O resultado deve ser semelhante à imagem abaixo, mas a localização das palavras pode ser diferente uma vez que a figura é gerada segundo o tamanho da tela:</p>
                    <figure>
                        <figDesc>Nuvem das palavras mais frequentes correspondentes às emoções de tristeza, felicidade, raiva e confiança no romance Dom Casmurro de Machado de Assis.</figDesc>
                        <graphic url="/images/analisis-de-sentimientos-r/analise-sentimento-R-syuzhet-02.png"/>
                    </figure>
                    <p>O que sugere o resultado desta nuvem? Ficamos impressionados com o aparecimento de palavras como “entre” no conjunto da tristeza e “cavalo” no conjunto da raiva. Este “disparate” está relacionado com o aviso já anunciado no início da lição. O vocabulário para análise de sentimentos que estamos usando aqui é traduzido do inglês, um tradutor automático que não é “perfeito”.</p>
                </div>
            </div>
            <div type="2">
                <head>Visualizando a evolução dos sentimentos em um texto</head>
                <p>Para complementar a leitura isolada das emoções, estudando a flutuação dos sentimentos positivos e negativos ao longo de um texto, há uma maneira de normalizar e visualizar estas informações. Como a análise da função de extração de sentimento atribui um valor positivo tanto ao sentimento positivo quanto ao negativo, precisamos gerar dados entre um intervalo de -1 para o momento mais negativo e 1 para o mais positivo, e onde 0 é neutro. Para isso, calculamos a valência do texto multiplicando os valores na coluna de valores negativos de nosso <emph>data frame</emph> com os resultados por -1 e adicionamos o valor na coluna de valores positivos.</p>
                <ab>
                    <code lang="language-R" xml:id="code_analise-sentimento-R-syuzhet_24" corresp="code_analise-sentimento-R-syuzhet_24.txt" rend="block"/>
                </ab>
                <p>Finalmente, podemos gerar um gráfico com a função <code rend="inline">simple_plot()</code> integrada no pacote <code rend="inline">syuzhet</code>, que nos dará duas imagens diferentes; a primeira, tem todas as medidas que o algoritmo calcula e, a segunda, é uma normalização das mesmas. O eixo horizontal apresenta o texto em 100 fragmentos normalizados e o eixo vertical nos informa sobre a valência do sentimento no texto. Dependendo das características de seu computador, este gráfico pode levar até 20-30 minutos para ser gerado.</p>
                <ab>
                    <code lang="language-R" xml:id="code_analise-sentimento-R-syuzhet_25" corresp="code_analise-sentimento-R-syuzhet_25.txt" rend="block"/>
                </ab>
                <quote>
                    <p>Assegure-se de possuir espaço suficiente no espaço de visualização de gráficos do R para que ele seja gerado. Caso contrário, aparecerá o erro: <emph>Error in plot.new() : figure margins too large</emph>
                    </p>
                </quote>
                <figure>
                    <figDesc>Evolução das emoções ao longo do texto</figDesc>
                    <graphic url="/images/analisis-de-sentimientos-r/analise-sentimento-R-syuzhet-03.png"/>
                </figure>
                <p>Assim, neste caso, podemos interpretar que o romance <emph>Dom Casmurro</emph> varia bastante entre momentos positivos e negativos. Começa de forma mais negativa, fica mais positivo, sendo seguido por um novo momento negativo e um segundo positivo (porém menos do que o primeiro) para um desfecho negativo. Qualquer pessoa que tenha lido o romance pode confirmar esta variação de sentimentos vivida pelo protagonista.</p>
                <div type="3">
                    <head>Salvar seus dados</head>
                    <p>Se quiser salvar seus dados para retornar a eles mais tarde, é possível fazê-lo em um ficheiro de valores separados por vírgula (CSV) com a função <code rend="inline">write.csv()</code>. Aqui dizemos para salvar o <emph>data frame</emph>, que contém o resultado das oito emoções e os dois sentimentos de texto em um ficheiro com uma extensão <code rend="inline">.csv</code>. Além disso, podemos acrescentar a palavra à qual cada linha de resultados corresponde, em uma coluna à esquerda usando a palavra vetor feita no início da análise.</p>
                    <ab>
                        <code lang="language-R" xml:id="code_analise-sentimento-R-syuzhet_26" corresp="code_analise-sentimento-R-syuzhet_26.txt" rend="block"/>
                    </ab>
                    <p>Agora, pode começar a analisar seus próprios textos e compará-los uns com os outros!</p>
                </div>
            </div>
            <head>Outras funcionalidades e suas limitações</head>
            <p>Talvez esteja trabalhando em um projeto onde já tem um dicionário de sentimentos criado, ou talvez precise personalizar o vocabulário e sua valência sentimental por razões culturais ou temporais, ou talvez esteja procurando melhorar os resultados traduzidos automaticamente do NRC usado aqui. Em qualquer um destes casos, a partir do final de 2020, também é possível usar o seu próprio conjunto de dados no <emph>script</emph> graças à função <code rend="inline">custom</code> e realizar algumas das operações que foram aprendidas nesta lição.</p>
            <p>Para carregar seu próprio “dicionário de sentimentos”, é preciso primeiro criar (ou modificar) uma tabela contendo, pelo menos, uma coluna para palavras e uma coluna para sua valência, por exemplo:</p>
            <table>
                <row>
                    <cell role="label">word</cell>
                    <cell role="label">value</cell>
                </row>
                <row>
                    <cell>amor</cell>
                    <cell>1</cell>
                </row>
                <row>
                    <cell>cólera</cell>
                    <cell>-1</cell>
                </row>
                <row>
                    <cell>tapete</cell>
                    <cell>0</cell>
                </row>
                <row>
                    <cell>catástrofe</cell>
                    <cell>-2</cell>
                </row>
            </table>
            <p>Em seguida, carregue os seus dados salvos como um CSV com a função <code rend="inline">read.csv</code>, que criará um novo conjunto disponível como <code rend="inline">data.frame</code>, no qual é possível verificar seu texto:</p>
            <ab>
                <code lang="language-R" xml:id="code_analise-sentimento-R-syuzhet_27" corresp="code_analise-sentimento-R-syuzhet_27.txt" rend="block"/>
            </ab>
            <p>Se quiser visualizar o progresso do sentimento ao longo de seu texto, podemos usar a função <code rend="inline">plot</code> com outros parâmetros que já vimos:</p>
            <ab>
                <code lang="language-R" xml:id="code_analise-sentimento-R-syuzhet_28" corresp="code_analise-sentimento-R-syuzhet_28.txt" rend="block"/>
            </ab>
            <p>Entretanto, tenha em mente que esta forma de análise será limitada e não será possível realizar as mesmas operações como explicado acima. Por exemplo, seguindo o modelo do exemplo, não conseguimos as informações sobre emoções, portanto não somos capazes de fazer uma nuvem de palavras.</p>
            <div type="2">
                <head>Referências</head>
                <p>Assis, Machado de. <emph>Dom Casmurro</emph>. São Paulo: Editora Ática, 1996.</p>
                <p>Jockers, Matthew L. <emph>Syuzhet: Extract Sentiment and Plot Arcs from Text</emph>, 2015. <ref target="https://github.com/mjockers/syuzhet">https://github.com/mjockers/syuzhet</ref>
                </p>
                <p>Jockers, Matthew L. "Introduction to the Syuzhet Package", CRAN R Project, 2017. <ref target="https://mran.microsoft.com/snapshot/2017-12-31/web/packages/syuzhet/vignettes/syuzhet-vignette.html">https://mran.microsoft.com/snapshot/2017-12-31/web/packages/syuzhet/vignettes/syuzhet-vignette.html</ref>
                </p>
                <p>Damasio, Antonio R. <emph>El error de Descartes: La razón de las emociones</emph>. Barcelona: Andres Bello, 1999.</p>
                <p>Mohammad, Saif, and Peter D. Turney. "Crowdsourcing a Word–Emotion Association Lexicon". <emph>Computational intelligence</emph> 29 (2013): 436-465, doi: 10.1111/j.1467-8640.2012.00460.x</p>
                <p>Pereira Zazo, Óscar. <emph>El analisis de la comunicación en español</emph>. Iowa: Kendal Hunt, 2015.</p>
                <p>Rodríguez Aldape, Fernando Manuel. <emph>Cuantificación del Interés de un usuario en un tema mediante minería de texto y análisis de sentimiento.</emph> Tese de Mestrado, Universidad Autónoma de Nuevo León, 2013.</p>
            </div>
            <div type="2">
                <head>Notas</head>
                <p>
                    <ref type="footnotemark" target="#pt_note_1"/> :Agradecemos Mounika Puligurthi, estagiária da Universidade do Texas (UT), pelo seu auxílio na compreensão deste cálculo (durante a primavera de 2019).</p>
                <p>
                    <ref type="footnotemark" target="#pt_note_2"/> :Perceba que a palavra “amor”, por exemplo, aparece em ambas as emoções com um valor de 20 pontos. O que será que isso significa?</p>
            </div>
        </body>
    </text>
</TEI>
